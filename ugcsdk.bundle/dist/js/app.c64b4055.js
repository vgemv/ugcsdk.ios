(function(e){function t(t){for(var n,s,o=t[0],c=t[1],l=t[2],d=0,f=[];d<o.length;d++)s=o[d],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&f.push(i[s][0]),i[s]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);u&&u(t);while(f.length)f.shift()();return a.push.apply(a,l||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,o=1;o<r.length;o++){var c=r[o];0!==i[c]&&(n=!1)}n&&(a.splice(t--,1),e=s(s.s=r[0]))}return e}var n={},i={app:0},a=[];function s(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=n,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;a.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";var n=r("85ec"),i=r.n(n);i.a},"0f20":function(e,t,r){"use strict";var n=r("1d3d"),i=r.n(n);i.a},1:function(e,t){},"153c":function(e,t,r){},1541:function(e,t,r){},"1a95":function(e,t,r){},"1b2d":function(e,t,r){},"1d3d":function(e,t,r){},"1fb3":function(e,t,r){"use strict";var n=r("1b2d"),i=r.n(n);i.a},2119:function(e,t,r){},"21aa":function(e,t,r){},"21ba":function(e,t,r){"use strict";var n=r("2ea9"),i=r.n(n);i.a},"25aa":function(e,t,r){},"2aa2":function(e,t,r){},"2ea9":function(e,t,r){},"2fb0":function(e,t,r){},"32a2":function(e,t,r){"use strict";(function(e){r("4160"),r("c975"),r("a15b"),r("fb6a"),r("a434"),r("d3b7"),r("ac1f"),r("25f0"),r("466d"),r("5319"),r("1276"),r("498a"),r("159b");function n(t,r,n){if(r.trim()){var i={font:"18px Arial, sans-serif",sizeToFill:!1,maxFontSizeToFill:!1,lineHeight:1,allowNewLine:!0,lineBreak:"none",textAlign:"left",verticalAlign:"top",justifyLines:!1,paddingX:0,paddingY:0,fitParent:!1,strokeText:!1,renderHDPI:!0,textDecoration:"none",lineWidth:.02,shadowBlur:.5},a={};for(var s in i)a[s]=n.hasOwnProperty(s)?n[s]:i[s];var o=t.getContext("2d");o.font=a.font;var c=1.1,l="undefined"!==typeof e?e.devicePixelRatio:window.devicePixelRatio;if(a.renderHDPI&&l>1){var u={};for(var d in o)u[d]=o[d];var f=t.width,p=t.height;for(var m in c=l,t.width=f*c,t.height=p*c,t.style.width=f*c*.5+"px",t.style.height=p*c*.5+"px",u)try{o[m]=u[m]}catch(H){}o.scale(c,c)}var h,v=(a.fitParent?t.parentNode.clientWidth:t.width)/c,g=(a.fitParent?t.parentNode.clientHeight:t.height)/c,b=v-2*a.paddingX,y=g-2*a.paddingY,_="none"===a.lineBreak.toLocaleLowerCase()?"":/\s+/,x=a.font.match(/\d+(px|em|%)/g)?+a.font.match(/\d+(px|em|%)/g)[0].match(/\d+/g):18,w=0,k=[],T=[],R={x:0,y:0},O=0,C="​";return r=P(r),A(x),I(),N(),S(),k}function P(e){do{e=e.replace(/\n\n/g,"\n"+C+"\n")}while(e.indexOf("\n\n")>-1);return e}function A(e){h||(h=a.sizeToFill?o.font.split(/\b\d+px\b/i):a.font.split(/\b\d+px\b/i)),o.font=h[0]+e+"px"+h[1],o.lineWidth=e*a.lineWidth,o.shadowBlur=e*a.shadowBlur}function I(){isNaN(a.lineHeight)?-1!==a.lineHeight.toString().indexOf("px")?O=parseInt(a.lineHeight):-1!==a.lineHeight.toString().indexOf("%")&&(O=parseInt(a.lineHeight)/100*x):O=x*a.lineHeight}function S(){if(a.sizeToFill){var e=r.trim().split(_).length,t=0,n=!1!==a.maxFontSizeToFill;do{if(n){if(!(++t<=a.maxFontSizeToFill))break;j(t)}else j(++t)}while(w<y&&k.join(_?" ":"").split(_).length==e);j(--t)}else E();a.justifyLines&&"word"!==a.lineBreak&&D(),B(),U(),F()}function j(e){A(e),O=e,E()}function E(){if(a.allowNewLine)for(var e=r.trim().split("\n"),t=0,n=0;t<e.length-1;t++)n+=e[t].trim().split(_).length,T.push(n);var i=r.trim().split(_);$(i),M(i),w=k.length*O}function $(e){var t,r,n,i;e.forEach((function(a,s){if(t="",r=o.measureText(a).width,r>b){for(var c=0;o.measureText(t+a[c]).width<=b&&c<a.length;c++)t+=a[c];n=a.slice(0,c),i=a.slice(c),e.splice(s,1,n,i)}}))}function M(e){k=[];for(var t=0,r=0;t<e.length;r++)if(k[r]="","word"!==a.lineBreak){if(o.measureText(k[r]+e[t]).width>b)break;while(o.measureText(k[r]+e[t]).width<=b&&t<e.length)if(k[r]+=e[t]+(_?" ":""),t++,a.allowNewLine)for(var n=0;n<T.length;n++)if(T[n]===t){r++,k[r]="";break}k[r]=_?k[r].trim():k[r]}else k[r]=e[t],t++}function D(){for(var e,t,r,n,i,a,s,c,l=0;l<k.length;l++)r=o.measureText(k[l]).width,(!e||r>e)&&(e=r,t=l);for(var u=" ",d=0;d<k.length;d++)if(d!==t&&(n=k[d].trim().split(_).length,!(n<=1))){k[d]=k[d].trim().split(_).join(u),i=o.measureText(u).width,a=(e-o.measureText(k[d]).width)/i,s=a/(n-1),c="";for(var f=0;f<s;f++)c+=u;k[d]=k[d].trim().split(u).join(c)}}function L(e,t,r){var n=o.measureText(e).width;switch(o.textAlign){case"center":t-=n/2;break;case"right":t-=n;break}o.beginPath(),o.moveTo(t,r),o.lineTo(t+n,r),o.stroke()}function F(){for(var e=C+(_?" ":""),t=0;t<k.length;t++)R.y=parseInt(R.y)+O,k[t]!==e&&(o.fillText(k[t],R.x,R.y),a.strokeText&&o.strokeText(k[t],R.x,R.y),"underline"===a.textDecoration.toLocaleLowerCase()&&L(k[t],R.x,R.y))}function U(){o.textAlign=a.textAlign,"center"==a.textAlign?R.x=v/2:"right"==a.textAlign?R.x=v-a.paddingX:R.x=a.paddingX}function B(){"middle"==a.verticalAlign?R.y=(g-w)/2:"bottom"==a.verticalAlign?R.y=g-w-a.paddingY:R.y=a.paddingY}function N(){if("string"!==typeof r)throw new TypeError("The second parameter must be a String.");if(isNaN(x))throw new TypeError('Cannot parse "font".');if(isNaN(O))throw new TypeError('Cannot parse "lineHeight".');if("left"!==a.textAlign.toLocaleLowerCase()&&"center"!==a.textAlign.toLocaleLowerCase()&&"right"!==a.textAlign.toLocaleLowerCase()&&"top"!==a.textAlign.toLocaleLowerCase())throw new TypeError('Property "textAlign" must be set to either "left", "center", "right, or "top".');if("top"!==a.verticalAlign.toLocaleLowerCase()&&"middle"!==a.verticalAlign.toLocaleLowerCase()&&"bottom"!==a.verticalAlign.toLocaleLowerCase())throw new TypeError('Property "verticalAlign" must be set to either "top", "middle", or "bottom".');if("boolean"!==typeof a.justifyLines)throw new TypeError('Property "justifyLines" must be a Boolean.');if(isNaN(a.paddingX))throw new TypeError('Property "paddingX" must be a Number.');if(isNaN(a.paddingY))throw new TypeError('Property "paddingY" must be a Number.');if("boolean"!==typeof a.fitParent)throw new TypeError('Property "fitParent" must be a Boolean.');if("auto"!==a.lineBreak.toLocaleLowerCase()&&"word"!==a.lineBreak.toLocaleLowerCase()&&"none"!==a.lineBreak.toLocaleLowerCase())throw new TypeError('Property "lineBreak" must be set to either "auto", "none" or "word".');if("boolean"!==typeof a.sizeToFill)throw new TypeError('Property "sizeToFill" must be a Boolean.');if("boolean"!==typeof a.strokeText)throw new TypeError('Property "strokeText" must be a Boolean.');if("boolean"!==typeof a.renderHDPI)throw new TypeError('Property "renderHDPI" must be a Boolean.');if("none"!==a.textDecoration.toLocaleLowerCase()&&"underline"!==a.textDecoration.toLocaleLowerCase())throw new TypeError('Property "textDecoration" must be set to either "none" or "underline".')}}t["a"]=n}).call(this,r("c8ba"))},"376e":function(e,t,r){"use strict";var n=r("baa8"),i=r.n(n);i.a},"3c38":function(e,t,r){"use strict";var n=r("6345"),i=r.n(n);i.a},"3cd8":function(e,t,r){},"3d18":function(e,t,r){},"407b":function(e,t,r){"use strict";var n=r("1a95"),i=r.n(n);i.a},4251:function(e,t,r){"use strict";var n=r("be7d"),i=r.n(n);i.a},"435b":function(e,t,r){"use strict";var n=r("e5dd"),i=r.n(n);i.a},"480c":function(e,t,r){},"507c":function(e,t,r){},"51dc":function(e,t,r){},"532f":function(e,t,r){"use strict";var n=r("2119"),i=r.n(n);i.a},"56d7":function(e,t,r){"use strict";r.r(t);r("96cf");var n,i=r("1da1"),a=(r("e260"),r("e6cf"),r("cca6"),r("a79d"),r("2b0e")),s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("Main")],1)},o=[],c=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"main"},[r("div",{directives:[{name:"show",rawName:"v-show",value:!e.makePoster&&!e.makeEnding&&!e.doExport,expression:"!makePoster&&!makeEnding&&!doExport"}],staticClass:"main-maker"},[r("ClipTop",{ref:"top",attrs:{overrideBackbutton:!e.doExport&&!e.makePoster&&!e.makeEnding},on:{export:function(t){e.doExport=!0}}}),r("div",{ref:"mainBox",staticClass:"main-box"},[r("PreviewPlayer",{ref:"preview",staticClass:"main-video",attrs:{pause:e.player.pause||e.doExport},on:{finished:e.playerFinished,loading:function(t){e.player.loading=!0},loaddone:e.previewLoaddone,resize:function(t){!e.makePoster&&!e.makeEnding&&e.doExport},render:function(t){e.preview_render=!0}}}),r("OverlayEditor",{ref:"overlayEditor",staticClass:"overlay-box",on:{change:e.overlayEditorChange,overlayActive:e.overlayActive,overlayDeactive:e.overlayDeactive}})],1),r("div",{ref:"toolBox",staticClass:"toolBox"},[r("PlayerController",{directives:[{name:"show",rawName:"v-show",value:e.showPlayerController,expression:"showPlayerController"}],attrs:{playing:!e.player.pause,loading:e.player.loading},on:{event:e.playerControllerEvent}}),r("ClipTimeline",{directives:[{name:"show",rawName:"v-show",value:e.showTimeline,expression:"showTimeline"}],ref:"timeline",attrs:{show_overlay:e.showOverlay,overlay_type:e.overlayType,show_amix:e.showAMix,playing:!e.player.pause,poster:e.editlist.poster,preview_render:e.preview_render,player:e.$refs.preview},on:{timelinesChange:e.timelinesChange,timeChange:e.timeChange,overlayChange:e.overlayChange,overlayActive:e.overlayActive,amixChange:e.amixChange,amixActive:e.amixActive,on_poster_click:function(t){e.makePoster=1},on_ending_click:function(t){e.makeEnding=1}}}),r("ToolTab",{directives:[{name:"show",rawName:"v-show",value:e.showTooltab,expression:"showTooltab"}],ref:"toolTab",attrs:{activeItem:e.activeItem},on:{select:e.tabSelect}}),r("ToolDialog",{ref:"toolDlg",on:{close:function(t){e.showTooltab=e.showPlayerController=e.showTimeline=!0,e.mainBoxResized()},beforechange:e.toolBeforeChange,change:e.toolValueChange}})],1),e.importProgress>=0?r("div",{staticClass:"spin"},[r("div",[r("mu-circular-progress",{attrs:{mode:"determinate",value:100*e.importProgress}}),r("br"),r("span",{staticStyle:{"font-size":"14px"}},[e._v("导入中 "+e._s((100*e.importProgress).toFixed(2))+"%")])],1)]):e._e()],1),e.makePoster?r("PosterMaker",{on:{close:function(t){e.makePoster=!1,e.reloadPlayer(!0)}}}):e._e(),e.makeEnding?r("EndingMaker",{on:{close:function(t){e.makeEnding=!1,e.reloadPlayer()}}}):e._e(),e.doExport?r("Exporter",{ref:"exporter",on:{close:function(t){e.doExport=!1,e.isBackbuttonExit=!0,e.reloadPlayer()}}}):e._e(),r("Importer",{ref:"importer",on:{select:e.importFileSelect,progress:function(t){e.importProgress=t},cancel:e.importCancel}}),r("vue-snotify")],1)},l=[],u=(r("99af"),r("c740"),r("4160"),r("c975"),r("d81d"),r("13d5"),r("a434"),r("4057"),r("b680"),r("b64b"),r("d3b7"),r("07ac"),r("ac1f"),r("3ca3"),r("5319"),r("159b"),r("ddb0"),r("2909")),d=r("ade3"),f=r("5530"),p=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("NativeVideo",{ref:"video",on:{resize:function(t){return e.$emit("resize")},meta:function(t){return e.$emit("render")},playing:function(t){return e.$emit("playing",t)},finished:function(t){return e.$emit("finished")},render:function(t){return e.$emit("render")},loading:function(t){return e.$emit("loading")},loaddone:function(t){return e.$emit("loaddone")},timeupdate:function(t){return e.$emit("timeupdate",t)}}})},m=[],h=(r("ef1c"),r("6283"),r("ee2a"),r("c1cc"),r("dba6"),r("93b8"),r("f200"),r("47e2"),r("fd96"),r("8a22"),r("822a"),r("6de3"),r("f4c5"),r("54d2"),r("bf06"),r("ebaa"),r("5c43"),r("e508"),r("5d8f"),r("e9a4"),r("d2f3"),r("d0d9"),r("de90"),r("e8d5"),r("0623"),r("6906"),r("f9a5")),v=r.n(h),g=r("8a64"),b=r.n(g),y=(r("5140"),{Overlay:{Type:{Image:1<<(n=1),Text:1<<++n,Mosic:1<<++n},Align:{Left:n=0,Center:++n,Right:++n,Top:++n}}}),_=y,x=Math.random().toString().substr(2,8),w={debug:1,verbose:2,info:3,warn:4,error:5,silent:6},k=w.info,T={Level:w,verbose:function(){k>w.verbose||window.console.debug.apply(window.console,arguments)},info:function(){k>w.info||window.console.info.apply(window.console,arguments)},warn:function(){k>w.warn||window.console.warn.apply(window.console,arguments)},error:function(){k>w.error||window.console.error.apply(window.console,arguments)},uilog:function(e,t){k>w.info||window.console.log("[ugcsdk.uipath](".concat(x,":").concat(e,"): ").concat(t))},set loglevel(e){k=e},get loglevel(){return k}},R=T,O=!1;window.clearAllCache=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise(window.requestFileSystem.bind(window,window.TEMPORARY,0));case 2:return t=e.sent,e.next=5,new Promise(t.root.getDirectory.bind(t.root,"ugc_res",{}));case 5:return r=e.sent,e.next=8,new Promise(r.removeRecursively.bind(r));case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})));var C={remoteResRoot:"file:"==location.protocol?"http://zb.vgemv.com/app_download/ugc/sdk/resource":"ugc",localResRoot:"ugc_res",assetResRoot_android:"jsugcsdk_www/dist/ugc",assetResRoot_ios:"ugcsdk.bundle/dist/ugc",get assetResRoot(){return j.isIOS()?cordova.file.applicationDirectory+this.assetResRoot_ios:cordova.file.applicationDirectory+this.assetResRoot_android},ResType:{image:"image",music:"music",audio:"audio",filter:"filter",font:"font",fontbg:"fontbg",mosic:"mosic"},get remoteResRootJson(){return this.remoteResRoot+"/res.json"},get assetResRootJson(){return this.assetResRoot+"/res.json"},tempFs:null,folders:{},filesystem:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.tempFs){t.next=4;break}return t.next=3,new Promise(window.requestFileSystem.bind(window,window.TEMPORARY,5242880));case 3:e.tempFs=t.sent;case 4:return t.abrupt("return",e.tempFs);case 5:case"end":return t.stop()}}),t)})))()},remoteRel2Abs:function(e,t){return this.remoteResRoot+(e?"/"+e:"")+(t?"/"+t:"")},localRel2Abs:function(e,t){return this.localResRoot+(e?"/"+e:"")+(t?"/"+t:"")},assetRel2Abs:function(e,t){return this.assetResRoot+(e?"/"+e:"")+(t?"/"+t:"")},assetReadText:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,new Promise(window.resolveLocalFileSystemURL.bind(window,e));case 2:return r=t.sent,t.next=5,new Promise(r.file.bind(r));case 5:return n=t.sent,i=new FileReader,t.next=9,new Promise((function(e,t){i.onload=e,i.onerror=t,i.readAsText(n)}));case 9:return a=t.sent.target.result,t.abrupt("return",a);case 11:case"end":return t.stop()}}),t)})))()},assetReadAsDataUrl:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,new Promise(window.resolveLocalFileSystemURL.bind(window,e));case 2:return r=t.sent,t.next=5,new Promise(r.file.bind(r));case 5:return n=t.sent,i=new FileReader,t.next=9,new Promise((function(e,t){i.onload=e,i.onerror=t,i.readAsDataURL(n)}));case 9:return a=t.sent.target.result,t.abrupt("return",a);case 11:case"end":return t.stop()}}),t)})))()},md5source:function(e){return b()(e.split(".").slice(0,-1).join("."))+"."+e.split(".").reverse()[0]},getFolder:function(e,t){var r=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var i,a,s,o,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,r.filesystem();case 2:if(i=n.sent,t=r.localRel2Abs(e,t),!r.folders[t]){n.next=6;break}return n.abrupt("return",r.folders[t]);case 6:s=t.split("/"),o=0;case 8:if(!(o<=s.length)){n.next=17;break}return c=s.slice(0,o).join("/"),n.next=12,new Promise(i.root.getDirectory.bind(i.root,c,{create:!0}));case 12:a=n.sent,r.folders[c]=a;case 14:o++,n.next=8;break;case 17:return n.abrupt("return",a);case 18:case"end":return n.stop()}}),n)})))()},getTempFolder:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.filesystem();case 2:if(r=t.sent,n=e.folders["ugc_temp"],n){t.next=8;break}return t.next=7,new Promise(r.root.getDirectory.bind(r.root,"ugc_temp",{create:!0}));case 7:n=t.sent;case 8:return t.abrupt("return",n);case 9:case"end":return t.stop()}}),t)})))()},getExportPosterFolder:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.filesystem();case 2:if(r=t.sent,n=e.folders["ugc_poster"],n){t.next=8;break}return t.next=7,new Promise(r.root.getDirectory.bind(r.root,"ugc_poster",{create:!0}));case 7:n=t.sent;case 8:return t.abrupt("return",n);case 9:case"end":return t.stop()}}),t)})))()},clearTempFiles:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i,a,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.filesystem();case 2:return n=r.sent,r.next=5,t.getTempFolder();case 5:return i=r.sent,r.next=8,new Promise(n.root.getDirectory.bind(n.root,"thumbs/",{create:!0}));case 8:if(a=r.sent,s=[new Promise(i.removeRecursively.bind(i)),new Promise(a.removeRecursively.bind(a))],!e){r.next=13;break}return r.next=13,Promise.all(s);case 13:case"end":return r.stop()}}),r)})))()},fetchAssetResList:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.t0=JSON,r.next=3,t.assetReadText(t.assetResRootJson);case 3:return r.t1=r.sent,n=r.t0.parse.call(r.t0,r.t1),r.t2=JSON,r.next=8,t.assetReadText(t.assetRel2Abs(n[e]));case 8:return r.t3=r.sent,i=r.t2.parse.call(r.t2,r.t3),i=i.map((function(r){return r.list?r.list=r.list.map((function(r){return r.source&&(r.source_asset_url=t.assetRel2Abs(e,r.source)),r.source_list&&(r.source_list_asset_url=r.source_list.map((function(r){return t.assetRel2Abs(e,r)}))),r})):r.source&&(r.source_asset_url=t.assetRel2Abs(e,r.source)),r})),r.abrupt("return",i);case 12:case"end":return r.stop()}}),r)})))()},fetchLocalResList:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a,s,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(window.requestFileSystem){r.next=2;break}return r.abrupt("return",[]);case 2:return r.next=4,t.getFolder(e);case 4:return n=r.sent,a=n.createReader(),r.next=8,new Promise(a.readEntries.bind(a));case 8:return s=r.sent,r.next=11,Promise.all(s.map(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.isDirectory){e.next=8;break}return r=t.createReader(),e.next=4,new Promise(r.readEntries.bind(r));case 4:return n=e.sent,e.abrupt("return",Object(f["a"])({},t,{list:n}));case 8:return e.abrupt("return",t);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return o=r.sent,r.abrupt("return",o);case 13:case"end":return r.stop()}}),r)})))()},fetchRemoteResList:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,v.a.get(t.remoteResRootJson);case 2:return n=r.sent.data,r.next=5,v.a.get(t.remoteRel2Abs(n[e]));case 5:return i=r.sent.data,i=i.map((function(r){return r.list?r.list=r.list.map((function(r){return r.source&&(r.source_remote_url=t.remoteRel2Abs(e,r.source),r.download=null),r.source_list&&(r.source_list_remote_url=r.source_list.map((function(r){return t.remoteRel2Abs(e,r)})),r.download=null),r})):r.source&&(r.source_remote_url=t.remoteRel2Abs(e,r.source),r.download=null),r})),r.abrupt("return",i);case 8:case"end":return r.stop()}}),r)})))()},copyedResTypes:{},fetchResList:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i,a,s,o,c;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.fetchLocalResList(e);case 2:return n=r.sent,r.prev=3,r.next=6,t.fetchAssetResList(e);case 6:i=r.sent,r.next=12;break;case 9:r.prev=9,r.t0=r["catch"](3),R.warn("asset resource not found");case 12:if(r.prev=12,!O){r.next=17;break}r.t1=i,r.next=20;break;case 17:return r.next=19,t.fetchRemoteResList(e);case 19:r.t1=r.sent;case 20:a=r.t1,r.next=27;break;case 23:r.prev=23,r.t2=r["catch"](12),a=i,R.warn("remote resource not found");case 27:if(R.verbose("remote",a),R.verbose("local",n),R.verbose("asset",i),a){r.next=32;break}return r.abrupt("return");case 32:return s=[],o=function(r,a){var o=t.md5source(a.source),c=a.name;if(a.local_file=n.filter((function(e){return e.name==o}))[0],a.thumb_remote_url=t.remoteRel2Abs(e,a.thumb),a.thumb_rel_url="ugc/"+e+"/"+(a.thumb||""),a.source_list&&(a.local_file_list=a.source_list.map((function(e){var r=t.md5source(e);return n.filter((function(e){return e.name==r}))[0]}))),!a.local_file&&i&&!t.copyedResTypes[e]){var l=i.filter((function(e){return e.name==r&&e.list}))[0],u=l&&l.list.filter((function(e){return e.name==c}))[0]||i.filter((function(e){return e.name==c}))[0];u&&s.push(t.copyAssetRes(e,a,u))}return a},c=a.map((function(e){if(e.list){var r=e.name;e.list=e.list.flatMap(o.bind(t,r))}else o(null,e);return e})),Promise.all(s).then((function(){t.copyedResTypes[e]=!0})),r.abrupt("return",c);case 37:case"end":return r.stop()}}),r,null,[[3,9],[12,23]])})))()},createResFile:function(e,t){var r=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var i,a,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,r.filesystem();case 2:return i=n.sent,n.next=5,r.getFolder(e);case 5:return a=r.md5source(t),s=r.localRel2Abs(e,a),R.verbose("createResFile:",s),n.next=10,new Promise(i.root.getFile.bind(i.root,s,{create:!0}));case 10:return n.abrupt("return",n.sent);case 11:case"end":return n.stop()}}),n)})))()},downloadRes:function(e,t,r){var n=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var s,o,c,l,u;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=t.source_remote_url,t.download={percent:0},o=[0],c=1+(t.source_list&&t.source_list.length||0),a.next=6,n.createResFile(e,t.source);case 6:return l=a.sent,a.prev=7,a.next=10,n.download(s,l,(function(e){t.download.percent=e,o[0]=e,r&&r(o.reduce((function(e,t){return e+t}))/c)}));case 10:if(!t.source_list){a.next=15;break}return u=[],a.next=14,Promise.all(t.source_list_remote_url.map(function(){var a=Object(i["a"])(regeneratorRuntime.mark((function i(a,s){var l;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,n.createResFile(e,t.source_list[s]);case 2:return l=i.sent,i.prev=3,i.next=6,n.download(a,l,(function(e){return o[s+1]=e&&r&&r(o.reduce((function(e,t){return e+t}))/c)}));case 6:u.push(l),i.next=13;break;case 9:i.prev=9,i.t0=i["catch"](3),l.remove(),R.warn("download file failed:".concat(a));case 13:case"end":return i.stop()}}),i,null,[[3,9]])})));return function(e,t){return a.apply(this,arguments)}}()));case 14:t.local_file_list=u;case 15:return delete t.download,t.local_file=l,a.abrupt("return",l);case 20:throw a.prev=20,a.t0=a["catch"](7),l.remove(),t.download=null,R.warn("download file failed:".concat(s)),a.t0;case 26:case"end":return a.stop()}}),a,null,[[7,20]])})))()},download:function(e,t,r){return Object(i["a"])(regeneratorRuntime.mark((function n(){var a,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return R.info("begin download:".concat(e)),n.next=3,new Promise((function(t,n){var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="blob",a.onprogress=function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r&&r(t.loaded/t.total);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.onerror=n,a.onload=function(){200==this.status?t(this.response):n(this.status)},a.send()}));case 3:return a=n.sent,n.next=6,new Promise(t.createWriter.bind(t));case 6:return s=n.sent,n.next=9,new Promise((function(e,t){s.onwriteend=e,s.onerror=t,s.write(a)}));case 9:case"end":return n.stop()}}),n)})))()},copingAssetRes:{},copyAssetRes:function(e,t,r){var n=this;return Object(i["a"])(regeneratorRuntime.mark((function i(){var a,s;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(a=e+"_"+t.source+r.source,s=n.copingAssetRes[a],!s){i.next=4;break}return i.abrupt("return",s);case 4:return i.prev=4,s=n.copingAssetRes[a]=n.copyAssetResIntenal(e,t,r),i.next=8,s;case 8:return delete n.copingAssetRes[a],i.abrupt("return",s);case 12:throw i.prev=12,i.t0=i["catch"](4),delete n.copingAssetRes[a],R.warn("copy asset failed:".concat(a)),i.t0;case 17:case"end":return i.stop()}}),i,null,[[4,12]])})))()},copyAssetResIntenal:function(e,t,r){var n=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var s,o,c;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.download={percent:0},a.next=3,new Promise((function(e){return setTimeout(e,100)}));case 3:return a.next=5,n.createResFile(e,t.source);case 5:return s=a.sent,a.next=8,n.getFolder(e);case 8:return o=a.sent,a.prev=9,a.next=12,new Promise(s.remove.bind(s));case 12:a.next=16;break;case 14:a.prev=14,a.t0=a["catch"](9);case 16:return a.prev=16,a.next=19,new Promise(resolveLocalFileSystemURL.bind(null,r.source_asset_url));case 19:c=a.sent,a.next=27;break;case 22:return a.prev=22,a.t1=a["catch"](16),t.download=null,R.warn(r,"not found"),a.abrupt("return");case 27:return a.prev=27,a.next=30,new Promise(c.copyTo.bind(c,o,s.name));case 30:s=a.sent,a.next=35;break;case 33:a.prev=33,a.t2=a["catch"](27);case 35:if(t.local_file=s,t.download=null,!r.source_list_asset_url){a.next=41;break}return a.next=40,Promise.all(r.source_list_asset_url.map(function(){var a=Object(i["a"])(regeneratorRuntime.mark((function i(a,s){var o,c,l;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,n.createResFile(e,t.source_list[s]);case 2:return o=i.sent,i.next=5,new Promise(o.getParent.bind(o));case 5:return c=i.sent,i.prev=6,i.next=9,new Promise(o.remove.bind(o));case 9:i.next=13;break;case 11:i.prev=11,i.t0=i["catch"](6);case 13:return i.prev=13,i.next=16,new Promise(resolveLocalFileSystemURL.bind(null,a));case 16:l=i.sent,i.next=23;break;case 19:return i.prev=19,i.t1=i["catch"](13),R.verbose(r,"not found"),i.abrupt("return");case 23:return i.prev=23,i.next=26,new Promise(l.copyTo.bind(l,c,o.name));case 26:return i.abrupt("return",i.sent);case 29:return i.prev=29,i.t2=i["catch"](23),i.abrupt("return",o);case 32:case"end":return i.stop()}}),i,null,[[6,11],[13,19],[23,29]])})));return function(e,t){return a.apply(this,arguments)}}()));case 40:t.local_file_list=a.sent;case 41:case"end":return a.stop()}}),a,null,[[9,14],[16,22],[27,33]])})))()},getBeautySource:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.fetchResList(e.ResType.filter);case 2:return r=t.sent,n=r.find((function(e){return"美颜"==e.name})),t.abrupt("return",n.local_file.toNativeURL());case 5:case"end":return t.stop()}}),t)})))()},getMosicSource:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.fetchResList(e.ResType.filter);case 2:return r=t.sent,n=r.reduce((function(e,t){return e.concat(t.list||[])}),Object(u["a"])(r)).find((function(e){return"马赛克"==e.name})),t.abrupt("return",n.local_file.toNativeURL());case 5:case"end":return t.stop()}}),t)})))()},getTransformSource:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.fetchResList(e.ResType.filter);case 2:return r=t.sent,n=r.find((function(e){return"transform"==e.name})),t.abrupt("return",n.local_file.toNativeURL());case 5:case"end":return t.stop()}}),t)})))()},pickAudio:function(){return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise(UGCApp.pickAudio.bind(UGCApp));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()},_ending:null,getLastEnding:function(){try{return this._ending||JSON.parse(localStorage.getItem("last-ending"))}catch(e){return this._ending}},saveLastEnding:function(e){this._ending=e;try{localStorage.setItem("last-ending",JSON.stringify(e))}catch(t){}}},P=C,A=null,I=window.matchMedia("(orientation: portrait)"),S=navigator.userAgent.indexOf("(cordova)")>=0,j={isCordova:function(){return S},isIOS:function(){return navigator.userAgent.toLowerCase().indexOf("iphone")>=0},isAndroid:function(){return navigator.userAgent.toLowerCase().indexOf("android")>=0},isPortrait:function(e){return e&&(A&&I.removeListener(A),I.addListener(A=e)),I.matches},config:{noReady:!0,input:"",output:"",output_thumb:""},getConfig:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.config.noReady){t.next=5;break}return t.next=3,new Promise(UGCApp.getConfig);case 3:e.config=t.sent,R.verbose("config: ",e.config);case 5:return t.abrupt("return",e.config);case 6:case"end":return t.stop()}}),t)})))()},setConfig:function(e){this.config=e},StatusCode:{},finish:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,P.clearTempFiles();case 2:return t.next=4,UGCApp.ffplay.stop(!1);case 4:return t.next=6,new Promise(UGCApp.done.bind(UGCApp,e));case 6:case"end":return t.stop()}}),t)})))()},init:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.isCordova()&&!window.Cordova){t.next=2;break}return t.abrupt("return");case 2:return r=window.File,t.next=5,new Promise((function(t,r){var n=document.createElement("script");e.isAndroid()?n.src="cordova/android/cordova.js":e.isIOS()&&(n.src="cordova/ios/cordova.js"),n.onload=function(){document.addEventListener("deviceready",t)},n.onerror=r,document.head.appendChild(n)}));case 5:return window.File=r,e.StatusCode=UGCApp.StatusCode,t.next=9,e.getConfig();case 9:n=t.sent.loglevel,void 0!==n&&n>0&&(R.loglevel=n),R.info("cordova init finished");case 12:case"end":return t.stop()}}),t)})))()},getCdvUrl:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return 0==e.indexOf("http://localhost")&&(e=e.replace(/http:\/\/localhost:.*?\//,"cdvfile://localhost/")),0==e.indexOf("/")&&(e="file://"+e),t.next=4,new Promise((function(t,r){return resolveLocalFileSystemURL(e,(function(e){t(e.toInternalURL())}),(function(){r()}))}));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))()}};var E={blur:"avgblur",brown:"colorchannelmixer=.393:.769:.189:0:.349:.686:.168:0:.272:.534:.131",colorful:"geq=r='X/W*r(X,Y)':g='(1-X/W)*g(X,Y)':b='(H-Y)/H*b(X,Y)'",flash:"hue=H=2*PI*t:s=sin(2*PI*t)+1",oldfilm:"vignette='PI/4+random(1)*PI/50':eval=frame",line:"split[a][b],[a]curves=darker[a],[a][b]blend=all_expr='if(eq(0,mod(Y,2)),A,B)':shortest=1",red_border:"drawbox=color=red:t='min(iw,ih)/20'",pink_border:"drawbox=color=pink:t='min(iw,ih)/20'",black_border:"drawbox=color=black:t='min(iw,ih)/20'",colormix:"edgedetect=mode=colormix"},$={blur:"模糊",brown:"旧照片",colorful:"流光溢彩",flash:"闪光",oldfilm:"旧影片",line:"黑条纹",double:"双画面",red_border:"红框",pink_border:"粉框",black_border:"黑框",colormix:"彩绘"},M={auto:[0,0]};Number.prototype.toEven=function(){var e=+this.toFixed(0);return e%2!=0?e-1:e};var D=0,L=1;function F(e){return U.apply(this,arguments)}function U(){return U=Object(i["a"])(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.total_sec){e.next=2;break}return e.abrupt("return",t);case 2:return r=t.url,e.next=5,new Promise(UGCApp.ffmpeg.format.bind(null,r));case 5:if(n=e.sent,n.duration){e.next=8;break}throw new Error("导入失败，文件可能不存在或没有权限");case 8:return(90+n.video.rotate)%180==0&&(i=n.video.width,n.video.width=n.video.height,n.video.height=i),e.abrupt("return",{url:r,src_rotate:n.video.rotate,width:n.video.width,height:n.video.height,start_sec:0,end_sec:n.duration/1e3,total_sec:n.duration/1e3});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),U.apply(this,arguments)}var B={VFPreset:E,VFPresetName:$,DARPreset:M,editlist:{_time_sec:0,video_min_sec:.1,get time_sec(){return this._time_sec},set time_sec(e){this._time_sec=e,this._cur_timeline_id=this.get_cur_timeline_id()},_timelines:[],get_next_timelineId:function(){return++D},get timelines(){return this._timelines},set timelines(e){var t;D=e.reduce((function(e,t){return Math.max(e,t.id)}),D),(t=this._timelines).splice.apply(t,[0,this._timelines.length].concat(Object(u["a"])(e)))},get total_sec(){if(0==this.timelines.length)return 0;var e=this.timelines[0].end_sec-this.timelines[0].start_sec;return 1==this.timelines.length?e:[e].concat(Object(u["a"])(this.timelines.slice(1))).reduce((function(e,t){return e+t.end_sec-t.start_sec}))},_cur_timeline_id:-1,get cur_timeline_id(){return this._cur_timeline_id},get_cur_timeline_id:function(){for(var e,t=this.time_sec,r=0;r<this.timelines.length;r++)if(e=this.timelines[r],t<this.timelines[r].offset_sec+this.timelines[r].end_sec-this.timelines[r].start_sec)break;var n=-1;return e?n=e.id:this.timelines.length&&(n=this.timelines[0].id),n},cur_timeline:function(e){e&&(this._cur_timeline_id=this.get_cur_timeline_id());var t=this.cur_timeline_id,r=this.timelines.filter((function(e){return e.id==t}))[0];return r},add_timelines:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return R.verbose("add timelines:",e),r.next=3,F(e);case 3:e=r.sent,R.verbose("add timelines with format:",e),n=e.map((function(e){return Object(f["a"])({id:t.get_next_timelineId(),url:"",thumbs:[],active:!1,left_drag_offset:0,focus:!1,width:0,height:0,start_sec:0,offset_sec:0,end_sec:0,total_sec:0,rotate:0,vflip:0,hflip:0,eq:{brightness:0,contrast:1,saturation:1,gamma:1}},e)})),n=t.timelines.length&&t.timelines[t.timelines.length-1].ending?[].concat(Object(u["a"])(t.timelines.slice(0,t.timelines.length-1)),Object(u["a"])(n),[t.timelines[t.timelines.length-1]]):[].concat(Object(u["a"])(t.timelines),Object(u["a"])(n)),n.reduce((function(e,t,r){return 1==r&&(e.offset_sec=0,e=e.end_sec-e.start_sec),t.offset_sec=e,t.offset_sec+t.end_sec-t.start_sec})),t.timelines=n,t._cur_timeline_id=t.get_cur_timeline_id();case 10:case"end":return r.stop()}}),r)})))()},getRotatedWidth:function(e){return e.rotate%180==0?e.width:e.height},getRotatedHeight:function(e){return e.rotate%180==0?e.height:e.width},update_timelines:function(e){e||(e=this.timelines),e.reduce((function(e,t,r){return 1==r&&(e.offset_sec=0,e=e.end_sec-e.start_sec),t.offset_sec=e,t.offset_sec+t.end_sec-t.start_sec})),e.forEach((function(e,t){UGCApp.ffplay.command("sp|ugc_movie@master"+t,e.start_sec),UGCApp.ffplay.command("ep|ugc_movie@master"+t,e.end_sec)}))},update_timeline_videobase:function(e){var t=[-1].concat(Object(u["a"])(this.timelines)).reduce((function(t,r,n){return r.id==e.id?n-1:t}));UGCApp.ffplay.command("brightness|eq@master"+t,e.eq.brightness),UGCApp.ffplay.command("saturation|eq@master"+t,e.eq.saturation),UGCApp.ffplay.command("gamma|eq@master"+t,e.eq.gamma),UGCApp.ffplay.command("contrast|eq@master"+t,e.eq.contrast)},amix:[],add_amix:function(e){var t;return this.amix.push(t=Object(f["a"])({id:L++,new:!0,active:!1,offset_sec:this.time_sec,end_sec:5,url:e.local_file.toNativeURL().replace("file://","")},e)),t},update_amix:function(e){if(window.UGCApp){var t=this.amix.filter((function(t){return t.id==e.id}));t.length&&(t=t[0],UGCApp.ffplay.command("ep|ugc_movie@slave"+e.id,e.end_sec.toFixed(0)),UGCApp.ffplay.command("offset|ugc_movie@slave"+e.id,e.offset_sec.toFixed(0)),UGCApp.ffplay.command("visible|overlay_opengl@slave"+e.id,e.active?"0":"1"))}else window.console.log("no ugcapp")},overlay:[],add_overlay:function(e,t){var r,n=t?this.poster.overlay:this.overlay;return n.push(r=Object(f["a"])({id:L++,new:!0,x:0,y:0,w:0,h:0,rotate:0,active:!1,offset_sec:Math.max(0,this.time_sec-.05),end_sec:3,url:""},e)),R.verbose("add overlay:",r),r},update_overlay:function(e,t){var r=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var i,a,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=(t?r.poster.overlay:r.overlay).filter((function(t){return t.id==e.id})),i.length){n.next=5;break}return n.abrupt("return");case 5:i=i[0];case 6:return a=r.preview_resolution[0]/r.resolution_dar[0],s=[],s.push(B.ffplayCommand("w|overlay_opengl@slave"+e.id,(e.w*a).toEven())),s.push(B.ffplayCommand("h|overlay_opengl@slave"+e.id,(e.h*a).toEven())),s.push(B.ffplayCommand("a|overlay_opengl@slave"+e.id,e.rotate)),s.push(B.ffplayCommand("x|overlay_opengl@slave"+e.id,(e.x*a).toFixed(0))),s.push(B.ffplayCommand("y|overlay_opengl@slave"+e.id,(e.y*a).toFixed(0))),s.push(B.ffplayCommand("ep|ugc_movie@slave"+e.id,e.end_sec.toFixed(3))),s.push(B.ffplayCommand("offset|ugc_movie@slave"+e.id,e.offset_sec.toFixed(3))),s.push(B.ffplayCommand("visible|overlay_opengl@slave"+e.id,e.active?"0":"1")),n.next=18,Promise.all(s);case 18:R.verbose("update overlay:",e);case 19:case"end":return n.stop()}}),n)})))()},remove_overlay:function(e){if(this.overlay.filter((function(t){return t.id==e})).length){var t=[-1].concat(Object(u["a"])(this.overlay)).reduce((function(t,r,n){return r.id==e?n-1:t}));this.overlay.splice(t,1)}if(this.poster.overlay.filter((function(t){return t.id==e})).length){var r=[-1].concat(Object(u["a"])(this.poster.overlay)).reduce((function(t,r,n){return r.id==e?n-1:t}));this.poster.overlay.splice(r,1)}if(this.amix.filter((function(t){return t.id==e})).length){var n=[-1].concat(Object(u["a"])(this.amix)).reduce((function(t,r,n){return r.id==e?n-1:t}));this.amix.splice(n,1)}if(this.mosic.filter((function(t){return t.id==e})).length){var i=[-1].concat(Object(u["a"])(this.mosic)).reduce((function(t,r,n){return r.id==e?n-1:t}));this.mosic.splice(i,1)}},_transform_source:null,get transform_source(){return this._transform_source||""},set transform_source(e){this._transform_source=e},mosic:[],mosic_source:null,add_mosic:function(e){var t,r=this.mosic;return r.push(t=Object(f["a"])({id:L++,type:_.Overlay.Type.Mosic,new:!1,x:0,y:0,w:0,h:0,rotate:0,active:!1,offset_sec:Math.max(0,this.time_sec-.05),end_sec:3},e)),R.verbose("add mosic:",t),t},update_mosic:function(e){if(window.UGCApp){var t=this.mosic.filter((function(t){return t.id==e.id}));if(t.length){t=t[0];var r=this.preview_resolution[0]/this.resolution_dar[0];UGCApp.ffplay.command("rect|glfilter@mosic"+e.id,[(e.x*r).toFixed(0),(e.y*r).toFixed(0),(e.w*r).toFixed(0),(e.h*r).toFixed(0)].join(",")),UGCApp.ffplay.command("ep|glfilter@mosic"+e.id,e.end_sec.toFixed(3)),UGCApp.ffplay.command("offset|glfilter@mosic"+e.id,e.offset_sec.toFixed(3)),UGCApp.ffplay.command("percent|glfilter@mosic"+e.id,"100"),R.verbose("update mosic:",e)}}else window.console.log("no ugcapp")},filter:[],set filter_source(e){UGCApp.ffplay.command("source|glfilter@filter",e.replace("file://",""))},set filter_reset(e){UGCApp.ffplay.command("reset|glfilter@filter",e)},set filter_percent(e){UGCApp.ffplay.command("percent|glfilter@filter",e)},get filter_percent(){return this.filter&&this.filter.length&&this.filter[0].percent||100},face:{beauty_level:0,beauty_source:""},set beauty_source(e){e=e.replace("file://",""),this.face.beauty_source!=e&&(this.face.beauty_source=e,UGCApp.ffplay.command("source|glfilter@beauty",e))},set beauty_level(e){this.face.beauty_level=e,UGCApp.ffplay.command("percent|glfilter@beauty",10*e)},get beauty_level(){return this.face.beauty_level},video:{cut:[0,0,0,0],dar:M.auto},audio:{_volume:100,get volume(){return this._volume},set volume(e){UGCApp.ffplay.command("volume|volume@master",e/100),this._volume=e}},bgm:{_volume:100,get volume(){return this._volume},set volume(e){UGCApp.ffplay.command("volume|volume@bgm",e/100),this._volume=e},url:""},poster:{url:"",rotate:0,overlay:[]},set dar(e){var t=this.resolution_dar;this.video.dar=e;var r=this.resolution_dar,n=t[0]/r[0];[].concat(Object(u["a"])(this.overlay),Object(u["a"])(this.mosic)).forEach((function(e){var i=[(e.x+e.w/2)/t[0],(e.y+e.h/2)/t[1]];e.w/=n,e.h/=n,e.x=i[0]*r[0]-e.w/2,e.y=i[1]*r[1]-e.h/2}))},get dar(){var e=this,t=!Object.keys(M.auto).find((function(t){return e.video.dar[t]!=M.auto[t]}));return t?0==this.timelines.length?[0,0]:[this.timelines[0].width,this.timelines[0].height]:this.video.dar},get dar_d(){return this.dar[0]/this.dar[1]},get resolution_dar(){return this.dar[0]<100||this.dar[1]<100?this.dar.map((function(e){return 1e3*e})):this.dar},get resolution_box_src(){var e,t=this;return e=this.timelines.length?1==this.timelines.length?[this.getRotatedWidth(this.timelines[0]),this.getRotatedHeight(this.timelines[0])]:this.timelines.reduce((function(e,r,n){return 1==n&&(e=[t.getRotatedWidth(e),t.getRotatedHeight(e)]),[Math.max(e[0],t.getRotatedWidth(r)),Math.max(e[1],t.getRotatedHeight(r))]})):[0,0],[e[0].toEven(),e[1].toEven()]},previewparam:{resolution_box:[1920,1920]},get preview_resolution(){var e=Math.min(this.resolution_box_src[0],this.previewparam.resolution_box[0]),t=Math.min(this.resolution_box_src[1],this.previewparam.resolution_box[1]);return this.dar_d>1?[e.toEven(),(e/this.dar_d).toEven()]:[(t*this.dar_d).toEven(),t.toEven()]},encodeparam:{preset:"low",hardware_encoder:!0,resolution_box:[0,0],bitrate:0},get low_encodeparam(){var e=Object(f["a"])({},this.encodeparam,{resolution_box:[960,960]}),t=Math.min(this.resolution_box_src[0],e.resolution_box[0]),r=Math.min(this.resolution_box_src[1],e.resolution_box[1]);return this.dar_d>1?e.resolution=[t.toEven(),(t/this.dar_d).toEven()]:e.resolution=[(r*this.dar_d).toEven(),r.toEven()],e.bitrate=2*Math.min(e.resolution[0],e.resolution[1]),e},get high_encodeparam(){var e=Object(f["a"])({},this.encodeparam,{resolution_box:[1920,1920]}),t=Math.min(this.resolution_box_src[0],e.resolution_box[0]),r=Math.min(this.resolution_box_src[1],e.resolution_box[1]);return this.dar_d>1?e.resolution=[t.toEven(),(t/this.dar_d).toEven()]:e.resolution=[(r*this.dar_d).toEven(),r.toEven()],e.bitrate=3*Math.min(e.resolution[0],e.resolution[1]),e},get preset_encodeparam(){return"high"==this.encodeparam.preset?this.high_encodeparam:this.low_encodeparam}},ffplayCommand:function(e,t){return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise((function(r,n){UGCApp.ffplay.command(e,t,r,n)})));case 1:case"end":return r.stop()}}),r)})))()},getUGCParam:function(e){var t=B.editlist,r=B.editlist.timelines,n=e.resolution[0],i=e.resolution[1],a=e.poster,s=e.oformat||"rgba",o=null,c="";if(r.length<=0)return"";var l=1;if(l){var d="ugc_movie@master{idx}='{src}':sp={sp}:ep={ep}:s=v+a[v{idx}][a{idx}],[v{idx}]{ending}gltransform=w={w}:h={h}:rotate={transpose}:oformat={oformat}[v{idx}]",f="[v{in}][a{in}][v{idx}][a{idx}]ugc_concat@master{idx}=delta_ts={delta}:v=1:a=1[v{idx}][a{idx}]",p={0:"0",90:"1",180:"2",270:"3"},m=n,h=i,v=r[0],g=(v.src_rotate+v.rotate)%360;90!=g&&270!=g||(m=i,h=n),c=d.replace(/{idx}/g,0).replace("{src}",v.url.replace("file://","")).replace("{sp}",v.start_sec).replace("{ep}",v.end_sec).replace(/{w}/g,m).replace(/{h}/g,h).replace("{source}",B.editlist.transform_source.replace("file://","")).replace("{transpose}",p[g]||"0").replace("{contrast}",v.eq.contrast).replace("{brightness}",v.eq.brightness).replace("{saturation}",v.eq.saturation).replace("{gamma}",v.eq.gamma).replace(/{oformat}/g,s).replace("{ending}",v.ending?"format=rgba,hwupload,":""),r.length>1&&(c=[c].concat(Object(u["a"])(r.slice(1))).reduce((function(e,t,r){var a=(t.src_rotate+t.rotate)%360;return m=n,h=i,90!=a&&270!=a||(m=i,h=n),e+","+d.replace(/{idx}/g,r).replace("{src}",t.url.replace("file://","")).replace("{sp}",t.start_sec).replace("{ep}",t.end_sec).replace(/{w}/g,m).replace(/{h}/g,h).replace("{source}",B.editlist.transform_source.replace("file://","")).replace("{transpose}",p[a]||"0").replace("{contrast}",t.eq.contrast).replace("{brightness}",t.eq.brightness).replace("{saturation}",t.eq.saturation).replace("{gamma}",t.eq.gamma).replace(/{oformat}/g,s).replace("{ending}",t.ending?"format=rgba,hwupload,":"")+","+f.replace(/{in}/g,r-1).replace(/{idx}/g,r).replace("{delta}",t.offset_sec)})));var b=r.length-1;c=c.replace(new RegExp("\\[v"+b+"\\]","g"),"[out1]").replace(new RegExp("\\[a"+b+"\\]","g"),"[out0]")}else{var y="ugc_movie@master{idx}={src}:sp={sp}:ep={ep}:s=v+a[v{idx}][a{idx}],[v{idx}]scale={w}:{h}:force_original_aspect_ratio=decrease,pad={w}:{h}:(ow-iw)/2:(oh-ih)/2,{transpose}{vflip}{hflip}setsar=1/1[v{idx}],[v{idx}]eq@master{idx}=contrast={contrast}:brightness={brightness}:saturation={saturation}:gamma={gamma}[v{idx}]",_="[v{in}][a{in}][v{idx}][a{idx}]ugc_concat@master{idx}=delta_ts={delta}:v=1:a=1[v{idx}][a{idx}]",x={0:"",90:"transpose=1,",180:"hflip,vflip,",270:"transpose=2,"},w=n,k=i,T=r[0],R=(T.src_rotate+T.rotate)%360;90!=R&&270!=R||(w=i,k=n),c=y.replace(/{idx}/g,0).replace("{src}",T.url.replace("file://","")).replace("{sp}",T.start_sec).replace("{ep}",T.end_sec).replace(/{w}/g,w).replace(/{h}/g,k).replace("{transpose}",x[R]).replace("{vflip}",T.vflip?"vflip,":"").replace("{hflip}",T.hflip?"hflip,":"").replace("{contrast}",T.eq.contrast).replace("{brightness}",T.eq.brightness).replace("{saturation}",T.eq.saturation).replace("{gamma}",T.eq.gamma),r.length>1&&(c=[c].concat(Object(u["a"])(r.slice(1))).reduce((function(e,t,r){var a=(t.src_rotate+t.rotate)%360;return w=n,k=i,90!=a&&270!=a||(w=i,k=n),e+","+y.replace(/{idx}/g,r).replace("{src}",t.url.replace("file://","")).replace("{sp}",t.start_sec).replace("{ep}",t.end_sec).replace(/{w}/g,w).replace(/{h}/g,k).replace("{transpose}",x[a]).replace("{vflip}",t.vflip?"vflip,":"").replace("{hflip}",t.hflip?"hflip,":"").replace("{contrast}",t.eq.contrast).replace("{brightness}",t.eq.brightness).replace("{saturation}",t.eq.saturation).replace("{gamma}",t.eq.gamma)+","+_.replace(/{in}/g,r-1).replace(/{idx}/g,r).replace("{delta}",t.offset_sec)})));var O=r.length-1;if(r.length>0&&o&&!a){var C="ugc_movie@master{idx}={src}:ep={ep}:s=v+a[v{idx}][a{idx}],[v{idx}]scale={w}:{h}:force_original_aspect_ratio=decrease,pad={w}:{h}:(ow-iw)/2:(oh-ih)/2,{transpose}{vflip}{hflip}setsar=1/1[v{idx}],[v{idx}]eq@master{idx}=contrast={contrast}:brightness={brightness}:saturation={saturation}:gamma={gamma}[v{idx}]",P="[v{in}][a{in}][v{idx}][a{idx}]ugc_concat@master{idx}=delta_ts={delta}:v=1:a=1[v{idx}][a{idx}]",A=r.length,I=n,S=i;c+=","+C.replace(/{idx}/g,A).replace("{src}",o.url.replace("file://","")).replace(/{ep}/g,o.end_sec).replace(/{w}/g,I).replace(/{h}/g,S).replace("{transpose}",x[0]).replace("{vflip}",o.vflip?"vflip,":"").replace("{hflip}",o.hflip?"hflip,":"").replace("{contrast}",o.eq.contrast).replace("{brightness}",o.eq.brightness).replace("{saturation}",o.eq.saturation).replace("{gamma}",o.eq.gamma)+","+P.replace(/{in}/g,A-1).replace(/{idx}/g,A).replace("{delta}",o.offset_sec),O++}c=c.replace(new RegExp("\\[v"+O+"\\]","g"),"[out1]").replace(new RegExp("\\[a"+O+"\\]","g"),"[out0]")}if(t.filter.length?c+=",[out1]"+t.filter.map((function(e){var t="";return e.local_file_list&&e.local_file_list.length&&(t=":lutpng="+e.local_file_list.map((function(e){return e.toNativeURL().replace("file://","")})).join("|")),"glfilter@filter=source={source}{lutpng}:percent={percent}".replace("{source}",e.local_file.toNativeURL().replace("file://","")).replace("{lutpng}",t).replace("{percent}",e.percent||0)})).reduce((function(e,t){return e+","+t}))+"[out1]":c+=",[out1]glfilter@filter=percent=100[out1]",t.mosic.length){var j=n/t.resolution_dar[0];c+=",[out1]"+t.mosic.map((function(e){return"glfilter@mosic{id}=source={source}:percent={percent}:x={x}:y={y}:w={w}:h={h}:offset={ss}:ep={t}".replace("{source}",t.mosic_source.replace("file://","")).replace("{percent}",100).replace(/{ss}/g,+e.offset_sec.toFixed(2)||0).replace(/{t}/g,e.end_sec).replace("{w}",+(e.w*j).toEven()).replace("{h}",+(e.h*j).toEven()).replace("{x}",+(e.x*j).toFixed(0)).replace("{y}",+(e.y*j).toFixed(0)).replace(/{id}/g,e.id)})).reduce((function(e,t){return e+","+t}))+"[out1]"}c+=",[out1]glfilter@beauty=source={source}:percent={percent}[out1]".replace("{source}",t.face.beauty_source).replace("{percent}",(10*t.face.beauty_level).toFixed(0)),a&&t.poster.overlay.forEach((function(e){e.offset_sec=0,e.end_sec=t.total_sec}));var E=[].concat(Object(u["a"])(t.overlay),Object(u["a"])(a?t.poster.overlay:[]));if(E.length){var $="ugc_movie@slave{id}='{url}':offset={ss}:ep={t}:loop=0,format=rgba,hwupload,[out1]overlay_opengl@slave{id}=x={x}:y={y}:w={w}:h={h}:a={rotate}:offset={ss}:ep={t}[out1]",M=n/t.resolution_dar[0],D=E.filter((function(e){return e.enabled}));c=[c].concat(Object(u["a"])(D)).reduce((function(e,r){var n=r.end_sec,i=+r.offset_sec.toFixed(2)||0;return n<=0&&(n=t.total_sec-i),e+","+$.replace("{url}",r.url.replace("file://","").replace(/[?].*$/,"")).replace(/{ss}/g,i).replace(/{t}/g,n).replace("{w}",+(r.w*M).toEven()).replace("{h}",+(r.h*M).toEven()).replace("{x}",+(r.x*M).toFixed(0)).replace("{y}",+(r.y*M).toFixed(0)).replace("{rotate}",r.rotate).replace(/{id}/g,r.id)}))}if(!a&&t.poster.url){var L="ugc_movie@slave{id}='{url}':offset=0:ep=0.1:loop=0,format=rgba,hwupload,[out1]overlay_opengl@slave{id}=x={x}:y={y}:w={w}:h={h}:a={rotate}:offset=0:ep=0.1[out1]",F=n,U=i,N=t.poster.rotate;c=c+","+L.replace("{url}",t.poster.url.replace("file://","").replace(/[?].*$/,"")).replace("{w}",F).replace("{h}",U).replace("{x}",0).replace("{y}",0).replace("{rotate}",N).replace(/{id}/g,"0")}c+=",[out0]volume@master={volume}[out0]".replace("{volume}",t.audio.volume/100);var H="ugc_movie@slave{id}='{url}':offset={ss}:ep={t}:sp=0:loop=0:s=a,[out0]amix@slave{id}=offset={ss}:ep={t}[out0]";return c=[c].concat(Object(u["a"])(t.amix)).reduce((function(e,r){var n=r.end_sec;return n<=0&&(n=t.total_sec-r.offset_Sec),e+","+H.replace("{url}",r.url.replace("file://","")).replace(/{ss}/g,+r.offset_sec.toFixed(2)||0).replace(/{t}/g,n).replace(/{id}/g,r.id)})),t.bgm&&t.bgm.url&&(c+=",ugc_movie@slave999='{url}':sp=0:ep={t}:offset=0:loop=0:s=a[ba0],[ba0]volume@bgm={volume}[ba0],[out0][ba0]amix@slave999=offset=0:ep={t}:duration=shortest[out0]".replace("{url}",decodeURIComponent(t.bgm.url.replace("file://",""))).replace(/{t}/g,t.total_sec).replace("{volume}",t.bgm.volume/100)),c},getLoglevel:function(){switch(R.loglevel){case R.Level.debug:return"debug";case R.Level.verbose:return"verbose";case R.Level.info:return"info";case R.Level.warn:return"warning";case R.Level.error:return"error";case R.Level.silient:return"quiet"}return"error"},getPosterPlayerParam:function(e){var t="ffplay -hide_banner -nostats -loglevel ".concat(this.getLoglevel(),' -ss {ss} -f ugc -i "{src}"'),r=this.getUGCParam({resolution:this.editlist.preview_resolution,poster:!0,oformat:"opengl"});return t=t.replace("{ss}",this.editlist.time_sec).replace("{src}",r),e?r:t},getPlayerParam:function(e){var t="ffplay -hide_banner -nostats -loglevel ".concat(this.getLoglevel(),' -ss {ss} -f ugc -i "{src}"'),r=this.getUGCParam({resolution:this.editlist.preview_resolution,oformat:"opengl"});return t=t.replace("{ss}",this.editlist.time_sec).replace("{src}",r),e?r:t},getExportParam:function(e){var t="ffmpeg -hide_banner -loglevel ".concat(this.getLoglevel(),' -f ugc -i "{src}" -acodec aac -b:v {b:v} -preset fast -profile:v high -vcodec {vcodec} -use_editlist 0 -movflags faststart -f mp4 -y {des}'),r=this.editlist.preset_encodeparam,n="h264";j.isAndroid()&&r.hardware_encoder&&(n="libhw_avc"),j.isIOS()&&r.hardware_encoder&&(n="h264_videotoolbox");var i=this.getUGCParam({resolution:r.resolution,oformat:"opengl"});return"h264"==n&&(i+=",[out1]hwdownload,format=rgba,format=yuv420p[out1]"),t=t.replace("{vcodec}",n).replace("{b:v}",r.bitrate+"k").replace("{src}",i).replace("{des}",e),t}},N=B,H=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"native-video-main",class:{show:e.showscreen}})},X=[],z=r("5714"),V=r("a884"),Y=r.n(V),q={EnterForeground:-1,Meta:1,Render:2,Timeupdate:3,Finished:4,Error:5,End:6,SeekDone:7,toString:function(e){for(var t in q)if(q[t]==e)return t}},G={rect:function(){},play:function(){},running:function(){},pause:function(){},stop:function(){},seek:function(){},duration:function(){},position:function(){},mute:function(){},thumb:function(){},refresh:function(){},setEventCallback:function(){}},W={data:function(){return{cmd:"",ready:!1,playing:!1,loaded:!1,keep_screen:!1,lastPosition:0,timeupdateTmr:null,seeking:!1,throttle_ing:!1}},computed:{showscreen:function(){return!0}},watch:{playing:function(e){this.$emit("playing",e)}},methods:{resize:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.$el.getBoundingClientRect(),R.verbose("[player] resize: ".concat(JSON.stringify(r))),t.next=4,e.rect(r);case 4:e.$emit("resize");case 5:case"end":return t.stop()}}),t)})))()},rect:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r={x:e.left,y:e.top,width:e.right-e.left,height:e.bottom-e.top},r.width&&r.height){t.next=3;break}return t.abrupt("return");case 3:return R.verbose("[player] update player rect: "+[r.x,r.y,r.width,r.height].join(",")),t.next=6,new Promise(G.rect.bind(null,r.x,r.y,r.width,r.height));case 6:return t.next=8,new Promise((function(e){return setTimeout(e,150)}));case 8:return t.next=10,new Promise(G.refresh.bind(null));case 10:case"end":return t.stop()}}),t)})))()},reload:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:R.verbose("[player] reload: ".concat(e.replace("ffplay",""))),G.command("reload|ffplay",e);case 2:case"end":return t.stop()}}),t)})))()},load:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.stop();case 2:if(t.ready=!1,t.playing=!1,t.loaded=!1,t.seeking=!1,t.throttle_ing=!1,t.cmd=e,G.setEventCallback(t.onEvent),!e){r.next=17;break}return R.info("[player] load player"),R.verbose("reload player param: "+e.replace("ffplay","")),t.$emit("loading"),r.next=15,new Promise(G.play.bind(null,e));case 15:return r.next=17,new Promise((function(e,r){var n=15e3,i=setInterval((function(){n-=100,n<0?(clearInterval(i),r("failed to wait NativePlayer.load")):t.loaded&&(clearInterval(i),e())}),100)}));case 17:case"end":return r.stop()}}),r)})))()},running:function(){return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise(G.running);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()},resume:function(){this.playing=!0,G.mute(0),G.resume(),R.verbose("[player] resume")},pause:function(){this.playing=!1,G.mute(1),G.pause(),R.verbose("[player] pause")},stop:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.playing=!1,R.verbose("[player] stop"),r.next=4,new Promise(G.stop.bind(null,!!e));case 4:return n=r.sent,r.abrupt("return",n);case 6:case"end":return r.stop()}}),r)})))()},doSeek2:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(-1!=e){r.next=4;break}return r.next=3,t.duration();case 3:e=r.sent;case 4:t.lastPosition=e,t.playing=!1,t.$emit("loading"),G.seek(e),t.throttle_ing=!1;case 9:case"end":return r.stop()}}),r)})))()},doSeek:Y()(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(-1!=t){e.next=4;break}return e.next=3,this.duration();case 3:t=e.sent;case 4:this.lastPosition=t,this.playing=!1,this.$emit("loading"),G.seek(t),this.throttle_ing=!1;case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),100),seek:function(e){this.seeking=!0,this.throttle_ing=!0,this.doSeek(e)},duration:function(){return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise(G.duration);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()},position:function(){return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise(G.position);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()},onResume:function(){G.refresh()},checkAndSendLoaddone:function(){!this.loaded||this.seeking||this.throttle_ing||this.$emit("loaddone")},onEvent:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:R.verbose("got player event: "+q.toString(e)),r.t0=e,r.next=r.t0===q.EnterForeground?4:r.t0===q.Meta?5:r.t0===q.Render?12:r.t0===q.Timeupdate?21:r.t0===q.Finished?22:r.t0===q.End?26:r.t0===q.SeekDone?29:33;break;case 4:return r.abrupt("break",33);case 5:return r.t1=t,r.next=8,t.duration();case 8:return r.t2=r.sent,r.t3={duration:r.t2},r.t1.$emit.call(r.t1,"meta",r.t3),r.abrupt("break",33);case 12:if(t.loaded){r.next=18;break}return r.next=15,new Promise((function(e){return setTimeout(e,100)}));case 15:return r.next=17,t.resize();case 17:t.loaded=!0;case 18:return t.$emit("render"),t.checkAndSendLoaddone(),r.abrupt("break",33);case 21:return r.abrupt("break",33);case 22:return t.$emit("finished"),t.seeking&&!t.throttle_ing&&(t.seeking=!1,t.$emit("seekdone")),t.checkAndSendLoaddone(),r.abrupt("break",33);case 26:return t.loaded=!1,t.$emit("end"),r.abrupt("break",33);case 29:return t.throttle_ing||(t.seeking=!1),t.$emit("seekdone"),t.checkAndSendLoaddone(),r.abrupt("break",33);case 33:case"end":return r.stop()}}),r)})))()}},mounted:function(){var e=this;j.isCordova()&&(G=UGCApp.ffplay,this.resize(),document.addEventListener("resume",this.onResume,!1)),this._resizeOb=new z["a"]((function(){e.resize()})),this._resizeOb.observe(this.$el)},beforeDestroy:function(){document.removeEventListener("resume",this.onResume,!1),this._resizeOb.disconnect()}},J=W,K=(r("836a"),r("2877")),Q=Object(K["a"])(J,H,X,!1,null,"1a42391a",null),Z=Q.exports,ee=null,te={components:{NativeVideo:Z},props:["pause","postermode"],data:function(){return{}},watch:{pause:function(e){e?this.$refs.video.pause():this.$refs.video.resume()}},methods:{seek:function(e){void 0===e&&(e=N.editlist.time_sec),this.$refs.video.seek(e)},stop:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loaded=!1,t.next=3,e.$refs.video.stop();case 3:case"end":return t.stop()}}),t)})))()},makeThumb:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,P.getTempFolder();case 2:return r=t.sent,n="poster_"+Math.random().toString(16).replace("0.","")+".jpg",i=r.nativeURL+"/"+n,t.prev=5,t.next=8,e.thumb(i);case 8:if(a=t.sent,!a){t.next=17;break}return t.next=12,new Promise((function(e){setTimeout(e,500)}));case 12:return t.next=14,e.$refs.preview.thumb(i);case 14:if(s=t.sent,!s){t.next=17;break}throw new Error("make poster error"+s);case 17:N.editlist.poster.url=i+"?"+Math.random(),N.editlist.poster.rotate=0,t.next=24;break;case 21:t.prev=21,t.t0=t["catch"](5),e.$snotify.error("截取封面失败");case 24:case"end":return t.stop()}}),t,null,[[5,21]])})))()},thumb:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,new Promise(UGCApp.ffplay.thumb.bind(null,e.replace("file://","")));case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}}),t)})))()},position:function(){return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise(UGCApp.ffplay.position);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()},reload:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.t0=!(ee==e),t.t0){t.next=5;break}return t.next=4,e.$refs.video.running();case 4:t.t0=!t.sent;case 5:if(!t.t0){t.next=9;break}return t.next=8,e.load();case 8:return t.abrupt("return",t.sent);case 9:return e.throttle_ing=e.seeking=!1,r=e.postermode?N.getPosterPlayerParam(!0):N.getPlayerParam(!0),t.next=13,e.$refs.video.reload(r);case 13:case"end":return t.stop()}}),t)})))()},load:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(ee=e,e.throttle_ing=e.seeking=!1,!e.postermode){t.next=7;break}return t.next=5,e.$refs.video.load(N.getPosterPlayerParam());case 5:t.next=9;break;case 7:return t.next=9,e.$refs.video.load(N.getPlayerParam());case 9:if(N.editlist.poster.url){t.next=12;break}return t.next=12,e.makeThumb();case 12:case"end":return t.stop()}}),t)})))()}}},re=te,ne=Object(K["a"])(re,p,m,!1,null,"5c8ea6fe",null),ie=ne.exports,ae=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e._t("default",null,{progress:e.exportProgress,error:e.error})],2)},se=[],oe={thumb:function(e,t,r,n,a){return Object(i["a"])(regeneratorRuntime.mark((function i(){var s;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return s=1e6,i.next=3,new Promise(UGCApp.ffmpeg.thumb.bind(null,e,t,r*s,n*s,a*s));case 3:return i.abrupt("return",i.sent);case 4:case"end":return i.stop()}}),i)})))()}},ce={Transcode:oe,props:[],data:function(){return{error:"",exportProgress:0}},methods:{begin:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i,a,s,o,c,l,u,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,j.getConfig();case 2:return r=t.sent,r.output||(r.output=cordova.file.cacheDirectory+"output.mp4",j.setConfig(r),R.info("config.output not set, use default: ".concat(r.output))),n=r.output.replace("file://",""),i=N.getExportParam(n),R.info("begin export"),R.verbose("begin export with param: ".concat(i)),t.next=10,new Promise(UGCApp.ffmpeg.start.bind(null,i));case 10:if(a=t.sent,!a){t.next=16;break}return e.error="导出未能开始："+a,R.error("export failed: ".concat(e.error)),e.$emit("error",{code:a,message:e.error}),t.abrupt("return");case 16:return s=N.editlist.total_sec,o=0,t.next=20,new Promise((function(e){setTimeout(e,1e3)}));case 20:return t.next=22,new Promise(UGCApp.ffmpeg.status);case 22:return c=t.sent,t.next=25,new Promise(UGCApp.ffmpeg.progress);case 25:return l=t.sent,o=l.pts/1e3,e.exportProgress=+Math.max(0,Math.min(100,o/s*100)).toFixed(1),e.$emit("progress",e.exportProgress),t.next=31,new Promise((function(e){setTimeout(e,500)}));case 31:R.verbose("export progress:"+l.pts+", status:"+c);case 32:if(1==c){t.next=20;break}case 33:return t.next=35,new Promise(UGCApp.ffmpeg.report);case 35:if(u=t.sent,0!=u){t.next=60;break}if(!j.isIOS()){t.next=43;break}return t.next=40,j.getCdvUrl(n);case 40:d=t.sent.replace("cdvfile:","http:"),t.next=46;break;case 43:return t.next=45,j.getCdvUrl(n);case 45:d=t.sent;case 46:return t.prev=46,r.output_thumb||(r.output_thumb=cordova.file.cacheDirectory+"output.jpg",j.setConfig(r),R.info("config.output_thumb not set, use default: ".concat(r.output_thumb))),t.next=50,e.copyPosterTo(r.output_thumb);case 50:t.next=57;break;case 52:t.prev=52,t.t0=t["catch"](46),e.error="导出封面失败",R.error("export poster failed: ".concat(e.error)),e.$emit("error",{code:u,message:e.error});case 57:e.$emit("success",d),t.next=63;break;case 60:e.error="导出失败",R.error("export failed: ".concat(e.error,", ret:").concat(u)),e.$emit("error",{code:u,message:e.error});case 63:case"end":return t.stop()}}),t,null,[[46,52]])})))()},cancel:function(){return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise(UGCApp.ffmpeg.cancel);case 2:case"end":return e.stop()}}),e)})))()},copyPosterTo:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i,a,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=N.editlist.poster.url,"/"==r[0]&&(r="file://"+r),"/"==e[0]&&(e="file://"+e),t.next=5,new Promise(resolveLocalFileSystemURL.bind(window,r));case 5:return n=t.sent,i=null,a=e.split("/").slice(0,-1).join("/"),s=e.split("/").reverse()[0],t.prev=9,t.next=12,new Promise(resolveLocalFileSystemURL.bind(window,e));case 12:o=t.sent,o.remove(),t.next=18;break;case 16:t.prev=16,t.t0=t["catch"](9);case 18:return t.next=20,new Promise(resolveLocalFileSystemURL.bind(window,a));case 20:return i=t.sent,t.next=23,new Promise(n.copyTo.bind(n,i,s));case 23:return t.abrupt("return",t.sent);case 24:case"end":return t.stop()}}),t,null,[[9,16]])})))()},createPoster:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,UGCRes.getTempFolder();case 2:return r=t.sent,n=r.nativeURL+"/poster_"+String(Math.random()).replace("0.","")+".jpg",n=n.replace("file://",""),t.next=7,new Promise(UGCApp.ffplay.thumb.bind(null,n));case 7:i=t.sent,i||R.error("make poster error:"+i),e.posterUrl=n,e.isTempPoster=!0;case 11:case"end":return t.stop()}}),t)})))()}},mouted:function(){return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise(UGCApp.ffplay.stop.bind(null,!1));case 2:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){this.cancel()}},le=ce,ue=Object(K["a"])(le,ae,se,!1,null,"3eb2ec04",null),de=ue.exports,fe=function(e){e.component("PreviewPlayer",ie),e.component("Export",de)};"undefined"!==typeof window&&window.Vue&&fe(window.Vue);var pe,me={version:"1.1.2",install:fe,Const:_,Log:R,PreviewPlayer:ie,Export:de,CordovaModel:j,Editlist:N,UGCResourceManager:P},he=Object(f["a"])({CaptureVideo:{Duration:600},Operate:{Init:ve("初始",pe=0),VideoAdd:ve("添加视频",++pe),VideoSplit:ve("分割视频",++pe),VideoTimeModify:ve("视频时间修改",++pe),VideoRemove:ve("删除视频",++pe),VideoParamsModify:ve("视频参数修改",++pe),VideoSort:ve("视频排序",++pe),VideoRotate:ve("视频旋转",++pe),VideoVFlip:ve("上下翻转视频",++pe),VideoHFlip:ve("左右翻转视频",++pe),VideoAspect:ve("画幅比例修改",++pe),PosterModify:ve("封面修改",++pe),EndingModify:ve("片尾修改",++pe),ImageAdd:ve("添加贴纸",++pe),ImageRemove:ve("删除贴纸",++pe),ImageModify:ve("贴纸修改",++pe),ImageTimeModify:ve("贴纸时间修改",++pe),MosicAdd:ve("添加马赛克",++pe),MosicRemove:ve("删除马赛克",++pe),MosicModify:ve("马赛克修改",++pe),MosicTimeModify:ve("马赛克时间修改",++pe),TextAdd:ve("添加文字",++pe),TextRemove:ve("删除文字",++pe),TextModify:ve("文字修改",++pe),TextTimeModify:ve("文字时间修改",++pe),FilterEnable:ve("启用滤镜",++pe),FilterDisable:ve("关闭滤镜",++pe),FilterModify:ve("滤镜参数修改",++pe),FaceEnable:ve("启用美颜",++pe),FaceDisable:ve("关闭美颜",++pe),FaceModify:ve("美颜参数修改",++pe),BGMSet:ve("设置背景音",++pe),BGMUnset:ve("删除背景音",++pe),BGMParamsModify:ve("背景音参数修改",++pe),AudioParamsModify:ve("音频参数修改",++pe),AudioEffectAdd:ve("添加音效",++pe),AudioEffectRemove:ve("删除音效",++pe),AudioEffectModify:ve("音效修改",++pe),AudioEffectTimeModify:ve("音效时间修改",++pe),AutoModify:ve("自动调整",++pe)}},_);function ve(e,t,r){return{Name:e,Type:t,Reload:r}}var ge=he,be=r("e9d0"),ye=r.n(be);function _e(e){return+e.toFixed(10)}function xe(e,t,r,n,i){r-=e,n-=t;var a=i*Math.PI/180,s=r*Math.cos(a)-n*Math.sin(a),o=r*Math.sin(a)+n*Math.cos(a);return{x:s+e,y:o+t}}r("4de4"),r("7db0");var we={operateHistory:[],undo:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i,a,s,o,c;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=t.undoOperateHistory(),!n){r.next=28;break}i=n.undo,a=n.restore,s=function(e,t){e.splice(0,e.length),t.forEach((function(t){return e.push(ye()(!0,{},t))}))},s(N.editlist.timelines,a.timelines),s(N.editlist.amix,a.amix),s(N.editlist.overlay,a.overlay),s(N.editlist.mosic,a.mosic),s(N.editlist.filter,a.filter),N.editlist.face=a.face,N.editlist.video=a.video,N.editlist.audio=a.audio,N.editlist.bgm=a.bgm,N.editlist.poster=a.poster,o=Object.keys(ge.Operate).find((function(e){return ge.Operate[e].Type==i.operateType})),r.t0=i.operateType,r.next=r.t0===ge.Operate.VideoRemove.Type?19:23;break;case 19:return c=N.editlist.timelines.find((function(e){return i.targetId==e.id})),c.active=!0,e.seek(c.offset_sec),r.abrupt("break",23);case 23:return N.editlist.time_sec>N.editlist.total_sec&&e.seek(N.editlist.total_sec),e.reload(),r.abrupt("return","撤销 "+ge.Operate[o].Name);case 28:return r.abrupt("return","没有可撤销的内容了！");case 29:case"end":return r.stop()}}),r)})))()},undoOperateHistory:function(){var e=this.getOperateHistory();if(e&&e.length>1){var t=e.pop();return this.saveOperateHistory(e),{restore:ye()(!0,{},e[e.length-1]),undo:ye()(!0,{},t),history:e}}},getOperateHistory:function(){return this.operateHistory,this.operateHistory||[]},createOperateHistory:function(e,t){var r=N.editlist,n=ye()(!0,{},{operateType:e,targetId:t,timelines:r.timelines,amix:r.amix,overlay:r.overlay,mosic:r.mosic,filter:r.filter,face:r.face,video:r.video,audio:r.audio,bgm:r.bgm,poster:r.poster});return n.amix.forEach((function(e){return e.active=!1})),n.overlay.forEach((function(e){e.active=!1,e.enabled=!0})),n.mosic.forEach((function(e){e.active=!1,e.enabled=!0})),R.verbose("create operate history: ",n),this.pushOperateHistory(n)},updateOperateHistory:function(e,t){var r=this.getOperateHistory(),n=r[r.length-1];if(!n)return r;if(n.operateType==e)if(e==ge.Operate.MosicAdd.Type){var i=n.mosic.find((function(e){return e.id==t.id}));i&&(ye()(i,t),i.active=!1,i.enabled=!0)}else if(e==ge.Operate.ImageAdd.Type){var a=n.overlay.find((function(e){return e.type==ge.Overlay.Type.Image&&e.id==t.id}));a&&(ye()(a,t),a.active=!1,a.enabled=!0)}else if(e==ge.Operate.TextAdd.Type){var s=n.overlay.find((function(e){return e.type==ge.Overlay.Type.Text&&e.id==t.id}));s&&(ye()(s,t),s.active=!1,s.enabled=!0)}if(e==ge.Operate.VideoAdd.Type&&(n.operateType==e||n.operateType==ge.Operate.Init.Type)){var o=n.timelines.find((function(e){return e.id==t.id}));o&&(o.thumbs=[],ye()(o,t))}return R.verbose("update operate history: ",n),this.saveOperateHistory(r)},pushOperateHistory:function(e){var t=this.getOperateHistory();return t.push(e),t.length>200&&t.splice(0,1),this.saveOperateHistory(t)},saveOperateHistory:function(e){try{this.operateHistory=e}catch(t){}return e}},ke=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"main-title"},[r("mu-button",{attrs:{large:"",icon:""},on:{click:e.exit}},[r("mu-icon",{attrs:{color:"white",size:"36",value:"chevron_left"}})],1),r("div",{staticStyle:{width:"100%","text-align":"center"}}),r("mu-button",{ref:"showDlgBtn",attrs:{icon:"",large:""},on:{click:e.showDlg}},[r("mu-icon",{attrs:{color:e.setting?"red":"white",size:"24",value:"settings"}})],1),r("mu-button",{attrs:{color:"red",small:"",round:""},on:{click:function(t){return e.$emit("export")}}},[e._v("导出")]),r("transition",{attrs:{name:"fade"}},[r("div",{directives:[{name:"show",rawName:"v-show",value:e.setting,expression:"setting"}],ref:"dlg",staticClass:"settings-dlg",attrs:{tabindex:"-1"},on:{blur:e.blur}},[r("div",{staticClass:"content"},[r("div",{staticClass:"setting-title"},[e._v("导出设置")]),r("div",{staticClass:"content-top"},[r("div",{staticClass:"content-item",class:{active:"high"==e.encodeparam.preset},on:{click:function(t){e.encodeparam.preset="high"}}},[e._v(" 视频质量优先 "),r("div",{staticClass:"content-desc"},[e._v("质量更加，生成速度较慢")]),r("div",{staticClass:"content-resolution"},[e._v("分辨率 "+e._s(e.high_resolution))])]),r("div",{staticClass:"content-item",class:{active:"low"==e.encodeparam.preset},on:{click:function(t){e.encodeparam.preset="low"}}},[e._v(" 视频大小优先 "),r("div",{staticClass:"content-desc"},[e._v("大小更少，生成速度较快")]),r("div",{staticClass:"content-resolution"},[e._v("分辨率 "+e._s(e.low_resolution))])])]),r("div",{staticClass:"content-other"},[e._v(" 硬编码 "),r("mu-switch",{on:{change:e.focus},model:{value:e.encodeparam.hardware_encoder,callback:function(t){e.$set(e.encodeparam,"hardware_encoder",t)},expression:"encodeparam.hardware_encoder"}})],1)])])])],1)},Te=[],Re=(r("a15b"),{props:["overrideBackbutton"],data:function(){return{setting:!1,encodeparam:N.editlist.encodeparam,low_resolution:"",high_resolution:""}},methods:{onBack:function(){this.overrideBackbutton&&this.exit()},exit:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.$data._confirm_ing){r.next=11;break}if(t.$data._confirm_ing=!0,r.t0=e,r.t0){r.next=7;break}return r.next=6,t.$confirm("是否退出？编辑的内容会丢失","退出");case 6:r.t0=r.sent.result;case 7:if(!r.t0){r.next=10;break}R.uilog("/","exit (without save)"),j.finish({statusCode:j.StatusCode.Cancel,message:"用户取消返回",output:"",output_thumb:""});case 10:t.$data._confirm_ing=!1;case 11:case"end":return r.stop()}}),r)})))()},updateData:function(){this.encodeparam=N.editlist.encodeparam,this.low_resolution=N.editlist.low_encodeparam.resolution.join("x"),this.high_resolution=N.editlist.high_encodeparam.resolution.join("x")},showDlg:function(){var e=this;this.setting?this.setting=!1:(this.updateData(),R.uilog("/top","show settings"),this.setting=!0,this.$nextTick((function(){e.$refs.dlg.focus()})))},focus:function(){this.$refs.dlg.focus()},blur:function(e){e.relatedTarget==this.$refs.showDlgBtn.$el||this.$refs.dlg.contains(e.relatedTarget)||(this.setting=!1)}},mounted:function(){document.addEventListener("backbutton",this.onBack,!1)}}),Oe=Re,Ce=(r("6f0f"),Object(K["a"])(Oe,ke,Te,!1,null,"f9e36f42",null)),Pe=Ce.exports,Ae=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"main",staticClass:"tool-box",class:{overlay:e.show_overlay||e.show_amix},on:{touchstart:e.currentStart,touchmove:e.currentMove,touchend:function(t){return e.changed()}}},[r("div",{ref:"mainLine",staticClass:"main-line going",style:e.mainLineStyle},[e.postermode?e._e():r("div",{staticClass:"video-post-btn",on:{click:function(t){return e.$emit("on_poster_click")}}},[e.poster_url?[r("img",{style:e.posterStyles,attrs:{src:e.poster_url},on:{error:e.posterLoadError}}),r("span",{staticClass:"text"},[e._v("封面")])]:[r("span",{staticClass:"text add"},[e._v("+选择封面")])]],2),r("div",{staticClass:"main-timeline"},e._l(e.timelines,(function(t){return r("TimelineItem",{key:t.id,attrs:{pps:e.pps,dragging:!!t.ending||e.dragging,focus:!e.postermode&&t.focus,active:!t.ending&&!e.postermode&&t.active,timeline:t,canload_preview:e.preview_render,min_sec:e.video_min_sec},on:{change:function(r){return e.timelineChange(t.id,r)},active:function(r){return e.timelineActive(t.id,r)}},nativeOn:{click:function(r){t.ending&&e.endingClick(r)}}})})),1),e.postermode||e.hasEnding?e._e():r("div",{staticClass:"video-ending-btn",on:{click:e.endingClick}},[r("span",[e._v("+片尾设置")])]),!e.postermode&&e.show_overlay?r("div",{staticClass:"sub-timeline",staticStyle:{"margin-top":"35px"}},[e._l(e.overlay,(function(t){return[t.type&e.overlay_type?r("TimelineOverlayItem",{key:t.id,attrs:{id:t.id,type:t.type,active:t.active,pps:e.pps,end_sec:t.end_sec,offset_sec:t.offset_sec},on:{change:function(r){return e.overlayChange(t.id,r)},active:function(r){return e.overlayActive(t.id,r)}}}):e._e()]}))],2):e._e(),!e.postermode&&e.show_amix?r("div",{staticClass:"sub-timeline",staticStyle:{"margin-top":"35px"}},e._l(e.amix,(function(t){return r("TimelineOverlayItem",{key:t.id,attrs:{id:t.id,is_amix:!0,active:t.active,pps:e.pps,end_sec:t.end_sec,offset_sec:t.offset_sec},on:{change:function(r){return e.amixChange(t.id,r)},active:function(r){return e.amixActive(t.id,r)}}})})),1):e._e()]),r("div",{ref:"current",staticClass:"time-tick"},[r("div",{staticClass:"current-time",class:{dragging:e.dragging}},[e._v(" "+e._s(e.currentTimeStr)+" ")])]),r("div",{staticClass:"total-time-tick"},[e._v(e._s(e.totalTimeStr))])])},Ie=[],Se=(r("fb6a"),r("a9e3"),r("c35a"),r("1276"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"box",class:{active:e.active,focus:e.focus,span:e.timeline.offset_sec},style:e.boxStyle,on:{touchend:e.toggleActive}},[r("mu-button",{ref:"left",staticClass:"left-tick",attrs:{flat:""},nativeOn:{touchstart:function(t){return t.stopPropagation(),e.leftStart(t)},touchmove:function(t){return t.stopPropagation(),e.leftMove(t)},touchend:function(t){return t.stopPropagation(),e.leftEnd(t)}}},[r("mu-icon",{class:{dragging:e.leftDragging,outbound:e.leftOutBound},attrs:{value:"keyboard_arrow_left"}})],1),r("div",{staticClass:"content"},[r("div",{staticClass:"thumb",class:{overlay:e.overlay_mode},style:e.thumbStyle},[e.timeline.ending?r("div",{staticClass:"video-ending"},[r("span",[e._v("片尾设置")])]):r("TimelineItemThumb",{attrs:{pps:e.pps,timeline:e.timeline,canload:e.canload_preview}})],1),r("div",{staticClass:"border"})]),r("mu-button",{ref:"right",staticClass:"right-tick",nativeOn:{touchstart:function(t){return t.stopPropagation(),e.rightStart(t)},touchmove:function(t){return t.stopPropagation(),e.rightMove(t)},touchend:function(t){return t.stopPropagation(),e.rightEnd(t)}}},[r("mu-icon",{class:{dragging:e.rightDragging,outbound:e.rightOutBound},attrs:{value:"keyboard_arrow_right"}})],1),e.active?e._e():r("div",{staticClass:"left-connect"},[r("mu-icon",{attrs:{size:12,value:"insert_link"}})],1)],1)}),je=[],Ee=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"box"},e._l(e.thumbs,(function(t,n){return r("img",{key:n,style:{left:t.ss*e.pps+"px",width:t.duration*e.pps+"px"},attrs:{src:t.url||e.firstThumb},on:{error:function(t){return e.thumbLoadError(n)}}})})),0)},$e=[],Me=(r("25f0"),10),De=1,Le={},Fe={props:["idx","pps","timeline","rotate","canload"],data:function(){return{editlist:N.editlist,thumbs:[]}},watch:{"editlist.time_sec":"update","timeline.start_sec":"update","timeline.end_sec":"update",rotate:function(){return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},canload:function(e){e&&this.fetchThumb(this.editlist.time_sec)}},computed:{firstThumb:function(){var e=this.thumbs.find((function(e){return e.url}));return e&&e.url}},methods:{update:function(){var e=N.editlist.time_sec;e-=this.timeline.offset_sec,e<-Me||e>this.timeline.end_sec-this.timeline.start_sec||(this.fetchThumb(e),this.fetchThumb(e-Me))},thumbLoadError:function(e){this.thumbs[e]&&this.thumbs[e].url&&(this.thumbs.splice(e,1),this.update())},prepareCacheFolder:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=""+e.timeline.id,Le[r]){t.next=11;break}return t.next=4,P.filesystem();case 4:return n=t.sent,t.next=7,new Promise(n.root.getDirectory.bind(n.root,"thumbs/",{create:!0}));case 7:return i=t.sent,t.next=10,new Promise(i.getDirectory.bind(i,r,{create:!0}));case 10:Le[r]=t.sent;case 11:case"end":return t.stop()}}),t)})))()},makeThumb:function(e,t,r,n,a){var s=this;return Object(i["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return R.verbose("makeThumb:"+t),i.next=3,s.prepareCacheFolder();case 3:return i.next=5,de.Transcode.thumb(e,t,r,n,a);case 5:return i.abrupt("return",i.sent);case 6:case"end":return i.stop()}}),i)})))()},fetchThumb:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i,a,s,o,c,l,u,d,f;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=_e(Math.max(0,e+t.timeline.start_sec)),!(n>_e(t.timeline.end_sec))){r.next=3;break}return r.abrupt("return");case 3:if(i=t.thumbs.find((function(e){return _e(e.ss)<=_e(n)&&_e(e.ss+e.duration)>=_e(n)})),i&&!i.preload){r.next=24;break}return a=n-n%Me,s=Me,o=De,c=t.timeline,l=c.url,u="{path}/thumbs/{id}/thumb_{ss}_{rn}.jpg".replace("{path}",cordova.file.tempDirectory||cordova.file.cacheDirectory).replace("{id}",c.id).replace("{ss}",a).replace("{rn}",Math.random().toString(16).replace("0.","")),d=i,d?(d.loading=!0,delete d.preload):(d={loading:!0,url:"",ss:a,duration:s},t.thumbs.push(d)),t.timeline.thumbs=t.thumbs,r.next=16,t.makeThumb(l,u,a,s,o);case 16:return f=r.sent,f&&window.console.error("make thumb error:"+f),delete d.loading,r.next=21,j.getCdvUrl(u);case 21:d.url=r.sent,R.verbose("make thumb:"+d.url),0==e&&we.updateOperateHistory(ge.Operate.VideoAdd.Type,c);case 24:case"end":return r.stop()}}),r)})))()},makeAllThumb:function(){var e=this.timeline.start_sec,t=this.timeline.end_sec;while(e<=t){var r=e-e%Me,n={preload:!0,url:"",ss:r,duration:Me};this.thumbs.push(n),this.timeline.thumbs=this.thumbs,e+=Me}}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.thumbs=e.timeline.thumbs,e.thumbs.length||e.makeAllThumb(),!e.canload){t.next=5;break}return t.next=5,e.fetchThumb(0);case 5:case"end":return t.stop()}}),t)})))()}},Ue=Fe,Be=(r("435b"),Object(K["a"])(Ue,Ee,$e,!1,null,"c9388e1e",null)),Ne=Be.exports,He={components:{TimelineItemThumb:Ne},props:["pps","dragging","active","focus","overlay_mode","timeline","min_sec","canload_preview"],data:function(){return{leftOutBound:!1,rightOutBound:!1,leftDragging:!1,rightDragging:!1,boxStyle:{width:0,left:0},thumbStyle:{width:0,left:0}}},watch:{"timeline.start_sec":"update","timeline.total_sec":"update","timeline.end_sec":"update","timeline.offset_sec":"update","timeline.left_drag_offset":"update"},methods:{update:function(){this.timeline.end_sec<=this.timeline.start_sec&&(this.timeline.end_sec=this.timeline.start_sec),this.boxStyle.width=(this.timeline.end_sec-this.timeline.start_sec)*this.pps+"px",this.boxStyle.left=(this.timeline.left_drag_offset+this.timeline.offset_sec)*this.pps+"px",this.thumbStyle.width=this.timeline.total_sec*this.pps+"px",this.thumbStyle.left=this.timeline.start_sec*this.pps*-1+"px"},toggleActive:function(){R.uilog("/timeline/item","active: ".concat(this.timeline.id)),this.dragging||this.$emit("active",!this.active)},leftStart:function(e){this._pageX=e.changedTouches[0].pageX,this._value=this.timeline.start_sec,this.leftDragging=!0,this.leftMove(e)},leftMove:function(e){var t=(e.changedTouches[0].pageX-this._pageX)/this.pps,r=Math.min(this.timeline.end_sec-this.min_sec,Math.max(0,this._value+t));return r==this.timeline.end_sec-this.min_sec||0==r?this.leftOutBound=!0:this.leftOutBound=!1,this.changed({seek_sec:0,start_sec:r,left_drag_offset:r-this._value}),!0},leftEnd:function(){R.uilog("/timeline/item","modify startTime: ".concat(this.timeline.start_sec)),this.leftDragging=!1,this.leftOutBound=!1,this.changed()},rightStart:function(e){this._pageX=e.changedTouches[0].pageX,this._value=this.timeline.end_sec,this.rightDragging=!0,this.rightMove(e)},rightMove:function(e){var t=(e.changedTouches[0].pageX-this._pageX)/this.pps,r=Math.min(this.timeline.total_sec,Math.max(this.timeline.start_sec+this.min_sec,this._value+t));return r==this.timeline.start_sec+this.min_sec||r==this.timeline.total_sec?this.rightOutBound=!0:this.rightOutBound=!1,this.changed({seek_sec:r-this.timeline.start_sec,end_sec:r}),!0},rightEnd:function(){R.uilog("/timeline/item","modify endTime: ".concat(this.timeline.end_sec)),this.rightDragging=!1,this.rightOutBound=!1,this.changed()},changed:function(e){var t=!e;e||(e={left_drag_offset:0}),this.$emit("change",Object(f["a"])({end:t,start_sec:this.timeline.start_sec,end_sec:this.timeline.end_sec,left_drag_offset:this.timeline.left_drag_offset},e))}},mounted:function(){this.update(),this.pps||(this.pps=screen.width/10)}},Xe=He,ze=(r("cb35"),Object(K["a"])(Xe,Se,je,!1,null,"0a27f5e2",null)),Ve=ze.exports,Ye=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"box",class:{active:e.active,amix:e.is_amix},style:[e.boxStyle,{height:e.active?"100%":"0"}],attrs:{tabindex:"-1"},on:{click:function(t){return t.stopPropagation(),e.toggleActive(t)}}},[r("div",{staticClass:"left-icon"},[r("mu-button",{attrs:{fab:"",small:"",color:e.is_amix?"orange":"red"}},[r("mu-icon",{attrs:{color:"white",size:"20",value:e.typeIcon}})],1)],1),r("div",{staticClass:"left-drag",on:{touchstart:function(t){return t.stopPropagation(),e.dragStart(t)},touchmove:function(t){return t.stopPropagation(),e.dragMove(t)},touchend:function(t){return t.stopPropagation(),e.dragEnd()}}},[r("mu-button",{attrs:{fab:"",small:"",color:"white",textColor:"red"}},[r("mu-icon",{attrs:{size:"20",value:"code"}})],1)],1),r("mu-button",{ref:"left",staticClass:"left-tick",attrs:{flat:""},nativeOn:{touchstart:function(t){return t.stopPropagation(),e.leftStart(t)},touchmove:function(t){return t.stopPropagation(),e.leftMove(t)},touchend:function(t){return t.stopPropagation(),e.changed()}}},[r("mu-icon",{class:{dragging:e.leftDragging},attrs:{value:"keyboard_arrow_left"}})],1),r("div",{staticClass:"content"},[r("div",{staticClass:"thumb overlay"},[r("mu-icon",{attrs:{value:e.typeIcon}}),r("span",[e._v(e._s(e.typeText))]),r("span",{staticClass:"time"},[e._v(e._s(e.fmtSeconds(e.end_sec)))])],1)]),r("mu-button",{ref:"right",staticClass:"right-tick",nativeOn:{touchstart:function(t){return t.stopPropagation(),e.rightStart(t)},touchmove:function(t){return t.stopPropagation(),e.rightMove(t)},touchend:function(t){return t.stopPropagation(),e.changed()}}},[r("mu-icon",{class:{dragging:e.rightDragging},attrs:{value:"keyboard_arrow_right"}})],1)],1)},qe=[],Ge=(r("5db7"),r("73d9"),r("d4ec")),We=r("bee2"),Je={span:5,features:["inside","outside","center","middle"],layouts:[],angles:[0,90,180,270,360],dynamicLayouts:function(){return this.layouts},render:function(e,t){},renderAngle:function(e){}},Ke={leftToLeft:function(e,t,r){if(t.left-e<=r.left&&t.left+e>=r.left)return{diff:t.left-r.left,from:"left",to:"left"}},leftToRight:function(e,t,r){if(t.left-e<=r.right&&t.left+e>=r.right)return{diff:t.left-r.right,from:"left",to:"right"}},rightToLeft:function(e,t,r){if(t.right-e<=r.left&&t.right+e>=r.left)return{diff:t.right-r.left,from:"right",to:"left"}},rightToRight:function(e,t,r){if(t.right-e<=r.right&&t.right+e>=r.right)return{diff:t.right-r.right,from:"right",to:"right"}},leftToCenter:function(e,t,r){var n=r.left+r.width/2;if(t.left-e<=n&&t.left+e>=n)return{diff:t.left-n,from:"left",to:"center"}},rightToCenter:function(e,t,r){var n=r.left+r.width/2;if(t.right-e<=n&&t.right+e>=n)return{diff:t.right-n,from:"right",to:"center"}},centerToCenter:function(e,t,r){var n=t.left+t.width/2,i=r.left+r.width/2;if(n-e<=i&&n+e>=i)return{diff:n-i,from:"center",to:"center"}},centerToLeft:function(e,t,r){var n=t.left+t.width/2;if(n-e<=r.left&&n+e>=r.left)return{diff:n-r.left,from:"center",to:"center"}},centerToRight:function(e,t,r){var n=t.left+t.width/2;if(n-e<=r.right&&n+e>=r.right)return{diff:n-r.right,from:"center",to:"center"}},topToTop:function(e,t,r){if(t.top-e<=r.top&&t.top+e>=r.top)return{diff:t.top-r.top,from:"top",to:"top"}},topToBottom:function(e,t,r){if(t.top-e<=r.bottom&&t.top+e>=r.bottom)return{diff:t.top-r.bottom,from:"top",to:"bottom"}},bottomToTop:function(e,t,r){if(t.bottom-e<=r.top&&t.bottom+e>=r.top)return{diff:t.bottom-r.top,from:"bottom",to:"top"}},bottomToBottom:function(e,t,r){if(t.bottom-e<=r.bottom&&t.bottom+e>=r.bottom)return{diff:t.bottom-r.bottom,from:"bottom",to:"bottom"}},topToMiddle:function(e,t,r){var n=r.top+r.height/2;if(t.top-e<=n&&t.top+e>=n)return{diff:t.top-n,from:"top",to:"middle"}},bottomToMiddle:function(e,t,r){var n=r.top+r.height/2;if(t.bottom-e<=n&&t.bottom+e>=n)return{diff:t.bottom-n,from:"bottom",to:"middle"}},middleToMiddle:function(e,t,r){var n=t.top+t.height/2,i=r.top+r.height/2;if(n-e<=i&&n+e>=i)return{diff:n-i,from:"middle",to:"middle"}},middleToTop:function(e,t,r){var n=t.top+t.height/2;if(n-e<=r.top&&n+e>=r.top)return{diff:n-r.top,from:"middle",to:"top"}},middleToBottom:function(e,t,r){var n=t.top+t.height/2;if(n-e<=r.bottom&&n+e>=r.bottom)return{diff:n-r.bottom,from:"middle",to:"bottom"}},inside:function(e,t,r){return[Ke.leftToLeft.call(this,e,t,r),Ke.rightToRight.call(this,e,t,r),Ke.topToTop.call(this,e,t,r),Ke.bottomToBottom.call(this,e,t,r)].filter((function(e){return e}))},outside:function(e,t,r){return[Ke.leftToRight.call(this,e,t,r),Ke.rightToLeft.call(this,e,t,r),Ke.topToBottom.call(this,e,t,r),Ke.bottomToTop.call(this,e,t,r)].filter((function(e){return e}))},center:function(e,t,r){return[Ke.leftToCenter.call(this,e,t,r),Ke.rightToCenter.call(this,e,t,r),Ke.centerToCenter.call(this,e,t,r),Ke.centerToLeft.call(this,e,t,r),Ke.centerToRight.call(this,e,t,r)].filter((function(e){return e}))},middle:function(e,t,r){return[Ke.topToMiddle.call(this,e,t,r),Ke.bottomToMiddle.call(this,e,t,r),Ke.middleToMiddle.call(this,e,t,r),Ke.middleToTop.call(this,e,t,r),Ke.middleToBottom.call(this,e,t,r)].filter((function(e){return e}))},angle:function(e,t,r){var n=t.angle+e>=r&&t.angle-e<=r;if(n)return{diff:r-t.angle,value:r}}},Qe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Je;Object(Ge["a"])(this,e),this.options=Object.assign({},Je,t),this.features=Object.create(Ke)}return Object(We["a"])(e,[{key:"findTargets",value:function(e,t){var r=this;t=t||this.options.features;var n=this.options.span;return this.options.dynamicLayouts().flatMap((function(i){return t.map((function(e){return r.features[e]})).flatMap((function(t){return t.call(r,n,e,i)})).filter((function(e){return e})).map((function(e){return e.layout=i,e}))}))}},{key:"getTargetPosition",value:function(e){return"center"==e.to?e.layout.left+e.layout.width/2:"middle"==e.to?e.layout.top+e.layout.height/2:e.layout[e.to]}},{key:"createLayout",value:function(e,t,r,n){if(e=Object.assign({},e),t){var i=this.getTargetPosition(t);"center"==t.from?(e.left=i-e.width/2,e.right=e.left+e.width):(e[t.from]=i,"left"==t.from?e.right=e.left+e.width:"right"==t.from&&(e.left=e.right-e.width))}if(r){var a=this.getTargetPosition(r);"middle"==r.from?(e.top=a-e.height/2,e.bottom=e.top+e.height):(e[r.from]=a,"top"==r.from?e.bottom=e.top+e.height:"bottom"==r.from&&(e.top=e.bottom-e.height))}return null!=n&&(e.angle=n),e}},{key:"check",value:function(e,t,r){var n=this.findTargets(t,r),i=null,a=null,s=null,o=null;return n.forEach((function(e){"left"==e.to||"center"==e.to||"right"==e.to?i?e.to==Math.abs(e.diff)<Math.abs(i.diff)&&(i=e):i=e:a?Math.abs(e.diff)<Math.abs(a.diff)&&(a=e):a=e})),(i||a)&&(i&&(s=this.getTargetPosition(i)),a&&(o=this.getTargetPosition(a)),t=this.createLayout(t,i,a)),this.options.render(s,o,t),t}},{key:"checkAngle",value:function(e){var t=this,r=this.options.angles.flatMap((function(r){return[t.features.angle.call(t,t.options.angleSpan,e,-r),t.features.angle.call(t,t.options.angleSpan,e,r)]})).filter((function(e){return e})),n=null,i=null;return r.forEach((function(e){null==n?n=e:Math.abs(e.diff)<Math.abs(n.diff)&&(n=e)})),n&&(i=n.value,e=this.createLayout(e,null,null,i)),this.options.renderAngle(i,e),e}}]),e}(),Ze=.1,et={props:["pps","active","end_sec","offset_sec","is_amix","type","id"],data:function(){return{overallDragging:!1,leftDragging:!1,rightDragging:!1,boxStyle:{width:0,left:0}}},watch:{end_sec:"update",offset_sec:"update"},computed:{typeIcon:function(){return this.is_amix?"music_note":ge.Overlay.Type.Text==this.type?"font_download":ge.Overlay.Type.Image==this.type?"image":"blur_on"},typeText:function(){return this.is_amix?"音效":ge.Overlay.Type.Text==this.type?"文字":ge.Overlay.Type.Image==this.type?"贴纸":"马赛克"}},methods:{fmtSeconds:function(e){var t=(e%60).toFixed(0),r=(e/60%60).toFixed(0),n=(e/60/60%60).toFixed(0);return n+":"+r+":"+t},update:function(){this.end_sec<=0&&(this.end_sec=Ze),this.boxStyle.width=this.end_sec*this.pps+"px",this.boxStyle.left=this.offset_sec*this.pps+"px"},toggleActive:function(){var e=this;R.uilog("/timeline/overlay","active: ".concat(this.id)),this.active||(this.$nextTick((function(){e.$el.focus({preventScroll:!0})})),this.$emit("active",!this.active))},dragStart:function(e){this._pageX=e.changedTouches[0].pageX,this._value=this.offset_sec,this.overallDragging=!0,this.dragMove(e)},dragMove:function(e){var t=this._value,r=(e.changedTouches[0].pageX-this._pageX)/this.pps;r=t+r;var n=this.createMagnetLayout({left:t,width:this.end_sec}),i=this.createMagnetLayout({left:r,width:this.end_sec});return i=this.magnet.check(n,i),r=i.left,r=Math.max(0,r),r=Math.min(N.editlist.total_sec,r),this.changed({offset_sec:r,overallDragging:this.overallDragging}),!0},dragEnd:function(){R.uilog("/timeline/overlay","modify offsetTime: ".concat(this.offset_sec)),this.overallDragging=!1,this.leftDragging=!1,this.rightDragging=!1,this.changed()},leftStart:function(e){this._pageX=e.changedTouches[0].pageX,this._value=this.offset_sec,this._value2=this.end_sec,this.leftDragging=!0,this.leftMove(e)},leftMove:function(e){var t=this._value,r=this._value2,n=(e.changedTouches[0].pageX-this._pageX)/this.pps;n=t+n;var i=this.createMagnetLayout({left:t,width:0}),a=this.createMagnetLayout({left:n,width:0});a=this.magnet.check(i,a),n=a.left,n=Math.max(0,n),n=Math.min(t+r-Ze,n);var s=Math.max(0,r+t-n);return this.changed({offset_sec:n,end_sec:s}),!0},rightStart:function(e){this._pageX=e.changedTouches[0].pageX,this._value=this.end_sec,this.rightDragging=!0,this.rightMove(e)},rightMove:function(e){var t=this._value,r=(e.changedTouches[0].pageX-this._pageX)/this.pps,n=t+r,i=this.createMagnetLayout({left:this.offset_sec+t,width:0}),a=this.createMagnetLayout({left:this.offset_sec+n,width:0});return a=this.magnet.check(i,a),n=a.left-this.offset_sec,n=Math.min(N.editlist.total_sec-this.offset_sec,n),n=Math.max(Ze,n),this.changed({end_sec:n}),!0},changed:function(e){var t=!e;t&&R.uilog("/timeline/overlay","modify: ".concat(JSON.stringify({offset_sec:this.offset_sec,end_sec:this.end_sec}))),this.$emit("change",Object(f["a"])({end:t,offset_sec:this.offset_sec,end_sec:this.end_sec},e))},createMagnetLayout:function(e){return{left:e.left,width:e.width,right:e.left+e.width,top:0,height:0,bottom:0}},vibrate:function(){navigator.vibrate([100])}},mounted:function(){var e=this;this.update(),this.pps||(this.pps=screen.width/10),this.magnet=new Qe({span:6/this.pps,features:["inside","outside"],render:function(t){null!=t&&e.vibrate()},dynamicLayouts:function(){var t=[];t=e.is_amix?N.editlist.amix:e.type===ge.Overlay.Type.Mosic||e.type===ge.Overlay.Type.Image?[].concat(Object(u["a"])(N.editlist.mosic),Object(u["a"])(N.editlist.overlay.filter((function(e){return e.type==ge.Overlay.Type.Image})))):N.editlist.overlay.filter((function(t){return t.type==e.type}));var r=t.filter((function(t){return t.id!=e.id})).map((function(t){return e.createMagnetLayout({left:t.offset_sec,width:t.end_sec})}));return e.overallDragging||r.push({left:N.editlist.time_sec,width:0}),r}})}},tt=et,rt=(r("922d"),Object(K["a"])(tt,Ye,qe,!1,null,"332828ec",null)),nt=rt.exports,it={toTimeStr:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=e/60,r=t/60,n=Math.floor(e%1*10);return Math.floor(r)+":"+Math.floor(t)+":"+Math.floor(e%60)+"."+n}},at={components:{TimelineItem:Ve,TimelineOverlayItem:nt},props:["playing","show_overlay","show_amix","postermode","poster","overlay_type","preview_render","player"],data:function(){return{Const:ge,pps:screen.width/10,timelines:N.editlist.timelines,amix:N.editlist.amix,video_min_sec:N.editlist.video_min_sec,time_sec:N.editlist.time_sec,mainLineStyle:{width:0,transform:"","transition-duration":"0s"},poster_url:"",dragging:!1,timelineChanging:!1,timer:null}},watch:{playing:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a,s,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!e){r.next=8;break}n=.5,t.mainLineStyle["transition-duration"]=n+"s",a=function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var r,n,i,a,s,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t._moveSpeed){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,t.player.position();case 5:if(r=e.sent,r>=0){e.next=8;break}return e.abrupt("return");case 8:r>t.total_sec&&(r=t.total_sec),n=t.getComputedTransformX(r),i=r,a=t.total_sec-i,s=(t.total_sec*t.pps+n)/t.pps,t.mainLineStyle["transition-duration"]=Math.max(0,a)+"s",t.mainLineStyle.transform="translateX(".concat(n,"px)"),t.mainLineStyle.transform="translateX(-"+(t.total_sec+Math.random()/1e3)*t.pps+"px)",R.verbose("left:".concat(t.total_sec*t.pps+n," total:").concat(t.total_sec*t.pps," remain:").concat(a,"/").concat(s," speed:").concat((t.total_sec*t.pps+n)/a)),t.time_sec=r,t.playing||(clearInterval(t._goingTmr),o=t.getComputedTransformX(r),t.mainLineStyle["transition-duration"]="0s",t.mainLineStyle.transform="translateX("+o+"px)"),e.next=24;break;case 21:e.prev=21,e.t0=e["catch"](2),R.warn("timeline animation fail");case 24:case"end":return e.stop()}}),e,null,[[2,21]])})));return function(){return e.apply(this,arguments)}}(),a(),t._goingTmr=setInterval(a,1e3*n),r.next=23;break;case 8:return clearInterval(t._goingTmr),s=t.getComputedTransformX(t.time_sec),t.mainLineStyle["transition-duration"]="0s",t.mainLineStyle.transform="translateX("+s+"px)",r.prev=12,r.next=15,t.player.position();case 15:o=r.sent,o>=0&&(t.time_sec=o,N.editlist.time_sec=o),r.next=22;break;case 19:r.prev=19,r.t0=r["catch"](12),R.warn("timeline animation fail");case 22:Math.abs(t.time_sec-t.total_sec)<1&&(t.mainLineStyle["transition-duration"]="0.1s",t.mainLineStyle.transform="translateX(-"+(t.time_sec+Math.random()/1e3)*t.pps+"px)",setTimeout((function(){t.mainLineStyle["transition-duration"]="0s"}),150));case 23:case"end":return r.stop()}}),r,null,[[12,19]])})))()},time_sec:function(e){this.update(),N.editlist.time_sec=e,this.refreshUI()},"poster.url":function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,j.getCdvUrl(e);case 2:r.t0=r.sent,r.t1=r.t0+"?",r.t2=Math.random(),t.poster_url=r.t1+r.t2;case 6:case"end":return r.stop()}}),r)})))()},timelines:function(){this.update(!0)}},computed:{overlay:function(){return[].concat(Object(u["a"])(N.editlist.overlay),Object(u["a"])(N.editlist.mosic))},total_sec:function(){return this.timelines.reduce((function(e,t){return e+t.end_sec-t.start_sec}),0)},currentTimeStr:function(){return it.toTimeStr(this.time_sec).replace("0:0","0")},totalTimeStr:function(){return it.toTimeStr(this.total_sec).split(".")[0].replace("0:0","0")},hasEnding:function(){return this.timelines.find((function(e){return e.ending}))},posterStyles:function(){return this.poster.rotate?this.poster.rotate?"transform: rotate("+this.poster.rotate+"deg)":"":{}}},methods:{updateFrame:function(){return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},seek:function(e){this.dragging||(this.time_sec=e,this.update(!0))},time_sec_idx:function(e){var t=this,r=this.timelines.filter((function(r,n){return n==e&&r.offset_sec<=t.timeSec&&r.offset_sec+(r.end_sec-r.start_sec)>t.timeSec}));return r.length?this.time_sec-r[0].offset_sec:-1},update_time_sec:function(e){this.time_sec=e,this.update(!0)},update:function(e){this.timelineChanging||(this.mainLineStyle.width=this.total_sec*this.pps+"px",(this._moveSpeed||e)&&(this.mainLineStyle.transform="translateX(-"+this.time_sec*this.pps+"px)"))},overlayActive:function(e,t){t?(this.overlay.forEach((function(t){t.active=t.id==e})),this.$emit("overlayActive",this.overlay.filter((function(t){return t.id==e}))[0])):(this.overlay.filter((function(t){return t.id==e}))[0].active=!1,this.$emit("overlayActive"))},overlayChange:function(e,t){var r=this.overlay.filter((function(t){return t.id==e}))[0];r.offset_sec=t.offset_sec,r.end_sec=t.end_sec,t.overallDragging&&(this.time_sec=r.offset_sec,this.changed({time_sec:this.time_sec}),this.update(!0)),t.end&&this.$emit("overlayChange",this.overlay.filter((function(t){return t.id==e}))[0])},amixChange:function(e,t){var r=this.amix.filter((function(t){return t.id==e}))[0];r.offset_sec=t.offset_sec,r.end_sec=t.end_sec,t.end&&this.$emit("amixChange",this.amix.filter((function(t){return t.id==e}))[0])},amixActive:function(e,t){t?(this.amix.forEach((function(t){t.active=t.id==e})),this.$emit("amixActive",this.amix.filter((function(t){return t.id==e}))[0])):(this.amix.filter((function(t){return t.id==e}))[0].active=!1,this.$emit("amixActive"))},timelineActive:function(e,t){var r=this;t?this.timelines.forEach((function(t){t.id==e?(t.active=!0,r.time_sec<t.offset_sec?r.time_sec=t.offset_sec+.01:r.time_sec>=t.offset_sec+t.end_sec-t.start_sec&&(r.time_sec=t.offset_sec+t.end_sec-t.start_sec-1e-4)):t.active=!1})):this.timelines.find((function(t){return t.id==e})).active=!1,this.update(!0)},timelineChange:function(e,t){var r=this.timelines.filter((function(t){return t.id==e}))[0];r.start_sec=t.start_sec,r.end_sec=t.end_sec,this.timelineChanging=!t.end;var n=r.offset_sec;if(t.left_drag_offset?this.timelines.forEach((function(e){e.offset_sec<n||(e.left_drag_offset=t.left_drag_offset)})):this.timelines.forEach((function(e){e.left_drag_offset=0})),void 0!==t.seek_sec){var i=this.timelines.indexOf(r),a=t.seek_sec+[0].concat(Object(u["a"])(this.timelines.slice(0,i))).reduce((function(e,t){return e+t.end_sec-t.start_sec}));this.time_sec=Math.max(0,a),this.changed({time_sec:this.time_sec})}N.editlist.update_timelines(this.timelines),t.end&&(this.$emit("timelinesChange",this.timelines),this.update(!0)),this.update()},currentStart:function(e){this._pageX=e.changedTouches[0].pageX,this._value=this.time_sec,R.uilog("/timeline","seek begin: ".concat(this.time_sec))},currentMove:function(e){var t=e.changedTouches[0].pageX-this._pageX;return this.dragging=!0,this._preOffset&&(this._moveSpeed=-t+this._preOffset),this._preOffset=t,this.time_sec=Math.max(0,Math.min(this.total_sec,this._value-t/this.pps)),this.changed({time_sec:this.time_sec}),!0},changed:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=!e,t.timer&&(clearTimeout(t.timer),t.timer=null),!(n&&Math.abs(t._moveSpeed)>1)){r.next=13;break}i=5*t._moveSpeed,i=Math.max(-60,Math.min(60,i));case 5:if(!(Math.abs(i)>1)){r.next=13;break}return a=t.time_sec+i/t.pps,i*=.8,t.time_sec=Math.max(0,Math.min(t.total_sec,a)),r.next=11,new Promise((function(e){t.timer=setTimeout(e,20)}));case 11:r.next=5;break;case 13:n&&(t._preOffset=0,t._moveSpeed=0,t.dragging=!1,R.uilog("/timeline","seek end: ".concat(t.time_sec))),t.$emit("timeChange",Object(f["a"])({time_sec:t.time_sec},e));case 15:case"end":return r.stop()}}),r)})))()},posterLoadError:function(){this.poster_url=null},endingClick:function(){this.$emit("on_ending_click")},refreshUI:function(){if(!this.timelineChanging){var e=N.editlist.cur_timeline();e&&(e.focus=!0,this.timelines.forEach((function(t){return t.id!=e.id&&(t.focus=!1)})),e.active||this.timelines.forEach((function(e){return e.active=!1})))}},getComputedTransformX:function(e){var t=window.getComputedStyle(this.$refs.mainLine),r=Number.parseFloat(t.transform.split(/[(,)]/)[5]);return isNaN(r)&&(r=-e*this.pps),r}},mounted:function(){this.update(!0),this.updateFrame()},beforeDestroy:function(){clearInterval(this._goingTmr)}},st=at,ot=(r("bc09"),Object(K["a"])(st,Ae,Ie,!1,null,"5f3d8022",null)),ct=ot.exports,lt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"controlBox"},[r("mu-icon",{staticStyle:{position:"absolute",left:"0"},attrs:{value:"aspect_ratio"},on:{click:function(t){return e.$emit("event",{eventID:e.EventID.AspectRatio})}}}),r("mu-icon",{attrs:{value:"skip_previous"},on:{click:function(t){return e.$emit("event",{eventID:e.EventID.SeekBegin})}}}),r("mu-button",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"},{name:"show",rawName:"v-show",value:!e.playing,expression:"!playing"}],staticStyle:{padding:"0",overflow:"visible"},attrs:{"data-mu-loading-size":"20","data-mu-loading-overlay-color":"rgba(0, 0, 0, 0)","data-mu-loading-color":"white",icon:""},on:{click:function(t){return e.$emit("event",{eventID:e.EventID.Play})}}},[r("mu-icon",{attrs:{value:"play_arrow"}})],1),r("mu-button",{directives:[{name:"show",rawName:"v-show",value:e.playing,expression:"playing"}],attrs:{icon:""},on:{click:function(t){return e.$emit("event",{eventID:e.EventID.Pause})}}},[r("mu-icon",{attrs:{value:"pause"}})],1),r("mu-icon",{attrs:{value:"skip_next"},on:{click:function(t){return e.$emit("event",{eventID:e.EventID.SeekEnd})}}}),r("mu-icon",{class:[e.hasHistory?"":"disabled"],staticStyle:{position:"absolute",right:"0"},attrs:{value:"undo"},on:{click:function(t){e.hasHistory&&e.$emit("event",{eventID:e.EventID.Undo})}}})],1)},ut=[],dt={Play:0,Pause:1,SeekBegin:2,SeekEnd:3,AspectRatio:4,Undo:5},ft={EventID:dt,props:["playing","loading"],data:function(){return{EventID:dt,history:we}},computed:{hasHistory:function(){return this.history.operateHistory.length>1}},created:function(){}},pt=ft,mt=(r("cc8d"),Object(K["a"])(pt,lt,ut,!1,null,"270f6bbc",null)),ht=mt.exports,vt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"toolTabBox"},[r("div",{staticClass:"middleBox"},[r("transition",{attrs:{name:"fade"}},[r("OverlayToolTab",{directives:[{name:"show",rawName:"v-show",value:e.activeItem&&e.activeItem.active,expression:"activeItem&&activeItem.active"}],ref:"overlayToolTab",class:{hide:"overlaytool"!=e.toolTab},attrs:{activeItem:e.activeItem},on:{select:e.overlayTabSelect}})],1),r("transition",{attrs:{name:"fade"}},[r("HScrollBar",{staticClass:"m-cut tabBox",class:{hide:"cut"!=e.toolTab}},[r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"note_add",text:"添加"},on:{click:function(t){return e.select(e.TabID.VideoAdd)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{disabled:!e.isCurTimelineRemovable,icon:"delete_forever",text:"删除"},on:{click:function(t){return e.select(e.TabID.VideoRemove)}}}),r("div",{staticStyle:{margin:"10px","border-right":"1px solid gray"}}),r("ClipBtn",{staticClass:"item-btn",attrs:{disabled:e.curTimelineIsEnding,icon:"view_agenda",text:"分割"},on:{click:function(t){return e.select(e.TabID.VideoSplit)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"view_column",text:"排序"},on:{click:function(t){return e.select(e.TabID.VideoSort)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{disabled:e.curTimelineIsEnding,icon:"sync",text:"旋转"},on:{click:function(t){return e.select(e.TabID.VideoRotate)}}})],1)],1),r("transition",{attrs:{name:"fade"}},[r("div",{staticClass:"m-image tabBox",class:{hide:"image"!=e.toolTab}},[r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"image",text:"贴纸"},on:{click:function(t){return e.select(e.TabID.AddImage)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"photo_library",text:"本地贴纸"},on:{click:function(t){return e.select(e.TabID.AddLocalImage)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"blur_on",text:"马赛克"},on:{click:function(t){return e.select(e.TabID.Mosic)}}})],1)]),r("transition",{attrs:{name:"fade"}},[r("div",{staticClass:"m-text tabBox",class:{hide:"text"!=e.toolTab}},[r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"textsms",text:"添加文字"},on:{click:function(t){return e.select(e.TabID.AddText)}}})],1)]),r("transition",{attrs:{name:"fade"}},[r("div",{staticClass:"m-filter tabBox",class:{hide:"filter"!=e.toolTab}},[r("ClipBtn",{staticClass:"item-btn",attrs:{disabled:e.curTimelineIsEnding,icon:"face",text:"美颜"},on:{click:function(t){return e.select(e.TabID.Face)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"photo_filter",disabled:e.curTimelineIsEnding,text:"滤镜"},on:{click:function(t){return e.select(e.TabID.Filter)}}})],1)]),r("transition",{attrs:{name:"fade"}},[r("div",{staticClass:"m-music tabBox",class:{hide:"music"!=e.toolTab}},[r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"volume_up",text:"调整音量"},on:{click:function(t){return e.select(e.TabID.AudioBase)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"surround_sound",text:"添加背景音"},on:{click:function(t){return e.select(e.TabID.BGM)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"audiotrack",text:"音效"},on:{click:function(t){return e.select(e.TabID.AudioEffect)}}})],1)])],1),r("div",{staticClass:"bottomBox"},[r("mu-icon",{class:{active:"cut"==e.toolTab},attrs:{value:"duo",size:"28",color:"white"},on:{click:function(t){e.toolTab="cut"}}}),r("mu-icon",{class:{active:"image"==e.toolTab},attrs:{value:"add_photo_alternate",size:"28",color:"white"},on:{click:function(t){e.toolTab="image"}}}),r("mu-icon",{class:{active:"text"==e.toolTab},attrs:{value:"post_add",size:"28",color:"white"},on:{click:function(t){e.toolTab="text"}}}),r("mu-icon",{class:{active:"filter"==e.toolTab},attrs:{value:"movie_filter",size:"28",color:"white"},on:{click:function(t){e.toolTab="filter"}}}),r("mu-icon",{class:{active:"music"==e.toolTab},attrs:{value:"music_note",size:"28",color:"white"},on:{click:function(t){e.toolTab="music"}}})],1)])},gt=[],bt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("span",{staticClass:"icon",class:{active:e.active,disabled:e.disabled},on:{click:e.clicked}},[e.src?e.src?r("div",{staticClass:"img"},[r("img",{attrs:{alt:" ",src:e.src},on:{"~error":function(t){t.target.src=e.src2}}}),r("div")]):e._e():r("mu-icon",{attrs:{value:e.icon}}),r("span",[e._v(e._s(e.text))]),e._t("default")],2)},yt=[],_t={props:["text","icon","src","src2","ricon","active","disabled"],methods:{clicked:function(e){this.disabled||this.$emit("click",e)}}},xt=_t,wt=(r("1fb3"),Object(K["a"])(xt,bt,yt,!1,null,"f8360a66",null)),kt=wt.exports,Tt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"bar",attrs:{HScrollBar:""}},[e.visibleLeftArrow?r("span",{staticClass:"material-icons left-icon"},[e._v("keyboard_arrow_left")]):e._e(),e.visibleRightArrow?r("span",{staticClass:"material-icons right-icon"},[e._v("keyboard_arrow_right")]):e._e(),e._t("default")],2)},Rt=[],Ot=20,Ct={props:["scroller"],data:function(){return{visibleLeftArrow:!1,visibleRightArrow:!1}},watch:{scroller:"refresh"},methods:{refresh:function(){var e=this.scroller||this.$el,t=e.scrollLeft,r=e.scrollWidth,n=e.offsetWidth;this.visibleLeftArrow=t>Ot,this.visibleRightArrow=t+n+Ot<r}},beforeDestroy:function(){this.$refs.bar.removeEventListener("scroll",this.onscroll,!0)},mounted:function(){this.onscroll=this.refresh.bind(this),this.$nextTick(this.onscroll),setTimeout(this.onscroll,1e3),this.$refs.bar.addEventListener("scroll",this.onscroll,!0)}},Pt=Ct,At=(r("7674"),Object(K["a"])(Pt,Tt,Rt,!1,null,"54853b12",null)),It=At.exports,St=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"overlayToolTabBox"},[r("div",{staticClass:"overlayToolTab"},[e.activeItem&&e.activeItem.text?[r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"edit",text:"编辑"},nativeOn:{click:function(t){return e.select(e.TabID.Edit)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"format_paint",text:"样式"},nativeOn:{click:function(t){return e.select(e.TabID.Template)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"tune",text:"调整"},nativeOn:{click:function(t){return e.select(e.TabID.Settings)}}})]:e._e(),[r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"delete_forever",text:"删除"},nativeOn:{click:function(t){return e.select(e.TabID.Remove)}}}),r("ClipBtn",{staticClass:"done-btn",attrs:{icon:"done"},nativeOn:{click:function(t){return e.select(e.TabID.Done)}}})]],2)])},jt=[],Et=0,$t={Edit:Et++,Template:Et++,Settings:Et++,Remove:Et++,Done:Et++},Mt={TabID:$t,components:{ClipBtn:kt},props:["activeItem"],data:function(){return{TabID:$t}},methods:{select:function(e){this.$emit("select",e,this.activeItem)}}},Dt=Mt,Lt=(r("dbee"),Object(K["a"])(Dt,St,jt,!1,null,"44fcf3a9",null)),Ft=Lt.exports,Ut=0,Bt={VideoAdd:Ut++,VideoRemove:Ut++,VideoRotate:Ut++,VideoSort:Ut++,VideoSplit:Ut++,VideoVFlip:Ut++,VideoHFlip:Ut++,VideoBase:Ut++,AddImage:Ut++,AddLocalImage:Ut++,AddText:Ut++,AudioBase:Ut++,BGM:Ut++,Face:Ut++,Filter:Ut++,Mosic:Ut++,AudioEffect:Ut++,AspectRatio:Ut++,ImageTab:Ut++,TextTab:Ut++,AudioTab:Ut++,OtherTab:Ut++,ToolEdit:Ut++,ToolTemplate:Ut++,ToolSettings:Ut++,ToolRemove:Ut++,ToolDone:Ut++},Nt={TabID:Bt,components:{ClipBtn:kt,OverlayToolTab:Ft,HScrollBar:It},props:["activeItem"],data:function(){return{TabID:Bt,toolTab:"cut"}},watch:{activeItem:function(e){e&&(e.type==ge.Overlay.Type.Text?this.toolTab="text":e.type!=ge.Overlay.Type.Image&&e.type!=ge.Overlay.Type.Mosic||(this.toolTab="image"))},toolTab:function(e){"image"==e?this.$emit("select",Bt.ImageTab):"text"==e?this.$emit("select",Bt.TextTab):"music"==e?this.$emit("select",Bt.AudioTab):this.$emit("select",Bt.OtherTab)}},computed:{isCurTimelineRemovable:function(){var e=N.editlist.timelines;if(e.length<=1)return!1;var t=e[e.length-1].ending;if(t){var r=N.editlist.cur_timeline_id,n=N.editlist.timelines.filter((function(e){return e.id==r}))[0];if(n.ending)return!0;if(e.length<=2)return!1}return!0},curTimelineIsEnding:function(){var e=N.editlist.cur_timeline_id,t=N.editlist.timelines.filter((function(t){return t.id==e}))[0];return t&&t.ending}},methods:{select:function(e){this.$emit("select",e)},overlayTabSelect:function(e,t){var r;switch(e){case Ft.TabID.Edit:r=Bt.ToolEdit;break;case Ft.TabID.Template:r=Bt.ToolTemplate;break;case Ft.TabID.Settings:r=Bt.ToolSettings;break;case Ft.TabID.Remove:r=Bt.ToolRemove;break;case Ft.TabID.Done:r=Bt.ToolDone;break;default:return}this.$emit("select",r,t)}}},Ht=Nt,Xt=(r("92bd"),Object(K["a"])(Ht,vt,gt,!1,null,"5504f62e",null)),zt=Xt.exports,Vt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("transition",{attrs:{name:"fade"},on:{"after-leave":function(t){return e.$emit("close")}}},[e.tabid>=0?r("div",{staticClass:"dialog-main",style:e.style},[r("div",{staticClass:"dialog-content"},[e.tabid==e.TabID.AudioBase?r("AudioBase",{ref:"audiobBase",attrs:{title:e.title},on:{"update:title":function(t){e.title=t},change:e.change}}):e._e(),e.tabid==e.TabID.VideoSort?r("Sort",{ref:"sort",attrs:{title:e.title,accept:e.dialogAccept},on:{"update:title":function(t){e.title=t},change:e.change}}):e._e(),e.tabid==e.TabID.BGM?r("BGM",{ref:"bgm",attrs:{title:e.title,accept:e.dialogAccept},on:{"update:title":function(t){e.title=t},change:e.change}}):e._e(),e.tabid==e.TabID.AudioEffect?r("AudioEffect",{ref:"audioEffect",attrs:{title:e.title,accept:e.dialogAccept},on:{"update:title":function(t){e.title=t},change:e.change}}):e._e(),e.tabid==e.TabID.Filter?r("VFilter",{ref:"vfilter",attrs:{title:e.title},on:{"update:title":function(t){e.title=t},change:e.change}}):e._e(),e.tabid==e.TabID.Face?r("Face",{ref:"face",attrs:{title:e.title},on:{"update:title":function(t){e.title=t},change:e.change}}):e._e(),e.tabid==e.TabID.AddImage?r("ImageOverlay",{ref:"imageOverlay",attrs:{title:e.title,options:e.options,postermode:e.postermode},on:{"update:title":function(t){e.title=t},change:e.change,beforechange:e.beforechange}}):e._e(),e.tabid==e.TabID.AddText?r("TextOverlay",{ref:"textOverlay",attrs:{title:e.title,postermode:e.postermode,accept:e.dialogAccept,options:e.options},on:{"update:title":function(t){e.title=t},change:e.change,beforechange:e.beforechange}}):e._e(),e.tabid==e.TabID.VideoBase?r("VideoBase",{ref:"videoBase",attrs:{title:e.title},on:{"update:title":function(t){e.title=t},change:e.change}}):e._e(),e.tabid==e.TabID.AspectRatio?r("AspectRatio",{ref:"aspectRatio",attrs:{title:e.title},on:{"update:title":function(t){e.title=t},change:e.change}}):e._e()],1),r("div",{staticClass:"bottom-title"},[e.dialogAcceptable?e._e():r("mu-button",{staticClass:"accept-btn",attrs:{flat:"",color:"white"},on:{click:e.close}},[r("mu-icon",{attrs:{value:""}})],1),e.dialogAcceptable?r("mu-button",{staticClass:"close-btn",attrs:{flat:"",color:"white"},on:{click:e.close}},[r("mu-icon",{attrs:{value:"close"}})],1):e._e(),r("div",{staticClass:"title"},[e._v(e._s(e.title))]),e.dialogAcceptable?r("mu-button",{staticClass:"accept-btn",attrs:{flat:"",color:"white"},on:{click:e.accept}},[r("mu-icon",{attrs:{value:"check"}})],1):e._e(),e.dialogAcceptable?e._e():r("mu-button",{staticClass:"accept-btn",attrs:{flat:"",color:"white"},on:{click:e.close}},[r("mu-icon",{attrs:{value:"keyboard_arrow_down"}})],1)],1)]):e._e()])},Yt=[],qt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"audio-base-main",on:{touchend:e.touchend}},[r("span",{staticStyle:{color:"white",width:"100px"}},[e._v("音量("+e._s(e.volume)+")")]),r("mu-slider",{staticStyle:{margin:"0"},attrs:{min:0,max:300,step:1},model:{value:e.volume,callback:function(t){e.volume=t},expression:"volume"}})],1)},Gt=[],Wt=r("84a2"),Jt=r.n(Wt),Kt={props:["title"],data:function(){return{volume:100}},watch:{volume:function(e){this.changeVolume(e)}},methods:{changeVolume:Jt()((function(e){N.editlist.audio.volume=e,R.uilog("/tool/volume","changed: ".concat(e))}),500),touchend:function(){},onDialogClose:function(){this.initState&&this.initState.volume!=this.audio.volume&&we.createOperateHistory(ge.Operate.AudioParamsModify.Type)}},mounted:function(){this.volume=N.editlist.audio.volume,this.$emit("update:title","音量"),this.initState={volume:this.audio.volume}}},Qt=Kt,Zt=(r("8fb4"),Object(K["a"])(Qt,qt,Gt,!1,null,"e285fa2e",null)),er=Zt.exports,tr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{width:"100%",padding:"5px 10px",height:"100%",display:"flex","flex-direction":"column"}},[r("div",{staticStyle:{color:"white",padding:"5px 0"}},[e._v(" 当前背景乐: "),r("span",{staticStyle:{background:"white",color:"gray","border-radius":"3px",padding:"3px 5px"},on:{click:e.remove}},[e._v(e._s(e.bgm&&e.bgm.name||"无")+" "+e._s(e.bgm&&e.bgm.name&&"删除"))])]),r("div",{staticClass:"audio-base-main",staticStyle:{padding:"5px 0"},on:{touchend:e.touchend}},[r("span",{staticStyle:{color:"white",width:"100px","white-space":"nowrap","padding-right":"10px"}},[e._v("背景音量("+e._s(e.volume)+")")]),r("mu-slider",{staticStyle:{margin:"0"},attrs:{min:0,max:300,step:1},model:{value:e.volume,callback:function(t){e.volume=t},expression:"volume"}})],1),r("div",{staticStyle:{"border-top":"1px solid gray",width:"100%",display:"flex"}},[r("HScrollBar",{staticClass:"tabs"},[e.isAndroid()?r("div",{staticClass:"tab",on:{click:e.pickAudio}},[e._v("本地音乐")]):e._e(),e._l(e.allBGM.filter((function(e){return e.list})),(function(t,n){return r("div",{key:n,staticClass:"tab",class:{active:e.active==n},on:{click:function(t){e.active=n}}},[e._v(e._s(t.name))])}))],2)],1),e._l(e.allBGM.filter((function(e){return e.list})),(function(t,n){return r("div",{directives:[{name:"show",rawName:"v-show",value:e.active==n,expression:"active == idx"}],key:t.name,staticStyle:{height:"100%",overflow:"auto"}},e._l(t.list,(function(n){return r("div",{key:t.name+n.name,staticClass:"bgmItem",class:{active:e.selectedBGMName==n.name},on:{click:function(t){return e.toggleBGM(n)}}},[n.playing?r("div",{staticClass:"playing musicmu-icon"},[r("mu-icon",{staticClass:"icon",attrs:{value:"format_align_left",size:"16"}})],1):r("mu-icon",{staticClass:"musicmu-icon",attrs:{size:"14",value:"music_note"}}),r("span",{staticClass:"musicName"},[e._v(e._s(n.name))]),r("span",{staticClass:"musicDuration"},[e._v(e._s(n.duration))]),n.local_file||n.download?e._e():r("mu-icon",{staticClass:"musicPlaymu-icon",attrs:{value:"arrow_downward"}}),n.download?r("mu-circular-progress",{staticStyle:{zoom:"0.2","margin-left":"10px"},attrs:{value:n.download.percent,size:60,color:"gray","stroke-width":10}}):e._e()],1)})),0)}))],2)},rr=[],nr=(r("b0c0"),{components:{HScrollBar:It},data:function(){return{active:0,volume:100,allBGM:[],bgm:null}},props:["accept"],computed:{selectedBGMName:function(){return this.bgm?this.bgm.name:"无背景音"}},watch:{accept:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.stop();case 2:e&&(n=N.editlist.bgm.url,t.bgm?(N.editlist.bgm.url=t.bgm.local_file.toNativeURL(),N.editlist.bgm.volume=t.volume):N.editlist.bgm.url="",n!=N.editlist.bgm.url&&(R.uilog("/tool/bgm","change: ".concat(t.bgm)),t.$emit("change"),N.editlist.bgm.url?n?t.initState.volume!=t.volume&&we.createOperateHistory(ge.Operate.BGMParamsModify.Type):we.createOperateHistory(ge.Operate.BGMSet.Type):we.createOperateHistory(ge.Operate.BGMUnset.Type)),t.$parent.close());case 3:case"end":return r.stop()}}),r)})))()},volume:function(e){this._audio&&(this._audio.volume=Math.min(1,e/100)),this.changeVolume(e)}},methods:{toggleBGM:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!e.playing||e!=t.bgm){r.next=5;break}return r.next=3,t.stop();case 3:r.next=7;break;case 5:return r.next=7,t.play(e);case 7:case"end":return r.stop()}}),r)})))()},changeVolume:Jt()((function(e){N.editlist.bgm.volume=e})),remove:function(){this.bgm=null,this.stop()},touchend:function(){},stop:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e._audio){t.next=7;break}return e._audio.pause(),e._audio.removeAttribute("src"),e._audio.load(),e._audio.onended&&e._audio.onended(),t.next=7,new Promise((function(e){return setTimeout(e,100)}));case 7:case"end":return t.stop()}}),t)})))()},play:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e.local_file||e.download){r.next=3;break}return P.downloadRes(P.ResType.music,e),r.abrupt("return");case 3:if(t.bgm=e,!e.local_file){r.next=18;break}return r.next=7,t.stop();case 7:if(!e.nobgm){r.next=10;break}return t.bgm=null,r.abrupt("return");case 10:return e.playing=!0,t.bgm=null,t.bgm=e,r.next=15,new Promise((function(r,n){t._audio=t._audio||new Audio,t._audio.src=e.local_file.toInternalURL(),t._audio.onended=r,t._audio.onerror=n,t._audio.volume=Math.min(1,t.volume/100),t._audio.play()}));case 15:e.playing=!1,t.bgm=null,t.bgm=e;case 18:case"end":return r.stop()}}),r)})))()},pickAudio:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,P.pickAudio();case 2:if(r=t.sent,r.path){t.next=6;break}return e.$snotify.error("选择失败"),t.abrupt("return");case 6:return t.next=8,e.getLocalAudio("file://"+r.path);case 8:n=t.sent,e.play(n);case 10:case"end":return t.stop()}}),t)})))()},getLocalAudio:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,new Promise(resolveLocalFileSystemURL.bind(window,e));case 2:return r=t.sent,n={name:r.name,local_file:r},t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})))()}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$emit("update:title","背景音乐"),e.$parent.acceptable(),t.next=4,P.fetchResList(P.ResType.music);case 4:if(e.allBGM=t.sent,e.bgm=e.allBGM.flatMap((function(e){return e.list})).filter((function(e){return e.local_file&&e.local_file.toNativeURL()==N.editlist.bgm.url}))[0],e.bgm||!N.editlist.bgm.url){t.next=10;break}return t.next=9,e.getLocalAudio(N.editlist.bgm.url);case 9:e.bgm=t.sent;case 10:e.volume=N.editlist.bgm.volume,e.initState={volume:e.volume};case 12:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){this.stop()}}),ir=nr,ar=(r("8746"),Object(K["a"])(ir,tr,rr,!1,null,"020c8ca4",null)),sr=ar.exports,or=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"audioEffect"},[r("mu-list",{staticClass:"main",attrs:{value:e.mainActive},on:{change:function(t){e.mainActive=t}}},e._l(e.allAudio,(function(t){return r("mu-list-item",{key:t.name,class:{active:e.mainActive==t.name},attrs:{value:t.name,button:!0}},[r("mu-list-item-title",[e._v(e._s(t.name))])],1)})),1),r("mu-list",{staticClass:"sub"},e._l(e.subList,(function(t){return r("mu-list-item",{key:t.name,attrs:{button:!0},on:{click:function(r){return e.chooseSubItem(t)}}},[r("mu-list-item-title",{staticClass:"subItem",class:{active:e.subActive&&e.subActive.name==t.name}},[t.playing?r("div",{staticClass:"playing"},[r("mu-icon",{staticClass:"icon",attrs:{value:"format_align_left",size:"16"}})],1):r("mu-icon",{attrs:{value:"music_note",size:"16"}}),r("div",{staticClass:"text"},[e._v(e._s(t.name))]),t.local_file||t.download?e._e():r("mu-icon",{staticClass:"musicPlaymu-icon",attrs:{value:"arrow_downward"}}),r("div",{staticStyle:{"text-align":"right"}},[t.download?r("mu-icon",{staticClass:"loading",attrs:{value:"rotate_left",size:"16"}}):r("span",[e._v(e._s(t.duration)+"″")])],1)],1)],1)})),1)],1)},cr=[],lr={props:["accept"],data:function(){return{mainActive:1,subActive:null,allAudio:[],subList:null}},watch:{mainActive:function(e){var t=this.allAudio.filter((function(t){return t.name==e}))[0];t&&(this.subList=t.list)},accept:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.stop();case 2:e&&t.subActive&&(N.editlist.add_amix(t.subActive),R.uilog("/tool/audio_effect","change: ".concat(JSON.stringify(t.subActive))),t.$emit("change"),we.createOperateHistory(ge.Operate.AudioEffectAdd.Type)),t.$parent.close();case 4:case"end":return r.stop()}}),r)})))()}},methods:{chooseSubItem:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.subActive!=e||!e.playing){r.next=4;break}return r.next=3,t.stop();case 3:return r.abrupt("return");case 4:return r.next=6,t.play(e);case 6:case"end":return r.stop()}}),r)})))()},stop:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e._audio){t.next=7;break}return e._audio.pause(),e._audio.removeAttribute("src"),e._audio.load(),e._audio.onended&&e._audio.onended(),t.next=7,new Promise((function(e){return setTimeout(e,100)}));case 7:case"end":return t.stop()}}),t)})))()},play:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e.local_file||e.download){r.next=3;break}return P.downloadRes(P.ResType.audio,e),r.abrupt("return");case 3:if(t.subActive=e,!e.local_file){r.next=13;break}return r.next=7,t.stop();case 7:return e.playing=!0,t.subList=t.subList.slice(0),r.next=11,new Promise((function(r,n){t._audio=t._audio||new Audio,t._audio.src=e.local_file.toInternalURL(),t._audio.onended=r,t._audio.onerror=n,t._audio.play()}));case 11:e.playing=!1,t.subList=t.subList.slice(0);case 13:case"end":return r.stop()}}),r)})))()}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$emit("update:title","音效"),e.$parent.acceptable(),t.next=4,P.fetchResList(P.ResType.audio);case 4:e.allAudio=t.sent,e.mainActive=e.allAudio[0].name;case 6:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){this.stop()}},ur=lr,dr=(r("7972"),r("83a6"),Object(K["a"])(ur,or,cr,!1,null,"7807f21b",null)),fr=dr.exports,pr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"filter-box"},[r("div",{staticClass:"filter-slider",style:{visibility:e.filter&&e.filter.percent>=0?"":"hidden"}},[r("span",[e._v(e._s(e.filter&&e.filter.name))]),r("mu-slider",{staticClass:"slider",attrs:{min:0,max:100,step:5,color:"red"},model:{value:e.percent,callback:function(t){e.percent=t},expression:"percent"}}),r("span",{staticStyle:{width:"50px","text-align":"center"}},[e._v(e._s(e.percent))])],1),r("mu-tabs",{attrs:{value:e.active,color:"transparent","indicator-color":"red","text-color":"white",left:""},on:{"update:value":function(t){e.active=t}}},e._l(e.allFilter.filter((function(e){return e.list})),(function(t,n){return r("mu-tab",{key:n},[e._v(e._s(t.name))])})),1),r("div",{staticClass:"filter-main"},[r("ClipBtn",{staticClass:"item-btn",class:{active:e.noactive},attrs:{icon:"check",text:"无滤镜"},nativeOn:{click:function(t){return e.toggleEffect()}}}),r("div",{staticStyle:{margin:"10px",height:"60%","border-right":"1px solid gray"}}),e._l(e.allFilter.filter((function(e){return e.list})),(function(t,n){return[e.active==n?r("div",{key:n,staticStyle:{display:"flex"}},e._l(t.list,(function(t){return r("ClipBtn",{key:t.name,staticClass:"item-btn",attrs:{active:e.filter&&t.name==e.filter.name,src:t.thumb_remote_url,src2:t.thumb_rel_url,text:t.name},nativeOn:{click:function(r){return e.toggleEffect(t)}}},[e.isNeedDownload(t)?r("mu-icon",{staticClass:"downloadmu-icon",attrs:{value:"arrow_downward"}}):e._e(),t.download?r("mu-circular-progress",{staticClass:"loadingmu-icon",staticStyle:{zoom:"0.2","margin-left":"10px"},attrs:{value:t.download.percent,size:60,color:"white","stroke-width":10}}):e._e()],1)})),1):e._e()]}))],2)],1)},mr=[],hr={components:{ClipBtn:kt},data:function(){return{allFilter:[],active:0,percent:100,filter:null}},watch:{percent:function(e){N.editlist.filter_percent=e,this.filter&&(this.filter.percent=e)}},computed:{noactive:function(){return!this.filter}},methods:{isNeedDownload:function(e){return!!(!e.local_file||e.source_list&&e.source_list.filter((function(t,r){return!e.local_file_list[r]})).length)&&!e.download},toggleEffect:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e){r.next=5;break}return N.editlist.filter.length=0,N.editlist.filter_reset="",t.filter=null,r.abrupt("return");case 5:if(t.filter&&e.name==t.filter.name){r.next=10;break}if(!t.isNeedDownload(e)){r.next=9;break}return r.next=9,P.downloadRes(P.ResType.filter,e,(function(t){e.download.percent=Math.ceil(100*t)}));case 9:e.local_file&&(N.editlist.filter.length=0,R.uilog("/tool/filter","change: ".concat(JSON.stringify(e))),N.editlist.filter.push(e),N.editlist.filter_reset=[e.local_file.toNativeURL()].concat(Object(u["a"])(e.local_file_list&&e.local_file_list.map((function(e){return e.toNativeURL()}))||[])).map((function(e){return e.replace("file://","")})).join("|"),t.filter=e,e.percent=100);case 10:case"end":return r.stop()}}),r)})))()},onDialogClose:function(){if(this.initState){var e=N.editlist.filter[0]&&N.editlist.filter[0].name;!this.initState.filterName&&e?we.createOperateHistory(ge.Operate.FilterEnable.Type):this.initState.filterName&&!e?we.createOperateHistory(ge.Operate.FilterDisable.Type):this.initState.filterName==e&&this.percent==this.initState.percent||we.createOperateHistory(ge.Operate.FilterModify.Type)}}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$emit("update:title","滤镜"),t.next=3,P.fetchResList(P.ResType.filter);case 3:e.allFilter=t.sent,N.editlist.filter.length&&e.allFilter.forEach((function(t){var r=t.list&&t.list.filter((function(e){return e.name==N.editlist.filter[0].name}))[0];r&&(e.filter=r)})),e.initState={percent:e.percent=N.editlist.filter_percent,filterName:N.editlist.filter[0]&&N.editlist.filter[0].name};case 6:case"end":return t.stop()}}),t)})))()}},vr=hr,gr=(r("8108"),Object(K["a"])(vr,pr,mr,!1,null,"1c097dd7",null)),br=gr.exports,yr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"image-main"},[r("ScrollTab",{attrs:{value:e.active,color:"transparent","indicator-color":"red","text-color":"white",left:""},on:{"update:value":function(t){e.active=t}}},e._l(e.allSticker,(function(t,n){return r("mu-tab",{key:n},[e._v(e._s(t.name))])})),1),e._l(e.allSticker,(function(t,n){return r("div",{directives:[{name:"show",rawName:"v-show",value:e.active==n,expression:"active == idx"}],key:n,staticClass:"tab-box"},e._l(t.list,(function(t){return r("div",{key:t.name,staticClass:"stickerItem",on:{click:function(r){return e.chooseSticker(t)}}},[r("img",{attrs:{loop:"0",alt:" ",src:t.thumb_remote_url+"/"+t.source+".thumb.apng"},on:{"~error":function(e){e.target.src=t.thumb_rel_url+t.source+".thumb.apng"}}}),t.local_file||t.download?e._e():r("mu-icon",{staticClass:"downloadmu-icon",attrs:{value:"arrow_downward"}}),t.download?r("mu-circular-progress",{staticClass:"loadingmu-icon",staticStyle:{zoom:"0.2","margin-left":"10px"},attrs:{value:t.download.percent,size:60,color:"white","stroke-width":10}}):e._e()],1)})),0)}))],2)},_r=[],xr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("HScrollBar",{staticClass:"scroll-tab",attrs:{scroller:e.scroller}},[r("mu-tabs",e._b({ref:"tab",on:{"update:value":function(t){return e.$emit("update:value",t)},change:function(t){e.fixTab(t),e.$emit("change",t)}}},"mu-tabs",e.$attrs,!1),[e._t("default")],2)],1)},wr=[],kr={components:{HScrollBar:It},data:function(){return{scroller:null}},methods:{fixTab:function(e){var t=this.$refs.tab.$el,r=t.querySelector(".mu-tab-link-highlight"),n=t.children[e].offsetLeft;t.children[e].scrollIntoView(!0),this.$nextTick((function(){var e=r.style.cssText;r.style.cssText=e.replace(/(translate\().*,/,"$1"+n+"px,")}))}},mounted:function(){var e=this;this.$nextTick((function(){e.scroller=e.$refs.tab.$el}))}},Tr=kr,Rr=(r("0f20"),Object(K["a"])(Tr,xr,wr,!1,null,null,null)),Or=Rr.exports,Cr={props:["postermode"],components:{ScrollTab:Or},data:function(){return{active:0,allSticker:[]}},methods:{chooseSticker:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e.local_file||e.download){r.next=3;break}return P.downloadRes(P.ResType.image,e,(function(t){e.download.percent=Math.ceil(100*t)})),r.abrupt("return");case 3:n=0==N.editlist.overlay.filter((function(e){return e.new})).length,e.local_file&&n&&(t.$emit("beforechange",{overlay:i}),i=N.editlist.add_overlay({end_sec:+e.duration,url:e.local_file.toURL(),type:ge.Overlay.Type.Image},t.postermode),R.uilog("/tool/overlay","choose ".concat(JSON.stringify(i))),t.$emit("change",{overlay:i}),we.createOperateHistory(ge.Operate.ImageAdd.Type,i.id),t.$parent.close());case 5:case"end":return r.stop()}}),r)})))()}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,P.fetchResList(P.ResType.image);case 2:e.allSticker=t.sent,e.$emit("update:title","贴纸");case 4:case"end":return t.stop()}}),t)})))()}},Pr=Cr,Ar=(r("532f"),Object(K["a"])(Pr,yr,_r,!1,null,"769a1834",null)),Ir=Ar.exports,Sr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"textOverlay"},[r("TextRender",e._b({directives:[{name:"show",rawName:"v-show",value:e.overlay.text,expression:"overlay.text"}],ref:"textRender",staticClass:"text-render"},"TextRender",e.overlay,!1)),r("mu-tabs",{attrs:{value:e.active,color:"transparent","indicator-color":"red","text-color":"white",left:""},on:{"update:value":function(t){e.active=t}}},[r("mu-tab",{attrs:{value:e.TabID.Edit}},[r("mu-icon",{attrs:{value:"keyboard"}}),e._v("文字 ")],1),r("mu-tab",{attrs:{value:e.TabID.Template}},[r("mu-icon",{attrs:{value:"extension"}}),e._v("样式 ")],1),r("mu-tab",{attrs:{value:e.TabID.Settings}},[r("mu-icon",{attrs:{value:"tune"}}),e._v("调整 ")],1)],1),r("div",{directives:[{name:"show",rawName:"v-show",value:e.active==e.TabID.Edit,expression:"active == TabID.Edit"}]},[r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.overlay.text,expression:"overlay.text"}],ref:"input",staticStyle:{width:"100%",border:"1px solid #666","border-radius":"5px","font-size":"16px",height:"32px","line-height":"2",padding:"0 10px"},style:e.inputStyles,attrs:{type:"text",placeholder:"请输入文本"},domProps:{value:e.overlay.text},on:{input:function(t){t.target.composing||e.$set(e.overlay,"text",t.target.value)}}})]),r("div",{directives:[{name:"show",rawName:"v-show",value:e.active==e.TabID.Template,expression:"active == TabID.Template"}]},[r("mu-tabs",{attrs:{value:e.templateActive,color:"transparent","indicator-color":"rgba(255,255,255,0.3)","text-color":"white",left:""},on:{"update:value":function(t){e.templateActive=t}}},e._l(e.allBg,(function(t){return r("mu-tab",{key:t.name,attrs:{value:t.name}},[e._v(e._s(t.name))])})),1),e._l(e.allBg,(function(t){return r("div",{directives:[{name:"show",rawName:"v-show",value:e.templateActive==t.name,expression:"templateActive == e.name"}],key:t.name,staticClass:"y-scroller stickerList",attrs:{value:t.name}},[r("div",{staticClass:"stickerItem none",on:{click:e.clearTemplate}},[r("mu-icon",{attrs:{value:"block",size:"24",color:"#eee"}})],1),e._l(t.list,(function(t,n){return r("div",{key:n,staticClass:"stickerItem",class:{active:t.name==e.overlay.templateName},on:{click:function(r){return e.chooseBubble(t)}}},[r("img",{attrs:{alt:" ",src:t.thumb_remote_url},on:{"~error":function(e){e.target.src=t.thumb_rel_url}}}),t.local_file||t.download?e._e():r("mu-icon",{staticClass:"downloadmu-icon",attrs:{value:"arrow_downward"}}),t.download?r("mu-circular-progress",{staticClass:"loadingmu-icon",staticStyle:{zoom:"0.2","margin-left":"10px"},attrs:{value:t.download.percent,size:60,color:"white","stroke-width":10}}):e._e()],1)}))],2)}))],2),r("div",{directives:[{name:"show",rawName:"v-show",value:e.active==e.TabID.Settings,expression:"active == TabID.Settings"}]},[r("div",{staticClass:"scroller"},[r("div",{staticClass:"stickerList nowrap"},[r("div",{staticClass:"stickerItem fontItem",class:{active:null==e.overlay.font},on:{click:e.clearFont}},[e._v("系统字体")]),e._l(e.allFont,(function(t,n){return r("div",{key:n,staticClass:"stickerItem fontItem",class:{active:t.family==e.overlay.font},on:{click:function(r){return e.chooseFont(t)}}},[r("img",{attrs:{alt:" ",src:t.thumb_remote_url},on:{"~error":function(e){e.target.src=t.thumb_rel_url}}}),t.local_file||t.download?e._e():r("mu-icon",{staticClass:"downloadmu-icon",attrs:{value:"arrow_downward"}}),t.download?r("mu-circular-progress",{staticClass:"loadingmu-icon",staticStyle:{zoom:"0.2","margin-left":"10px","line-height":"0"},attrs:{value:t.download.percent,size:50,color:"white","stroke-width":10}}):e._e()],1)}))],2)]),r("div",{staticClass:"stickerList align"},[r("mu-icon",{staticClass:"alignItem",class:{active:e.Const.Overlay.Align.Left==e.overlay.align},attrs:{value:"format_align_left"},on:{click:function(t){return e.chooseAlign(e.Const.Overlay.Align.Left)}}}),r("mu-icon",{staticClass:"alignItem",class:{active:e.Const.Overlay.Align.Center==e.overlay.align},attrs:{value:"format_align_center"},on:{click:function(t){return e.chooseAlign(e.Const.Overlay.Align.Center)}}}),r("mu-icon",{staticClass:"alignItem",class:{active:e.Const.Overlay.Align.Right==e.overlay.align},attrs:{value:"format_align_right"},on:{click:function(t){return e.chooseAlign(e.Const.Overlay.Align.Right)}}})],1),r("div",[r("mu-tabs",{attrs:{value:e.colorTabActive,color:"transparent","indicator-color":"rgba(255,255,255,0.3)","text-color":"white",left:""},on:{"update:value":function(t){e.colorTabActive=t}}},[r("mu-tab",{attrs:{value:"文字颜色"}},[e._v("文字颜色")]),r("mu-tab",{attrs:{value:"描边"}},[e._v("描边")]),r("mu-tab",{attrs:{value:"阴影"}},[e._v("阴影")]),r("mu-tab",{attrs:{value:"背景"}},[e._v("背景")])],1),r("div",{directives:[{name:"show",rawName:"v-show",value:"文字颜色"==e.colorTabActive,expression:"colorTabActive == '文字颜色'"}]},[r("div",{staticClass:"stickerList nowrap colorList scroller"},e._l(e.ColorPreset,(function(t,n){return r("div",{key:n,staticClass:"colorItem",class:{active:t==e.overlay.color},style:{background:t},on:{click:function(r){e.overlay.color=t}}})})),0),r("div",{staticClass:"bottomSlider"},[r("label",{staticClass:"label"},[e._v("透明度")]),r("mu-slider",{staticClass:"slider",attrs:{"track-color":"#666",max:1,min:0,step:.01},model:{value:e.overlay.transparent,callback:function(t){e.$set(e.overlay,"transparent",t)},expression:"overlay.transparent"}})],1)]),r("div",{directives:[{name:"show",rawName:"v-show",value:"描边"==e.colorTabActive,expression:"colorTabActive == '描边'"}]},[r("div",{staticClass:"stickerList nowrap colorList scroller"},[r("div",{staticClass:"colorItem none",on:{click:function(t){e.overlay.borderColor=null}}},[e._v("无")]),e._l(e.ColorPreset,(function(t,n){return r("div",{key:n,staticClass:"colorItem",class:{active:t==e.overlay.borderColor},style:{background:t},on:{click:function(r){e.overlay.borderColor=t}}})}))],2),r("div",{staticClass:"bottomSlider"},[r("label",{staticClass:"label"},[e._v("粗细")]),r("mu-slider",{staticClass:"slider",attrs:{"track-color":"#666",max:5,min:1,step:.01},model:{value:e.overlay.borderSize,callback:function(t){e.$set(e.overlay,"borderSize",t)},expression:"overlay.borderSize"}})],1)]),r("div",{directives:[{name:"show",rawName:"v-show",value:"阴影"==e.colorTabActive,expression:"colorTabActive == '阴影'"}]},[r("div",{staticClass:"stickerList nowrap colorList scroller"},[r("div",{staticClass:"colorItem none",on:{click:function(t){e.overlay.shadowColor=null}}},[e._v("无")]),e._l(e.ColorPreset,(function(t,n){return r("div",{key:n,staticClass:"colorItem",class:{active:t==e.overlay.shadowColor},style:{background:t},on:{click:function(r){e.overlay.shadowColor=t}}})}))],2),r("div",{staticClass:"bottomSlider"},[r("label",{staticClass:"label"},[e._v("强度")]),r("mu-slider",{staticClass:"slider",attrs:{"track-color":"#666",max:10,min:0,step:.01},model:{value:e.overlay.shadowLevel,callback:function(t){e.$set(e.overlay,"shadowLevel",t)},expression:"overlay.shadowLevel"}})],1)]),r("div",{directives:[{name:"show",rawName:"v-show",value:"背景"==e.colorTabActive,expression:"colorTabActive == '背景'"}]},[r("div",{staticClass:"stickerList nowrap colorList scroller"},[r("div",{staticClass:"colorItem none",on:{click:function(t){e.overlay.backgroundColor=null}}},[e._v("无")]),e._l(e.ColorPreset,(function(t,n){return r("div",{key:n,staticClass:"colorItem",class:{active:t==e.overlay.backgroundColor},style:{background:t},on:{click:function(r){e.overlay.backgroundColor=t}}})}))],2),r("div",{staticClass:"bottomSlider"},[r("label",{staticClass:"label"},[e._v("透明度")]),r("mu-slider",{staticClass:"slider",attrs:{"track-color":"#666",max:1,min:0,step:.01},model:{value:e.overlay.backgroundTransparent,callback:function(t){e.$set(e.overlay,"backgroundTransparent",t)},expression:"overlay.backgroundTransparent"}})],1)])],1)])],1)},jr=[],Er=(r("2b3d"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"box"},[r("div",{staticClass:"border"},[e.loading?r("mu-icon",{staticClass:"loading",attrs:{value:"refresh",size:"30"}}):e._e(),r("canvas",{ref:"canvas",staticClass:"main",style:e.canvasStyles,attrs:{width:"1024",height:"500"}})],1)])}),$r=[],Mr=r("cdd9"),Dr=r.n(Mr),Lr=r("32a2"),Fr=1e3,Ur="黑体",Br={props:["text","font","fontUrl","align","color","transparent","borderColor","borderSize","shadowColor","shadowLevel","backgroundColor","backgroundTransparent","templateName","templateBgUrl","endX","endY","startX","startY","wordCount"],watch:{text:"delayRefresh",font:"delayRefresh",fontUrl:"delayRefresh",align:"delayRefresh",color:"delayRefresh",transparent:"delayRefresh",borderColor:"delayRefresh",borderSize:"delayRefresh",shadowColor:"delayRefresh",shadowLevel:"delayRefresh",backgroundColor:"delayRefresh",backgroundTransparent:"delayRefresh",templateBgUrl:"delayRefresh",startX:"delayRefresh",startY:"delayRefresh",endX:"delayRefresh",endY:"delayRefresh",wordCount:"delayRefresh"},data:function(){var e=this;return{loading:!1,delayRefresh:Jt()((function(){e.$refs.canvas&&e.refresh()}),200,{leading:!1,trailing:!0}),textSize:Fr,textAreaWidth:0,textAreaHeight:0,textLines:[]}},computed:{canvasStyles:function(){return{"max-height":this.templateBgUrl?"80px":this.isHorizontal?"50px":"120px"}}},methods:{refresh:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i,a,s,o,c,l,u,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.$refs.canvas,n=e.canvasCtx,t.next=4,e._loadFont();case 4:if(!e.templateBgUrl){t.next=16;break}return t.next=7,new Promise((function(t,r){var n=new Image;n.onload=function(){return t(n)},n.onerror=r,n.crossOrigin="anonymous",n.src=e.templateBgUrl}));case 7:i=t.sent,r.width=i.naturalWidth,r.height=i.naturalHeight,n.clearRect(0,0,r.width,r.height),e.backgroundColor&&(n.fillStyle=Dr()(e.backgroundColor,1-e.backgroundTransparent),n.fillRect(0,0,r.width,r.height)),i&&i.width&&n.drawImage(i,0,0,r.width,r.height),e.text.length&&(a={x:i.naturalWidth*e.startX,y:i.naturalHeight*e.startY,width:i.naturalWidth*(e.endX-e.startX),height:i.naturalHeight*(e.endY-e.startY)},s=e.drawText(e.text,a,{textAlign:e.align==ge.Overlay.Align.Left?"left":e.align==ge.Overlay.Align.Right?"right":e.align==ge.Overlay.Align.Top?"top":"center"}),n.drawImage(s,a.x,a.y)),t.next=22;break;case 16:o=e.text.split("\n"),c=o.reduce((function(e,t){return Math.max(e,t.replace(/[^\x0-\xff]/g,"xx").length/2)}),0),l=e.text,e.align==ge.Overlay.Align.Top?(r.width=Math.ceil(Fr/c*o.length),r.height=Fr):(r.width=Fr,r.height=Math.ceil(Fr/c*o.length)),e.backgroundColor&&(n.fillStyle=Dr()(e.backgroundColor,1-e.backgroundTransparent),n.fillRect(0,0,r.width,r.height)),e.text.length&&(u={x:0,y:0,width:r.width,height:r.height},d=e.drawText(l,u,{lineBreak:"word",textAlign:e.align==ge.Overlay.Align.Left?"left":e.align==ge.Overlay.Align.Right?"right":e.align==ge.Overlay.Align.Top?"top":"center"}),n.drawImage(d,u.x,u.y));case 22:case"end":return t.stop()}}),t)})))()},drawText:function(e,t,r){var n=document.createElement("canvas"),i=n.getContext("2d");return n.width=t.width,n.height=t.height,i.shadowColor=this.shadowColor,i.strokeStyle=this.borderColor,i.fillStyle=Dr()(this.color,1-this.transparent),e&&Object(Lr["a"])(n,e,Object(f["a"])({textAlign:"center",verticalAlign:"middle",sizeToFill:!0,strokeText:!0,renderHDPI:!1,font:"10px "+(this.font||Ur),lineWidth:.05*this.borderSize/5,shadowBlur:.5*this.shadowLevel/10,paddingX:Math.min(t.width,t.height)/20,paddingY:Math.min(t.width,t.height)/20},r)),n},_loadFont:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.fontUrl){t.next=11;break}if(!document.fonts){t.next=8;break}return r=new FontFace(e.font,"url("+e.fontUrl+")"),t.next=5,r.load();case 5:document.fonts.add(r),t.next=11;break;case 8:n=document.createElement("style"),n.appendChild(document.createTextNode("                        @font-face {                        font-family: '"+e.font+"';                        src: url('"+e.fontUrl+"');                        }                    ")),document.head.appendChild(n);case 11:case"end":return t.stop()}}),t)})))()},getDataPng:function(){return this.$refs.canvas.toDataURL()},getBlob:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,r=null,t.prev=2,t.next=5,new Promise((function(t){e.$refs.canvas.toBlob(t)}));case 5:r=t.sent;case 6:return t.prev=6,e.loading=!1,t.finish(6);case 9:return t.abrupt("return",r);case 10:case"end":return t.stop()}}),t,null,[[2,,6,9]])})))()}},mounted:function(){this.canvasCtx=this.$refs.canvas.getContext("2d"),this.refresh()}},Nr=Br,Hr=(r("788a"),Object(K["a"])(Nr,Er,$r,!1,null,"0c62ceba",null)),Xr=Hr.exports,zr=(r("2095"),r("d4ea"));a["a"].use(zr["a"]);var Vr=0,Yr={Edit:Vr++,Template:Vr++,Settings:Vr++},qr=["#ffffff","#ff0000","#0000ff","#00ff00","#ff0000","#FFC0CB","#FFA500","#777777","#770000","#000077","#007700","#777700","#770077","#775533"],Gr={TabID:Yr,props:["accept","postermode","options"],components:{TextRender:Xr},data:function(){var e=this.newOverlay();return{TabID:Yr,ColorPreset:qr,Const:ge,active:Yr.Edit,colorTabActive:0,templateActive:0,isApplyToAll:!1,allTemplateWord:[],allBg:[],allFont:[],overlay:e,overlayProps:Object.keys(e).filter((function(e){return"text"!=e}))}},watch:{options:"handleOptions",active:function(){var e=this;this.categoryActive=0,this.$nextTick((function(){e.active==Yr.Edit?e.$refs.input.focus():e.$refs.input.blur()}))},accept:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a,s,o,c,l,u,d;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=!0,e&&t.overlayInitialState&&(n=Object.keys(t.overlayInitialState).find((function(e){return t.overlayInitialState[e]!=t.overlay[e]}))),!(e&&n&&t.overlay.text)){r.next=23;break}return a=t.overlay,s=!a.id,t.$emit("beforechange",{overlay:a}),null==t.overlay.id&&(a=N.editlist.add_overlay(t.overlay,t.postermode)),o=null,c=function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$refs.textRender.getBlob();case 2:if(o=e.sent,null!=o){e.next=7;break}return e.next=6,new Promise((function(e){t.$nextTick((function(){return c().then(e)}))}));case 6:return e.abrupt("return");case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r.next=11,c();case 11:return r.next=13,P.getTempFolder();case 13:return l=r.sent,u=l.name+"/textImage_"+a.id+"_"+Math.random().toString(16).replace("0.","")+".png",r.next=17,t.createCacheFile(o,u);case 17:d=r.sent,a.url=d+"?"+Math.random(),t.overlay=a,R.uilog("/tool/text","save: ".concat(a)),t.$emit("change",{overlay:a}),t.postermode||(s?we.createOperateHistory(ge.Operate.TextAdd.Type,a.id):we.createOperateHistory(ge.Operate.TextModify.Type));case 23:t.$parent.close();case 24:case"end":return r.stop()}}),r)})))()}},computed:{inputStyles:function(){var e=Math.min(this.overlay.text.split(/\n/).length,3);return{height:(e<=1?36:20*e+8)+"px","line-height":(e<=1?36:20)+"px"}}},methods:{clearTemplate:function(){this.overlay.templateName=null,this.overlay.templateBgUrl=null,this.overlay.startX=0,this.overlay.startY=0,this.overlay.endX=0,this.overlay.endY=0,this.overlay.wordCount=0},chooseTemplate:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.templateName=e.name;case 1:case"end":return r.stop()}}),r)})))()},chooseBubble:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!window.requestFileSystem){r.next=7;break}if(e.local_file||e.download){r.next=4;break}return r.next=4,P.downloadRes(P.ResType.fontbg,e);case 4:e.local_file&&(t.overlay.templateBgUrl=e.local_file.toInternalURL()),r.next=8;break;case 7:t.overlay.templateBgUrl=e.source_remote_url;case 8:t.overlay.templateBgUrl&&t.setBackground(e);case 9:case"end":return r.stop()}}),r)})))()},clearFont:function(){this.overlay.font=null,this.overlay.fontUrl=null},setBackground:function(e){this.overlay.templateName=e.name,this.overlay.startX=e.startX,this.overlay.startY=e.startY,this.overlay.endX=e.endX,this.overlay.endY=e.endY,this.overlay.wordCount=e.wordCount},chooseFont:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!window.requestFileSystem){r.next=7;break}if(e.local_file){r.next=4;break}return r.next=4,P.downloadRes(P.ResType.font,e);case 4:e.local_file&&(t.overlay.fontUrl=e.local_file.toInternalURL()),r.next=8;break;case 7:t.overlay.fontUrl=e.source_remote_url;case 8:t.overlay.fontUrl&&(t.overlay.font=e.family);case 9:case"end":return r.stop()}}),r)})))()},chooseAlign:function(e){this.overlay.align=e},newOverlay:function(){return{type:ge.Overlay.Type.Text,text:"",font:null,fontUrl:null,color:"grey",borderColor:null,shadowColor:null,backgroundColor:null,align:ge.Overlay.Align.Left,transparent:0,borderSize:1,shadowLevel:1,backgroundTransparent:0,templateName:"",templateBgUrl:null,startX:0,startY:0,endX:0,endY:0,wordCount:0}},updateOverlay:function(e){this.overlay=e},createCacheFile:function(e,t){return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(window.requestFileSystem){r.next=2;break}return r.abrupt("return",URL.createObjectURL(e));case 2:return r.next=4,P.filesystem();case 4:return n=r.sent,r.next=7,new Promise((function(e,r){n.root.getFile(t,{create:!0,exclusive:!1},e,r)}));case 7:return i=r.sent,r.next=10,new Promise((function(e,t){i.createWriter(e,t)}));case 10:return a=r.sent,r.next=13,new Promise((function(t,r){a.onwriteend=t,a.onerror=r,a.write(e)}));case 13:return r.abrupt("return",i.nativeURL);case 14:case"end":return r.stop()}}),r)})))()},handleOptions:function(){var e=this.options;if(e)switch(e.operateToolTabId){case zt.TabID.ToolEdit:this.active=Yr.Edit;break;case zt.TabID.ToolTemplate:this.active=Yr.Template;break;case zt.TabID.ToolSettings:this.active=Yr.Settings;break;default:break}e&&e.overlay?(this.updateOverlay(e.overlay),this.overlayInitialState=ye()(!0,{},e.overlay)):(this.overlay=this.newOverlay(),this.overlayInitialState=null)},applyToAll:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isApplyToAll){t.next=5;break}return r=e.overlay,n=N.editlist.overlay.map(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(n){var i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n.type!=ge.Overlay.Type.Text||n.id==r.id){t.next=17;break}return e.overlayProps.forEach((function(e){n[e]=r[e]})),e.overlay=n,t.prev=3,e.$refs.textRender.refresh(),t.next=7,e.$refs.textRender.getBlob();case 7:return i=t.sent,t.next=10,e.createCacheFile(i,"textImage_"+n.id+".png");case 10:a=t.sent,n.url=a,t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](3),R.error("create text image failed",t.t0);case 17:case"end":return t.stop()}}),t,null,[[3,14]])})));return function(e){return t.apply(this,arguments)}}()),t.next=5,Promise.all(n);case 5:case"end":return t.stop()}}),t)})))()}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.handleOptions(),e.$parent.acceptable(),e.$refs.input.focus(),t.next=5,P.fetchResList(P.ResType.font);case 5:return e.allFont=t.sent,t.next=8,P.fetchResList(P.ResType.fontbg);case 8:e.allBg=t.sent,e.$emit("update:title","贴字");case 10:case"end":return t.stop()}}),t)})))()}},Wr=Gr,Jr=(r("c5b1"),r("21ba"),Object(K["a"])(Wr,Sr,jr,!1,null,"2506cfd3",null)),Kr=Jr.exports,Qr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"videobase-item"},[r("span",[e._v("亮度("+e._s(e.eq.brightness)+")")]),r("mu-slider",{attrs:{min:-1,max:1,step:.02},on:{change:e.change},model:{value:e.eq.brightness,callback:function(t){e.$set(e.eq,"brightness",t)},expression:"eq.brightness"}})],1),r("div",{staticClass:"videobase-item"},[r("span",[e._v("对比度("+e._s(e.eq.contrast)+")")]),r("mu-slider",{attrs:{min:0,max:5,step:.05},on:{change:e.change},model:{value:e.eq.contrast,callback:function(t){e.$set(e.eq,"contrast",t)},expression:"eq.contrast"}})],1),r("div",{staticClass:"videobase-item"},[r("span",[e._v("饱和度("+e._s(e.eq.saturation)+")")]),r("mu-slider",{attrs:{min:0,max:3,step:.03},on:{change:e.change},model:{value:e.eq.saturation,callback:function(t){e.$set(e.eq,"saturation",t)},expression:"eq.saturation"}})],1),r("div",{staticClass:"videobase-item"},[r("span",[e._v("伽马值("+e._s(e.eq.gamma)+")")]),r("mu-slider",{attrs:{min:.1,max:10,step:.1},on:{change:e.change},model:{value:e.eq.gamma,callback:function(t){e.$set(e.eq,"gamma",t)},expression:"eq.gamma"}})],1),r("div",{staticStyle:{"text-align":"center"}},[r("mu-button",{attrs:{small:""},on:{click:e.resumeNormal}},[e._v("恢复默认")])],1)])},Zr=[],en={data:function(){return{eq:{brightness:0,contrast:0,saturation:0,gamma:0}}},methods:{resumeNormal:function(){this.eq.brightness=0,this.eq.contrast=1,this.eq.saturation=1,this.eq.gamma=1,this.change()},change:function(){N.editlist.update_timeline_videobase(N.editlist.cur_timeline())},onDialogClose:function(){var e=this;this.initState&&Object.keys(this.eq).find((function(t){return e.eq[t]!=e.initState.eq[t]}))&&we.createOperateHistory(ge.Operate.VideoParamsModify.Type)}},mounted:function(){this.eq=N.editlist.cur_timeline().eq,this.$emit("update:title","视频参数"),this.initState={eq:ye()(!0,{},this.eq)}}},tn=en,rn=(r("685f"),Object(K["a"])(tn,Qr,Zr,!1,null,"608f2bee",null)),nn=rn.exports,an=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"sort_main"},[r("Container",{staticClass:"sort_box",attrs:{"auto-scroll-enabled":!1,orientation:"horizontal","drag-begin-delay":200},on:{drop:e.onDrop}},[e._l(e.timelines,(function(t){return[t.ending?e._e():r("Draggable",{key:t.id,staticClass:"sort_item"},[r("div",{staticClass:"sort_head"},[e._v(e._s((t.end_sec-t.start_sec).toFixed(1)))]),r("div",{staticClass:"sort_thumb"},[t.thumbs.length&&t.thumbs[0].url?r("img",{attrs:{src:t.thumbs[0].url}}):e._e()])])]}))],2),r("div",{staticClass:"sort_tip"},[e._v("长按拖动改变顺序")])],1)},sn=[],on=r("3f7d"),cn={props:["accept"],components:{Container:on["Container"],Draggable:on["Draggable"]},data:function(){return{timelines:[]}},watch:{accept:function(e){var t=this;e&&(N.editlist.update_timelines(this.timelines),N.editlist.timelines=this.timelines,R.uilog("/tool/sort","sorted: ".concat(JSON.stringify(this.timelines.map((function(e){return e.id}))))),this.$emit("change","sort"),this.initState.timelines.find((function(e,r){return t.timelines[r].id!=e.id}))&&we.createOperateHistory(ge.Operate.VideoSort.Type)),this.$parent.close()}},methods:{onDrop:function(e){var t=e.removedIndex,r=e.addedIndex,n=e.payload;if(null!==t||null!==r){var i=Object(u["a"])(this.timelines),a=n;null!==t&&(a=i.splice(t,1)[0]),null!==r&&i.splice(r,0,a),this.timelines=i}}},mounted:function(){this.timelines=N.editlist.timelines,this.$emit("update:title","排序"),this.$parent.acceptable(),this.initState={timelines:ye()(!0,[],this.timelines)}}},ln=cn,un=(r("e65f"),r("6a78"),Object(K["a"])(ln,an,sn,!1,null,"facd8976",null)),dn=un.exports,fn=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"face-main"},[r("mu-switch",{attrs:{color:"red"},model:{value:e.enabled,callback:function(t){e.enabled=t},expression:"enabled"}}),r("span",{staticStyle:{color:"white",width:"100px"}},[e._v("美颜级别")]),r("mu-slider",{staticStyle:{margin:"0"},attrs:{disabled:!e.enabled,min:0,max:10,step:1},model:{value:e.face.level,callback:function(t){e.$set(e.face,"level",t)},expression:"face.level"}}),r("div",{staticStyle:{width:"50px","text-align":"center"}},[e._v(e._s(e.face.level))])],1)},pn=[],mn={data:function(){return{enabled:!1,face:{level:10}}},watch:{enabled:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(R.uilog("/tool/face","enabled: ".concat(t)),t){e.next=5;break}N.editlist.beauty_level=0,e.next=11;break;case 5:if(0==this.face.level&&(this.face.level=10),N.editlist.face.beauty_source){e.next=10;break}return e.next=9,P.getBeautySource();case 9:N.editlist.beauty_source=e.sent;case 10:N.editlist.beauty_level=this.face.level;case 11:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),"face.level":function(e){N.editlist.beauty_level=e}},methods:{onDialogClose:function(){this.initeState&&(this.initeState.enabled!=this.enabled?this.enabled?we.createOperateHistory(ge.Operate.FaceEnable.Type):we.createOperateHistory(ge.Operate.FaceDisable.Type):this.initeState.level!=N.editlist.beauty_level&&we.createOperateHistory(ge.Operate.FaceModify.Type))}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$emit("update:title","美颜"),e.enabled=N.editlist.face.beauty_level>0,e.face.level=N.editlist.face.beauty_level,e.initeState={enabled:e.enabled,level:e.face.level};case 4:case"end":return t.stop()}}),t)})))()}},hn=mn,vn=(r("6b05"),Object(K["a"])(hn,fn,pn,!1,null,"107c639e",null)),gn=vn.exports,bn=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"aspect-box"},[r("div",[r("ClipBtn",{staticClass:"item-btn",attrs:{active:!e.curAspectRatio,icon:"phonelink_lock",text:"原始"},nativeOn:{click:function(t){return e.choose(null)}}}),e._l(e.AspectRatio,(function(t,n){return r("ClipBtn",{key:t[0]+":"+t[1],staticClass:"item-btn",attrs:{active:e.curAspectRatio==t,src:e.AspectRatioIcon[n],text:t[0]+":"+t[1]},nativeOn:{click:function(r){return e.choose(t)}}})}))],2)])},yn=[],_n=[[9,16],[16,9],[1,1],[3,4],[4,3]];function xn(e){return wn.apply(this,arguments)}function wn(){return wn=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var r,n,i,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=30,n=100,i=document.createElement("canvas"),i.width=n+2*r,i.height=n+2*r,a=i.getContext("2d"),a.fillStyle="white",s=t[0]/t[1],s>1?a.fillRect(r,r+(n-n/s)/2,n,n/s):a.fillRect(r+(n-n*s)/2,r,n*s,n),e.t0=URL,e.next=12,new Promise(i.toBlob.bind(i));case 12:return e.t1=e.sent,e.abrupt("return",e.t0.createObjectURL.call(e.t0,e.t1));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),wn.apply(this,arguments)}for(var kn={components:{ClipBtn:kt},data:function(){return{AspectRatio:_n,AspectRatioIcon:[],curAspectRatio:null}},methods:{choose:function(e){this.curAspectRatio!=e&&(this.curAspectRatio=e,N.editlist.dar=e||N.DARPreset.auto,R.uilog("/tool/aspect_ratio","change: ".concat(e)),this.$emit("change"))},onDialogClose:function(){this.initState&&this.initState.aspectRatio!=this.curAspectRatio&&we.createOperateHistory(ge.Operate.VideoAspect.Type)}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$emit("update:title","画幅比例"),t.next=3,xn(_n);case 3:e.AspectRatioIcon=t.sent,e.curAspectRatio=_n.filter((function(e){return e.join(":")==N.editlist.video.dar.join(":")}))[0],e.initState={aspectRatio:e.curAspectRatio};case 6:case"end":return t.stop()}}),t)})))()}},Tn=kn,Rn=(r("62b1"),Object(K["a"])(Tn,bn,yn,!1,null,"4eec2d4a",null)),On=Rn.exports,Cn={components:{AudioBase:er,BGM:sr,AudioEffect:fr,VFilter:br,ImageOverlay:Ir,TextOverlay:Kr,VideoBase:nn,Sort:dn,Face:gn,AspectRatio:On},props:["postermode"],data:function(){return{tabid:-1,title:"",dialogAccept:!1,dialogAcceptable:!1,TabID:zt.TabID,options:null}},computed:{style:function(){var e={height:"auto"};return this.options&&this.options.height&&(e.position="absolute",e.height=this.options.height),e}},methods:{show:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.title="",this.dialogAccept=!1,this.dialogAcceptable=!1,this.tabid=e,this.options=Object(f["a"])({},t)},beforechange:function(e){this.$emit("beforechange",e)},change:function(e){this.$emit("change",e,this.tabid)},acceptable:function(){this.dialogAcceptable=!0},close:function(){this.dialogAccept=!1,this.triggerClose(),this.tabid=-1},accept:function(){this.dialogAccept=!0},triggerClose:function(){var e=this;Object.keys(this.$refs).forEach((function(t){e.$refs[t]&&e.$refs[t].onDialogClose&&e.$refs[t].onDialogClose()}))}}},Pn=Cn,An=(r("407b"),Object(K["a"])(Pn,Vt,Yt,!1,null,"173e9416",null)),In=An.exports,Sn=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"resize",rawName:"v-resize",value:e.updateUISize,expression:"updateUISize"}],ref:"mainbox",on:{click:e.boxClick}},[e.overlay?r("div",{directives:[{name:"show",rawName:"v-show",value:e.show&&(e.loaded||!e.overlay.url),expression:"show && (loaded||!overlay.url)"}],ref:"main",staticClass:"clip_img",style:e.style,attrs:{tabindex:"-1"},on:{touchstart:e.touchstart,touchmove:e.touchmove,touchend:e.hideMagnet,touchcancel:e.hideMagnet}},[e.url?r("APNGPlayer",{key:e.url,ref:"img",staticClass:"img",attrs:{overlay:e.overlay,src:e.url},on:{load:e.imgLoaded,error:e.imgLoadError}}):e._e(),r("div",{staticClass:"border"}),r("div",{staticClass:"remove-btn item-btn",on:{click:e.remove}},[r("mu-icon",{attrs:{value:"close"}})],1),e.edit_filter&&e.edit_filter(e.overlay)?r("div",{staticClass:"edit-btn item-btn",on:{click:function(t){return e.$emit("edit",e.overlay)}}},[r("mu-icon",{attrs:{value:"edit"}})],1):e._e(),r("div",{staticClass:"resize-btn item-btn",on:{touchstart:function(t){return t.stopPropagation(),e.resize_start(t)},touchmove:function(t){return t.stopPropagation(),e.resize_move(t)},touchend:function(t){return t.stopPropagation(),e.resize_end(t)}}},[r("mu-icon",{attrs:{value:"code"}})],1)],1):e._e(),e.overlay?[e.magnetX?r("div",{staticClass:"magnet-x",style:{left:e.magnetX+"px"}}):e._e(),e.magnetY?r("div",{staticClass:"magnet-y",style:{top:e.magnetY+"px"}}):e._e(),e.magnetCross?r("div",{staticClass:"magnet-cross-x",style:{left:e.magnetCross.x+"px"}}):e._e(),e.magnetCross?r("div",{staticClass:"magnet-cross-y",style:{top:e.magnetCross.y+"px"}}):e._e(),r("div",{staticClass:"video-border video-border-left",style:e.borderStyles.left}),r("div",{staticClass:"video-border video-border-right",style:e.borderStyles.right}),r("div",{staticClass:"video-border video-border-top",style:e.borderStyles.top}),r("div",{staticClass:"video-border video-border-bottom",style:e.borderStyles.bottom})]:e._e()],2)},jn=[],En=(r("466d"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.is_png?r("canvas",{ref:"canvas"}):r("img",{ref:"img",attrs:{src:e.src},on:{load:e.onImgLoad,error:function(t){return e.$emit("error",t)}}})}),$n=[],Mn=(r("45fc"),r("ace4"),r("5cc6"),r("9a8c"),r("a975"),r("735e"),r("c1ac"),r("d139"),r("3a7b"),r("d5d6"),r("82f8"),r("e91f"),r("60bd"),r("5f96"),r("3280"),r("3fcc"),r("ca91"),r("25a1"),r("cd26"),r("3c5d"),r("2954"),r("649e"),r("219c"),r("170b"),r("b39a"),r("72f7"),r("fb2c"),new Uint32Array(256)),Dn=0;Dn<256;Dn++){for(var Ln=Dn,Fn=0;Fn<8;Fn++)Ln=0!==(1&Ln)?3988292384^Ln>>>1:Ln>>>1;Mn[Dn]=Ln}var Un=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length-t,n=-1,i=t,a=t+r;i<a;i++)n=n>>>8^Mn[255&(n^e[i])];return-1^n},Bn=r("99de"),Nn=r("7e84"),Hn=r("257e"),Xn=r("262e"),zn=r("faa1"),Vn=r.n(zn),Yn=function(e){function t(e,r,n){var i;return Object(Ge["a"])(this,t),i=Object(Bn["a"])(this,Object(Nn["a"])(t).call(this)),Object(d["a"])(Object(Hn["a"])(i),"context",void 0),Object(d["a"])(Object(Hn["a"])(i),"playbackRate",1),Object(d["a"])(Object(Hn["a"])(i),"_apng",void 0),Object(d["a"])(Object(Hn["a"])(i),"_prevFrame",void 0),Object(d["a"])(Object(Hn["a"])(i),"_prevFrameData",void 0),Object(d["a"])(Object(Hn["a"])(i),"_currentFrameNumber",0),Object(d["a"])(Object(Hn["a"])(i),"_ended",!1),Object(d["a"])(Object(Hn["a"])(i),"_paused",!0),Object(d["a"])(Object(Hn["a"])(i),"_numPlays",0),i._apng=e,i.context=r,i.stop(),n&&i.play(),i}return Object(Xn["a"])(t,e),Object(We["a"])(t,[{key:"renderNextFrame",value:function(){this._currentFrameNumber=(this._currentFrameNumber+1)%this._apng.frames.length,this._currentFrameNumber===this._apng.frames.length-1&&(this._numPlays++,0!==this._apng.numPlays&&this._numPlays>=this._apng.numPlays&&(this._ended=!0,this._paused=!0)),this.renderCurrentFrame()}},{key:"renderCurrentFrame",value:function(){var e=this.currentFrame;this._prevFrame&&1==this._prevFrame.disposeOp?this.context.clearRect(this._prevFrame.left,this._prevFrame.top,this._prevFrame.width,this._prevFrame.height):this._prevFrame&&2==this._prevFrame.disposeOp&&this.context.putImageData(this._prevFrameData,this._prevFrame.left,this._prevFrame.top),this._prevFrame=e,this._prevFrameData=null,2!=e.disposeOp||e._prevFrameData||(this._prevFrameData=this.context.getImageData(e.left,e.top,e.width,e.height)),0==e.blendOp&&this.context.clearRect(e.left,e.top,e.width,e.height),this.context.drawImage(e.imageElement,e.left,e.top),this.emit("frame",this._currentFrameNumber),this._ended&&this.emit("end")}},{key:"seek",value:function(e){var t=this._apng.frames,r=0,n=0,i=0;this._ended=!1,this._pause=!0,this._numPlays=Math.floor(e/this._apng.playTime),e>this._apng.playTime&&(e%=this._apng.playTime);for(var a=0;a<t.length;a++)if(r+=t[a].delay,n=a,this._nextRenderTimeDelta=r-e,t[a].cache&&(i=a),r>=e)break;if(this._currentFrameNumber=n,this._prevFrame!=this.currentFrame){0!=i&&(this._prevFrame=t[i-1]);for(var s=i;s<n;s++)this._currentFrameNumber=s,this.renderCurrentFrame();this._currentFrameNumber=n,this.renderCurrentFrame()}}},{key:"play",value:function(){var e=this;this.emit("play"),this._ended&&this.stop(),this._paused=!1;var t=performance.now()+this.currentFrame.delay/this.playbackRate;t-=this.currentFrame.delay-(this._nextRenderTimeDelta||0)/this.playbackRate;var r=function r(n){if(!e._ended&&!e._paused){if(n>=t){while(n-t>=e._apng.playTime/e.playbackRate)t+=e._apng.playTime/e.playbackRate,e._numPlays++;do{e.renderNextFrame(),t+=e.currentFrame.delay/e.playbackRate}while(!e._ended&&n>t)}requestAnimationFrame(r)}};requestAnimationFrame(r)}},{key:"pause",value:function(){this.emit("pause"),this._paused||(this.emit("pause"),this._paused=!0)}},{key:"stop",value:function(){this.emit("stop"),this._numPlays=0,this._ended=!1,this._paused=!0,this._currentFrameNumber=-1,this.context.clearRect(0,0,this._apng.width,this._apng.height),this.renderNextFrame()}},{key:"currentFrameNumber",get:function(){return this._currentFrameNumber}},{key:"currentFrame",get:function(){return this._apng.frames[this._currentFrameNumber]}},{key:"paused",get:function(){return this._paused}},{key:"ended",get:function(){return this._ended}}]),t}(Vn.a),qn=function(){function e(){Object(Ge["a"])(this,e),Object(d["a"])(this,"width",0),Object(d["a"])(this,"height",0),Object(d["a"])(this,"numPlays",0),Object(d["a"])(this,"playTime",0),Object(d["a"])(this,"frames",[])}return Object(We["a"])(e,[{key:"createImages",value:function(){return Promise.all(this.frames.map((function(e){return e.createImage()})))}},{key:"getPlayer",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.createImages().then((function(){return new Yn(t,e,r)}))}}]),e}(),Gn=function(){function e(){Object(Ge["a"])(this,e),Object(d["a"])(this,"left",0),Object(d["a"])(this,"top",0),Object(d["a"])(this,"width",0),Object(d["a"])(this,"height",0),Object(d["a"])(this,"delay",0),Object(d["a"])(this,"disposeOp",0),Object(d["a"])(this,"blendOp",0),Object(d["a"])(this,"imageData",null),Object(d["a"])(this,"imageElement",null),Object(d["a"])(this,"cache",null)}return Object(We["a"])(e,[{key:"createImage",value:function(){var e=this;return this.imageElement?Promise.resolve():new Promise((function(t,r){var n=URL.createObjectURL(e.imageData);e.imageElement=document.createElement("img"),e.imageElement.onload=function(){URL.revokeObjectURL(n),t()},e.imageElement.onerror=function(){URL.revokeObjectURL(n),e.imageElement=null,r(new Error("Image creation error"))},e.imageElement.src=n}))}}]),e}(),Wn=new Error("Not a PNG"),Jn=new Error("Not an animated PNG");var Kn=new Uint8Array([137,80,78,71,13,10,26,10]);function Qn(e){var t=new Uint8Array(e);if(Array.prototype.some.call(Kn,(function(e,r){return e!==t[r]})))return Wn;var r=!1;if(Zn(t,(function(e){return!(r="acTL"===e)})),!r)return Jn;var n=[],i=[],a=null,s=null,o=0,c=new qn;if(Zn(t,(function(e,t,r,l){var u=new DataView(t.buffer);switch(e){case"IHDR":a=t.subarray(r+8,r+8+l),c.width=u.getUint32(r+8),c.height=u.getUint32(r+12);break;case"acTL":c.numPlays=u.getUint32(r+8+4);break;case"fcTL":s&&(c.frames.push(s),o++),s=new Gn,s.width=u.getUint32(r+8+4),s.height=u.getUint32(r+8+8),s.left=u.getUint32(r+8+12),s.top=u.getUint32(r+8+16);var d=u.getUint16(r+8+20),f=u.getUint16(r+8+22);0===f&&(f=100),s.delay=1e3*d/f,s.delay<=10&&(s.delay=100),c.playTime+=s.delay,s.disposeOp=u.getUint8(r+8+24),s.blendOp=u.getUint8(r+8+25),s.dataParts=[],0===o&&2===s.disposeOp&&(s.disposeOp=1);break;case"fdAT":s&&s.dataParts.push(t.subarray(r+8+4,r+8+l));break;case"IDAT":s&&s.dataParts.push(t.subarray(r+8,r+8+l));break;case"IEND":i.push(ri(t,r,12+l));break;default:n.push(ri(t,r,12+l))}})),s&&c.frames.push(s),0==c.frames.length)return Jn;var l=new Blob(n),u=new Blob(i);return c.frames.forEach((function(e){var t=[];t.push(Kn),a.set(ii(e.width),0),a.set(ii(e.height),4),t.push(ni("IHDR",a)),t.push(l),e.dataParts.forEach((function(e){return t.push(ni("IDAT",e))})),t.push(u),e.imageData=new Blob(t,{type:"image/png"}),delete e.dataParts,t=null})),c}function Zn(e,t){var r,n,i,a=new DataView(e.buffer),s=8;do{n=a.getUint32(s),r=ei(e,s+4,4),i=t(r,e,s,n),s+=12+n}while(!1!==i&&"IEND"!=r&&s<e.length)}function ei(e,t,r){var n=Array.prototype.slice.call(e.subarray(t,t+r));return String.fromCharCode.apply(String,n)}function ti(e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}function ri(e,t,r){var n=new Uint8Array(r);return n.set(e.subarray(t,t+r)),n}var ni=function(e,t){var r=e.length+t.length,n=new Uint8Array(r+8),i=new DataView(n.buffer);i.setUint32(0,t.length),n.set(ti(e),4),n.set(t,8);var a=Un(n,4,r);return i.setUint32(r+4,a),n},ii=function(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])},ai={props:["src","overlay"],data:function(){return{player:null,is_png:!0}},methods:{seek:function(e){var t=this;void 0===e&&(e=this.overlay.offset_sec),e-=this.overlay.offset_sec,Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.player&&t.player.seek(1e3*e);case 1:case"end":return r.stop()}}),r)})))()},play:function(){this.player&&this.player.play()},pause:function(){this.player&&this.player.pause()},onImgLoad:function(){this.naturalWidth=this.$refs.img.naturalWidth,this.naturalHeight=this.$refs.img.naturalHeight,this.$emit("load")}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i,a,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return R.verbose("apng src: ".concat(e.src)),t.next=3,new Promise(window.resolveLocalFileSystemURL.bind(window,e.src));case 3:return r=t.sent,t.next=6,new Promise(r.file.bind(r));case 6:return n=t.sent,i=new FileReader,t.next=10,new Promise((function(e,t){i.onload=e,i.onerror=t,i.readAsArrayBuffer(n)}));case 10:if(a=t.sent.target.result,s=Qn(a),!(s instanceof Error)){t.next=15;break}return e.is_png=!1,t.abrupt("return");case 15:return o=e.$refs.canvas,o.width=e.naturalWidth=s.width,o.height=e.naturalHeight=s.height,t.next=20,s.getPlayer(o.getContext("2d"));case 20:e.player=t.sent,e.seek(N.editlist.time_sec),e.$emit("load");case 23:case"end":return t.stop()}}),t)})))()}},si=ai,oi=Object(K["a"])(si,En,$n,!1,null,"7831d96a",null),ci=oi.exports;function li(e,t,r){var n=Math.sqrt(Math.pow(e.X-t.X,2)+Math.pow(e.Y-t.Y,2)),i=Math.sqrt(Math.pow(e.X-r.X,2)+Math.pow(e.Y-r.Y,2)),a=Math.sqrt(Math.pow(t.X-r.X,2)+Math.pow(t.Y-r.Y,2)),s=(Math.pow(n,2)+Math.pow(i,2)-Math.pow(a,2))/(2*n*i),o=Math.round(180*Math.acos(s)/Math.PI),c=(t.X-e.X)*(r.Y-t.Y)-(t.Y-e.Y)*(r.X-t.X);return c<0&&(o=360-o),{angle:o,scale:i/n}}function ui(e){var t=e.offsetLeft,r=e.offsetParent;while(null!=r)t+=r.offsetLeft+(r.offsetWidth-r.clientWidth)/2,r=r.offsetParent;var n=e.offsetTop;r=e.offsetParent;while(null!=r)n+=r.offsetTop+(r.offsetHeight-r.clientHeight)/2,r=r.offsetParent;return{x:t,y:n}}var di={props:["postermode","edit_filter"],components:{APNGPlayer:ci},data:function(){return{editlist:N.editlist,userModify:!1,overlay:null,show:!1,loaded:!1,ignoreLoadEvent:!1,url:"",magnetX:null,magnetY:null,magnetCross:null,box:{width:0,height:0,offsetX:0,offsetY:0,scale:1},style:{left:"50px",top:"50px",width:"100px",height:"100px",transform:"rotate(0deg)"},temp:{pageX:0,pageY:0,offsetX:0,offsetY:0},tempStyle:{x:0,y:0,w:0,h:0,rotate:0}}},watch:Object(d["a"])({"overlay.url":"load"},"editlist.time_sec",(function(e){this.overlay&&(this.delayPlay&&this._delayPlay(),this._playing?e<this.overlay.offset_sec+this.overlay.end_sec&&this._delayPause():this.updateIsShow())})),computed:{hasActive:function(){return!!this.overlay},borderStyles:function(){return{top:{display:this.box.offsetY>0?"block":"none",height:this.box.offsetY+"px"},bottom:{display:this.box.offsetY>0?"block":"none",height:this.box.offsetY+"px"},left:{display:this.box.offsetX>0?"block":"none",width:this.box.offsetX+"px"},right:{display:this.box.offsetX>0?"block":"none",width:this.box.offsetX+"px"}}}},methods:{seek:function(e){this.overlay&&(e<this.overlay.offset_sec||e>this.overlay.offset_sec+this.overlay.end_sec||this.$refs.img&&this.$refs.img.seek(e))},_delayPlay:function(){var e=this;clearTimeout(this._delayPlayTmr),this._delayPlayTmr=setTimeout((function(){e.delayPlay=!1,e.$refs.img&&(e.$refs.img.seek(),e.$refs.img.play(),e._playing=!0,e.show=!0)}),1e3*(this.overlay.offset_sec-N.editlist.time_sec))},play:function(){this.overlay&&(clearTimeout(this._delayPlayTmr),N.editlist.time_sec>this.overlay.offset_sec+this.overlay.end_sec||(this.delayPlay=this.overlay.offset_sec>N.editlist.time_sec,this.delayPlay?this._delayPlay():(this.$refs.img&&this.$refs.img.play(),this._playing=!0)))},_delayPause:function(){var e=this;clearTimeout(this._delayPauseTmr),this._delayPauseTmr=setTimeout((function(){clearTimeout(e._delayPlayTmr),e.$refs.img&&(e.$refs.img.pause(),e._playing=!1,e.show=!1)}),1e3*(this.overlay.offset_sec+this.overlay.end_sec-N.editlist.time_sec))},pause:function(){this.delayPlay=!1,this._playing=!1,clearTimeout(this._delayPauseTmr),clearTimeout(this._delayPlayTmr),this.$refs.img&&this.$refs.img.pause()},updateIsShow:function(){this.show=this.overlay&&N.editlist.time_sec>=this.overlay.offset_sec&&N.editlist.time_sec<=this.overlay.offset_sec+this.overlay.end_sec},updateUISize:function(){this.box.width=this.$refs.mainbox.clientWidth,this.box.height=this.$refs.mainbox.clientHeight;var e=this.box.width/this.box.height,t=N.editlist.dar[0]/N.editlist.dar[1];t>e?(this.box.offsetY=(this.box.height-this.box.width/t)/2,this.box.offsetX=0,this.box.scale=N.editlist.resolution_dar[0]/this.box.width):(this.box.offsetX=(this.box.width-this.box.height*t)/2,this.box.offsetY=0,this.box.scale=N.editlist.resolution_dar[1]/this.box.height),R.verbose("ClipImg update box: "+JSON.stringify(this.box))},boxClick:function(e){if(this.hasActive)this.blur();else{var t=ui(this.$refs.mainbox),r=t.x,n=t.y;r=(e.pageX-r-this.box.offsetX)*this.box.scale,n=(e.pageY-n-this.box.offsetY)*this.box.scale;var i=this.postermode?N.editlist.poster.overlay:[].concat(Object(u["a"])(N.editlist.overlay),Object(u["a"])(N.editlist.mosic)),a=i.filter((function(e){return e.offset_sec<=N.editlist.time_sec&&(0==e.end_sec||e.offset_sec+e.end_sec>=N.editlist.time_sec)})).filter((function(e){var t=e.x,i=e.y,a=xe(t+e.w/2,i+e.h/2,r,n,-e.rotate);return t<a.x&&i<a.y&&t+e.w>a.x&&i+e.h>a.y}));if(a.length){var s=a.reverse()[0];this.active(s),this.load(),this.$emit("overlayActive",s)}else this.blur()}},blur:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.overlay){t.next=20;break}if(R.uilog("/overlay_editor","blur"),e.overlay.enabled=!0,e.overlay.active=!1,!e.overlay.new){t.next=10;break}return e.overlay.new=!1,t.next=8,e.$emit("change");case 8:t.next=16;break;case 10:if(e.overlay.type!=ge.Overlay.Type.Mosic){t.next=14;break}N.editlist.update_mosic(e.overlay),t.next=16;break;case 14:return t.next=16,N.editlist.update_overlay(e.overlay,e.postermode);case 16:e.userModify&&e.createOrUpdateOperateHistory(),r=e.overlay,e.overlay=null,e.$emit("overlayDeactive",r);case 20:case"end":return t.stop()}}),t)})))()},active:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:R.uilog("/overlay_editor","active. ".concat(JSON.stringify(e))),t.overlay&&(t.overlay.active=!1),e.active=!0,t.overlay=e,t.userModify=!1,t.overlay.type==ge.Overlay.Type.Mosic?(t.loaded=!1,t.url="",N.editlist.update_mosic(t.overlay)):N.editlist.update_overlay(t.overlay,t.postermode),t.updateUI(),t.updateIsShow(),!e.url&&e.w<=10&&(t.toCenter(1),t.onChange(!0)),t.$nextTick((function(){t.$refs.main.focus()})),R.verbose("ClipImg active: "+JSON.stringify(t.overlay));case 11:case"end":return r.stop()}}),r)})))()},updateUI:function(){if(this.updateUISize(),this.overlay){var e=this.overlay.x,t=this.overlay.y;this.style.left=this.box.offsetX+e/this.box.scale+"px",this.style.top=this.box.offsetY+t/this.box.scale+"px",this.style.width=this.overlay.w/this.box.scale+"px",this.style.height=this.overlay.h/this.box.scale+"px",this.style.transform="rotate("+this.overlay.rotate+"deg)"}},imgLoaded:function(){this.loaded=!0,!this.ignoreLoadEvent&&this.overlay&&this.$refs.img.naturalWidth&&this.$refs.img.naturalHeight&&this.setDefaultSize()},setDefaultSize:function(){var e=!1,t=this.style.width,r=this.$refs.img.naturalWidth/this.$refs.img.naturalHeight;+this.style.width.replace("px","")<10&&(this.toCenter(r),e=!0),this.style.width=r*this.style.height.replace("px","")+"px",Math.ceil(this.style.width+0)!=Math.ceil(t+0)&&(e=!0),e&&this.onChange(!0)},imgLoadError:function(e){R.error("overlay img load error ",e)},toCenter:function(e){var t=this.box.width/2-this.box.offsetX,r=this.box.height/2-this.box.offsetY;e>1?r=t/e:t=r*e,this.style.left=(this.box.width-t)/2+"px",this.style.top=(this.box.height-r)/2+"px",this.style.width=t+"px",this.style.height=r+"px"},remove:function(){var e=this;this.overlay.active=!1;var t=this.postermode?N.editlist.poster.overlay:N.editlist.overlay,r=t.findIndex((function(t){return t.id==e.overlay.id}));r>=0&&t.splice(r,1),r=N.editlist.mosic.findIndex((function(t){return t.id==e.overlay.id})),r>=0&&N.editlist.mosic.splice(r,1),this.overlay=null,this.$emit("change")},resize_start:function(e){this.temp.pageX=e.changedTouches[0].pageX,this.temp.pageY=e.changedTouches[0].pageY,this.tempStyle.x=+this.style.left.replace("px",""),this.tempStyle.y=+this.style.top.replace("px",""),this.tempStyle.w=+this.style.width.replace("px",""),this.tempStyle.h=+this.style.height.replace("px","");var t=ui(this.$refs.main),r=t.x,n=t.y;return this.temp.offsetX=this.temp.pageX-(r-this.tempStyle.x),this.temp.offsetY=this.temp.pageY-(n-this.tempStyle.y),this.tempStyle.rotate=+this.style.transform.match(/\d+/)[0],!0},resize_move_scale:function(e){var t=e.changedTouches[0].pageX-this.temp.pageX,r=e.changedTouches[0].pageY-this.temp.pageY,n=t,i=r;return this.style.left=this.tempStyle.x-n/2+"px",this.style.top=this.tempStyle.y-i/2+"px",this.style.width=this.tempStyle.w+n+"px",this.style.height=this.tempStyle.h+i+"px",this.onChange(),e.preventDefault&&e.preventDefault(),e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),!1},resize_move:function(e){if(this.overlay.type==ge.Overlay.Type.Mosic)return this.resize_move_scale(e);var t=e.changedTouches[0].pageX-this.temp.pageX,r=e.changedTouches[0].pageY-this.temp.pageY,n=li({X:this.tempStyle.x+this.tempStyle.w/2,Y:this.tempStyle.y+this.tempStyle.h/2},{X:this.temp.offsetX,Y:this.temp.offsetY},{X:this.temp.offsetX+t,Y:this.temp.offsetY+r}),i=n.angle,a=n.scale;i=(i+this.tempStyle.rotate)%360;var s=this.createMagnetLayout({angle:i,left:this.tempStyle.x,top:this.tempStyle.y,width:this.tempStyle.w,height:this.tempStyle.h});s=this.magnet.checkAngle(s),i=s.angle,this.style.transform="rotate("+i+"deg)";var o=(a-1)*this.tempStyle.w,c=(a-1)*this.tempStyle.h;return this.style.left=this.tempStyle.x-o/2+"px",this.style.top=this.tempStyle.y-c/2+"px",this.style.width=this.tempStyle.w+o+"px",this.style.height=this.tempStyle.h+c+"px",this.onChange(),e.preventDefault&&e.preventDefault(),e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),!1},resize_end:function(){this.magnetCross=null,R.uilog("/overlay_editor","resize end. ".concat(JSON.stringify(this.overlay)))},touchstart:function(e){this.temp.pageX=e.changedTouches[0].pageX,this.temp.pageY=e.changedTouches[0].pageY,this.tempStyle.x=+this.style.left.replace("px",""),this.tempStyle.y=+this.style.top.replace("px","")},touchmove:function(e){var t=this.tempStyle.x+e.changedTouches[0].pageX-this.temp.pageX,r=this.tempStyle.y+e.changedTouches[0].pageY-this.temp.pageY,n=this.createMagnetLayout({left:this.tempStyle.x,top:this.tempStyle.y,width:+this.style.width.replace("px",""),height:+this.style.height.replace("px","")}),i=this.createMagnetLayout({left:t,top:r,width:n.width,height:n.height});return i=this.magnet.check(n,i),t=i.left,r=i.top,this.style.left=t+"px",this.style.top=r+"px",this.onChange(),e.preventDefault&&e.preventDefault(),e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),!1},onChange:function(e){this.overlay.x=(+this.style.left.replace("px","")-this.box.offsetX)*this.box.scale,this.overlay.y=(+this.style.top.replace("px","")-this.box.offsetY)*this.box.scale,this.overlay.w=+this.style.width.replace("px","")*this.box.scale,this.overlay.h=+this.style.height.replace("px","")*this.box.scale,this.overlay.rotate=+this.style.transform.match(/\d+/)[0],this.overlay.x=+this.overlay.x.toFixed(2),this.overlay.y=+this.overlay.y.toFixed(2),this.overlay.w=+this.overlay.w.toFixed(2),this.overlay.h=+this.overlay.h.toFixed(2),this.overlay.type==ge.Overlay.Type.Mosic?N.editlist.update_mosic(this.overlay):N.editlist.update_overlay(this.overlay,this.postermode),R.verbose("overlay changed: "+this.overlay.x+","+this.overlay.y+","+this.overlay.w+","+this.overlay.h),e?this.createOrUpdateOperateHistory(!0):this.userModify=!0},load:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.overlay||!e.overlay.url){t.next=16;break}return e.ignoreLoadEvent=!0,e.loaded=!1,t.prev=3,t.next=6,j.getCdvUrl(e.overlay.url);case 6:r=t.sent,t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](3),r=e.overlay.url;case 12:if(e.ignoreLoadEvent=!1,e.overlay){t.next=15;break}return t.abrupt("return");case 15:e.url=r+"?"+e.overlay.id;case 16:case"end":return t.stop()}}),t,null,[[3,9]])})))()},createOrUpdateOperateHistory:function(e){this.postermode||(e?this.overlay.type==ge.Overlay.Type.Mosic?we.updateOperateHistory(ge.Operate.MosicAdd.Type,this.overlay):this.overlay.type==ge.Overlay.Type.Image?we.updateOperateHistory(ge.Operate.ImageAdd.Type,this.overlay):we.updateOperateHistory(ge.Operate.TextAdd.Type,this.overlay):this.overlay.type==ge.Overlay.Type.Mosic?we.createOperateHistory(ge.Operate.MosicModify.Type):this.overlay.type==ge.Overlay.Type.Image?we.createOperateHistory(ge.Operate.ImageModify.Type):we.createOperateHistory(ge.Operate.TextModify.Type))},createMagnetLayout:function(e){return Object(f["a"])({},e,{right:e.left+e.width,bottom:e.top+e.height})},hideMagnet:function(){R.uilog("/overlay_editor","move end. ".concat(JSON.stringify(this.overlay))),this.magnetX=null,this.magnetY=null,this.magnetCross=null}},mounted:function(){var e=this,t=this.$refs.mainbox;this.magnet=new Qe({span:10,angleSpan:4,features:["middleToMiddle","centerToCenter"],render:function(t,r){e.magnetX=t,e.magnetY=r},renderAngle:function(t,r){e.magnetCross=null!=t?{x:r.left+=r.width/2,y:r.top+=r.height/2}:null},dynamicLayouts:function(){return[e.createMagnetLayout({left:0,top:0,width:t.offsetWidth,height:t.offsetHeight})]}})}},fi=di,pi=(r("6f2d"),r("d93d"),Object(K["a"])(fi,Sn,jn,!1,null,"e5dbe36a",null)),mi=pi.exports,hi=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"main"},[r("PosterMakerTop",{attrs:{saving:e.saving},on:{close:e.close,save:e.save}}),r("div",{staticClass:"title"},[e._v("选择封面")]),r("div",{ref:"mainBox",staticClass:"main-box"},[r("PreviewPlayer",{ref:"preview",staticClass:"main-video",attrs:{pause:!0,postermode:!0,player:e.$refs.preview},on:{render:e.onPreviewLoaded}}),r("OverlayEditor",{ref:"overlayEditor",staticClass:"overlay-box",attrs:{postermode:!0,edit_filter:function(t){return t.type==e.Const.Overlay.Type.Text}},on:{change:e.overlayChange,edit:e.overlayEdit}})],1),r("div",{staticClass:"toolBox"},[r("ClipTimeline",{ref:"timeline",attrs:{playing:!e.player.pause,postermode:!0},on:{timeChange:e.timeChange}}),r("PosterToolTab",{on:{select:e.tabSelect}}),r("ToolDialog",{ref:"toolDlg",attrs:{postermode:!0},on:{close:e.mainBoxResized,change:e.toolValueChange}})],1)],1)},vi=[],gi=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"main-title"},[r("mu-button",{attrs:{large:"",icon:""},on:{click:function(t){return e.$emit("close")}}},[r("mu-icon",{attrs:{color:"white",size:"36",value:"close"}})],1),r("div",{staticStyle:{width:"100%","text-align":"center"}}),r("mu-button",{attrs:{color:"red",small:"",round:"",disabled:e.saving},on:{click:function(t){return e.$emit("save")}}},[e._v(e._s(e.saving?"保存中...":"保存"))])],1)},bi=[],yi={props:["saving"],data:function(){return{}},methods:{}},_i=yi,xi=(r("3c38"),Object(K["a"])(_i,gi,bi,!1,null,"38988548",null)),wi=xi.exports,ki=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"poster-tab-main"},[r("mu-button",{attrs:{color:"red",small:"",round:""},on:{click:function(t){return e.$emit("select",e.TabID.AddLocalImage)}}},[r("mu-icon",{attrs:{value:"image",left:""}}),e._v("贴图 ")],1),r("mu-button",{attrs:{color:"red",small:"",round:""},on:{click:function(t){return e.$emit("select",e.TabID.AddText)}}},[r("mu-icon",{attrs:{value:"textsms",left:""}}),e._v("贴字 ")],1)],1)},Ti=[],Ri={data:function(){return{TabID:zt.TabID}}},Oi=Ri,Ci=(r("9378"),Object(K["a"])(Oi,ki,Ti,!1,null,"0f6f2a1b",null)),Pi=Ci.exports,Ai=0,Ii={components:{PosterMakerTop:wi,ClipTimeline:ct,OverlayEditor:mi,PosterToolTab:Pi,ToolDialog:In},data:function(){return{Const:ge,player:{pause:!0},saving:!1,waitReload:!1,importProgress:-1}},methods:{save:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$refs.overlayEditor.hasActive&&!e.waitReload){t.next=10;break}if(e.saving=!0,!e.$refs.overlayEditor.hasActive){t.next=7;break}if(e.$refs.overlayEditor.blur(),e.waitReload){t.next=7;break}return t.next=7,e.reloadPlayer();case 7:return t.next=9,new Promise((function(t,r){var n=setInterval((function(){e.waitReload||(clearInterval(n),clearTimeout(i),t())}),100),i=setTimeout((function(){clearInterval(n),r()}),5e3)}));case 9:e.saving=!1;case 10:return t.next=12,P.getTempFolder();case 12:return r=t.sent,n="poster_"+Math.random().toString(16).replace("0.","")+".jpg",i=r.nativeURL+"/"+n,t.prev=15,t.next=18,e.$refs.preview.thumb(i);case 18:if(a=t.sent,!a){t.next=27;break}return t.next=22,new Promise((function(e){setTimeout(e,500)}));case 22:return t.next=24,e.$refs.preview.thumb(i);case 24:if(s=t.sent,!s){t.next=27;break}throw new Error("make poster error"+s);case 27:N.editlist.poster.url=i+"?"+Math.random(),N.editlist.poster.rotate=0,e.close(),we.createOperateHistory(ge.Operate.PosterModify.Type),t.next=36;break;case 33:t.prev=33,t.t0=t["catch"](15),e.$snotify.error("截取封面失败");case 36:case"end":return t.stop()}}),t,null,[[15,33]])})))()},close:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:N.editlist.time_sec=e.cache_time_sec,e.$emit("close");case 2:case"end":return t.stop()}}),t)})))()},onPreviewLoaded:function(){this.waitReload=!1},reloadPlayer:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.waitReload=!0,r.next=3,t.$refs.preview.reload(!e);case 3:case"end":return r.stop()}}),r)})))()},timeChange:function(e){this.player.pause=!0,this.$refs.preview.seek(e.time_sec),this.$refs.timeline.seek(e.time_sec),N.editlist.time_sec=Ai=e.time_sec},overlayChange:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.reloadPlayer();case 2:case"end":return t.stop()}}),t)})))()},overlayEdit:function(e){this.$refs.toolDlg.show(zt.TabID.AddText,{height:"auto",overlay:e,operateToolTabId:zt.TabID.ToolSettings})},tabSelect:function(e){this.$refs.overlayEditor.blur(),e==zt.TabID.AddLocalImage?this.pickImg():(R.uilog("/poster","add text"),this.$refs.toolDlg.show(e,{height:"auto"}))},toolValueChange:function(e){if(e&&e.overlay)return e.overlay.offset_sec=0,e.overlay.end_sec=N.editlist.total_sec,this.$refs.overlayEditor.active(e.overlay),void(e.overlay.type==ge.Overlay.Type.Text&&this.reloadPlayer())},pickImg:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return R.uilog("/poster","pick image"),t.prev=1,t.next=4,new Promise((function(e,t){return navigator.camera.getPicture(e,t,{sourceType:Camera.PictureSourceType.PHOTOLIBRARY,allowEdit:!1,correctOrientation:!0,mediaType:Camera.MediaType.PICTURE})}));case 4:if(r=t.sent,r){t.next=7;break}return t.abrupt("return");case 7:n=N.editlist.add_overlay({url:r,type:ge.Overlay.Type.Image},!0),R.uilog("/poster","pick image done: ".concat(JSON.stringify(n))),e.toolValueChange({overlay:n}),t.next=14;break;case 12:t.prev=12,t.t0=t["catch"](1);case 14:case"end":return t.stop()}}),t,null,[[1,12]])})))()},mainBoxResized:function(){var e=this;this.$nextTick((function(){e.$refs.overlayEditor.updateUI()}))}},beforeMount:function(){this.cache_time_sec=N.editlist.time_sec,N.editlist.time_sec=Ai},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:R.uilog("/poster","enter"),e.reloadPlayer(),document.addEventListener("backbutton",e.close,!1);case 3:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:document.removeEventListener("backbutton",e.close,!1);case 1:case"end":return t.stop()}}),t)})))()}},Si=Ii,ji=(r("6df3"),Object(K["a"])(Si,hi,vi,!1,null,"8650f720",null)),Ei=ji.exports,$i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"ending-main"},[r("PosterMakerTop",{on:{close:e.close,save:function(t){e.rendering=!0}}}),r("div",{staticClass:"title"},[e._v("设置片尾")]),r("div",{ref:"mainBox",staticClass:"main-box"},[r("div",{staticStyle:{"text-align":"center"}},[r("div",{staticClass:"avatar",on:{click:e.onAvatarClick}},[e.avatarUrl?r("img",{attrs:{src:e.avatarUrl},on:{error:e.avatarLoadError}}):r("span",{staticClass:"material-icons"},[e._v("account_circle")]),r("div",{staticClass:"text"},[e._v("编辑头像")])])]),r("div",{staticClass:"input"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.ending.nickName,expression:"ending.nickName"}],attrs:{placeholder:"请输入昵称信息",maxlength:"18"},domProps:{value:e.ending.nickName},on:{input:function(t){t.target.composing||e.$set(e.ending,"nickName",t.target.value)}}})]),r("div",{staticClass:"input"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.ending.desc,expression:"ending.desc"}],attrs:{placeholder:"请输入描述信息（可为空）",maxlength:"23"},domProps:{value:e.ending.desc},on:{input:function(t){t.target.composing||e.$set(e.ending,"desc",t.target.value)}}})])]),e.rendering?r("EndingRender",{ref:"render",attrs:{"avatar-file":e.ending.avatarFile,"nick-name":e.ending.nickName||e.nickNamePlaceholder,desc:e.ending.desc},on:{rendered:e.save,error:e.renderError}}):e._e(),e.cropping?r("Crop",{ref:"crop",attrs:{src:e.cropAvatarUrl,ratio:1},on:{close:function(t){e.cropping=!1,e.cropAvatarUrl=""},save:e.cropSave}}):e._e(),r("mu-bottom-sheet",{attrs:{"overlay-close":!0,"esc-press-close":!0,open:e.isMenuOpen},on:{"update:open":function(t){e.isMenuOpen=t}}},[r("mu-list",{on:{"item-click":function(t){e.isMenuOpen=!1}}},[r("mu-sub-header",[e._v("选择")]),r("mu-list-item",{attrs:{button:""},on:{click:e.pickImage}},[r("mu-list-item-action",[r("mu-icon",{attrs:{value:"folder_open",color:"orange"}})],1),r("mu-list-item-title",{staticStyle:{color:"#f44336"}},[e._v("更换一张照片")])],1),r("mu-list-item",{attrs:{button:""},on:{click:e.deleteAvatar}},[r("mu-list-item-action",[r("mu-icon",{attrs:{value:"delete",color:"orange"}})],1),r("mu-list-item-title",[e._v("删除")])],1)],1)],1)],1)},Mi=[],Di=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"crop-main"},[r("PosterMakerTop",{on:{close:e.close,save:e.save}}),r("div",{staticClass:"title"},[e._v("图片裁剪")]),r("div",{ref:"mainBox",staticClass:"main-box"},[r("VueCropper",{ref:"cropper",style:{background:"transparent"},attrs:{img:e.src,outputSize:1,outputType:"png",autoCrop:!0,fixed:!0,fixedNumber:e.fixedNumber,full:!0,original:!0,fixedBox:!0,canMoveBox:!1,mode:"cover"}})],1)],1)},Li=[],Fi=r("7e79"),Ui={props:["src","ratio"],components:{PosterMakerTop:wi,VueCropper:Fi["VueCropper"]},computed:{fixedNumber:function(){return[this.ratio,1]}},methods:{close:function(){this.$emit("close")},save:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.$refs.cropper,t.next=3,new Promise(r.getCropBlob.bind(r));case 3:n=t.sent,e.$emit("save",n);case 5:case"end":return t.stop()}}),t)})))()}},mounted:function(){}},Bi=Ui,Ni=(r("5c20"),Object(K["a"])(Bi,Di,Li,!1,null,"00699070",null)),Hi=Ni.exports,Xi=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"mask"},[r("div",{staticClass:"loading"},[r("mu-icon",{staticClass:"loading-icon",attrs:{value:"refresh",size:"30"}}),e._v("生成片尾中 ")],1),r("canvas",{ref:"canvas",staticClass:"render"})])},zi=[],Vi=(r("cb29"),1e3),Yi=60,qi="黑体",Gi={props:["avatarFile","nickName","desc"],methods:{render:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=5*Yi,n={marginTop:1.5*-Yi-r/2,size:r,file:e.avatarFile},i={marginTop:0,fontSize:Yi,color:"white",font:qi,content:e.nickName},a={marginTop:1.5*Yi,fontSize:.8*Yi,color:"#888",font:qi,content:e.desc},t.prev=4,e.setupCanvas(),e.drawBg(),!e.avatarFile){t.next=10;break}return t.next=10,e.drawImage(n);case 10:e.nickName&&e.drawText(i),e.desc&&e.drawText(a),e.$emit("rendered"),t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](4),e.$emit("error",t.t0);case 18:case"end":return t.stop()}}),t,null,[[4,15]])})))()},drawBg:function(){},drawText:function(e){var t=this.canvasCtx;t.save(),t.font=e.fontSize+"px "+e.font,t.fillStyle=e.color;var r=this.canvas.width/2,n=this.canvas.height/2,i=r,a=n+e.marginTop,s=e.content;t.textAlign="center",t.textBaseline="middle",t.fillText(s,i,a),t.restore()},drawImage:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i,a,s,o,c,l,u,d;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=t.canvasCtx,i=t.canvas.width/2,a=t.canvas.height/2,r.next=5,t.loadImage(e.file);case 5:s=r.sent,o=e.size,c=0,l=0,u=i,d=a+e.marginTop,s.naturalHeight>s.naturalWidth?(l=o,c=o/s.naturalWidth*s.naturalHeight):(l=o/s.naturalHeight*s.naturalWidth,c=o),n.save(),n.beginPath(),n.fillStyle="black",n.arc(u,d,o/2,0,2*Math.PI),n.closePath(),n.fill(),n.globalCompositeOperation="source-in",n.drawImage(s,u-l/2,d-c/2,l,c),n.restore();case 21:case"end":return r.stop()}}),r)})))()},loadImage:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(r,n){var i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,j.getCdvUrl(e);case 2:if(i=t.sent,"cdvfile:"==location.protocol){t.next=7;break}return t.next=6,P.assetReadAsDataUrl(i);case 6:i=t.sent;case 7:a=new Image,a.onload=r.bind(a,a),a.onerror=n.bind(a,"load image fail"),a.src=i;case 11:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)})))()},setupCanvas:function(){this.canvas.width=Vi,this.canvas.height=Vi},getDataPng:function(){return this.$refs.canvas.toDataURL()},getBlob:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=null,t.next=3,new Promise((function(t){e.$refs.canvas.toBlob(t)}));case 3:return r=t.sent,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})))()}},mounted:function(){this.canvas=this.$refs.canvas,this.canvasCtx=this.$refs.canvas.getContext("2d"),this.render()}},Wi=Gi,Ji=(r("4251"),Object(K["a"])(Wi,Xi,zi,!1,null,"b5f97684",null)),Ki=Ji.exports,Qi={components:{PosterMakerTop:wi,EndingRender:Ki,Crop:Hi},data:function(){return{rendering:!1,editlist:null,avatarUrl:null,cropAvatarUrl:null,isMenuOpen:!1,cropping:!1,nickNamePlaceholder:"请输入昵称信息",ending:{avatarFile:"",nickName:"",desc:""}}},methods:{avatarLoadError:function(){this.avatarUrl=""},onAvatarClick:function(){this.ending.avatarFile?this.isMenuOpen=!0:this.pickImage()},deleteAvatar:function(){this.ending.avatarFile="",this.ending.url="",this.avatarUrl=""},pickImage:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return R.uilog("/ending","pick image"),t.next=3,new Promise((function(e,t){return navigator.camera.getPicture(e,t,{sourceType:Camera.PictureSourceType.PHOTOLIBRARY,allowEdit:!1,mediaType:Camera.MediaType.PICTURE,destinationType:Camera.DestinationType.NATIVE_URI})}));case 3:if(r=t.sent,r){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,e.fileToImageUrl(r);case 8:e.cropAvatarUrl=t.sent,e.cropping=!0,R.uilog("/ending","pick image done: ".concat(e.cropAvatarUrl));case 11:case"end":return t.stop()}}),t)})))()},save:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i,a,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return R.uilog("/ending","save"),r={avatarFile:e.ending.avatarFile,nickName:e.ending.nickName,desc:e.ending.desc,url:null},P.saveLastEnding(r),t.next=5,P.getTempFolder();case 5:return n=t.sent,i=n.name+"/endingImage_"+Math.random().toString(16).replace("0.","")+".png",t.prev=7,t.next=10,e.$refs.render.getBlob();case 10:return a=t.sent,t.next=13,e.createCacheFile(a,i);case 13:if(s=t.sent,r.url=s,R.verbose("created ending file: "+s),o=N.editlist.timelines.find((function(e){return e.ending})),!o){t.next=21;break}Object.assign(o,r),t.next=23;break;case 21:return t.next=23,N.editlist.add_timelines([Object(f["a"])({start_sec:0,end_sec:2,total_sec:2,ending:!0},r)]);case 23:e.$emit("close"),we.createOperateHistory(ge.Operate.EndingModify.Type),t.next=31;break;case 27:t.prev=27,t.t0=t["catch"](7),e.$snotify.error("生成片尾失败"),e.$emit("close");case 31:e.rendering=!1;case 32:case"end":return t.stop()}}),t,null,[[7,27]])})))()},renderError:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.rendering=!1,t.$snotify.error("生成失败"),window.console.error(e);case 3:case"end":return r.stop()}}),r)})))()},close:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:R.uilog("/ending","cancel"),e.$emit("close");case 2:case"end":return t.stop()}}),t)})))()},fileToImageUrl:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.t0=P,t.next=3,j.getCdvUrl(e);case 3:return t.t1=t.sent,t.next=6,t.t0.assetReadAsDataUrl.call(t.t0,t.t1);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})))()},cropSave:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,P.getExportPosterFolder();case 2:return n=r.sent,i=n.name+"/avatarCropImage_"+Math.random().toString(16).replace("0.","")+".png",r.next=6,t.createCacheFile(e,i);case 6:return a=r.sent,r.next=9,t.fileToImageUrl(a);case 9:t.avatarUrl=r.sent,t.ending.avatarFile=a,t.cropping=!1;case 12:case"end":return r.stop()}}),r)})))()},createCacheFile:function(e,t){return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(R.uilog("/ending","begin create image"),window.requestFileSystem){r.next=3;break}return r.abrupt("return",URL.createObjectURL(e));case 3:return r.next=5,P.filesystem();case 5:return n=r.sent,r.next=8,new Promise((function(e,r){n.root.getFile(t,{create:!0,exclusive:!1},e,r)}));case 8:return i=r.sent,r.next=11,new Promise((function(e,t){i.createWriter(e,t)}));case 11:return a=r.sent,r.next=14,new Promise((function(t,r){a.onwriteend=t,a.onerror=r,a.write(e)}));case 14:return R.uilog("/ending","create image done"),r.abrupt("return",i.nativeURL);case 16:case"end":return r.stop()}}),r)})))()}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(R.uilog("/ending","enter"),r=N.editlist.timelines.find((function(e){return e.ending})),r||(r=P.getLastEnding()),!r){t.next=8;break}return e.ending=Object(f["a"])({},r),t.next=7,e.fileToImageUrl(e.ending.avatarFile);case 7:e.avatarUrl=t.sent;case 8:document.addEventListener("backbutton",e.close,!1);case 9:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:document.removeEventListener("backbutton",e.close,!1);case 1:case"end":return t.stop()}}),t)})))()}},Zi=Qi,ea=(r("9541"),Object(K["a"])(Zi,$i,Mi,!1,null,"ee7ae812",null)),ta=ea.exports,ra=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.output.desSrc?r("div",{staticClass:"exporter-main"},[r("div",{staticClass:"main-title"},[r("mu-button",{attrs:{large:"",icon:""},on:{click:e.cancel}},[r("mu-icon",{attrs:{color:"white",size:"36",value:"close"}})],1),r("mu-button",{staticClass:"btn-done",attrs:{large:"",icon:""},on:{click:e.done}},[r("mu-icon",{attrs:{color:"white",size:"36",value:"done"}})],1)],1),r("div",{staticClass:"title"},[r("mu-icon",{attrs:{value:"check"}}),e._v("导出完成 "),r("span",[e._v("视频已保存到系统相册")])],1),r("div",{staticClass:"content"},[r("VueVideoPlayer",{ref:"videoPlayer",staticClass:"video-player-box vjs-custom-skin",attrs:{options:e.playerOptions,playsinline:!0}})],1),r("div",{staticClass:"bottom"})]):r("div",{staticClass:"exporter-main"},[r("div",{staticClass:"main-title"},[r("mu-button",{attrs:{large:"",icon:""},on:{click:e.cancel}},[r("mu-icon",{attrs:{color:"white",size:"36",value:"close"}})],1)],1),e._m(0),r("Export",{ref:"export",staticClass:"content",on:{error:e.error,success:e.success},scopedSlots:e._u([{key:"default",fn:function(t){return[e.thumbUrl?r("img",{style:e.posterStyles,attrs:{src:e.thumbUrl}}):e._e(),r("div",{staticClass:"progress"},[r("mu-circular-progress",{staticClass:"progress-item progress-slave",attrs:{mode:"determinate",color:"rgba(255,255,255,0.3",value:100,"stroke-width":10,size:105}}),r("mu-circular-progress",{staticClass:"progress-item progress-master",attrs:{mode:"determinate",color:"red",value:t.progress,"stroke-width":5,size:100}}),r("div",{staticClass:"progress-item"},[e._v(e._s(t.progress)+"%")])],1)]}}],null,!1,1590960116)}),r("div",{staticClass:"bottom"})],1)},na=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"title"},[e._v(" 导出中 "),r("span",[e._v("期间请不要切换程序")])])}],ia=r("d6d3"),aa=(r("fda2"),r("451f"),ia["videojs"].getComponent("SeekBar"));aa.prototype.getPercent=function(){var e=this.player_.currentTime(),t=e/this.player_.duration();return t>=1?1:t},aa.prototype.handleMouseMove=function(e){var t=this.calculateDistance(e)*this.player_.duration();t===this.player_.duration()&&(t-=.1),this.player_.currentTime(t),this.update()};var sa={components:{VueVideoPlayer:ia["videoPlayer"]},data:function(){return{thumbUrl:"",posterUrl:"",posterRotate:null,isTempPoster:!1,exportProgress:0,output:{desSrc:""},errorMessage:"",playerOptions:{language:"cn",sources:[{type:"video/mp4",src:""}],poster:""}}},computed:{posterStyles:function(){return this.posterRotate&&!this.isTempPoster?this.posterRotate?"transform: rotate("+this.posterRotate+"deg)":"":{}}},methods:{done:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,j.getConfig();case 2:r=t.sent,n={statusCode:j.StatusCode.Ok,message:e.errorMessage||"导出成功",output:r.output,output_thumb:r.output_thumb},R.uilog("/exporter","done. ".concat(JSON.stringify(n))),j.finish(n);case 6:case"end":return t.stop()}}),t)})))()},cancel:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(R.uilog("/exporter","cancel"),!e.$refs.export){t.next=4;break}return t.next=4,e.$refs.export.cancel();case 4:e.$emit("close");case 5:case"end":return t.stop()}}),t)})))()},error:function(e){this.errorMessage=e.message,this.$snotify.error("导出失败："+this.errorMessage)},success:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.output.desSrc=t.playerOptions.sources[0].src=e,t.playerOptions.poster=t.thumbUrl;case 2:case"end":return r.stop()}}),r)})))()}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.posterUrl=N.editlist.poster.url,e.posterRotate=N.editlist.poster.rotate,t.prev=2,t.next=5,j.getCdvUrl(e.posterUrl);case 5:e.thumbUrl=t.sent,t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](2),e.posterUrl=null;case 11:document.addEventListener("backbutton",e.cancel,!1),R.uilog("/exporter","begin"),e.$refs.export.begin();case 14:case"end":return t.stop()}}),t,null,[[2,8]])})))()},beforeDestroy:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:document.removeEventListener("backbutton",e.cancel,!1);case 1:case"end":return t.stop()}}),t)})))()}},oa=sa,ca=(r("83c7"),r("da08"),Object(K["a"])(oa,ra,na,!1,null,"fdb28bf6",null)),la=ca.exports,ua=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("mu-bottom-sheet",{attrs:{"overlay-close":e.editlist.timelines.length>0,"esc-press-close":e.editlist.timelines.length>0,open:e.isopen},on:{"update:open":function(t){e.isopen=t}}},[r("mu-list",{on:{"item-click":e.close}},[r("mu-sub-header",[e._v("选择")]),r("mu-list-item",{attrs:{button:""},on:{click:e.importFile}},[r("mu-list-item-action",[r("mu-icon",{attrs:{value:"folder_open",color:"orange"}})],1),r("mu-list-item-title",[e._v("从文件导入")])],1),r("mu-list-item",{attrs:{button:""},on:{click:e.captureFile}},[r("mu-list-item-action",[r("mu-icon",{attrs:{value:"photo_camera",color:"orange"}})],1),r("mu-list-item-title",[e._v("拍摄")])],1),r("mu-list-item",{attrs:{button:""},on:{click:function(t){return e.$emit("cancel")}}},[r("mu-list-item-action",[r("mu-icon",{attrs:{value:"cancel",color:"gray"}})],1),r("mu-list-item-title",[e._v("取消")])],1)],1)],1)},da=[],fa={data:function(){return{isopen:!1,editlist:N.editlist}},methods:{open:function(){this.isopen=!0},close:function(){this.isopen=!1},importFile:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(R.uilog("/importer","pick video from library"),!e.isIOS()){t.next=16;break}return t.prev=2,t.next=5,new Promise(MediaPicker.getMedias.bind(MediaPicker,{selectMode:102,maxSelectCount:1}));case 5:r=t.sent,R.info("import file ",r),e.$emit("select",r),t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](2),R.error("import file failed: ",t.t0),N.editlist.timelines.length||e.open();case 14:t.next=28;break;case 16:return t.prev=16,t.next=19,new Promise((function(e,t){return navigator.camera.getPicture(e,t,{sourceType:Camera.PictureSourceType.PHOTOLIBRARY,allowEdit:!0,mediaType:Camera.MediaType.VIDEO})}));case 19:n=t.sent,R.info("import file ",n),e.$emit("select",[{uri:n}]),t.next=28;break;case 24:t.prev=24,t.t1=t["catch"](16),R.error("import file failed: ",t.t1),N.editlist.timelines.length||e.open();case 28:case"end":return t.stop()}}),t,null,[[2,10],[16,24]])})))()},captureFile:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return R.uilog("/importer","capture video from camera"),t.prev=1,t.next=4,new Promise((function(e,t){return navigator.device.capture.captureVideo(e,t,{duration:ge.CaptureVideo.Duration})}));case 4:r=t.sent,R.error("capture file",r),e.$emit("select",r.map((function(e){return{uri:e.fullPath}}))),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),R.error("capture file failed: ",t.t0),N.editlist.timelines.length||e.open();case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))()},importProgress:function(e){e&&"progress"==e.status&&this.$emit("progress",e.index)}},mounted:function(){this.isIOS()&&document.addEventListener("MediaPicker.CompressVideoEvent",this.importProgress)},beforeDestroy:function(){this.isIOS()&&document.removeEventListener("MediaPicker.CompressVideoEvent",this.importProgress)}},pa=fa,ma=(r("e778"),Object(K["a"])(pa,ua,da,!1,null,"37304692",null)),ha=ma.exports,va={components:{ClipTop:Pe,ClipTimeline:ct,PlayerController:ht,ToolTab:zt,ToolDialog:In,OverlayEditor:mi,PosterMaker:Ei,EndingMaker:ta,Exporter:la,Importer:ha},data:function(){return{player:{pause:!0,loading:!1,going2play:!1},preview_render:!1,editlist:N.editlist,showOverlay:!1,overlayType:!1,showAMix:!1,showTooltab:!0,showPlayerController:!0,showTimeline:!0,activeItem:null,makePoster:!1,makeEnding:!1,doExport:!1,importProgress:-1}},watch:Object(d["a"])({},"player.pause",(function(e){e?this.$refs.overlayEditor.pause():this.$refs.overlayEditor.play()})),methods:{reloadPlayer:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.player.pause=!0,t.preview_render=!1,r.next=4,t.$refs.preview.reload(!e);case 4:case"end":return r.stop()}}),r)})))()},seekPlayer:function(e){this.$refs.preview.seek(e),this.$refs.overlayEditor.seek(e)},playerFinished:function(){this.player.pause=!0},timeChange:function(e){this.player.pause=!0,this.seekPlayer(e.time_sec)},timelinesChange:function(e){this.editlist.timelines=e,we.createOperateHistory(ge.Operate.VideoTimeModify.Type)},amixChange:function(e){this.editlist.update_amix(e),we.createOperateHistory(ge.Operate.AudioEffectTimeModify.Type)},amixActive:function(e){this.activeItem=e},overlayChange:function(e){this.$refs.overlayEditor.active(e),this.editlist.update_overlay(e),e.type==ge.Overlay.Type.Image?we.createOperateHistory(ge.Operate.ImageTimeModify.Type):e.type==ge.Overlay.Type.Text?we.createOperateHistory(ge.Operate.TextTimeModify.Type):e.type==ge.Overlay.Type.Mosic&&we.createOperateHistory(ge.Operate.MosicTimeModify.Type)},overlayActive:function(e){e?this.$refs.overlayEditor.active(e):(this.$refs.overlayEditor.blur(),this.activeItem&&this.activeItem.active&&(this.activeItem.active=!1)),this.activeItem=e},overlayDeactive:function(){this.activeItem=null},blankClicked:function(){this.$refs.overlayEditor.blur()},previewLoaddone:function(){this.player.loading=!1,this.player.pause=!this.player.going2play,this.player.going2play=!1},playerControllerEvent:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i,a,s,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:a="";try{a=Object.keys(ht.EventID)[Object.values(ht.EventID).indexOf(e.eventID)]}catch(e){}R.uilog("/","player control: ".concat(a)),r.t0=e.eventID,r.next=r.t0===ht.EventID.Play?6:r.t0===ht.EventID.Pause?8:r.t0===ht.EventID.SeekBegin?10:r.t0===ht.EventID.SeekEnd?21:r.t0===ht.EventID.Undo?32:r.t0===ht.EventID.AspectRatio?34:36;break;case 6:return!t.$refs.preview.$refs.video.seeking&&t.$refs.preview.$refs.video.loaded?t.player.pause=!1:t.player.going2play=!0,r.abrupt("break",36);case 8:return t.player.pause=!0,r.abrupt("break",36);case 10:if(t.player.pause=!0,n=t.editlist.cur_timeline(),i=_e(t.editlist.time_sec),!n){r.next=20;break}return Math.abs(i-n.offset_sec)<.05&&(s=Math.max(0,t.editlist.timelines.findIndex((function(e){return e.id==n.id}))-1),n=t.editlist.timelines[s]),r.next=17,new Promise((function(e){return setTimeout(e,100)}));case 17:i=n.offset_sec+.01,t.seekPlayer(i),t.$refs.timeline.update_time_sec(i);case 20:return r.abrupt("break",36);case 21:if(t.player.pause=!0,n=t.editlist.cur_timeline(),i=_e(t.editlist.time_sec),!n){r.next=31;break}return i==_e(n.offset_sec+n.end_sec-n.start_sec)&&(o=t.editlist.timelines.indexOf(n)+1,o<t.editlist.timelines.length&&(n=t.editlist.timelines[o])),r.next=28,new Promise((function(e){return setTimeout(e,100)}));case 28:i=n.offset_sec+n.end_sec-n.start_sec+.01,t.seekPlayer(i),t.$refs.timeline.update_time_sec(i);case 31:return r.abrupt("break",36);case 32:return t.undo(),r.abrupt("break",36);case 34:return t.$refs.toolDlg.show(zt.TabID.AspectRatio,{height:t.$refs.toolTab.$el.clientHeight+"px"}),r.abrupt("break",36);case 36:case"end":return r.stop()}}),r)})))()},toolBeforeChange:function(){this.player.pause=!0},toolValueChange:function(e,t){if(t==zt.TabID.AspectRatio&&(this.player.pause=!0),e&&e.overlay)return this.overlayActive(e.overlay),void(e.overlay.type==ge.Overlay.Type.Text&&this.reloadPlayer());this.reloadPlayer()},overlayEditorChange:function(){this.reloadPlayer()},tabSelect:function(e){var t=this,r="";try{r=Object.keys(zt.TabID)[Object.values(zt.TabID).indexOf(e)]}catch(O){}switch(R.uilog("/","tab change: ".concat(r)),e){case zt.TabID.ImageTab:this.showOverlay=!0,this.overlayType=ge.Overlay.Type.Image|ge.Overlay.Type.Mosic,this.showAMix=!1;break;case zt.TabID.TextTab:this.showOverlay=!0,this.overlayType=ge.Overlay.Type.Text,this.showAMix=!1;break;case zt.TabID.AudioTab:this.showAMix=!0,this.showOverlay=!1;break;case zt.TabID.OtherTab:this.showOverlay=!1,this.showAMix=!1;break;case zt.TabID.ToolEdit:case zt.TabID.ToolTemplate:case zt.TabID.ToolSettings:this.activeItem.type==ge.Overlay.Type.Text&&(this.showTimeline=!1,this.showPlayerController=!1,this.$refs.toolDlg.show(zt.TabID.AddText,{height:"auto",overlay:this.activeItem,operateToolTabId:e}));break;case zt.TabID.ToolDone:this.activeItem.active=!1,this.activeItem=null,this.$refs.overlayEditor.blur();break;case zt.TabID.ToolRemove:switch(this.editlist.remove_overlay(this.activeItem.id),this.activeItem.active=!1,this.activeItem.type){case ge.Overlay.Type.Image:we.createOperateHistory(ge.Operate.ImageRemove.Type);break;case ge.Overlay.Type.Text:we.createOperateHistory(ge.Operate.TextRemove.Type);break;case ge.Overlay.Type.Mosic:we.createOperateHistory(ge.Operate.MosicRemove.Type);break;default:we.createOperateHistory(ge.Operate.AudioEffectRemove.Type);break}this.$refs.overlayEditor.blur(),this.activeItem=null,this.reloadPlayer();break;case zt.TabID.VideoAdd:this.pickVideo();break;case zt.TabID.VideoRemove:var n=this.editlist.timelines,i=n.findIndex((function(e){return e.active}));if(-1==i){var a=this.editlist.cur_timeline();i=!a&&n.length?0:n.findIndex((function(e){return e.id==a.id}))}if(i>=0){var s=n[i];n.splice(i,1),[0].concat(Object(u["a"])(n)).reduce((function(e,t){return t.offset_sec=e,t.offset_sec+t.end_sec-t.start_sec})),[].concat(Object(u["a"])(this.editlist.amix),Object(u["a"])(this.editlist.overlay)).forEach((function(e){var r=_e(s.offset_sec)<=_e(e.offset_sec)&&_e(e.offset_sec)<_e(s.offset_sec+s.end_sec-s.start_sec);r&&t.editlist.remove_overlay(e.id)})),this.player.pause=!0;var o=0;o=0!=i&&n.length?n[i-1].offset_sec+n[i-1].end_sec-n[i-1].start_sec+.01:0,this.seekPlayer(o),this.$refs.timeline.update_time_sec(o),this.reloadPlayer(),we.createOperateHistory(ge.Operate.VideoRemove.Type,s.id)}0==n.length&&(this.editlist.poster.url="",this.editlist.poster.overlay.splice(0,-1),this.pickVideo());break;case zt.TabID.VideoSplit:this.player.pause=!0;var c=this.editlist.timelines,l=(+this.editlist.time_sec).toFixed(3)-.01,d=this.editlist.cur_timeline(),f=c.findIndex((function(e){return e.id==d.id})),p=ye()(!0,{},d,{id:this.editlist.get_next_timelineId()});if(d.active=!1,l-d.offset_sec<this.editlist.video_min_sec||d.offset_sec+d.end_sec-d.start_sec-l<this.editlist.video_min_sec)return void this.$snotify.error("时长小于".concat(this.editlist.video_min_sec,"秒，无法分割"));d.end_sec=p.start_sec=l-d.offset_sec+d.start_sec,c.splice(f+1,0,p),c.reduce((function(e,t,r){return 1==r&&(e=e.end_sec-e.start_sec),t.offset_sec=e,t.offset_sec+t.end_sec-t.start_sec})),this.editlist.cur_timeline(!0),this.$refs.timeline.refreshUI(),this.reloadPlayer(),we.createOperateHistory(ge.Operate.VideoSplit.Type);break;case zt.TabID.VideoRotate:var m=this.editlist.timelines,h=this.editlist.cur_timeline(),v=m.findIndex((function(e){return e.id==h.id}));if(v>=0){var g=m[v];0==v&&(this.editlist.poster.rotate+=270,this.editlist.poster.rotate%=360,this.rotatePosterOverlay(g,270)),g.rotate+=270,g.rotate%=360,this.reloadPlayer(),we.createOperateHistory(ge.Operate.VideoRotate.Type)}break;case zt.TabID.VideoVFlip:var b=this.editlist.timelines,y=-1;if(b.forEach((function(e,r){e.offset_sec<t.editlist.time_sec&&e.end_sec-e.start_sec+e.offset_sec>t.editlist.time_sec&&(y=r)})),y>=0){var _=b[y];_.vflip=!_.vflip,this.reloadPlayer(),we.createOperateHistory(ge.Operate.VideoVFlip.Type)}break;case zt.TabID.VideoHFlip:var x=this.editlist.timelines,w=-1;if(x.forEach((function(e,r){e.offset_sec<t.editlist.time_sec&&e.end_sec-e.start_sec+e.offset_sec>t.editlist.time_sec&&(w=r)})),w>=0){var k=x[w];k.hflip=!k.hflip,this.reloadPlayer(),we.createOperateHistory(ge.Operate.VideoHFlip.Type)}break;case zt.TabID.AddLocalImage:this.pickImg();break;case zt.TabID.Mosic:this.addMosic();break;default:var T;switch(e){case zt.TabID.Face:case zt.TabID.AudioBase:this.player.pause=!0,T=this.$refs.toolTab.$el.clientHeight+"px";break;case zt.TabID.AddText:this.showTimeline=!1,this.showPlayerController=!1,T="auto";break;case zt.TabID.BGM:T=this.$el.clientHeight/2+"px";break;default:T=this.$refs.toolBox.clientHeight+"px"}this.$refs.toolDlg.show(e,{height:T})}e!=zt.TabID.ImageTab&&e!=zt.TabID.TextTab&&e!=zt.TabID.AudioTab&&e!=zt.TabID.OtherTab||this.overlayActive(null)},pickImg:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return R.uilog("/","pick image"),t.next=3,new Promise((function(e,t){return navigator.camera.getPicture(e,t,{sourceType:Camera.PictureSourceType.PHOTOLIBRARY,allowEdit:!1,correctOrientation:!0,mediaType:Camera.MediaType.PICTURE})}));case 3:if(r=t.sent,r){t.next=6;break}return t.abrupt("return");case 6:n=e.editlist.add_overlay({url:r,type:ge.Overlay.Type.Image}),e.$refs.overlayEditor.active(n),e.overlayActive(n),R.uilog("/","pick image done, url: ".concat(n.url)),we.createOperateHistory(ge.Operate.ImageAdd.Type);case 11:case"end":return t.stop()}}),t)})))()},importFileSelect:function(e,t){var r=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var i,a,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=r.editlist.timelines.length,a=r.editlist.total_sec,n.next=4,Promise.all(e.map((function(e){var t=e.uri.replace("file://","");return{url:t}})));case 4:return s=n.sent,R.uilog("/","file imported: ".concat(JSON.stringify(s))),n.prev=6,n.next=9,r.editlist.add_timelines(s);case 9:n.next=16;break;case 11:return n.prev=11,n.t0=n["catch"](6),R.error("add timeline failed",n.t0),r.$snotify.error(n.t0),n.abrupt("return");case 16:return t||s.forEach((function(e){we.createOperateHistory(ge.Operate.VideoAdd.Type,e.id)})),n.next=19,r.$refs.preview.reload();case 19:a+=.01,i&&(r.seekPlayer(a),r.$refs.timeline.update_time_sec(a)),R.uilog("/","player loaded"),r.importProgress=-1,r.editlist.timelines.length||r.pickVideo();case 24:case"end":return n.stop()}}),n,null,[[6,11]])})))()},importCancel:function(){this.editlist.timelines.length<=0&&this.$refs.top.exit(!0)},pickVideo:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$refs.importer.open();case 1:case"end":return t.stop()}}),t)})))()},mainBoxResized:function(){var e=this;this.$nextTick((function(){e.$refs.overlayEditor.updateUI()}))},addMosic:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(R.uilog("/","add mosic"),e.editlist.mosic_source){t.next=5;break}return t.next=4,P.getMosicSource();case 4:e.editlist.mosic_source=t.sent;case 5:return r=e.editlist.add_mosic(),e.activeItem=r,e.$refs.overlayEditor.active(r),e.$refs.overlayEditor.toCenter(1),t.next=11,e.reloadPlayer();case 11:R.uilog("/","add mosic done"),we.createOperateHistory(ge.Operate.MosicAdd.Type,r.id);case 13:case"end":return t.stop()}}),t)})))()},undo:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.player.pause=!0,t.next=3,we.undo(e.$refs.preview);case 3:r=t.sent,R.uilog("/","history undo: ".concat(r)),e.$refs.overlayEditor.blur(),e.activeItem&&(e.activeItem.active=!1),e.$snotify.success(r),N.editlist.timelines.length||e.pickVideo();case 9:case"end":return t.stop()}}),t)})))()},rotatePosterOverlay:function(e,t){var r=this.editlist.getRotatedWidth(e),n=r,i=0;this.editlist.poster.overlay.forEach((function(e){var a=Math.hypot(e.w,e.h),s=e.x-(e.w-a)/2,o=e.y-(e.h-a)/2,c=xe(n,i,s,o,t),l=xe(n,i,s+e.w,o+e.h,t);n=(c.x+l.x)/2,i=(c.y+l.y)/2,c=xe(n,i,c.x,c.y,-t),c.x-=r,e.x=c.x+(e.w-a)/2,e.y=c.y+(e.h-a)/2,e.rotate+=t,e.rotate%=360}))}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(R.info("JSUGCSDK verison: ".concat(me.version)),R.uilog("/","begin"),e.isCordova){t.next=5;break}return R.warn("需要UGC客户端支持"),t.abrupt("return");case 5:return t.next=7,j.getConfig();case 7:if(r=t.sent,!r.input){t.next=14;break}return R.uilog("/","config.input video: ".concat(r.input)),t.next=12,e.importFileSelect([{uri:r.input}],!0);case 12:t.next=15;break;case 14:e.pickVideo();case 15:we.createOperateHistory(ge.Operate.Init.Type);case 16:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}},ga=va,ba=(r("88e0"),r("376e"),Object(K["a"])(ga,c,l,!1,null,"40416608",null)),ya=ba.exports,_a={name:"app",components:{Main:ya}},xa=_a,wa=(r("034f"),Object(K["a"])(xa,s,o,!1,null,null,null)),ka=wa.exports,Ta=r("30f4"),Ra=(r("d6f6"),r("480c"),r("aa12"),r("4d7d")),Oa=r("f213");r("26e8");a["a"].use(Ta["a"]),a["a"].use(Ra["a"]),a["a"].use(Oa["a"],{toast:{position:"centerTop"}}),a["a"].component("PreviewPlayer",ie),a["a"].component("Export",de),a["a"].config.productionTip=!1,a["a"].config.performance=!0,a["a"].prototype.isCordova=j.isCordova,a["a"].prototype.isIOS=j.isIOS,a["a"].prototype.isAndroid=j.isAndroid,a["a"].prototype.isMobile=function(){return j.isIOS()||j.isAndroid()},a["a"].prototype.isPortrait=j.isPortrait,Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,j.init();case 2:new a["a"]({render:function(e){return e(ka)}}).$mount("#app");case 3:case"end":return e.stop()}}),e)})))()},"5c20":function(e,t,r){"use strict";var n=r("3d18"),i=r.n(n);i.a},"62b1":function(e,t,r){"use strict";var n=r("c7b5"),i=r.n(n);i.a},6345:function(e,t,r){},"668e":function(e,t,r){},"685f":function(e,t,r){"use strict";var n=r("3cd8"),i=r.n(n);i.a},"6a78":function(e,t,r){"use strict";var n=r("794a"),i=r.n(n);i.a},"6b05":function(e,t,r){"use strict";var n=r("f64d"),i=r.n(n);i.a},"6b28":function(e,t,r){},"6df3":function(e,t,r){"use strict";var n=r("668e"),i=r.n(n);i.a},"6f0f":function(e,t,r){"use strict";var n=r("92db"),i=r.n(n);i.a},"6f2d":function(e,t,r){"use strict";var n=r("9066"),i=r.n(n);i.a},7674:function(e,t,r){"use strict";var n=r("9c94"),i=r.n(n);i.a},"788a":function(e,t,r){"use strict";var n=r("2fb0"),i=r.n(n);i.a},"794a":function(e,t,r){},7972:function(e,t,r){"use strict";var n=r("21aa"),i=r.n(n);i.a},"7edc":function(e,t,r){},"7fb4":function(e,t,r){},8108:function(e,t,r){"use strict";var n=r("9158"),i=r.n(n);i.a},"836a":function(e,t,r){"use strict";var n=r("af44"),i=r.n(n);i.a},"83a6":function(e,t,r){"use strict";var n=r("d017"),i=r.n(n);i.a},"83c7":function(e,t,r){"use strict";var n=r("d02c"),i=r.n(n);i.a},"85ec":function(e,t,r){},8746:function(e,t,r){"use strict";var n=r("507c"),i=r.n(n);i.a},"88e0":function(e,t,r){"use strict";var n=r("c22b"),i=r.n(n);i.a},"8fb4":function(e,t,r){"use strict";var n=r("153c"),i=r.n(n);i.a},9066:function(e,t,r){},9158:function(e,t,r){},"922d":function(e,t,r){"use strict";var n=r("f1ef"),i=r.n(n);i.a},"92b4":function(e,t,r){},"92bd":function(e,t,r){"use strict";var n=r("b984"),i=r.n(n);i.a},"92db":function(e,t,r){},9336:function(e,t,r){},9378:function(e,t,r){"use strict";var n=r("51dc"),i=r.n(n);i.a},9541:function(e,t,r){"use strict";var n=r("25aa"),i=r.n(n);i.a},"9c94":function(e,t,r){},af44:function(e,t,r){},b984:function(e,t,r){},baa8:function(e,t,r){},bc09:function(e,t,r){"use strict";var n=r("c837"),i=r.n(n);i.a},be7d:function(e,t,r){},c22b:function(e,t,r){},c5b1:function(e,t,r){"use strict";var n=r("f70a"),i=r.n(n);i.a},c7b5:function(e,t,r){},c837:function(e,t,r){},cb35:function(e,t,r){"use strict";var n=r("9336"),i=r.n(n);i.a},cc8d:function(e,t,r){"use strict";var n=r("6b28"),i=r.n(n);i.a},d017:function(e,t,r){},d02c:function(e,t,r){},d93d:function(e,t,r){"use strict";var n=r("2aa2"),i=r.n(n);i.a},da08:function(e,t,r){"use strict";var n=r("92b4"),i=r.n(n);i.a},dbee:function(e,t,r){"use strict";var n=r("7fb4"),i=r.n(n);i.a},e5dd:function(e,t,r){},e65f:function(e,t,r){"use strict";var n=r("1541"),i=r.n(n);i.a},e778:function(e,t,r){"use strict";var n=r("7edc"),i=r.n(n);i.a},f1ef:function(e,t,r){},f64d:function(e,t,r){},f70a:function(e,t,r){}});
//# sourceMappingURL=app.c64b4055.js.map