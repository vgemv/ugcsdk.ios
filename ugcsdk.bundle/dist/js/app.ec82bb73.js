(function(e){function t(t){for(var n,s,o=t[0],c=t[1],l=t[2],d=0,f=[];d<o.length;d++)s=o[d],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&f.push(i[s][0]),i[s]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);u&&u(t);while(f.length)f.shift()();return a.push.apply(a,l||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,o=1;o<r.length;o++){var c=r[o];0!==i[c]&&(n=!1)}n&&(a.splice(t--,1),e=s(s.s=r[0]))}return e}var n={},i={app:0},a=[];function s(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=n,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;a.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"031c":function(e,t,r){"use strict";var n=r("e99d"),i=r.n(n);i.a},"034f":function(e,t,r){"use strict";var n=r("85ec"),i=r.n(n);i.a},"0811":function(e,t,r){},"09eb":function(e,t,r){},"0a0d":function(e,t,r){"use strict";var n=r("9428"),i=r.n(n);i.a},"0f20":function(e,t,r){"use strict";var n=r("1d3d"),i=r.n(n);i.a},1174:function(e,t,r){"use strict";var n=r("efa5"),i=r.n(n);i.a},1539:function(e,t,r){"use strict";var n=r("0811"),i=r.n(n);i.a},1541:function(e,t,r){},"1d3d":function(e,t,r){},"224e":function(e,t,r){"use strict";var n=r("ae1f"),i=r.n(n);i.a},"270a":function(e,t,r){"use strict";var n=r("8efa"),i=r.n(n);i.a},"2a0d":function(e,t,r){},3210:function(e,t,r){},"32a2":function(e,t,r){"use strict";(function(e){r("4160"),r("c975"),r("a15b"),r("fb6a"),r("a434"),r("d3b7"),r("ac1f"),r("25f0"),r("466d"),r("5319"),r("1276"),r("498a"),r("159b");function n(t,r,n){if(r.trim()){var a={font:"18px Arial, sans-serif",sizeToFill:!1,maxFontSizeToFill:!1,lineHeight:1,allowNewLine:!0,lineBreak:"none",textAlign:"left",verticalAlign:"top",justifyLines:!1,paddingX:0,paddingY:0,fitParent:!1,strokeText:!1,renderHDPI:!0,textDecoration:"none",lineWidth:.02,shadowBlur:.5},s={};for(var o in a)s[o]=n.hasOwnProperty(o)?n[o]:a[o];var c=t.getContext("2d");c.font=s.font;var l=1.1,u="undefined"!==typeof e?e.devicePixelRatio:window.devicePixelRatio;if(s.renderHDPI&&u>1){var d={};for(var f in c)d[f]=c[f];var p=t.width,h=t.height;for(var m in l=u,t.width=p*l,t.height=h*l,t.style.width=p*l*.5+"px",t.style.height=h*l*.5+"px",d)try{c[m]=d[m]}catch(z){}c.scale(l,l)}var v,g=(s.fitParent?t.parentNode.clientWidth:t.width)/l,b=(s.fitParent?t.parentNode.clientHeight:t.height)/l,w=g-2*s.paddingX,y=b-2*s.paddingY,x="none"===s.lineBreak.toLocaleLowerCase()?"":/\s+/,_=s.font.match(/\d+(px|em|%)/g)?+s.font.match(/\d+(px|em|%)/g)[0].match(/\d+/g):18,k=0,T=[],C=[],R={x:0,y:0},O=0,P="​";return r=A(r),I(_),S(),X(),M(),T}function A(e){do{e=e.replace(/\n\n/g,"\n"+P+"\n")}while(e.indexOf("\n\n")>-1);return e}function I(e){v||(v=s.sizeToFill?c.font.split(/\b\d+px\b/i):s.font.split(/\b\d+px\b/i)),c.font=v[0]+e+"px"+v[1],c.lineWidth=e*s.lineWidth,c.shadowBlur=e*s.shadowBlur}function S(){isNaN(s.lineHeight)?-1!==s.lineHeight.toString().indexOf("px")?O=parseInt(s.lineHeight):-1!==s.lineHeight.toString().indexOf("%")&&(O=parseInt(s.lineHeight)/100*_):O=_*s.lineHeight}function M(){if(s.sizeToFill){var e=r.trim().split(x).length,t=0,n=!1!==s.maxFontSizeToFill;do{if(n){if(!(++t<=s.maxFontSizeToFill))break;E(t)}else E(++t)}while(k<y&&T.join(x?" ":"").split(x).length==e);E(--t)}else j();s.justifyLines&&"word"!==s.lineBreak&&L(),H(),B(),F()}function E(e){I(e),O=e,j()}function j(){if(s.allowNewLine)for(var e=r.trim().split("\n"),t=0,n=0;t<e.length-1;t++)n+=e[t].trim().split(x).length,C.push(n);var i=r.trim().split(x);$(i),D(i),k=T.length*O}function $(e){var t,r,n,i;e.forEach((function(a,s){if(t="",r=c.measureText(a).width,r>w){for(var o=0;c.measureText(t+a[o]).width<=w&&o<a.length;o++)t+=a[o];n=a.slice(0,o),i=a.slice(o),e.splice(s,1,n,i)}}))}function D(e){T=[];for(var t=0,r=0;t<e.length;r++)if(T[r]="","word"!==s.lineBreak){if(c.measureText(T[r]+e[t]).width>w)break;while(c.measureText(T[r]+e[t]).width<=w&&t<e.length)if(T[r]+=e[t]+(x?" ":""),t++,s.allowNewLine)for(var n=0;n<C.length;n++)if(C[n]===t){r++,T[r]="";break}T[r]=x?T[r].trim():T[r]}else T[r]=e[t],t++}function L(){for(var e,t,r,n,a,s,o,l,u=0;u<T.length;u++)r=c.measureText(T[u]).width,(!e||r>e)&&(e=r,t=u);var d=" ";for(i=0;i<T.length;i++)if(i!==t&&(n=T[i].trim().split(x).length,!(n<=1))){T[i]=T[i].trim().split(x).join(d),a=c.measureText(d).width,s=(e-c.measureText(T[i]).width)/a,o=s/(n-1),l="";for(var f=0;f<o;f++)l+=d;T[i]=T[i].trim().split(d).join(l)}}function U(e,t,r){var n=c.measureText(e).width;switch(c.textAlign){case"center":t-=n/2;break;case"right":t-=n;break}c.beginPath(),c.moveTo(t,r),c.lineTo(t+n,r),c.stroke()}function F(){for(var e=P+(x?" ":""),t=0;t<T.length;t++)R.y=parseInt(R.y)+O,T[t]!==e&&(c.fillText(T[t],R.x,R.y),s.strokeText&&c.strokeText(T[t],R.x,R.y),"underline"===s.textDecoration.toLocaleLowerCase()&&U(T[t],R.x,R.y))}function B(){c.textAlign=s.textAlign,"center"==s.textAlign?R.x=g/2:"right"==s.textAlign?R.x=g-s.paddingX:R.x=s.paddingX}function H(){"middle"==s.verticalAlign?R.y=(b-k)/2:"bottom"==s.verticalAlign?R.y=b-k-s.paddingY:R.y=s.paddingY}function X(){if("string"!==typeof r)throw new TypeError("The second parameter must be a String.");if(isNaN(_))throw new TypeError('Cannot parse "font".');if(isNaN(O))throw new TypeError('Cannot parse "lineHeight".');if("left"!==s.textAlign.toLocaleLowerCase()&&"center"!==s.textAlign.toLocaleLowerCase()&&"right"!==s.textAlign.toLocaleLowerCase()&&"top"!==s.textAlign.toLocaleLowerCase())throw new TypeError('Property "textAlign" must be set to either "left", "center", "right, or "top".');if("top"!==s.verticalAlign.toLocaleLowerCase()&&"middle"!==s.verticalAlign.toLocaleLowerCase()&&"bottom"!==s.verticalAlign.toLocaleLowerCase())throw new TypeError('Property "verticalAlign" must be set to either "top", "middle", or "bottom".');if("boolean"!==typeof s.justifyLines)throw new TypeError('Property "justifyLines" must be a Boolean.');if(isNaN(s.paddingX))throw new TypeError('Property "paddingX" must be a Number.');if(isNaN(s.paddingY))throw new TypeError('Property "paddingY" must be a Number.');if("boolean"!==typeof s.fitParent)throw new TypeError('Property "fitParent" must be a Boolean.');if("auto"!==s.lineBreak.toLocaleLowerCase()&&"word"!==s.lineBreak.toLocaleLowerCase()&&"none"!==s.lineBreak.toLocaleLowerCase())throw new TypeError('Property "lineBreak" must be set to either "auto", "none" or "word".');if("boolean"!==typeof s.sizeToFill)throw new TypeError('Property "sizeToFill" must be a Boolean.');if("boolean"!==typeof s.strokeText)throw new TypeError('Property "strokeText" must be a Boolean.');if("boolean"!==typeof s.renderHDPI)throw new TypeError('Property "renderHDPI" must be a Boolean.');if("none"!==s.textDecoration.toLocaleLowerCase()&&"underline"!==s.textDecoration.toLocaleLowerCase())throw new TypeError('Property "textDecoration" must be set to either "none" or "underline".')}}t["a"]=n}).call(this,r("c8ba"))},"3be7":function(e,t,r){},"3d69":function(e,t,r){},"3d70":function(e,t,r){},4716:function(e,t,r){},"475a":function(e,t,r){"use strict";var n=r("5e14"),i=r.n(n);i.a},"480c":function(e,t,r){},4988:function(e,t,r){"use strict";var n=r("5cc1"),i=r.n(n);i.a},"499f":function(e,t,r){"use strict";var n=r("09eb"),i=r.n(n);i.a},"4d630":function(e,t,r){"use strict";var n=r("c6d9"),i=r.n(n);i.a},"4fca":function(e,t,r){},5637:function(e,t,r){"use strict";var n=r("4fca"),i=r.n(n);i.a},"56d7":function(e,t,r){"use strict";r.r(t);r("96cf");var n,i=r("1da1"),a=(r("e260"),r("e6cf"),r("cca6"),r("a79d"),r("2b0e")),s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("Clip")],1)},o=[],c=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"main"},[r("div",{directives:[{name:"show",rawName:"v-show",value:!e.makePoster&&!e.makeEnding&&!e.doExport,expression:"!makePoster&&!makeEnding&&!doExport"}],staticClass:"main-maker"},[r("ClipTop",{on:{export:function(t){e.doExport=!0}}}),r("div",{ref:"mainBox",staticClass:"main-box"},[r("PreviewPlayer",{ref:"preview",staticClass:"main-video",attrs:{pause:e.player.pause||e.doExport,editlist:e.editlist},on:{finished:e.playerFinished,resize:function(t){!e.makePoster&&!e.makeEnding&&e.doExport}}}),r("ClipImg",{ref:"overlayEditor",staticClass:"overlay-box",attrs:{overlays_in:e.editlist.overlay,mosics_in:e.editlist.mosic,time_sec:e.editlist.time_sec},on:{change:e.clipImgChange,overlayActive:e.overlayActive,overlayDeactive:e.overlayDeactive}})],1),r("div",{ref:"toolBox",staticClass:"toolBox"},[r("PlayerController",{directives:[{name:"show",rawName:"v-show",value:e.showPlayerController,expression:"showPlayerController"}],attrs:{playing:!e.player.pause},on:{event:e.playerControllerEvent}}),r("ClipTimeline",{directives:[{name:"show",rawName:"v-show",value:e.showTimeline,expression:"showTimeline"}],ref:"timeline",attrs:{timelines_in:e.editlist.timelines,show_overlay:e.showOverlay,overlay_type:e.overlayType,show_amix:e.showAMix,playing:!e.player.pause,poster:e.editlist.poster.url},on:{timelinesChange:e.timelinesChange,timeChange:e.timeChange,overlayChange:e.overlayChange,overlayActive:e.overlayActive,amixChange:e.amixChange,amixActive:e.amixActive,on_poster_click:function(t){e.makePoster=1},on_ending_click:function(t){e.makeEnding=1}}}),r("ToolTab",{directives:[{name:"show",rawName:"v-show",value:e.showTooltab,expression:"showTooltab"}],ref:"toolTab",attrs:{editlist:e.editlist,activeItem:e.activeItem},on:{select:e.tabSelect}}),r("ToolDialog",{ref:"toolDlg",attrs:{editlist:e.editlist},on:{close:function(t){e.showTooltab=e.showPlayerController=e.showTimeline=!0,e.mainBoxResized()},beforechange:e.toolBeforeChange,change:e.toolValueChange}})],1),e.importProgress>=0?r("div",{staticClass:"spin"},[r("div",[r("mu-circular-progress",{attrs:{mode:"determinate",value:100*e.importProgress}}),r("br"),r("span",{staticStyle:{"font-size":"14px"}},[e._v("导入中 "+e._s((100*e.importProgress).toFixed(2))+"%")])],1)]):e._e()],1),e.makePoster?r("PosterMaker",{attrs:{editlist:this.editlist},on:{close:function(t){e.makePoster=!1,e.seekPlayer(0),e.reloadPlayer()}}}):e._e(),e.makeEnding?r("EndingMaker",{on:{close:function(t){e.makeEnding=!1,e.reloadPlayer()}}}):e._e(),e.doExport?r("Exporter",{ref:"exporter",on:{close:function(t){e.doExport=!1}}}):e._e(),r("Importer",{ref:"importer",attrs:{editlist:e.editlist},on:{select:e.importFileSelect,progress:function(t){e.importProgress=t}}})],1)},l=[],u=(r("99af"),r("4de4"),r("7db0"),r("c740"),r("4160"),r("c975"),r("d81d"),r("13d5"),r("a434"),r("4057"),r("b64b"),r("d3b7"),r("3ca3"),r("159b"),r("ddb0"),r("2909")),d=r("e9d0"),f=r.n(d),p=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"main-title"},[r("mu-button",{attrs:{large:"",icon:""},on:{click:e.exit}},[r("mu-icon",{attrs:{color:"white",size:"36",value:"chevron_left"}})],1),r("div",{staticStyle:{width:"100%","text-align":"center"}}),r("mu-button",{ref:"showDlgBtn",attrs:{icon:"",large:""},on:{click:e.showDlg}},[r("mu-icon",{attrs:{color:e.setting?"red":"white",size:"24",value:"settings"}})],1),r("mu-button",{attrs:{color:"red",small:"",round:""},on:{click:function(t){return e.$emit("export")}}},[e._v(" 导出 ")]),r("transition",{attrs:{name:"fade"}},[r("div",{directives:[{name:"show",rawName:"v-show",value:e.setting,expression:"setting"}],ref:"dlg",staticClass:"settings-dlg",attrs:{tabindex:"-1"},on:{blur:e.blur}},[r("div",{staticClass:"content"},[r("div",{staticClass:"setting-title"},[e._v("导出设置")]),r("div",{staticClass:"content-top"},[r("div",{staticClass:"content-item",class:{active:"high"==e.encodeparam.preset},on:{click:function(t){e.encodeparam.preset="high"}}},[e._v(" 视频质量优先 "),r("div",{staticClass:"content-desc"},[e._v("质量更加，生成速度较慢")]),r("div",{staticClass:"content-resolution"},[e._v("分辨率 "+e._s(e.high_resolution))])]),r("div",{staticClass:"content-item",class:{active:"low"==e.encodeparam.preset},on:{click:function(t){e.encodeparam.preset="low"}}},[e._v(" 视频大小优先 "),r("div",{staticClass:"content-desc"},[e._v("大小更少，生成速度较快")]),r("div",{staticClass:"content-resolution"},[e._v("分辨率 "+e._s(e.low_resolution))])])]),r("div",{staticClass:"content-other"},[e._v(" 硬编码 "),r("mu-switch",{on:{change:e.focus},model:{value:e.encodeparam.hardware_encoder,callback:function(t){e.$set(e.encodeparam,"hardware_encoder",t)},expression:"encodeparam.hardware_encoder"}})],1)])])])],1)},h=[],m=(r("a15b"),r("fb6a"),r("a9e3"),r("b680"),r("4d63"),r("ac1f"),r("25f0"),r("5319"),r("5530")),v=null,g=window.matchMedia("(orientation: portrait)"),b=navigator.userAgent.indexOf("(cordova)")>=0,w={isCordova:function(){return b},isIOS:function(){return navigator.userAgent.toLowerCase().indexOf("iphone")>=0},isAndroid:function(){return navigator.userAgent.toLowerCase().indexOf("android")>=0},isPortrait:function(e){return e&&(v&&g.removeListener(v),g.addListener(v=e)),g.matches},init:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.isCordova()&&!window.Cordova){t.next=2;break}return t.abrupt("return");case 2:return window.console.log("test"),r=window.File,t.next=6,new Promise((function(t,r){var n=document.createElement("script");e.isAndroid()?n.src="cdvfile://localhost/assets/www/cordova.js":e.isIOS()&&(n.src="cordova/cordova.js"),n.onload=function(){document.addEventListener("deviceready",t)},n.onerror=r,document.head.append(n)}));case 6:window.File=r;case 7:case"end":return t.stop()}}),t)})))()}},y={Overlay:{Type:{Image:1<<(n=1),Text:1<<++n,Mosic:1<<++n},Align:{Left:n=0,Center:++n,Right:++n,Top:++n}},CaptureVideo:{Duration:600},Operate:{Init:x("初始",n=0),VideoAdd:x("添加视频",++n),VideoSplit:x("分割视频",++n),VideoTimeModify:x("视频时间修改",++n),VideoRemove:x("删除视频",++n),VideoParamsModify:x("视频参数修改",++n),VideoSort:x("视频排序",++n),VideoRotate:x("视频旋转",++n),VideoVFlip:x("上下翻转视频",++n),VideoHFlip:x("左右翻转视频",++n),VideoAspect:x("画幅比例修改",++n),PosterModify:x("封面修改",++n),EndingModify:x("封低修改",++n),ImageAdd:x("添加贴纸",++n),ImageRemove:x("删除贴纸",++n),ImageModify:x("贴纸修改",++n),ImageTimeModify:x("贴纸时间修改",++n),MosicAdd:x("添加马赛克",++n),MosicRemove:x("删除马赛克",++n),MosicModify:x("马赛克修改",++n),MosicTimeModify:x("马赛克时间修改",++n),TextAdd:x("添加文字",++n),TextRemove:x("删除文字",++n),TextModify:x("文字修改",++n),TextTimeModify:x("文字时间修改",++n),FilterEnable:x("启用滤镜",++n),FilterDisable:x("关闭滤镜",++n),FilterModify:x("滤镜参数修改",++n),BGMSet:x("设置背景音",++n),BGMUnset:x("删除背景音",++n),BGMParamsModify:x("背景音参数修改",++n),AudioParamsModify:x("音频参数修改",++n),AudioEffectAdd:x("添加音效",++n),AudioEffectRemove:x("删除音效",++n),AudioEffectModify:x("音效修改",++n),AudioEffectTimeModify:x("音效时间修改",++n),AutoModify:x("自动调整",++n)}};function x(e,t,r){return{Name:e,Type:t,Reload:r}}var _=y;function k(e){return+e.toFixed(10)}function T(e,t,r,n,i){r-=e,n-=t;var a=i*Math.PI/180,s=r*Math.cos(a)-n*Math.sin(a),o=r*Math.sin(a)+n*Math.cos(a);return{x:s+e,y:o+t}}r("5db7"),r("73d9"),r("b0c0"),r("1276");var C=r("bc3a"),R=r.n(C),O=r("6821"),P=r.n(O),A=!1;window.clearAllCache=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise(window.requestFileSystem.bind(window,window.TEMPORARY,0));case 2:return t=e.sent,e.next=5,new Promise(t.root.getDirectory.bind(t.root,"ugc_res",{}));case 5:return r=e.sent,e.next=8,new Promise(r.removeRecursively.bind(r));case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})));var I={remoteResRoot:"file:"==location.protocol?"http://zb.vgemv.com/app_download/ugc/sdk/resource":"ugc",localResRoot:"ugc_res",get assetResRoot(){return w.isIOS()?cordova.file.applicationDirectory+"ugcsdk.bundle/dist/ugc":cordova.file.applicationDirectory+"www/dist/ugc"},ResType:{image:"image",music:"music",audio:"audio",filter:"filter",font:"font",fontbg:"fontbg",mosic:"mosic"},get remoteResRootJson(){return this.remoteResRoot+"/res.json"},get assetResRootJson(){return this.assetResRoot+"/res.json"},tempFs:null,folders:{},filesystem:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.tempFs){t.next=4;break}return t.next=3,new Promise(window.requestFileSystem.bind(window,window.TEMPORARY,5242880));case 3:e.tempFs=t.sent;case 4:return t.abrupt("return",e.tempFs);case 5:case"end":return t.stop()}}),t)})))()},remoteRel2Abs:function(e,t){return this.remoteResRoot+(e?"/"+e:"")+(t?"/"+t:"")},localRel2Abs:function(e,t){return this.localResRoot+(e?"/"+e:"")+(t?"/"+t:"")},assetRel2Abs:function(e,t){return this.assetResRoot+(e?"/"+e:"")+(t?"/"+t:"")},assetReadText:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,new Promise(window.resolveLocalFileSystemURL.bind(window,e));case 2:return r=t.sent,t.next=5,new Promise(r.file.bind(r));case 5:return n=t.sent,i=new FileReader,t.next=9,new Promise((function(e,t){i.onload=e,i.onerror=t,i.readAsText(n)}));case 9:return a=t.sent.target.result,t.abrupt("return",a);case 11:case"end":return t.stop()}}),t)})))()},assetReadAsDataUrl:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,new Promise(window.resolveLocalFileSystemURL.bind(window,e));case 2:return r=t.sent,t.next=5,new Promise(r.file.bind(r));case 5:return n=t.sent,i=new FileReader,t.next=9,new Promise((function(e,t){i.onload=e,i.onerror=t,i.readAsDataURL(n)}));case 9:return a=t.sent.target.result,t.abrupt("return",a);case 11:case"end":return t.stop()}}),t)})))()},md5source:function(e){return P()(e.split(".").slice(0,-1).join("."))+"."+e.split(".").reverse()[0]},getFolder:function(e,t){var r=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var i,a,s,o,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,r.filesystem();case 2:if(i=n.sent,t=r.localRel2Abs(e,t),!r.folders[t]){n.next=6;break}return n.abrupt("return",r.folders[t]);case 6:s=t.split("/"),o=0;case 8:if(!(o<=s.length)){n.next=17;break}return c=s.slice(0,o).join("/"),n.next=12,new Promise(i.root.getDirectory.bind(i.root,c,{create:!0}));case 12:a=n.sent,r.folders[c]=a;case 14:o++,n.next=8;break;case 17:return n.abrupt("return",a);case 18:case"end":return n.stop()}}),n)})))()},getTempFolder:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.filesystem();case 2:return r=t.sent,t.next=5,new Promise(r.root.getDirectory.bind(r.root,"ugc_temp",{create:!0}));case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})))()},clearTempFiles:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i,a,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.filesystem();case 2:return n=r.sent,r.next=5,t.getTempFolder();case 5:return i=r.sent,r.next=8,new Promise(n.root.getDirectory.bind(n.root,"thumbs/",{create:!0}));case 8:if(a=r.sent,s=[new Promise(i.removeRecursively.bind(i)),new Promise(a.removeRecursively.bind(a))],!e){r.next=13;break}return r.next=13,Promise.all(s);case 13:case"end":return r.stop()}}),r)})))()},fetchAssetResList:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.t0=JSON,r.next=3,t.assetReadText(t.assetResRootJson);case 3:return r.t1=r.sent,n=r.t0.parse.call(r.t0,r.t1),r.t2=JSON,r.next=8,t.assetReadText(t.assetRel2Abs(n[e]));case 8:return r.t3=r.sent,i=r.t2.parse.call(r.t2,r.t3),i=i.map((function(r){return r.list?r.list=r.list.map((function(r){return r.source&&(r.source_asset_url=t.assetRel2Abs(e,r.source)),r.source_list&&(r.source_list_asset_url=r.source_list.map((function(r){return t.assetRel2Abs(e,r)}))),r})):r.source&&(r.source_asset_url=t.assetRel2Abs(e,r.source)),r})),r.abrupt("return",i);case 12:case"end":return r.stop()}}),r)})))()},fetchLocalResList:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a,s,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(window.requestFileSystem){r.next=2;break}return r.abrupt("return",[]);case 2:return r.next=4,t.getFolder(e);case 4:return n=r.sent,a=n.createReader(),r.next=8,new Promise(a.readEntries.bind(a));case 8:return s=r.sent,r.next=11,Promise.all(s.map(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.isDirectory){e.next=8;break}return r=t.createReader(),e.next=4,new Promise(r.readEntries.bind(r));case 4:return n=e.sent,e.abrupt("return",Object(m["a"])({},t,{list:n}));case 8:return e.abrupt("return",t);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return o=r.sent,r.abrupt("return",o);case 13:case"end":return r.stop()}}),r)})))()},fetchRemoteResList:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,R.a.get(t.remoteResRootJson);case 2:return n=r.sent.data,r.next=5,R.a.get(t.remoteRel2Abs(n[e]));case 5:return i=r.sent.data,i=i.map((function(r){return r.list?r.list=r.list.map((function(r){return r.source&&(r.source_remote_url=t.remoteRel2Abs(e,r.source),r.download=null),r.source_list&&(r.source_list_remote_url=r.source_list.map((function(r){return t.remoteRel2Abs(e,r)})),r.download=null),r})):r.source&&(r.source_remote_url=t.remoteRel2Abs(e,r.source),r.download=null),r})),r.abrupt("return",i);case 8:case"end":return r.stop()}}),r)})))()},copyedResTypes:{},fetchResList:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i,a,s,o,c;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.fetchLocalResList(e);case 2:return n=r.sent,r.prev=3,r.next=6,t.fetchAssetResList(e);case 6:i=r.sent,r.next=11;break;case 9:r.prev=9,r.t0=r["catch"](3);case 11:if(r.prev=11,!A){r.next=16;break}r.t1=i,r.next=19;break;case 16:return r.next=18,t.fetchRemoteResList(e);case 18:r.t1=r.sent;case 19:a=r.t1,r.next=25;break;case 22:r.prev=22,r.t2=r["catch"](11),a=i;case 25:if(window.console.log("remote",a),window.console.log("local",n),window.console.log("asset",i),a){r.next=30;break}return r.abrupt("return");case 30:return s=[],o=function(r,a){var o=t.md5source(a.source),c=a.name;if(a.local_file=n.filter((function(e){return e.name==o}))[0],a.thumb_remote_url=t.remoteRel2Abs(e,a.thumb),a.source_list&&(a.local_file_list=a.source_list.map((function(e){var r=t.md5source(e);return n.filter((function(e){return e.name==r}))[0]}))),!a.local_file&&i&&!t.copyedResTypes[e]){var l=i.filter((function(e){return e.name==r&&e.list}))[0],u=l&&l.list.filter((function(e){return e.name==c}))[0]||i.filter((function(e){return e.name==c}))[0];u&&s.push(t.copyAssetRes(e,a,u))}return a},c=a.map((function(e){if(e.list){var r=e.name;e.list=e.list.flatMap(o.bind(t,r))}else o(null,e);return e})),Promise.all(s).then((function(){t.copyedResTypes[e]=!0})),r.abrupt("return",c);case 35:case"end":return r.stop()}}),r,null,[[3,9],[11,22]])})))()},createResFile:function(e,t){var r=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var i,a,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,r.filesystem();case 2:return i=n.sent,n.next=5,r.getFolder(e);case 5:return a=r.md5source(t),s=r.localRel2Abs(e,a),window.console.log("createResFile:",s),n.next=10,new Promise(i.root.getFile.bind(i.root,s,{create:!0}));case 10:return n.abrupt("return",n.sent);case 11:case"end":return n.stop()}}),n)})))()},downloadRes:function(e,t,r){var n=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var s,o,c,l,u;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=t.source_remote_url,t.download={percent:0},o=[0],c=1+(t.source_list&&t.source_list.length||0),a.next=6,n.createResFile(e,t.source);case 6:return l=a.sent,a.prev=7,a.next=10,n.download(s,l,(function(e){t.download.percent=e,o[0]=e,r&&r(o.reduce((function(e,t){return e+t}))/c)}));case 10:if(!t.source_list){a.next=15;break}return u=[],a.next=14,Promise.all(t.source_list_remote_url.map(function(){var a=Object(i["a"])(regeneratorRuntime.mark((function i(a,s){var l;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,n.createResFile(e,t.source_list[s]);case 2:return l=i.sent,i.prev=3,i.next=6,n.download(a,l,(function(e){return o[s+1]=e&&r&&r(o.reduce((function(e,t){return e+t}))/c)}));case 6:u.push(l),i.next=12;break;case 9:i.prev=9,i.t0=i["catch"](3),l.remove();case 12:case"end":return i.stop()}}),i,null,[[3,9]])})));return function(e,t){return a.apply(this,arguments)}}()));case 14:t.local_file_list=u;case 15:return delete t.download,t.local_file=l,a.abrupt("return",l);case 20:throw a.prev=20,a.t0=a["catch"](7),l.remove(),t.download=null,a.t0;case 25:case"end":return a.stop()}}),a,null,[[7,20]])})))()},download:function(e,t,r){return Object(i["a"])(regeneratorRuntime.mark((function n(){var a,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,new Promise((function(t,n){var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="blob",a.onprogress=function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r&&r(t.loaded/t.total);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.onerror=n,a.onload=function(){200==this.status?t(this.response):n(this.status)},a.send()}));case 2:return a=n.sent,n.next=5,new Promise(t.createWriter.bind(t));case 5:return s=n.sent,n.next=8,new Promise((function(e,t){s.onwriteend=e,s.onerror=t,s.write(a)}));case 8:case"end":return n.stop()}}),n)})))()},copingAssetRes:{},copyAssetRes:function(e,t,r){var n=this;return Object(i["a"])(regeneratorRuntime.mark((function i(){var a,s;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(a=e+"_"+t.source+r.source,s=n.copingAssetRes[a],!s){i.next=4;break}return i.abrupt("return",s);case 4:return i.prev=4,s=n.copingAssetRes[a]=n.copyAssetResIntenal(e,t,r),i.next=8,s;case 8:return delete n.copingAssetRes[a],i.abrupt("return",s);case 12:throw i.prev=12,i.t0=i["catch"](4),delete n.copingAssetRes[a],i.t0;case 16:case"end":return i.stop()}}),i,null,[[4,12]])})))()},copyAssetResIntenal:function(e,t,r){var n=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var s,o,c;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.download={percent:0},a.next=3,new Promise((function(e){return setTimeout(e,100)}));case 3:return a.next=5,n.createResFile(e,t.source);case 5:return s=a.sent,a.next=8,n.getFolder(e);case 8:return o=a.sent,a.prev=9,a.next=12,new Promise(s.remove.bind(s));case 12:a.next=16;break;case 14:a.prev=14,a.t0=a["catch"](9);case 16:return a.prev=16,a.next=19,new Promise(resolveLocalFileSystemURL.bind(null,r.source_asset_url));case 19:c=a.sent,a.next=27;break;case 22:return a.prev=22,a.t1=a["catch"](16),t.download=null,window.console.log(r,"not found"),a.abrupt("return");case 27:return a.prev=27,a.next=30,new Promise(c.copyTo.bind(c,o,s.name));case 30:s=a.sent,a.next=35;break;case 33:a.prev=33,a.t2=a["catch"](27);case 35:if(t.local_file=s,t.download=null,!r.source_list_asset_url){a.next=41;break}return a.next=40,Promise.all(r.source_list_asset_url.map(function(){var a=Object(i["a"])(regeneratorRuntime.mark((function i(a,s){var o,c,l;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,n.createResFile(e,t.source_list[s]);case 2:return o=i.sent,i.next=5,new Promise(o.getParent.bind(o));case 5:return c=i.sent,i.prev=6,i.next=9,new Promise(o.remove.bind(o));case 9:i.next=13;break;case 11:i.prev=11,i.t0=i["catch"](6);case 13:return i.prev=13,i.next=16,new Promise(resolveLocalFileSystemURL.bind(null,a));case 16:l=i.sent,i.next=23;break;case 19:return i.prev=19,i.t1=i["catch"](13),window.console.log(r,"not found"),i.abrupt("return");case 23:return i.prev=23,i.next=26,new Promise(l.copyTo.bind(l,c,o.name));case 26:return i.abrupt("return",i.sent);case 29:return i.prev=29,i.t2=i["catch"](23),i.abrupt("return",o);case 32:case"end":return i.stop()}}),i,null,[[6,11],[13,19],[23,29]])})));return function(e,t){return a.apply(this,arguments)}}()));case 40:t.local_file_list=a.sent;case 41:case"end":return a.stop()}}),a,null,[[9,14],[16,22],[27,33]])})))()},getBeautySource:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.fetchResList(e.ResType.filter);case 2:return r=t.sent,n=r.find((function(e){return"美颜"==e.name})),t.abrupt("return",n.local_file.toNativeURL());case 5:case"end":return t.stop()}}),t)})))()},getMosicSource:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.fetchResList(e.ResType.filter);case 2:return r=t.sent,n=r.reduce((function(e,t){return e.concat(t.list||[])}),Object(u["a"])(r)).find((function(e){return"马赛克"==e.name})),t.abrupt("return",n.local_file.toNativeURL());case 5:case"end":return t.stop()}}),t)})))()},getTransformSource:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.fetchResList(e.ResType.filter);case 2:return r=t.sent,n=r.find((function(e){return"transform"==e.name})),t.abrupt("return",n.local_file.toNativeURL());case 5:case"end":return t.stop()}}),t)})))()},_ending:null,getLastEnding:function(){try{return this._ending||JSON.parse(localStorage.getItem("last-ending"))}catch(e){return this._ending}},saveLastEnding:function(e){this._ending=e;try{localStorage.setItem("last-ending",JSON.stringify(e))}catch(t){}},operateHistory:null,undoOperateHistory:function(){var e=this.getOperateHistory();if(e&&e.length>1){var t=e.pop();return this.saveOperateHistory(e),{restore:f()(!0,{},e[e.length-1]),undo:f()(!0,{},t),history:e}}},getOperateHistory:function(){return this.operateHistory,this.operateHistory||[]},createOperateHistory:function(e,t,r){var n=f()(!0,{},{operateType:t,targetId:r,timelines:e.timelines,amix:e.amix,overlay:e.overlay,mosic:e.mosic,filter:e.filter,face:e.face,video:e.video,audio:e.audio,bgm:e.bgm,poster:e.poster});return n.amix.forEach((function(e){return e.active=!1})),n.overlay.forEach((function(e){e.active=!1,e.enabled=!0})),n.mosic.forEach((function(e){e.active=!1,e.enabled=!0})),window.console.log("create operate history: ",n),this.pushOperateHistory(n)},updateOperateHistory:function(e,t){var r=this.getOperateHistory(),n=r[r.length-1];if(!n)return r;if(n.operateType==e)if(e==_.Operate.MosicAdd.Type){var i=n.mosic.find((function(e){return e.id==t.id}));i&&(f()(i,t),i.active=!1,i.enabled=!0)}else if(e==_.Operate.ImageAdd.Type){var a=n.overlay.find((function(e){return e.type==_.Overlay.Type.Image&&e.id==t.id}));a&&(f()(a,t),a.active=!1,a.enabled=!0)}else if(e==_.Operate.TextAdd.Type){var s=n.overlay.find((function(e){return e.type==_.Overlay.Type.Text&&e.id==t.id}));s&&(f()(s,t),s.active=!1,s.enabled=!0)}if(e==_.Operate.VideoAdd.Type&&(n.operateType==e||n.operateType==_.Operate.Init.Type)){var o=n.timelines.find((function(e){return e.id==t.id}));o&&(o.thumbs=[],f()(o,t))}return window.console.log("update operate history: ",n),this.saveOperateHistory(r)},pushOperateHistory:function(e){var t=this.getOperateHistory();return t.push(e),t.length>200&&t.splice(0,1),this.saveOperateHistory(t)},saveOperateHistory:function(e){try{this.operateHistory=e}catch(t){}return e}},S=I,M={blur:"avgblur",brown:"colorchannelmixer=.393:.769:.189:0:.349:.686:.168:0:.272:.534:.131",colorful:"geq=r='X/W*r(X,Y)':g='(1-X/W)*g(X,Y)':b='(H-Y)/H*b(X,Y)'",flash:"hue=H=2*PI*t:s=sin(2*PI*t)+1",oldfilm:"vignette='PI/4+random(1)*PI/50':eval=frame",line:"split[a][b],[a]curves=darker[a],[a][b]blend=all_expr='if(eq(0,mod(Y,2)),A,B)':shortest=1",red_border:"drawbox=color=red:t='min(iw,ih)/20'",pink_border:"drawbox=color=pink:t='min(iw,ih)/20'",black_border:"drawbox=color=black:t='min(iw,ih)/20'",colormix:"edgedetect=mode=colormix"},E={blur:"模糊",brown:"旧照片",colorful:"流光溢彩",flash:"闪光",oldfilm:"旧影片",line:"黑条纹",double:"双画面",red_border:"红框",pink_border:"粉框",black_border:"黑框",colormix:"彩绘"},j={auto:[0,0]};Number.prototype.toEven=function(){var e=+this.toFixed(0);return e%2!=0?e-1:e};var $=0,D=1,L={VFPreset:M,VFPresetName:E,DARPreset:j,editlist:{time_sec:0,video_min_sec:1,timelines:[],get total_sec(){if(0==this.timelines.length)return 0;var e=this.timelines[0].end_sec-this.timelines[0].start_sec;return 1==this.timelines.length?e:[e].concat(Object(u["a"])(this.timelines.slice(1))).reduce((function(e,t){return e+t.end_sec-t.start_sec}))},get timelineId(){return $++},add_timelines:function(e){var t=e.map((function(e){return Object(m["a"])({id:$++,url:"",thumbs:[],active:!1,left_drag_offset:0,focus:!1,width:0,height:0,start_sec:0,offset_sec:0,end_sec:0,total_sec:0,rotate:0,vflip:0,hflip:0,eq:{brightness:0,contrast:1,saturation:1,gamma:1}},e)}));t=this.timelines.length&&this.timelines[this.timelines.length-1].ending?[].concat(Object(u["a"])(this.timelines.slice(0,this.timelines.length-1)),Object(u["a"])(t),[this.timelines[this.timelines.length-1]]):[].concat(Object(u["a"])(this.timelines),Object(u["a"])(t)),t.reduce((function(e,t,r){return 1==r&&(e.offset_sec=0,e=e.end_sec-e.start_sec),t.offset_sec=e,t.offset_sec+t.end_sec-t.start_sec})),this.timelines=t},getRotatedWidth:function(e){return e.rotate%180==0?e.width:e.height},getRotatedHeight:function(e){return e.rotate%180==0?e.height:e.width},update_timelines:function(e){e||(e=this.timelines),e.reduce((function(e,t,r){return 1==r&&(e.offset_sec=0,e=e.end_sec-e.start_sec),t.offset_sec=e,t.offset_sec+t.end_sec-t.start_sec})),e.forEach((function(e,t){UGCApp.ffplay.command("sp|ugc_movie@master"+t,e.start_sec),UGCApp.ffplay.command("ep|ugc_movie@master"+t,e.end_sec)}))},update_timeline_videobase:function(e){var t=[-1].concat(Object(u["a"])(this.timelines)).reduce((function(t,r,n){return r.id==e.id?n-1:t}));UGCApp.ffplay.command("brightness|eq@master"+t,e.eq.brightness),UGCApp.ffplay.command("saturation|eq@master"+t,e.eq.saturation),UGCApp.ffplay.command("gamma|eq@master"+t,e.eq.gamma),UGCApp.ffplay.command("contrast|eq@master"+t,e.eq.contrast)},config:{noReady:!0,input:"",output:"",output_thumb:""},getConfig:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.config.noReady){t.next=5;break}return t.next=3,new Promise(UGCApp.getConfig);case 3:e.config=t.sent,window.console.log("config: ",e.config);case 5:return t.abrupt("return",e.config);case 6:case"end":return t.stop()}}),t)})))()},setConfig:function(e){this.config=e},amix:[],add_amix:function(e){var t;return this.amix.push(t=Object(m["a"])({id:D++,new:!0,active:!1,offset_sec:this.time_sec,end_sec:5,url:e.local_file.toNativeURL().replace("file://","")},e)),t},update_amix:function(e){if(window.UGCApp){var t=this.amix.filter((function(t){return t.id==e.id}));t.length&&(t=t[0],UGCApp.ffplay.command("ep|ugc_movie@slave"+e.id,e.end_sec.toFixed(0)),UGCApp.ffplay.command("offset|ugc_movie@slave"+e.id,e.offset_sec.toFixed(0)),UGCApp.ffplay.command("visible|overlay@slave"+e.id,e.active?"0":"1"))}else window.console.log("no ugcapp")},overlay:[],add_overlay:function(e,t){var r,n=t?this.poster.overlay:this.overlay;return n.push(r=Object(m["a"])({id:D++,new:!0,x:0,y:0,w:0,h:0,rotate:0,active:!1,offset_sec:Math.max(0,this.time_sec-.05),end_sec:3,url:""},e)),r},update_overlay:function(e,t){var r=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var i,a,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(window.UGCApp){n.next=3;break}return window.console.log("no ugcapp"),n.abrupt("return");case 3:if(i=(t?r.poster.overlay:r.overlay).filter((function(t){return t.id==e.id})),i.length){n.next=8;break}return n.abrupt("return");case 8:i=i[0];case 9:return a=r.preview_resolution[0]/r.resolution_dar[0],s=[],s.push(L.ffplayCommand("w|scale@slave"+e.id,(e.w*a).toEven())),s.push(L.ffplayCommand("h|scale@slave"+e.id,(e.h*a).toEven())),s.push(L.ffplayCommand("a|rotate@slave"+e.id,e.rotate+"*PI/180")),s.push(L.ffplayCommand("x|overlay@slave"+e.id,(e.x*a).toFixed(0))),s.push(L.ffplayCommand("y|overlay@slave"+e.id,(e.y*a).toFixed(0))),s.push(L.ffplayCommand("ep|ugc_movie@slave"+e.id,e.end_sec.toFixed(3))),s.push(L.ffplayCommand("offset|ugc_movie@slave"+e.id,e.offset_sec.toFixed(3))),s.push(L.ffplayCommand("visible|overlay@slave"+e.id,e.active?"0":"1")),n.next=21,Promise.all(s);case 21:case"end":return n.stop()}}),n)})))()},remove_overlay:function(e){if(this.overlay.filter((function(t){return t.id==e})).length){var t=[-1].concat(Object(u["a"])(this.overlay)).reduce((function(t,r,n){return r.id==e?n-1:t}));this.overlay.splice(t,1)}if(this.poster.overlay.filter((function(t){return t.id==e})).length){var r=[-1].concat(Object(u["a"])(this.poster.overlay)).reduce((function(t,r,n){return r.id==e?n-1:t}));this.poster.overlay.splice(r,1)}if(this.amix.filter((function(t){return t.id==e})).length){var n=[-1].concat(Object(u["a"])(this.amix)).reduce((function(t,r,n){return r.id==e?n-1:t}));this.amix.splice(n,1)}if(this.mosic.filter((function(t){return t.id==e})).length){var i=[-1].concat(Object(u["a"])(this.mosic)).reduce((function(t,r,n){return r.id==e?n-1:t}));this.mosic.splice(i,1)}},_transform_source:null,get transform_source(){return this._transform_source||""},set transform_source(e){this._transform_source=e},mosic:[],mosic_source:null,add_mosic:function(e){var t,r=this.mosic;return r.push(t=Object(m["a"])({id:D++,type:_.Overlay.Type.Mosic,new:!1,x:0,y:0,w:0,h:0,rotate:0,active:!1,offset_sec:Math.max(0,this.time_sec-.05),end_sec:3},e)),t},update_mosic:function(e){if(window.UGCApp){var t=this.mosic.filter((function(t){return t.id==e.id}));if(t.length){t=t[0];var r=this.preview_resolution[0]/this.resolution_dar[0];UGCApp.ffplay.command("rect|glfilter@mosic"+e.id,[(e.x*r).toFixed(0),(e.y*r).toFixed(0),(e.w*r).toFixed(0),(e.h*r).toFixed(0)].join(",")),UGCApp.ffplay.command("ep|glfilter@mosic"+e.id,e.end_sec.toFixed(3)),UGCApp.ffplay.command("offset|glfilter@mosic"+e.id,e.offset_sec.toFixed(3)),UGCApp.ffplay.command("percent|glfilter@mosic"+e.id,"100")}}else window.console.log("no ugcapp")},filter:[],set filter_source(e){UGCApp.ffplay.command("source|glfilter@filter",e.replace("file://",""))},set filter_reset(e){UGCApp.ffplay.command("reset|glfilter@filter",e)},set filter_percent(e){UGCApp.ffplay.command("percent|glfilter@filter",e)},face:{beauty_level:0,beauty_source:""},set beauty_source(e){e=e.replace("file://",""),this.face.beauty_source!=e&&(this.face.beauty_source=e,UGCApp.ffplay.command("source|glfilter@beauty",e))},set beauty_level(e){this.face.beauty_level=e,UGCApp.ffplay.command("percent|glfilter@beauty",10*e)},video:{cut:[0,0,0,0],dar:j.auto},audio:{volume:100},bgm:{volume:100,url:""},poster:{url:"",rotate:0,overlay:[]},get cur_timeline(){var e=k(this.time_sec),t=this.timelines.filter((function(t){return k(t.offset_sec)<=e&&k(t.offset_sec+t.end_sec-t.start_sec)>e}))[0];return!t&&this.timelines.length&&(t=this.timelines[this.timelines.length-1]),t},get dar(){var e=this,t=!Object.keys(j.auto).find((function(t){return e.video.dar[t]!=j.auto[t]}));return t?0==this.timelines.length?[0,0]:[this.getRotatedWidth(this.timelines[0]),this.getRotatedHeight(this.timelines[0])]:this.video.dar},get dar_d(){return this.dar[0]/this.dar[1]},get resolution_dar(){return this.dar[0]<100||this.dar[1]<100?this.dar.map((function(e){return 1e3*e})):this.dar},get resolution_box_src(){var e,t=this;return e=this.timelines.length?1==this.timelines.length?[this.getRotatedWidth(this.timelines[0]),this.getRotatedHeight(this.timelines[0])]:this.timelines.reduce((function(e,r,n){return 1==n&&(e=[t.getRotatedWidth(e),t.getRotatedHeight(e)]),[Math.max(e[0],t.getRotatedWidth(r)),Math.max(e[1],t.getRotatedHeight(r))]})):[0,0],[e[0].toEven(),e[1].toEven()]},previewparam:{resolution_box:[640,640]},get preview_resolution(){var e=Math.min(this.resolution_box_src[0],this.previewparam.resolution_box[0]),t=Math.min(this.resolution_box_src[1],this.previewparam.resolution_box[1]);return this.dar_d>1?[e.toEven(),(e/this.dar_d).toEven()]:[(t*this.dar_d).toEven(),t.toEven()]},encodeparam:{preset:"low",hardware_encoder:!0,resolution_box:[0,0],bitrate:0},get low_encodeparam(){var e=Object(m["a"])({},this.encodeparam,{resolution_box:[960,540]}),t=Math.min(this.resolution_box_src[0],e.resolution_box[0]),r=Math.min(this.resolution_box_src[1],e.resolution_box[1]);return this.dar_d>1?e.resolution=[t.toEven(),(t/this.dar_d).toEven()]:e.resolution=[(r*this.dar_d).toEven(),r.toEven()],e.bitrate=2*Math.min(e.resolution[0],e.resolution[1]),e},get high_encodeparam(){var e=Object(m["a"])({},this.encodeparam,{resolution_box:[1280,720]}),t=Math.min(this.resolution_box_src[0],e.resolution_box[0]),r=Math.min(this.resolution_box_src[1],e.resolution_box[1]);return this.dar_d>1?e.resolution=[t.toEven(),(t/this.dar_d).toEven()]:e.resolution=[(r*this.dar_d).toEven(),r.toEven()],e.bitrate=3*Math.min(e.resolution[0],e.resolution[1]),e},get preset_encodeparam(){return"high"==this.encodeparam.preset?this.high_encodeparam:this.low_encodeparam},operate:{history:[]},createOperateHistory:function(e,t){this.operate.history=S.createOperateHistory(this,e,t)},updateOperateHistory:function(e,t){this.operate.history=S.updateOperateHistory(e,t)},undoOperateHistory:function(){var e=S.undoOperateHistory();return e&&e.history&&(this.operate.history=e.history),e}},ffplayCommand:function(e,t){return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise((function(r,n){UGCApp.ffplay.command(e,t,r,n)})));case 1:case"end":return r.stop()}}),r)})))()},getUGCParam:function(e){var t=L.editlist,r=L.editlist.timelines,n=e.resolution[0],i=e.resolution[1],a=e.poster,s=null,o="";if(r.length<=0)return"";var c=1;if(c){var l="ugc_movie@master{idx}={src}:sp={sp}:ep={ep}:s=v+a[v{idx}][a{idx}],[v{idx}]gltransform=w={w}:h={h}:rotate={transpose}:oformat=rgba,format=rgba[v{idx}]",d="[v{in}][a{in}][v{idx}][a{idx}]ugc_concat@master{idx}=delta_ts={delta}:v=1:a=1[v{idx}][a{idx}]",f={0:"0",90:"1",180:"2",270:"3"},p=n,h=i,m=r[0],v=(m.src_rotate+m.rotate)%360;90!=v&&270!=v||(p=i,h=n),o=l.replace(/{idx}/g,0).replace("{src}",m.url.replace("file://","")).replace("{sp}",m.start_sec).replace("{ep}",m.end_sec).replace(/{w}/g,p).replace(/{h}/g,h).replace("{source}",L.editlist.transform_source.replace("file://","")).replace("{transpose}",f[v]||"0").replace("{contrast}",m.eq.contrast).replace("{brightness}",m.eq.brightness).replace("{saturation}",m.eq.saturation).replace("{gamma}",m.eq.gamma),r.length>1&&(o=[o].concat(Object(u["a"])(r.slice(1))).reduce((function(e,t,r){var a=(t.src_rotate+t.rotate)%360;return p=n,h=i,90!=a&&270!=a||(p=i,h=n),e+","+l.replace(/{idx}/g,r).replace("{src}",t.url.replace("file://","")).replace("{sp}",t.start_sec).replace("{ep}",t.end_sec).replace(/{w}/g,p).replace(/{h}/g,h).replace("{source}",L.editlist.transform_source.replace("file://","")).replace("{transpose}",f[a]||"0").replace("{contrast}",t.eq.contrast).replace("{brightness}",t.eq.brightness).replace("{saturation}",t.eq.saturation).replace("{gamma}",t.eq.gamma)+","+d.replace(/{in}/g,r-1).replace(/{idx}/g,r).replace("{delta}",t.offset_sec)})));var g=r.length-1;o=o.replace(new RegExp("\\[v"+g+"\\]","g"),"[out1]").replace(new RegExp("\\[a"+g+"\\]","g"),"[out0]")}else{var b="ugc_movie@master{idx}={src}:sp={sp}:ep={ep}:s=v+a[v{idx}][a{idx}],[v{idx}]scale={w}:{h}:force_original_aspect_ratio=decrease,pad={w}:{h}:(ow-iw)/2:(oh-ih)/2,{transpose}{vflip}{hflip}setsar=1/1[v{idx}],[v{idx}]eq@master{idx}=contrast={contrast}:brightness={brightness}:saturation={saturation}:gamma={gamma}[v{idx}]",w="[v{in}][a{in}][v{idx}][a{idx}]ugc_concat@master{idx}=delta_ts={delta}:v=1:a=1[v{idx}][a{idx}]",y={0:"",90:"transpose=1,",180:"hflip,vflip,",270:"transpose=2,"},x=n,_=i,k=r[0],T=(k.src_rotate+k.rotate)%360;90!=T&&270!=T||(x=i,_=n),o=b.replace(/{idx}/g,0).replace("{src}",k.url.replace("file://","")).replace("{sp}",k.start_sec).replace("{ep}",k.end_sec).replace(/{w}/g,x).replace(/{h}/g,_).replace("{transpose}",y[T]).replace("{vflip}",k.vflip?"vflip,":"").replace("{hflip}",k.hflip?"hflip,":"").replace("{contrast}",k.eq.contrast).replace("{brightness}",k.eq.brightness).replace("{saturation}",k.eq.saturation).replace("{gamma}",k.eq.gamma),r.length>1&&(o=[o].concat(Object(u["a"])(r.slice(1))).reduce((function(e,t,r){var a=(t.src_rotate+t.rotate)%360;return x=n,_=i,90!=a&&270!=a||(x=i,_=n),e+","+b.replace(/{idx}/g,r).replace("{src}",t.url.replace("file://","")).replace("{sp}",t.start_sec).replace("{ep}",t.end_sec).replace(/{w}/g,x).replace(/{h}/g,_).replace("{transpose}",y[a]).replace("{vflip}",t.vflip?"vflip,":"").replace("{hflip}",t.hflip?"hflip,":"").replace("{contrast}",t.eq.contrast).replace("{brightness}",t.eq.brightness).replace("{saturation}",t.eq.saturation).replace("{gamma}",t.eq.gamma)+","+w.replace(/{in}/g,r-1).replace(/{idx}/g,r).replace("{delta}",t.offset_sec)})));var C=r.length-1;if(r.length>0&&s&&!a){var R="ugc_movie@master{idx}={src}:ep={ep}:s=v+a[v{idx}][a{idx}],[v{idx}]scale={w}:{h}:force_original_aspect_ratio=decrease,pad={w}:{h}:(ow-iw)/2:(oh-ih)/2,{transpose}{vflip}{hflip}setsar=1/1[v{idx}],[v{idx}]eq@master{idx}=contrast={contrast}:brightness={brightness}:saturation={saturation}:gamma={gamma}[v{idx}]",O="[v{in}][a{in}][v{idx}][a{idx}]ugc_concat@master{idx}=delta_ts={delta}:v=1:a=1[v{idx}][a{idx}]",P=r.length,A=n,I=i;o+=","+R.replace(/{idx}/g,P).replace("{src}",s.url.replace("file://","")).replace(/{ep}/g,s.end_sec).replace(/{w}/g,A).replace(/{h}/g,I).replace("{transpose}",y[0]).replace("{vflip}",s.vflip?"vflip,":"").replace("{hflip}",s.hflip?"hflip,":"").replace("{contrast}",s.eq.contrast).replace("{brightness}",s.eq.brightness).replace("{saturation}",s.eq.saturation).replace("{gamma}",s.eq.gamma)+","+O.replace(/{in}/g,P-1).replace(/{idx}/g,P).replace("{delta}",s.offset_sec),C++}o=o.replace(new RegExp("\\[v"+C+"\\]","g"),"[out1]").replace(new RegExp("\\[a"+C+"\\]","g"),"[out0]")}if(t.filter.length&&(o+=",[out1]"+t.filter.map((function(e){var t="";return e.local_file_list&&e.local_file_list.length&&(t=":lutpng="+e.local_file_list.map((function(e){return e.toNativeURL().replace("file://","")})).join("|")),"glfilter@filter=source={source}{lutpng}:percent={percent}".replace("{source}",e.local_file.toNativeURL().replace("file://","")).replace("{lutpng}",t).replace("{percent}",e.percent||0)})).reduce((function(e,t){return e+","+t}))+"[out1]"),t.mosic.length){var S=n/t.resolution_dar[0];o+=",[out1]"+t.mosic.map((function(e){return"glfilter@mosic{id}=source={source}:percent={percent}:x={x}:y={y}:w={w}:h={h}:offset={ss}:ep={t}".replace("{source}",t.mosic_source.replace("file://","")).replace("{percent}",100).replace(/{ss}/g,+e.offset_sec.toFixed(2)||0).replace(/{t}/g,e.end_sec).replace("{w}",+(e.w*S).toEven()).replace("{h}",+(e.h*S).toEven()).replace("{x}",+(e.x*S).toFixed(0)).replace("{y}",+(e.y*S).toFixed(0)).replace(/{id}/g,e.id)})).reduce((function(e,t){return e+","+t}))+"[out1]"}var M=[].concat(Object(u["a"])(t.overlay),Object(u["a"])(a?t.poster.overlay:[]));if(M.length){var E="ugc_movie@slave{id}='{url}':offset={ss}:ep={t}:loop=0,scale@slave{id}={w}:{h},rotate@slave{id}='a={rotate}*PI/180:ow=hypot(iw,ih):oh=ow:c=0x00000000',[out1]overlay@slave{id}='{x}:{y}:shortest=0:offset={ss}:ep={t}:format=auto'[out1]",j=n/t.resolution_dar[0],$=M.filter((function(e){return e.enabled}));o=[o].concat(Object(u["a"])($)).reduce((function(e,r){var n=r.end_sec,i=+r.offset_sec.toFixed(2)||0;return n<=0&&(n=t.total_sec-i),a&&(i=0,n=t.total_sec),e+","+E.replace("{url}",r.url.replace("file://","").replace(/[?].*$/,"")).replace(/{ss}/g,i).replace(/{t}/g,n).replace("{w}",+(r.w*j).toEven()).replace("{h}",+(r.h*j).toEven()).replace("{x}",+(r.x*j).toFixed(0)).replace("{y}",+(r.y*j).toFixed(0)).replace("{rotate}",r.rotate).replace(/{id}/g,r.id)}))}if(!a&&t.poster.url){var D="ugc_movie@slave{id}='{url}':offset=0:ep=0.1,scale@slave{id}={w}:{h},rotate@slave{id}='a={rotate}*PI/180:ow=hypot(iw,ih):oh=ow:c=0x00000000',[out1]overlay@slave{id}={x}:{y}:shortest=0:offset=0:ep=0.1:format=auto[out1]",U=n,F=i,B=t.poster.rotate;B%180!=0&&(U=i,F=n);var H=Math.hypot(U,F),X=(n-H)/2,z=(i-H)/2;o=o+","+D.replace("{url}",t.poster.url.replace("file://","").replace(/[?].*$/,"")).replace("{w}",U).replace("{h}",F).replace("{x}",X).replace("{y}",z).replace("{rotate}",B).replace(/{id}/g,"0")}o+=",[out0]volume={volume}[out0]".replace("{volume}",t.audio.volume/100);var N="ugc_movie@slave{id}='{url}':offset={ss}:ep={t}:sp=0:loop=0:s=a,[out0]amix@slave{id}=offset={ss}:ep={t}[out0]";return o=[o].concat(Object(u["a"])(t.amix)).reduce((function(e,r){var n=r.end_sec;return n<=0&&(n=t.total_sec-r.offset_Sec),e+","+N.replace("{url}",r.url.replace("file://","")).replace(/{ss}/g,+r.offset_sec.toFixed(2)||0).replace(/{t}/g,n).replace(/{id}/g,r.id)})),t.bgm&&t.bgm.url&&(o+=",ugc_movie@slave999='{url}':sp=0:ep={t}:offset=0:loop=0:s=a[ba0],[ba0]volume={volume}[ba0],[out0][ba0]amix=offset=0:ep={t}:duration=shortest[out0]".replace("{url}",t.bgm.url.replace("file://","")).replace(/{t}/g,t.total_sec).replace("{volume}",t.bgm.volume/100)),o},getPosterPlayerParam:function(){var e='ffplay -loglevel verbose -ss {ss} -f ugc -i "{src}" -an';return e=e.replace("{ss}",this.editlist.time_sec).replace("{src}",this.getUGCParam({resolution:this.editlist.preview_resolution,poster:!0})),window.console.log(e),e},getPlayerParam:function(){var e,t='ffplay -loglevel verbose -ss {ss} -f ugc -i "{src}"';return t=t.replace("{ss}",this.editlist.time_sec).replace("{src}",e=this.getUGCParam({resolution:this.editlist.preview_resolution})),window.console.log(t,e),e&&t},getExportParam:function(e){var t='ffmpeg -loglevel verbose -f ugc -i "{src}" -acodec aac -b:v {b:v} -preset fast -vcodec {vcodec} -use_editlist 0 -f mp4 -y {des}',r=this.editlist.preset_encodeparam,n="h264";return w.isAndroid()&&r.hardware_encoder&&(n="libhw_avc"),w.isIOS()&&r.hardware_encoder&&(n="h264_videotoolbox"),t=t.replace("{vcodec}",n).replace("{b:v}",r.bitrate+"k").replace("{src}",this.getUGCParam({resolution:r.resolution})).replace("{des}",e),window.console.log(t),t}},U=L,F={data:function(){return{setting:!1,encodeparam:U.editlist.encodeparam,low_resolution:"",high_resolution:""}},methods:{exit:function(){UGCApp.done({statusCode:UGCApp.StatusCode.Cancel,message:"用户取消返回",output:"",output_thumb:""})},updateData:function(){this.encodeparam=U.editlist.encodeparam,this.low_resolution=U.editlist.low_encodeparam.resolution.join("x"),this.high_resolution=U.editlist.high_encodeparam.resolution.join("x")},showDlg:function(){var e=this;this.setting?this.setting=!1:(this.updateData(),this.setting=!0,this.$nextTick((function(){e.$refs.dlg.focus()})))},focus:function(){this.$refs.dlg.focus()},blur:function(e){e.relatedTarget==this.$refs.showDlgBtn.$el||this.$refs.dlg.contains(e.relatedTarget)||(this.setting=!1)}}},B=F,H=(r("c9dc"),r("2877")),X=Object(H["a"])(B,p,h,!1,null,"548f090f",null),z=X.exports,N=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"main",staticClass:"tool-box",class:{overlay:e.show_overlay||e.show_amix},on:{touchstart:e.currentStart,touchmove:e.currentMove,touchend:function(t){return e.changed()}}},[r("div",{ref:"mainLine",staticClass:"main-line going",style:e.mainLineStyle},[e.postermode?e._e():r("div",{staticClass:"video-post-btn",on:{click:function(t){return e.$emit("on_poster_click")}}},[e.poster_url?r("img",{attrs:{src:e.poster_url},on:{error:e.posterLoadError}}):r("span",{staticClass:"material-icons"},[e._v("insert_photo")]),r("span",{staticClass:"text"},[e._v("封面")])]),r("div",{staticClass:"main-timeline"},[e._l(e.timelines,(function(t){return[t.ending?r("TimelineItem",{key:t.id,attrs:{pps:e.pps,dragging:!0,active:!1,focus:!e.postermode&&t.focus,start_sec:t.start_sec,end_sec:t.end_sec,total_sec:t.total_sec,offset_sec:t.offset_sec,left_drag_offset:t.left_drag_offset,min_sec:e.video_min_sec},on:{change:function(r){return e.timelineChange(t.id,r)},active:function(r){return e.timelineActive(t.id,r)}},nativeOn:{click:function(t){return e.endingClick(t)}}},[r("div",{staticClass:"video-ending"},[r("span",[e._v("片尾设置")])])]):r("TimelineItem",{key:t.id,attrs:{pps:e.pps,dragging:e.dragging,focus:!e.postermode&&t.focus,active:!e.postermode&&t.active,start_sec:t.start_sec,end_sec:t.end_sec,total_sec:t.total_sec,offset_sec:t.offset_sec,left_drag_offset:t.left_drag_offset,min_sec:e.video_min_sec},on:{change:function(r){return e.timelineChange(t.id,r)},active:function(r){return e.timelineActive(t.id,r)}}},[r("TimelineItemThumb",{attrs:{time_sec:e.time_sec-t.offset_sec,pps:e.pps,timeline:t}})],1)]}))],2),e.postermode||e.hasEnding?e._e():r("div",{staticClass:"video-ending-btn",on:{click:e.endingClick}},[r("span",[e._v("+片尾设置")])]),!e.postermode&&e.show_overlay?r("div",{staticClass:"sub-timeline",staticStyle:{"margin-top":"35px"}},[e._l(e.overlay,(function(t){return[t.type&e.overlay_type?r("TimelineOverlayItem",{key:t.id,attrs:{id:t.id,type:t.type,active:t.active,pps:e.pps,end_sec:t.end_sec,offset_sec:t.offset_sec},on:{change:function(r){return e.overlayChange(t.id,r)},active:function(r){return e.overlayActive(t.id,r)}}}):e._e()]}))],2):e._e(),!e.postermode&&e.show_amix?r("div",{staticClass:"sub-timeline",staticStyle:{"margin-top":"35px"}},e._l(e.amix,(function(t){return r("TimelineOverlayItem",{key:t.id,attrs:{id:t.id,is_amix:!0,active:t.active,pps:e.pps,end_sec:t.end_sec,offset_sec:t.offset_sec},on:{change:function(r){return e.amixChange(t.id,r)},active:function(r){return e.amixActive(t.id,r)}}})})),1):e._e()]),r("div",{ref:"current",staticClass:"time-tick"},[r("div",{staticClass:"current-time",class:{dragging:e.dragging}},[e._v(" "+e._s(e.currentTimeStr)+" ")])]),r("div",{staticClass:"total-time-tick"},[e._v(" "+e._s(e.totalTimeStr)+" ")])])},G=[],V=(r("c35a"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"box",class:{active:e.active,focus:e.focus,span:e.offset_sec},style:e.boxStyle,on:{touchend:e.toggleActive}},[r("mu-button",{ref:"left",staticClass:"left-tick",attrs:{flat:""},nativeOn:{touchstart:function(t){return t.stopPropagation(),e.leftStart(t)},touchmove:function(t){return t.stopPropagation(),e.leftMove(t)},touchend:function(t){return t.stopPropagation(),e.leftEnd(t)}}},[r("mu-icon",{class:{dragging:e.leftDragging,outbound:e.leftOutBound},attrs:{value:"keyboard_arrow_left"}})],1),r("div",{staticClass:"content"},[r("div",{staticClass:"thumb",class:{overlay:e.overlay_mode},style:e.thumbStyle},[e._t("default")],2),r("div",{staticClass:"border"})]),r("mu-button",{ref:"right",staticClass:"right-tick",nativeOn:{touchstart:function(t){return t.stopPropagation(),e.rightStart(t)},touchmove:function(t){return t.stopPropagation(),e.rightMove(t)},touchend:function(t){return t.stopPropagation(),e.rightEnd(t)}}},[r("mu-icon",{class:{dragging:e.rightDragging,outbound:e.rightOutBound},attrs:{value:"keyboard_arrow_right"}})],1),e.active?e._e():r("div",{staticClass:"left-connect"},[r("mu-icon",{attrs:{size:12,value:"insert_link"}})],1)],1)}),Y=[],q={props:["pps","dragging","active","focus","overlay_mode","start_sec","end_sec","total_sec","offset_sec","min_sec","left_drag_offset"],data:function(){return{leftOutBound:!1,rightOutBound:!1,leftDragging:!1,rightDragging:!1,boxStyle:{width:0,left:0},thumbStyle:{width:0,left:0}}},watch:{start_sec:"update",total_sec:"update",end_sec:"update",offset_sec:"update",left_drag_offset:"update"},methods:{update:function(){this.end_sec<=this.start_sec&&(this.end_sec=this.start_sec),this.boxStyle.width=(this.end_sec-this.start_sec)*this.pps+"px",this.boxStyle.left=(this.left_drag_offset+this.offset_sec)*this.pps+"px",this.thumbStyle.width=this.total_sec*this.pps+"px",this.thumbStyle.left=this.start_sec*this.pps*-1+"px"},toggleActive:function(){this.dragging||this.$emit("active",!this.active)},leftStart:function(e){this._pageX=e.changedTouches[0].pageX,this._value=this.start_sec,this.leftDragging=!0,this.leftMove(e)},leftMove:function(e){var t=(e.changedTouches[0].pageX-this._pageX)/this.pps,r=Math.min(this.end_sec-this.min_sec,Math.max(0,this._value+t));return r==this.end_sec-this.min_sec||0==r?this.leftOutBound=!0:this.leftOutBound=!1,this.changed({seek_sec:0,start_sec:r,left_drag_offset:r-this._value}),!0},leftEnd:function(){this.leftDragging=!1,this.leftOutBound=!1,this.changed()},rightStart:function(e){this._pageX=e.changedTouches[0].pageX,this._value=this.end_sec,this.rightDragging=!0,this.rightMove(e)},rightMove:function(e){var t=(e.changedTouches[0].pageX-this._pageX)/this.pps,r=Math.min(this.total_sec,Math.max(this.start_sec+this.min_sec,this._value+t));return r==this.start_sec+this.min_sec||r==this.total_sec?this.rightOutBound=!0:this.rightOutBound=!1,this.changed({seek_sec:r-this.start_sec,end_sec:r}),!0},rightEnd:function(){this.rightDragging=!1,this.rightOutBound=!1,this.changed()},changed:function(e){var t=!e;e||(e={left_drag_offset:0}),this.$emit("change",Object(m["a"])({end:t,start_sec:this.start_sec,end_sec:this.end_sec,left_drag_offset:this.left_drag_offset},e))}},mounted:function(){this.update(),this.pps||(this.pps=screen.width/10)}},W=q,J=(r("1174"),Object(H["a"])(W,V,Y,!1,null,"475fe86e",null)),K=J.exports,Q=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"box",class:{active:e.active,amix:e.is_amix},style:[e.boxStyle,{height:e.active?"100%":"0"}],attrs:{tabindex:"-1"},on:{click:function(t){return t.stopPropagation(),e.toggleActive(t)}}},[r("div",{staticClass:"left-icon"},[r("mu-button",{attrs:{fab:"",small:"",color:e.is_amix?"orange":"red"}},[r("mu-icon",{attrs:{color:"white",size:"20",value:e.typeIcon}})],1)],1),r("div",{staticClass:"left-drag",on:{touchstart:function(t){return t.stopPropagation(),e.dragStart(t)},touchmove:function(t){return t.stopPropagation(),e.dragMove(t)},touchend:function(t){return t.stopPropagation(),e.dragEnd()}}},[r("mu-button",{attrs:{fab:"",small:"",color:"white",textColor:"red"}},[r("mu-icon",{attrs:{size:"20",value:"code"}})],1)],1),r("mu-button",{ref:"left",staticClass:"left-tick",attrs:{flat:""},nativeOn:{touchstart:function(t){return t.stopPropagation(),e.leftStart(t)},touchmove:function(t){return t.stopPropagation(),e.leftMove(t)},touchend:function(t){return t.stopPropagation(),e.changed()}}},[r("mu-icon",{class:{dragging:e.leftDragging},attrs:{value:"keyboard_arrow_left"}})],1),r("div",{staticClass:"content"},[r("div",{staticClass:"thumb overlay"},[r("mu-icon",{attrs:{value:e.typeIcon}}),r("span",[e._v(e._s(e.typeText))]),r("span",{staticClass:"time"},[e._v(e._s(e.fmtSeconds(e.end_sec)))])],1)]),r("mu-button",{ref:"right",staticClass:"right-tick",nativeOn:{touchstart:function(t){return t.stopPropagation(),e.rightStart(t)},touchmove:function(t){return t.stopPropagation(),e.rightMove(t)},touchend:function(t){return t.stopPropagation(),e.changed()}}},[r("mu-icon",{class:{dragging:e.rightDragging},attrs:{value:"keyboard_arrow_right"}})],1)],1)},Z=[],ee=r("d4ec"),te=r("bee2"),re={span:5,features:["inside","outside","center","middle"],layouts:[],dynamicLayouts:function(){return this.layouts},render:function(e,t){}},ne={leftToLeft:function(e,t,r){if(t.left-e<=r.left&&t.left+e>=r.left)return{diff:t.left-r.left,from:"left",to:"left"}},leftToRight:function(e,t,r){if(t.left-e<=r.right&&t.left+e>=r.right)return{diff:t.left-r.right,from:"left",to:"right"}},rightToLeft:function(e,t,r){if(t.right-e<=r.left&&t.right+e>=r.left)return{diff:t.right-r.left,from:"right",to:"left"}},rightToRight:function(e,t,r){if(t.right-e<=r.right&&t.right+e>=r.right)return{diff:t.right-r.right,from:"right",to:"right"}},leftToCenter:function(e,t,r){var n=r.left+r.width/2;if(t.left-e<=n&&t.left+e>=n)return{diff:t.left-n,from:"left",to:"center"}},rightToCenter:function(e,t,r){var n=r.left+r.width/2;if(t.right-e<=n&&t.right+e>=n)return{diff:t.right-n,from:"right",to:"center"}},centerToCenter:function(e,t,r){var n=t.left+t.width/2,i=r.left+r.width/2;if(n-e<=i&&n+e>=i)return{diff:n-i,from:"center",to:"center"}},centerToLeft:function(e,t,r){var n=t.left+t.width/2;if(n-e<=r.left&&n+e>=r.left)return{diff:n-r.left,from:"center",to:"center"}},centerToRight:function(e,t,r){var n=t.left+t.width/2;if(n-e<=r.right&&n+e>=r.right)return{diff:n-r.right,from:"center",to:"center"}},topToTop:function(e,t,r){if(t.top-e<=r.top&&t.top+e>=r.top)return{diff:t.top-r.top,from:"top",to:"top"}},topToBottom:function(e,t,r){if(t.top-e<=r.bottom&&t.top+e>=r.bottom)return{diff:t.top-r.bottom,from:"top",to:"bottom"}},bottomToTop:function(e,t,r){if(t.bottom-e<=r.top&&t.bottom+e>=r.top)return{diff:t.bottom-r.top,from:"bottom",to:"top"}},bottomToBottom:function(e,t,r){if(t.bottom-e<=r.bottom&&t.bottom+e>=r.bottom)return{diff:t.bottom-r.bottom,from:"bottom",to:"bottom"}},topToMiddle:function(e,t,r){var n=r.top+r.height/2;if(t.top-e<=n&&t.top+e>=n)return{diff:t.top-n,from:"top",to:"middle"}},bottomToMiddle:function(e,t,r){var n=r.top+r.height/2;if(t.bottom-e<=n&&t.bottom+e>=n)return{diff:t.bottom-n,from:"bottom",to:"middle"}},middleToMiddle:function(e,t,r){var n=t.top+t.height/2,i=r.top+r.height/2;if(n-e<=i&&n+e>=i)return{diff:n-i,from:"middle",to:"middle"}},middleToTop:function(e,t,r){var n=t.top+t.height/2;if(n-e<=r.top&&n+e>=r.top)return{diff:n-r.top,from:"middle",to:"top"}},middleToBottom:function(e,t,r){var n=t.top+t.height/2;if(n-e<=r.bottom&&n+e>=r.bottom)return{diff:n-r.bottom,from:"middle",to:"bottom"}},inside:function(e,t,r){return[ne.leftToLeft.call(this,e,t,r),ne.rightToRight.call(this,e,t,r),ne.topToTop.call(this,e,t,r),ne.bottomToBottom.call(this,e,t,r)].filter((function(e){return e}))},outside:function(e,t,r){return[ne.leftToRight.call(this,e,t,r),ne.rightToLeft.call(this,e,t,r),ne.topToBottom.call(this,e,t,r),ne.bottomToTop.call(this,e,t,r)].filter((function(e){return e}))},center:function(e,t,r){return[ne.leftToCenter.call(this,e,t,r),ne.rightToCenter.call(this,e,t,r),ne.centerToCenter.call(this,e,t,r),ne.centerToLeft.call(this,e,t,r),ne.centerToRight.call(this,e,t,r)].filter((function(e){return e}))},middle:function(e,t,r){return[ne.topToMiddle.call(this,e,t,r),ne.bottomToMiddle.call(this,e,t,r),ne.middleToMiddle.call(this,e,t,r),ne.middleToTop.call(this,e,t,r),ne.middleToBottom.call(this,e,t,r)].filter((function(e){return e}))}},ie=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re;Object(ee["a"])(this,e),this.options=Object.assign({},re,t),this.features=Object.create(ne)}return Object(te["a"])(e,[{key:"findTargets",value:function(e,t){var r=this;t=t||this.options.features;var n=this.options.span;return this.options.dynamicLayouts().flatMap((function(i){return t.map((function(e){return r.features[e]})).flatMap((function(t){return t.call(r,n,e,i)})).filter((function(e){return e})).map((function(e){return e.layout=i,e}))}))}},{key:"getTargetPosition",value:function(e){return"center"==e.to?e.layout.left+e.layout.width/2:"middle"==e.to?e.layout.top+e.layout.height/2:e.layout[e.to]}},{key:"createLayout",value:function(e,t,r){if(e=Object.assign({},e),t){var n=this.getTargetPosition(t);"center"==t.from?(e.left=n-e.width/2,e.right=e.left+e.width):(e[t.from]=n,"left"==t.from?e.right=e.left+e.width:"right"==t.from&&(e.left=e.right-e.width))}if(r){var i=this.getTargetPosition(r);"middle"==r.from?(e.top=i-e.height/2,e.bottom=e.top+e.height):(e[r.from]=i,"top"==r.from?e.bottom=e.top+e.height:"bottom"==r.from&&(e.top=e.bottom-e.height))}return e}},{key:"check",value:function(e,t,r){var n=this.findTargets(t,r),i=null,a=null,s=null,o=null;return n.forEach((function(e){"left"==e.to||"center"==e.to||"right"==e.to?i?e.to==Math.abs(e.diff)<Math.abs(i.diff)&&(i=e):i=e:a?Math.abs(e.diff)<Math.abs(a.diff)&&(a=e):a=e})),(i||a)&&(i&&(s=this.getTargetPosition(i)),a&&(o=this.getTargetPosition(a)),t=this.createLayout(t,i,a)),this.options.render(s,o),t}}]),e}(),ae=.1,se={props:["pps","active","end_sec","offset_sec","is_amix","type","id"],data:function(){return{overallDragging:!1,leftDragging:!1,rightDragging:!1,boxStyle:{width:0,left:0}}},watch:{end_sec:"update",offset_sec:"update"},computed:{typeIcon:function(){return this.is_amix?"music_note":_.Overlay.Type.Text==this.type?"font_download":_.Overlay.Type.Image==this.type?"image":"blur_on"},typeText:function(){return this.is_amix?"音效":_.Overlay.Type.Text==this.type?"文字":_.Overlay.Type.Image==this.type?"贴纸":"马赛克"}},methods:{fmtSeconds:function(e){var t=(e%60).toFixed(0),r=(e/60%60).toFixed(0),n=(e/60/60%60).toFixed(0);return n+":"+r+":"+t},update:function(){window.console.log("update:"+this.end_sec),this.end_sec<=0&&(this.end_sec=ae),this.boxStyle.width=this.end_sec*this.pps+"px",this.boxStyle.left=this.offset_sec*this.pps+"px"},toggleActive:function(){var e=this;this.active||(window.console.log("active",this.active),this.$nextTick((function(){e.$el.focus({preventScroll:!0})})),this.$emit("active",!this.active))},dragStart:function(e){this._pageX=e.changedTouches[0].pageX,this._value=this.offset_sec,this.overallDragging=!0,this.dragMove(e)},dragMove:function(e){var t=this._value,r=(e.changedTouches[0].pageX-this._pageX)/this.pps;r=t+r;var n=this.createMagnetLayout({left:t,width:this.end_sec}),i=this.createMagnetLayout({left:r,width:this.end_sec});return i=this.magnet.check(n,i),r=i.left,r=Math.max(0,r),r=Math.min(U.editlist.total_sec,r),this.changed({offset_sec:r,overallDragging:this.overallDragging}),!0},dragEnd:function(){this.overallDragging=!1,this.leftDragging=!1,this.rightDragging=!1,this.changed()},leftStart:function(e){this._pageX=e.changedTouches[0].pageX,this._value=this.offset_sec,this._value2=this.end_sec,this.leftDragging=!0,this.leftMove(e)},leftMove:function(e){var t=this._value,r=this._value2,n=(e.changedTouches[0].pageX-this._pageX)/this.pps;n=t+n;var i=this.createMagnetLayout({left:t,width:0}),a=this.createMagnetLayout({left:n,width:0});a=this.magnet.check(i,a),n=a.left,n=Math.max(0,n),n=Math.min(t+r-ae,n);var s=Math.max(0,r+t-n);return this.changed({offset_sec:n,end_sec:s}),!0},rightStart:function(e){this._pageX=e.changedTouches[0].pageX,this._value=this.end_sec,this.rightDragging=!0,this.rightMove(e)},rightMove:function(e){var t=this._value,r=(e.changedTouches[0].pageX-this._pageX)/this.pps,n=t+r,i=this.createMagnetLayout({left:this.offset_sec+t,width:0}),a=this.createMagnetLayout({left:this.offset_sec+n,width:0});return a=this.magnet.check(i,a),n=a.left-this.offset_sec,n=Math.min(U.editlist.total_sec-this.offset_sec,n),n=Math.max(ae,n),this.changed({end_sec:n}),!0},changed:function(e){var t=!e;this.$emit("change",Object(m["a"])({end:t,offset_sec:this.offset_sec,end_sec:this.end_sec},e))},createMagnetLayout:function(e){return{left:e.left,width:e.width,right:e.left+e.width,top:0,height:0,bottom:0}},vibrate:function(){navigator.vibrate([100])}},mounted:function(){var e=this;this.update(),this.pps||(this.pps=screen.width/10),this.magnet=new ie({span:6/this.pps,features:["inside","outside"],render:function(t){null!=t&&e.vibrate()},dynamicLayouts:function(){var t=[];t=e.is_amix?U.editlist.amix:e.type===_.Overlay.Type.Mosic||e.type===_.Overlay.Type.Image?[].concat(Object(u["a"])(U.editlist.mosic),Object(u["a"])(U.editlist.overlay.filter((function(e){return e.type==_.Overlay.Type.Image})))):U.editlist.overlay.filter((function(t){return t.type==e.type}));var r=t.filter((function(t){return t.id!=e.id})).map((function(t){return e.createMagnetLayout({left:t.offset_sec,width:t.end_sec})}));return e.overallDragging||r.push({left:U.editlist.time_sec,width:0}),r}})}},oe=se,ce=(r("df05"),Object(H["a"])(oe,Q,Z,!1,null,"ec466ad2",null)),le=ce.exports,ue=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"box"},e._l(e.thumbs,(function(t,n){return r("img",{key:n,style:{left:t.ss*e.pps+"px",width:t.duration*e.pps+"px"},attrs:{src:t.url||e.firstThumb},on:{error:function(t){return e.thumbLoadError(n)}}})})),0)},de=[],fe=(r("baa5"),r("841c"),{Util:{getCdvUrl:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return 0==e.indexOf("http://localhost")&&(e=e.replace(/http:\/\/localhost:.*?\//,"cdvfile://localhost/")),0==e.indexOf("/")&&(e="file://"+e),t.next=4,new Promise((function(t,r){return resolveLocalFileSystemURL(e,(function(e){t(e.toInternalURL())}),(function(){r()}))}));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))()},getLocalUrl:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return 0==e.indexOf("http://localhost")&&(e=e.replace(/http:\/\/localhost:.*?\//,"cdvfile://localhost/")),0==e.indexOf("/")&&(e="file://"+e),t.next=4,new Promise((function(t,r){return resolveLocalFileSystemURL(e,(function(e){t(fe.Util.normalizeFileUrl(e.toURL()))}),(function(){r()}))}));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))()},normalizeFileUrl:function(e){return 0==e.toLowerCase().search(/.{0,5}file:\/\//)&&(e=decodeURI(e)),e}},getThumbList:function(e,t){return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a,s,o,c,l;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,Promise.all(e.map(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,fe.Util.getLocalUrl(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return r.sent,r.next=6,Promise.all(e.map(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,r){return UGCApp.ffmpeg.format(t,e,r)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:for(r.sent,n=e.map((function(e,t){return cordova.file.cacheDirectory+"editor_thumb_"+t+".jpg"})),a="",s="",o=" -filter_complex '",c=0;c<e.length;c++)a+=" -analyzeduration 0 -probesize 32 -skip_frame nokey -t 0.001 -i '"+e[c]+"' ",o+="["+c+":v]scale=100:100:force_original_aspect_ratio=increase,crop=100:100[out"+c+"];",s+=" -map [out"+c+"] -frames:v 1 -f image2 -y '"+n[c]+"'";o=o.replace(/;$/,"'"),UGCApp.ffmpeg.start("ffmpeg "+a+o+s),l=0,t.progress=-1;case 17:return r.next=19,new Promise((function(e,t){return UGCApp.ffmpeg.status(e,t)}));case 19:return t.status=l=r.sent,r.next=22,new Promise((function(e){setTimeout(e,1e3)}));case 22:if(1==l){r.next=17;break}case 23:return r.next=25,Promise.all(n.map(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,fe.Util.getCdvUrl(t);case 2:return r=e.sent,n=Url(r,!0),n.query["_"]=Math.random(),e.abrupt("return",n.toString());case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 25:return r.abrupt("return",r.sent);case 26:case"end":return r.stop()}}),r)})))()},getThumb:function(e,t){return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i,a,s,o,c,l,u,d,f;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,fe.Util.getLocalUrl(e);case 2:return n=r.sent,r.next=5,new Promise((function(e,t){return UGCApp.ffmpeg.format(n,e,t)}));case 5:return i=r.sent,a=cordova.file.cacheDirectory+"editor_thumb.jpg",r.next=9,new Promise((function(e){return resolveLocalFileSystemURI(a,(function(t){return t.remove(),e()}),e)})).catch((function(){}));case 9:for(s=10,o="",c="",l=0;l<s;l++)u=i.duration/1e3/s*l,o+=" -analyzeduration 0 -probesize 32 -ss "+u+" -t 0.001 -i '"+n+"' ",c+="["+l+"]";c+="concat="+s,d="ffmpeg {input} -filter_complex {concat},scale=100:100:force_original_aspect_ratio=increase,crop=100:100,tile={n}x1 -f image2 -y {des}".replace("{input}",o).replace("{des}",a).replace("{concat}",c).replace(/\{n\}/g,s),UGCApp.ffmpeg.start(d),f=0,t.progress=-1;case 18:return r.next=20,new Promise((function(e,t){return UGCApp.ffmpeg.status(e,t)}));case 20:return t.status=f=r.sent,r.next=23,new Promise((function(e){setTimeout(e,1e3)}));case 23:if(1==f){r.next=18;break}case 24:return r.next=26,fe.Util.getCdvUrl(a);case 26:return r.abrupt("return",r.sent);case 27:case"end":return r.stop()}}),r)})))()},Transcode:{singleEx:function(e,t,r){return Object(i["a"])(regeneratorRuntime.mark((function n(){var i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=!1,n.next=3,fe.Transcode.single(e,t,r);case 3:if(i=n.sent,i){n.next=8;break}return n.next=7,fe.Transcode.single(e,t,r,!0);case 7:i=n.sent;case 8:return n.abrupt("return",i);case 9:case"end":return n.stop()}}),n)})))()},single:function(e,t,r,n){return Object(i["a"])(regeneratorRuntime.mark((function i(){var a,s,o,c,l,u,d,f,p,h,m,v,g,b,y,x,_,k,T,C,R,O,P,A,I,S;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(0!=e.indexOf("file://")){i.next=4;break}i.t0=e,i.next=7;break;case 4:return i.next=6,fe.Util.getLocalUrl(e);case 6:i.t0=i.sent;case 7:return a=i.t0,i.next=10,new Promise((function(e,t){return UGCApp.ffmpeg.format(a,e,t)}));case 10:s=i.sent,o="",c="0:v",(90+s.video.rotate)%180==0&&(u=s.video.width,s.video.width=s.video.height,s.video.height=u),d=Math.max(s.video.width/t.uiBox.width,s.video.height/t.uiBox.height),f=t.uiBox.width*d/2-s.video.width/2,p=t.uiBox.height*d/2-s.video.height/2,i.t1=regeneratorRuntime.keys(t.imgs);case 18:if((i.t2=i.t1()).done){i.next=47;break}if(h=i.t2.value,m=t.imgs[h],v="movie='{url}'{gif},scale={w}:{h},rotate='a={rotate}*PI/180:ow=hypot(iw,ih):oh=ow:c=none'[p{id}],[{in}][p{id}]overlay={x}:{y}{shortest}[{out}]",g=Math.sqrt(m.w*m.w+m.h*m.h),b=m.url.toLowerCase().lastIndexOf(".gif")==m.url.length-4,i.t3=v.replace("{gif}",b?":loop=0:discontinuity=1,setpts=N/(FR*TB)":"").replace("{shortest}",b?":shortest=1":""),0!=m.url.indexOf("data:")){i.next=29;break}i.t4=m.url.replace(":","\\\\:"),i.next=32;break;case 29:return i.next=31,fe.Util.getLocalUrl(m.url);case 31:i.t4=i.sent.replace("file://","").replace(/:/g,"\\:");case 32:i.t5=i.t4,i.t6=(m.w*d).toFixed(2),i.t7=(m.h*d).toFixed(2),i.t8=((m.x-(g/2-m.w/2))*d-f).toFixed(2),i.t9=((m.y-(g/2-m.h/2))*d-p).toFixed(2),i.t10=m.rotate,i.t11=m.id,i.t12=c,i.t13="outP"+m.id,v=i.t3.replace.call(i.t3,"{url}",i.t5).replace("{w}",i.t6).replace("{h}",i.t7).replace("{x}",i.t8).replace("{y}",i.t9).replace("{rotate}",i.t10).replace(/\{id\}/g,i.t11).replace("{in}",i.t12).replace("{out}",i.t13),c=l="outP"+m.id,o&&(o+=","),o+=v,i.next=18;break;case 47:return y="fps=30",x="scale='min(1080,iw)':min'(1080,ih)':force_original_aspect_ratio=decrease,scale=trunc(iw/2)*2:trunc(ih/2)*2",_='-vf "',o&&(_+=o.replace("["+l+"]","")+","),_+=y+",",_+=x,t.vfilter&&(_+=","+t.vfilter),_+='"',k="",t.afilter&&(k='-af "',k+=t.afilter+'"'),T=a+"-"+(new Date).getTime()+".mp4",C=3e3*Math.pow(Math.max(s.video.width,s.video.height)/1280,2),R="h264",w.isAndroid()&&!n&&(R="libhw_avc"),w.isIOS()&&(R="h264_videotoolbox",T=cordova.file.cacheDirectory+"output.mp4"),UGCApp.ffmpeg.start("ffmpeg -accurate_seek {start} -t {len} -i {src} {vfilter} {afilter} -acodec aac -b:v {b:v} -vcodec {vcodec} -use_editlist 0 -f mp4 -y {des}".replace("{start}",t.timeline.left>1?"-ss "+t.timeline.left:"").replace("{len}",t.timeline.right-t.timeline.left).replace("{vcodec}",R).replace("{src}",a).replace("{vfilter}",_).replace("{afilter}",k).replace("{b:v}",C+"k").replace("{des}",T)),O=1e3*(t.timeline.right-t.timeline.left),P=0,A=0,i.next=68,new Promise((function(e){setTimeout(e,1e3)}));case 68:return i.next=70,new Promise(UGCApp.ffmpeg.status);case 70:return r.status=A=i.sent,i.next=73,new Promise(UGCApp.ffmpeg.progress);case 73:return P=i.sent,r.progress=Math.max(0,P.pts/O),i.next=77,new Promise((function(e){setTimeout(e,200)}));case 77:window.console.log("ffmpeg progress:"+P.pts+", status:"+A);case 78:if(1==A){i.next=68;break}case 79:return i.next=81,new Promise(UGCApp.ffmpeg.report);case 81:if(I=i.sent,0!=I){i.next=98;break}if(!w.isIOS()){i.next=92;break}return i.next=86,new Promise((function(e,t){return UGCApp.sendToDCIM(T,e,t)}));case 86:return S=i.sent,i.next=89,fe.Util.getLocalUrl(S);case 89:r.desSrc=i.sent,i.next=96;break;case 92:return UGCApp.scanFile(T),i.next=95,fe.Util.getCdvUrl(T);case 95:r.desSrc=i.sent;case 96:i.next=98;break;case 98:return i.abrupt("return",0==I);case 99:case"end":return i.stop()}}),i)})))()},mergeEx:function(e,t,r){return Object(i["a"])(regeneratorRuntime.mark((function n(){var i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=!1,n.next=3,fe.Transcode.merge(e,t,r);case 3:if(i=n.sent,i){n.next=8;break}return n.next=7,fe.Transcode.merge(e,t,r,!0);case 7:i=n.sent;case 8:return n.abrupt("return",i);case 9:case"end":return n.stop()}}),n)})))()},merge:function(e,t,r,n){return Object(i["a"])(regeneratorRuntime.mark((function a(){var s,o,c,l,u,d,f,p,h,m,v,g,b,y,x;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Promise.all(e.map(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,fe.Util.getLocalUrl(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:s=a.sent,o="",c="",l="",t.renderParams.map((function(e,r){o+=" -i '"+s[r]+"' ",c+="[{idx}]scale={w}:{h},pad={boxW}:{boxH}:{x}:{y},setsar=sar=1/1,setdar=dar={boxW}/{boxH}[{idx}_out];".replace(/{idx}/g,r).replace("{w}",e.w).replace("{h}",e.h).replace("{x}",e.x).replace("{y}",e.y).replace(/{boxW}/g,t.width).replace(/{boxH}/g,t.height),l+="[{idx}_out][{idx}:a]".replace(/{idx}/g,r),e.hasAudio||(c+="anullsrc,atrim=duration={duration}[{idx}:a];".replace("{duration}",e.duration).replace(/{idx}/g,r))})),u=s[0]+"-"+(new Date).getTime()+".mp4",d=3e3*Math.pow(Math.max(t.width,t.height)/1280,2),f="h264",w.isAndroid()&&!n&&(f="libhw_avc"),w.isIOS()&&(f="h264_videotoolbox",u=cordova.file.cacheDirectory+"output.mp4"),p="fps=30",h="scale='min(3840,iw)':min'(2160,ih)':force_original_aspect_ratio=decrease,scale=trunc(iw/2)*2:trunc(ih/2)*2",m='ffmpeg {input} -filter_complex "{scale}{concat}concat=n={concat_n}:v=1:a=1[outv][outa];[outv]{fps},{limit}[outv2]" -map [outa] -map [outv2] -acodec aac -b:v {b:v} -vcodec {vcodec} -use_editlist 0 -f mp4 {des}'.replace("{input}",o).replace("{scale}",c).replace("{fps}",p).replace("{limit}",h).replace("{concat}",l).replace("{concat_n}",e.length).replace("{vcodec}",f).replace("{b:v}",d+"k").replace("{des}",u),UGCApp.ffmpeg.start(m),v=1e3*t.renderParams.reduce((function(e,t){return{duration:e.duration+t.duration}})).duration,g=0,b=0;case 19:return a.next=21,new Promise(UGCApp.ffmpeg.status);case 21:return r.status=b=a.sent,a.next=24,new Promise(UGCApp.ffmpeg.progress);case 24:return g=a.sent,r.progress=g.pts/v,a.next=28,new Promise((function(e){setTimeout(e,200)}));case 28:if(1==b){a.next=19;break}case 29:return a.next=31,new Promise(UGCApp.ffmpeg.report);case 31:if(y=a.sent,0!=y){a.next=46;break}if(!w.isIOS()){a.next=42;break}return a.next=36,new Promise((function(e,t){return UGCApp.sendToDCIM(u,e,t)}));case 36:return x=a.sent,a.next=39,fe.Util.getLocalUrl(x);case 39:r.desSrc=a.sent,a.next=46;break;case 42:return UGCApp.scanFile(u),a.next=45,fe.Util.getCdvUrl(u);case 45:r.desSrc=a.sent;case 46:return a.abrupt("return",0==y);case 47:case"end":return a.stop()}}),a)})))()},cancel:function(){UGCApp.ffmpeg.cancel()}}}),pe=fe,he=10,me=1,ve={},ge={props:["idx","pps","time_sec","timeline"],data:function(){return{thumbs:[]}},watch:{time_sec:"update","timeline.start_sec":"update","timeline.end_sec":"update"},computed:{firstThumb:function(){var e=this.thumbs.find((function(e){return e.url}));return e&&e.url}},methods:{update:function(){var e=this.time_sec;e<0||e>this.timeline.offset_sec+this.timeline.end_sec-this.timeline.start_sec||(this.fetchThumb(e),this.fetchThumb(e-he),this.fetchThumb(e+he))},thumbLoadError:function(e){this.thumbs[e].url&&(this.thumbs.splice(e,1),this.update())},prepareCacheFolder:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=""+e.timeline.id,ve[r]){t.next=11;break}return t.next=4,S.filesystem();case 4:return n=t.sent,t.next=7,new Promise(n.root.getDirectory.bind(n.root,"thumbs/",{create:!0}));case 7:return i=t.sent,t.next=10,new Promise(i.getDirectory.bind(i,r,{create:!0}));case 10:ve[r]=t.sent;case 11:case"end":return t.stop()}}),t)})))()},makeThumb2:function(){return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},makeThumb:function(e,t,r,n,a){var s=this;return Object(i["a"])(regeneratorRuntime.mark((function i(){var o;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return window.console.log("makeThumb:"+t),i.next=3,s.prepareCacheFolder();case 3:return o=1e6,i.next=6,new Promise(UGCApp.ffmpeg.thumb.bind(null,e,t,r*o,n*o,a*o));case 6:return i.abrupt("return",i.sent);case 7:case"end":return i.stop()}}),i)})))()},fetchThumb:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i,a,s,o,c,l,u,d,f;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=k(Math.max(0,e+t.timeline.start_sec)),!(n>k(t.timeline.end_sec))){r.next=3;break}return r.abrupt("return");case 3:if(i=t.thumbs.find((function(e){return k(e.ss)<=k(n)&&k(e.ss+e.duration)>=k(n)})),i&&!i.preload){r.next=24;break}return a=n-n%he,s=he,o=me,c=t.timeline,l=c.url,u="{path}/thumbs/{id}/thumb_{ss}_{rn}.jpg".replace("{path}",cordova.file.tempDirectory||cordova.file.cacheDirectory).replace("{id}",c.id).replace("{ss}",a).replace("{rn}",Math.random().toString(16).replace("0.","")),d=i,d?(d.loading=!0,delete d.preload):(d={loading:!0,url:"",ss:a,duration:s},t.thumbs.push(d)),t.timeline.thumbs=t.thumbs,r.next=16,t.makeThumb(l,u,a,s,o);case 16:return f=r.sent,f&&window.console.error("make thumb error:"+f),delete d.loading,r.next=21,pe.Util.getCdvUrl(u);case 21:d.url=r.sent,window.console.debug("make thumb:"+d.url),0==e&&U.editlist.updateOperateHistory(_.Operate.VideoAdd.Type,c);case 24:case"end":return r.stop()}}),r)})))()},makeAllThumb:function(){var e=this.timeline.start_sec,t=this.timeline.end_sec;while(e<=t){var r=e-e%he,n={preload:!0,url:"",ss:r,duration:he};this.thumbs.push(n),this.timeline.thumbs=this.thumbs,e+=he}}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.makeAllThumb(),t.next=3,e.fetchThumb(0);case 3:case"end":return t.stop()}}),t)})))()}},be=ge,we=(r("4d630"),Object(H["a"])(be,ue,de,!1,null,"21cbc8a0",null)),ye=we.exports,xe={toTimeStr:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=e/60,r=t/60,n=Math.floor(e%1*10);return Math.floor(r)+":"+Math.floor(t)+":"+Math.floor(e%60)+"."+n}},_e={components:{TimelineItem:K,TimelineOverlayItem:le,TimelineItemThumb:ye},props:["time_sec_in","timelines_in","playing","show_overlay","show_amix","postermode","poster","overlay_type"],data:function(){return{Const:_,pps:screen.width/10,timelines:this.timelines_in,overlay_in:U.editlist.overlay,mosic_in:U.editlist.mosic,amix:U.editlist.amix,video_min_sec:U.editlist.video_min_sec,time_sec:U.editlist.time_sec,mainLineStyle:{width:0,transform:"","transition-duration":"0s"},poster_url:"",dragging:!1,timelineChanging:!1,timer:null}},watch:{overlay:function(){window.console.log("over watch")},playing:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a,s,o,c;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!e){r.next=9;break}n=.5,t.mainLineStyle["transition-duration"]=n+"s",window.console.log("begin playing"),a=function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var r,n,i,a,s,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t._moveSpeed){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,new Promise(UGCApp.ffplay.position);case 5:if(r=e.sent,window.console.log("position:".concat(r," total:").concat(t.total_sec)),r>=0){e.next=9;break}return e.abrupt("return");case 9:r>t.total_sec&&(r=t.total_sec),n=window.getComputedStyle(t.$refs.mainLine),i=Number.parseFloat(n.transform.split(/[(,)]/)[5]),a=r,s=t.total_sec-a,o=(t.total_sec*t.pps+i)/t.pps,t.mainLineStyle["transition-duration"]=Math.max(0,s)+"s",t.mainLineStyle.transform="translateX(".concat(i,"px)"),t.mainLineStyle.transform="translateX(-"+(t.total_sec+Math.random()/1e3)*t.pps+"px)",window.console.log("left:".concat(t.total_sec*t.pps+i," remain:").concat(s,"/").concat(o," speed:").concat((t.total_sec*t.pps+i)/s)),window.console.log("move: ".concat(t.mainLineStyle.transform)),t.time_sec=r,e.next=26;break;case 23:e.prev=23,e.t0=e["catch"](2),window.console.log(e.t0);case 26:case"end":return e.stop()}}),e,null,[[2,23]])})));return function(){return e.apply(this,arguments)}}(),a(),t._goingTmr=setInterval(a,1e3*n),r.next=26;break;case 9:return clearInterval(t._goingTmr),window.console.log("stop ".concat(t.mainLineStyle.transform)),s=window.getComputedStyle(t.$refs.mainLine),o=Number.parseFloat(s.transform.split(/[(,)]/)[5]),t.mainLineStyle["transition-duration"]="0s",t.mainLineStyle.transform="translateX("+o+"px)",r.prev=15,r.next=18,new Promise(UGCApp.ffplay.position);case 18:c=r.sent,c>=0&&(t.time_sec=c,U.editlist.time_sec=c),r.next=25;break;case 22:r.prev=22,r.t0=r["catch"](15),window.console.log(r.t0);case 25:Math.abs(t.time_sec-t.total_sec)<1&&(t.mainLineStyle["transition-duration"]="0.1s",t.mainLineStyle.transform="translateX(-"+(t.time_sec+Math.random()/1e3)*t.pps+"px)",setTimeout((function(){t.mainLineStyle["transition-duration"]="0s"}),100));case 26:case"end":return r.stop()}}),r,null,[[15,22]])})))()},time_sec_in:function(e){this.time_sec=e,this.update(!0)},time_sec:function(e){this.update(),U.editlist.time_sec=e,this.refreshUI()},timelines_in:function(e){var t=this.timelines.map((function(e){return e.id})).join(","),r=e.map((function(e){return e.id})).join(",");t!=r&&(this.timelines=e),this.timelines.length!=e.length&&(this.timelines=e),this.update(!0)},poster:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,pe.Util.getCdvUrl(e);case 2:r.t0=r.sent,r.t1=r.t0+"?",r.t2=Math.random(),t.poster_url=r.t1+r.t2;case 6:case"end":return r.stop()}}),r)})))()}},computed:{overlay:function(){return[].concat(Object(u["a"])(this.overlay_in),Object(u["a"])(this.mosic_in))},total_sec:function(){return this.timelines.length?1==this.timelines.length?this.timelines[0].end_sec-this.timelines[0].start_sec:this.timelines.reduce((function(e,t,r){return 1==r&&(e=e.end_sec-e.start_sec),t.offset_sec=e,e+t.end_sec-t.start_sec})):0},currentTimeStr:function(){return xe.toTimeStr(this.time_sec).replace("0:0","0")},totalTimeStr:function(){return xe.toTimeStr(this.total_sec).split(".")[0].replace("0:0","0")},hasEnding:function(){return this.timelines.find((function(e){return e.ending}))}},methods:{updateFrame:function(){return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},seek:function(e){this.dragging||(this.time_sec=e,this.update(!0))},time_sec_idx:function(e){var t=this,r=this.timelines.filter((function(r,n){return n==e&&r.offset_sec<=t.timeSec&&r.offset_sec+(r.end_sec-r.start_sec)>t.timeSec}));return r.length?this.time_sec-r[0].offset_sec:-1},update:function(e){this.timelineChanging||(this.mainLineStyle.width=this.timelines.reduce((function(e,t){return e+t.end_sec-t.start_sec}),0)*this.pps+"px",(this._moveSpeed||e)&&(this.mainLineStyle.transform="translateX(-"+this.time_sec*this.pps+"px)"),this.timelines.reduce((function(e,t){return t.offset_sec=e,e+t.end_sec-t.start_sec}),0))},overlayActive:function(e,t){t?(this.overlay.forEach((function(t){t.active=t.id==e})),this.$emit("overlayActive",this.overlay.filter((function(t){return t.id==e}))[0])):(this.overlay.filter((function(t){return t.id==e}))[0].active=!1,this.$emit("overlayActive"))},overlayChange:function(e,t){var r=this.overlay.filter((function(t){return t.id==e}))[0];r.offset_sec=t.offset_sec,r.end_sec=t.end_sec,t.overallDragging&&(this.time_sec=r.offset_sec,this.changed({time_sec:this.time_sec}),this.update(!0)),t.end&&this.$emit("overlayChange",this.overlay.filter((function(t){return t.id==e}))[0])},amixChange:function(e,t){var r=this.amix.filter((function(t){return t.id==e}))[0];r.offset_sec=t.offset_sec,r.end_sec=t.end_sec,t.end&&this.$emit("amixChange",this.amix.filter((function(t){return t.id==e}))[0])},amixActive:function(e,t){t?(this.amix.forEach((function(t){t.active=t.id==e})),this.$emit("amixActive",this.amix.filter((function(t){return t.id==e}))[0])):(this.amix.filter((function(t){return t.id==e}))[0].active=!1,this.$emit("amixActive"))},timelineActive:function(e,t){var r=this;t?this.timelines.forEach((function(t){t.id==e?(t.active=!0,r.time_sec<t.offset_sec?r.time_sec=t.offset_sec:r.time_sec>=t.offset_sec+t.end_sec-t.start_sec&&(r.time_sec=t.offset_sec+t.end_sec-t.start_sec-1e-4)):t.active=!1})):this.timelines.find((function(t){return t.id==e})).active=!1},timelineChange:function(e,t){var r=this.timelines.filter((function(t){return t.id==e}))[0];r.start_sec=t.start_sec,r.end_sec=t.end_sec,this.timelineChanging=!t.end;var n=r.offset_sec;if(t.left_drag_offset?this.timelines.forEach((function(e){e.offset_sec<n||(e.left_drag_offset=t.left_drag_offset)})):this.timelines.forEach((function(e){e.left_drag_offset=0})),void 0!==t.seek_sec){var i=this.timelines.indexOf(r),a=t.seek_sec+[0].concat(Object(u["a"])(this.timelines.slice(0,i))).reduce((function(e,t){return e+t.end_sec-t.start_sec}));this.time_sec=Math.max(0,a),this.changed({time_sec:this.time_sec})}U.editlist.update_timelines(this.timelines),window.console.log("change end:"+t.end),t.end&&(this.$emit("timelinesChange",this.timelines),this.update(!0)),this.update()},currentStart:function(e){this._pageX=e.changedTouches[0].pageX,this._value=this.time_sec},currentMove:function(e){var t=e.changedTouches[0].pageX-this._pageX;return this.dragging=!0,this._preOffset&&(this._moveSpeed=-t+this._preOffset),this._preOffset=t,this.time_sec=Math.max(0,Math.min(this.total_sec,this._value-t/this.pps)),this.changed({time_sec:this.time_sec}),!0},changed:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=!e,!(n&&Math.abs(t._moveSpeed)>1)){r.next=12;break}i=5*t._moveSpeed,i=Math.max(-60,Math.min(60,i));case 4:if(!(Math.abs(i)>1)){r.next=12;break}return a=t.time_sec+i/t.pps,i*=.8,t.time_sec=Math.max(0,Math.min(t.total_sec,a)),r.next=10,new Promise((function(e){clearTimeout(t.timer),t.timer=setTimeout(e,20)}));case 10:r.next=4;break;case 12:n&&(t._preOffset=0,t._moveSpeed=0,t.dragging=!1),t.$emit("timeChange",Object(m["a"])({time_sec:t.time_sec},e));case 14:case"end":return r.stop()}}),r)})))()},posterLoadError:function(){this.poster_url=null},endingClick:function(){this.$emit("on_ending_click")},refreshUI:function(){if(!this.timelineChanging){var e=U.editlist.cur_timeline;e&&(e.focus=!0,this.timelines.forEach((function(t){return t.id!=e.id&&(t.focus=!1)})),e.active||this.timelines.forEach((function(e){return e.active=!1})))}}},mounted:function(){this.update(),this.updateFrame()},beforeDestroy:function(){clearInterval(this._goingTmr)}},ke=_e,Te=(r("9ab9"),Object(H["a"])(ke,N,G,!1,null,"7d1d4da4",null)),Ce=Te.exports,Re=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"controlBox"},[r("mu-icon",{staticStyle:{position:"absolute",left:"0"},attrs:{value:"aspect_ratio"},on:{click:function(t){return e.$emit("event",{eventID:e.EventID.AspectRatio})}}}),r("mu-icon",{attrs:{value:"skip_previous"},on:{click:function(t){return e.$emit("event",{eventID:e.EventID.SeekBegin})}}}),r("mu-icon",{directives:[{name:"show",rawName:"v-show",value:!e.playing,expression:"!playing"}],attrs:{value:"play_arrow"},on:{click:function(t){return e.$emit("event",{eventID:e.EventID.Play})}}}),r("mu-icon",{directives:[{name:"show",rawName:"v-show",value:e.playing,expression:"playing"}],attrs:{value:"pause"},on:{click:function(t){return e.$emit("event",{eventID:e.EventID.Pause})}}}),r("mu-icon",{attrs:{value:"skip_next"},on:{click:function(t){return e.$emit("event",{eventID:e.EventID.SeekEnd})}}}),r("mu-icon",{class:[e.hasHistory?"":"disabled"],staticStyle:{position:"absolute",right:"0"},attrs:{value:"undo"},on:{click:function(t){e.hasHistory&&e.$emit("event",{eventID:e.EventID.Undo})}}})],1)},Oe=[],Pe={Play:0,Pause:1,SeekBegin:2,SeekEnd:3,AspectRatio:4,Undo:5},Ae={EventID:Pe,props:["playing"],data:function(){return{EventID:Pe,editlist:U.editlist}},computed:{hasHistory:function(){return this.editlist.operate.history.length>1}},created:function(){U.editlist.operate=this.editlist.operate}},Ie=Ae,Se=(r("0a0d"),Object(H["a"])(Ie,Re,Oe,!1,null,"7ba491a2",null)),Me=Se.exports,Ee=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"toolTabBox"},[r("div",{staticClass:"middleBox"},[r("transition",{attrs:{name:"fade"}},[r("OverlayToolTab",{directives:[{name:"show",rawName:"v-show",value:e.activeItem&&e.activeItem.active,expression:"activeItem&&activeItem.active"}],ref:"overlayToolTab",class:{hide:"overlaytool"!=e.toolTab},attrs:{activeItem:e.activeItem},on:{select:e.overlayTabSelect}})],1),r("transition",{attrs:{name:"fade"}},[r("HScrollBar",{staticClass:"m-cut tabBox",class:{hide:"cut"!=e.toolTab}},[r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"note_add",text:"添加"},on:{click:function(t){return e.select(e.TabID.VideoAdd)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{disabled:!e.isCurTimelineRemovable,icon:"delete_forever",text:"删除"},on:{click:function(t){return e.select(e.TabID.VideoRemove)}}}),r("div",{staticStyle:{margin:"10px","border-right":"1px solid gray"}}),r("ClipBtn",{staticClass:"item-btn",attrs:{disabled:e.curTimelineIsEnding,icon:"view_agenda",text:"分割"},on:{click:function(t){return e.select(e.TabID.VideoSplit)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"exposure",text:"视频参数"},on:{click:function(t){return e.select(e.TabID.VideoBase)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"view_column",text:"排序"},on:{click:function(t){return e.select(e.TabID.VideoSort)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{disabled:e.curTimelineIsEnding,icon:"sync",text:"旋转"},on:{click:function(t){return e.select(e.TabID.VideoRotate)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{disabled:e.curTimelineIsEnding,icon:"swap_vert",text:"上下翻转"},on:{click:function(t){return e.select(e.TabID.VideoVFlip)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{disabled:e.curTimelineIsEnding,icon:"swap_horiz",text:"左右翻转"},on:{click:function(t){return e.select(e.TabID.VideoHFlip)}}})],1)],1),r("transition",{attrs:{name:"fade"}},[r("div",{staticClass:"m-image tabBox",class:{hide:"image"!=e.toolTab}},[r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"image",text:"贴纸"},on:{click:function(t){return e.select(e.TabID.AddImage)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"photo_library",text:"本地贴纸"},on:{click:function(t){return e.select(e.TabID.AddLocalImage)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"blur_on",text:"马赛克"},on:{click:function(t){return e.select(e.TabID.Mosic)}}})],1)]),r("transition",{attrs:{name:"fade"}},[r("div",{staticClass:"m-text tabBox",class:{hide:"text"!=e.toolTab}},[r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"textsms",text:"添加文字"},on:{click:function(t){return e.select(e.TabID.AddText)}}})],1)]),r("transition",{attrs:{name:"fade"}},[r("div",{staticClass:"m-filter tabBox",class:{hide:"filter"!=e.toolTab}},[r("ClipBtn",{staticClass:"item-btn",attrs:{disabled:e.curTimelineIsEnding,icon:"face",text:"美颜"},on:{click:function(t){return e.select(e.TabID.Face)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"photo_filter",disabled:e.curTimelineIsEnding,text:"滤镜"},on:{click:function(t){return e.select(e.TabID.Filter)}}})],1)]),r("transition",{attrs:{name:"fade"}},[r("div",{staticClass:"m-music tabBox",class:{hide:"music"!=e.toolTab}},[r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"volume_up",text:"调整音量"},on:{click:function(t){return e.select(e.TabID.AudioBase)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"surround_sound",text:"添加背景音"},on:{click:function(t){return e.select(e.TabID.BGM)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"audiotrack",text:"音效"},on:{click:function(t){return e.select(e.TabID.AudioEffect)}}})],1)])],1),r("div",{staticClass:"bottomBox"},[r("mu-icon",{class:{active:"cut"==e.toolTab},attrs:{value:"duo",size:"28",color:"white"},on:{click:function(t){e.toolTab="cut"}}}),r("mu-icon",{class:{active:"image"==e.toolTab},attrs:{value:"add_photo_alternate",size:"28",color:"white"},on:{click:function(t){e.toolTab="image"}}}),r("mu-icon",{class:{active:"text"==e.toolTab},attrs:{value:"post_add",size:"28",color:"white"},on:{click:function(t){e.toolTab="text"}}}),r("mu-icon",{class:{active:"music"==e.toolTab},attrs:{value:"music_note",size:"28",color:"white"},on:{click:function(t){e.toolTab="music"}}})],1)])},je=[],$e=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("span",{staticClass:"icon",class:{active:e.active,disabled:e.disabled},on:{click:e.clicked}},[e.src?e.src?r("div",{staticClass:"img"},[r("img",{attrs:{src:e.src}}),r("div")]):e._e():r("mu-icon",{attrs:{value:e.icon}}),r("span",[e._v(e._s(e.text))]),e._t("default")],2)},De=[],Le={props:["text","icon","src","ricon","active","disabled"],methods:{clicked:function(e){this.disabled||this.$emit("click",e)}}},Ue=Le,Fe=(r("c525"),Object(H["a"])(Ue,$e,De,!1,null,"4fb247b2",null)),Be=Fe.exports,He=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"bar",attrs:{HScrollBar:""}},[e.visibleLeftArrow?r("span",{staticClass:"material-icons left-icon"},[e._v(" keyboard_arrow_left ")]):e._e(),e.visibleRightArrow?r("span",{staticClass:"material-icons right-icon"},[e._v(" keyboard_arrow_right ")]):e._e(),e._t("default")],2)},Xe=[],ze=20,Ne={props:["scroller"],data:function(){return{visibleLeftArrow:!1,visibleRightArrow:!1}},watch:{scroller:"refresh"},methods:{refresh:function(){var e=this.scroller||this.$el,t=e.scrollLeft,r=e.scrollWidth,n=e.offsetWidth;this.visibleLeftArrow=t>ze,this.visibleRightArrow=t+n+ze<r}},beforeDestroy:function(){this.$refs.bar.removeEventListener("scroll",this.onscroll,!0)},mounted:function(){this.$nextTick(this.refresh.bind(this)),this.onscroll=this.refresh.bind(this),this.$refs.bar.addEventListener("scroll",this.onscroll,!0)}},Ge=Ne,Ve=(r("224e"),Object(H["a"])(Ge,He,Xe,!1,null,"68f1f59b",null)),Ye=Ve.exports,qe=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"overlayToolTabBox"},[r("div",{staticClass:"overlayToolTab"},[e.activeItem&&e.activeItem.text?[r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"edit",text:"编辑"},nativeOn:{click:function(t){return e.select(e.TabID.Edit)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"format_paint",text:"样式"},nativeOn:{click:function(t){return e.select(e.TabID.Template)}}}),r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"tune",text:"调整"},nativeOn:{click:function(t){return e.select(e.TabID.Settings)}}})]:e._e(),[r("ClipBtn",{staticClass:"item-btn",attrs:{icon:"delete_forever",text:"删除"},nativeOn:{click:function(t){return e.select(e.TabID.Remove)}}}),r("ClipBtn",{staticClass:"done-btn",attrs:{icon:"done"},nativeOn:{click:function(t){return e.select(e.TabID.Done)}}})]],2)])},We=[],Je=0,Ke={Edit:Je++,Template:Je++,Settings:Je++,Remove:Je++,Done:Je++},Qe={TabID:Ke,components:{ClipBtn:Be},props:["activeItem"],data:function(){return{TabID:Ke}},methods:{select:function(e){this.$emit("select",e,this.activeItem)}}},Ze=Qe,et=(r("270a"),Object(H["a"])(Ze,qe,We,!1,null,"6729f64e",null)),tt=et.exports,rt=0,nt={VideoAdd:rt++,VideoRemove:rt++,VideoRotate:rt++,VideoSort:rt++,VideoSplit:rt++,VideoVFlip:rt++,VideoHFlip:rt++,VideoBase:rt++,AddImage:rt++,AddLocalImage:rt++,AddText:rt++,AudioBase:rt++,BGM:rt++,Face:rt++,Filter:rt++,Mosic:rt++,AudioEffect:rt++,AspectRatio:rt++,ImageTab:rt++,TextTab:rt++,AudioTab:rt++,OtherTab:rt++,ToolEdit:rt++,ToolTemplate:rt++,ToolSettings:rt++,ToolRemove:rt++,ToolDone:rt++},it={TabID:nt,components:{ClipBtn:Be,OverlayToolTab:tt,HScrollBar:Ye},props:["activeItem","editlist"],data:function(){return{TabID:nt,toolTab:"cut"}},watch:{activeItem:function(e){e&&(e.type==_.Overlay.Type.Text?this.toolTab="text":e.type!=_.Overlay.Type.Image&&e.type!=_.Overlay.Type.Mosic||(this.toolTab="image"))},toolTab:function(e){"image"==e?this.$emit("select",nt.ImageTab):"text"==e?this.$emit("select",nt.TextTab):"music"==e?this.$emit("select",nt.AudioTab):this.$emit("select",nt.OtherTab)}},computed:{isCurTimelineRemovable:function(){var e=this.editlist.timelines;if(e.length<=1)return!1;var t=e[e.length-1].ending;if(t){var r=this.editlist.cur_timeline;if(r.ending)return!0;if(e.length<=2)return!1}return!0},curTimelineIsEnding:function(){var e=this.editlist.cur_timeline;return e&&e.ending}},methods:{select:function(e){this.$emit("select",e)},overlayTabSelect:function(e,t){var r;switch(e){case tt.TabID.Edit:r=nt.ToolEdit;break;case tt.TabID.Template:r=nt.ToolTemplate;break;case tt.TabID.Settings:r=nt.ToolSettings;break;case tt.TabID.Remove:r=nt.ToolRemove;break;case tt.TabID.Done:r=nt.ToolDone;break;default:return}this.$emit("select",r,t)}}},at=it,st=(r("499f"),Object(H["a"])(at,Ee,je,!1,null,"7329176e",null)),ot=st.exports,ct=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("transition",{attrs:{name:"fade"},on:{"after-leave":function(t){return e.$emit("close")}}},[e.tabid>=0?r("div",{staticClass:"dialog-main",style:e.style},[r("div",{staticClass:"dialog-content"},[e.tabid==e.TabID.AudioBase?r("AudioBase",{ref:"audiobBase",attrs:{title:e.title,editlist:e.editlist},on:{"update:title":function(t){e.title=t},change:e.change}}):e._e(),e.tabid==e.TabID.VideoSort?r("Sort",{ref:"sort",attrs:{title:e.title,accept:e.dialogAccept,editlist:e.editlist},on:{"update:title":function(t){e.title=t},change:e.change}}):e._e(),e.tabid==e.TabID.BGM?r("BGM",{ref:"bgm",attrs:{title:e.title,accept:e.dialogAccept,editlist:e.editlist},on:{"update:title":function(t){e.title=t},change:e.change}}):e._e(),e.tabid==e.TabID.AudioEffect?r("AudioEffect",{ref:"audioEffect",attrs:{title:e.title,editlist:e.editlist,accept:e.dialogAccept},on:{"update:title":function(t){e.title=t},change:e.change}}):e._e(),e.tabid==e.TabID.Filter?r("VFilter",{ref:"vfilter",attrs:{title:e.title,editlist:e.editlist},on:{"update:title":function(t){e.title=t},change:e.change}}):e._e(),e.tabid==e.TabID.Face?r("Face",{ref:"face",attrs:{title:e.title,editlist:e.editlist},on:{"update:title":function(t){e.title=t},change:e.change}}):e._e(),e.tabid==e.TabID.AddImage?r("ImageOverlay",{ref:"imageOverlay",attrs:{title:e.title,options:e.options,postermode:e.postermode,editlist:e.editlist},on:{"update:title":function(t){e.title=t},change:e.change,beforechange:e.beforechange}}):e._e(),e.tabid==e.TabID.AddText?r("TextOverlay",{ref:"textOverlay",attrs:{title:e.title,postermode:e.postermode,accept:e.dialogAccept,editlist:e.editlist,options:e.options},on:{"update:title":function(t){e.title=t},change:e.change,beforechange:e.beforechange}}):e._e(),e.tabid==e.TabID.VideoBase?r("VideoBase",{ref:"videoBase",attrs:{title:e.title,editlist:e.editlist},on:{"update:title":function(t){e.title=t},change:e.change}}):e._e(),e.tabid==e.TabID.AspectRatio?r("AspectRatio",{ref:"aspectRatio",attrs:{title:e.title,editlist:e.editlist},on:{"update:title":function(t){e.title=t},change:e.change}}):e._e()],1),r("div",{staticClass:"bottom-title"},[e.dialogAcceptable?e._e():r("mu-button",{staticClass:"accept-btn",attrs:{flat:"",color:"white"},on:{click:e.close}},[r("mu-icon",{attrs:{value:""}})],1),e.dialogAcceptable?r("mu-button",{staticClass:"close-btn",attrs:{flat:"",color:"white"},on:{click:e.close}},[r("mu-icon",{attrs:{value:"close"}})],1):e._e(),r("div",{staticClass:"title"},[e._v(e._s(e.title))]),e.dialogAcceptable?r("mu-button",{staticClass:"accept-btn",attrs:{flat:"",color:"white"},on:{click:e.accept}},[r("mu-icon",{attrs:{value:"check"}})],1):e._e(),e.dialogAcceptable?e._e():r("mu-button",{staticClass:"accept-btn",attrs:{flat:"",color:"white"},on:{click:e.close}},[r("mu-icon",{attrs:{value:"keyboard_arrow_down"}})],1)],1)]):e._e()])},lt=[],ut=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"audio-base-main",on:{touchend:e.touchend}},[r("span",{staticStyle:{color:"white",width:"100px"}},[e._v("音量("+e._s(e.audio.volume)+")")]),r("mu-slider",{staticStyle:{margin:"0"},attrs:{min:0,max:300,step:1},model:{value:e.audio.volume,callback:function(t){e.$set(e.audio,"volume",t)},expression:"audio.volume"}})],1)},dt=[],ft={props:["title"],data:function(){return{audio:{volume:100}}},methods:{touchend:function(){this.$emit("change")},onDialogClose:function(){this.initState&&this.initState.volume!=this.audio.volume&&U.editlist.createOperateHistory(_.Operate.AudioParamsModify.Type)}},mounted:function(){this.audio=U.editlist.audio,this.$emit("update:title","音量"),this.initState={volume:this.audio.volume}}},pt=ft,ht=(r("78e0"),Object(H["a"])(pt,ut,dt,!1,null,"7da5b59a",null)),mt=ht.exports,vt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{width:"100%",padding:"5px 10px",height:"100%",display:"flex","flex-direction":"column"}},[r("div",{staticStyle:{color:"white",padding:"5px 0"}},[e._v(" 当前背景乐: "),r("span",{staticStyle:{background:"white",color:"gray","border-radius":"3px",padding:"3px 5px"},on:{click:e.remove}},[e._v(e._s(e.bgm&&e.bgm.name||"无")+" "+e._s(e.bgm&&e.bgm.name&&"删除"))])]),r("div",{staticClass:"audio-base-main",staticStyle:{padding:"5px 0"},on:{touchend:e.touchend}},[r("span",{staticStyle:{color:"white",width:"100px","white-space":"nowrap","padding-right":"10px"}},[e._v(" 背景音量("+e._s(e.volume)+") ")]),r("mu-slider",{staticStyle:{margin:"0"},attrs:{min:0,max:300,step:1},model:{value:e.volume,callback:function(t){e.volume=t},expression:"volume"}})],1),r("div",{staticStyle:{"border-top":"1px solid gray",width:"100%",display:"flex"}},[r("HScrollBar",{staticClass:"tabs"},[r("div",{staticClass:"tab",on:{click:e.pickAudio}},[e._v("本地音乐")]),e._l(e.allBGM.filter((function(e){return e.list})),(function(t,n){return r("div",{key:n,staticClass:"tab",class:{active:e.active==n},on:{click:function(t){e.active=n}}},[e._v(e._s(t.name))])}))],2)],1),e._l(e.allBGM.filter((function(e){return e.list})),(function(t,n){return r("div",{directives:[{name:"show",rawName:"v-show",value:e.active==n,expression:"active == idx"}],key:t.name,staticStyle:{height:"100%",overflow:"auto"}},e._l(t.list,(function(n){return r("div",{key:t.name+n.name,staticClass:"bgmItem",class:{active:e.selectedBGMName==n.name},on:{click:function(t){return e.toggleBGM(n)}}},[r("mu-icon",{staticClass:"musicmu-icon",attrs:{size:"14",value:"music_note"}}),r("span",{staticClass:"musicName"},[e._v(e._s(n.name)+" ")]),r("span",{staticClass:"musicDuration"},[e._v(e._s(n.duration))]),n.local_file||n.download?e._e():r("mu-icon",{staticClass:"musicPlaymu-icon",attrs:{value:"arrow_downward"}}),n.download?r("mu-circular-progress",{staticStyle:{zoom:"0.2","margin-left":"10px"},attrs:{value:n.download.percent,size:60,color:"gray","stroke-width":10}}):e._e()],1)})),0)}))],2)},gt=[],bt={components:{HScrollBar:Ye},data:function(){return{active:0,volume:100,allBGM:[],bgm:null}},props:["accept"],computed:{selectedBGMName:function(){return this.bgm?this.bgm.name:"无背景音"}},watch:{accept:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.bgm){r.next=3;break}return t.$parent.close(),r.abrupt("return");case 3:return r.next=5,t.stop();case 5:return r.next=7,new Promise((function(e){var r=function r(){t.bgm.local_file?e():setTimeout(r,200)};r()}));case 7:e&&(n=U.editlist.bgm.url,t.bgm?(U.editlist.bgm.url=t.bgm.local_file.toNativeURL(),U.editlist.bgm.volume=t.volume):U.editlist.bgm.url="",n==U.editlist.bgm.url&&t.volume==t.initState.volume||(t.$emit("change"),U.editlist.bgm.url?n?t.initState.volume!=t.volume&&U.editlist.createOperateHistory(_.Operate.BGMParamsModify.Type):U.editlist.createOperateHistory(_.Operate.BGMSet.Type):U.editlist.createOperateHistory(_.Operate.BGMUnset.Type)),t.$parent.close());case 8:case"end":return r.stop()}}),r)})))()},volume:function(e){this._audio&&(this._audio.volume=Math.min(1,e/100))}},methods:{toggleBGM:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.play(e);case 2:case"end":return r.stop()}}),r)})))()},remove:function(){this.bgm=null,this.stop()},touchend:function(){},stop:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e._audio){t.next=7;break}return e._audio.pause(),e._audio.removeAttribute("src"),e._audio.load(),e._audio.onended&&e._audio.onended(),t.next=7,new Promise((function(e){return setTimeout(e,100)}));case 7:case"end":return t.stop()}}),t)})))()},play:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.bgm=e,e.local_file||e.download){r.next=4;break}return r.next=4,S.downloadRes(S.ResType.music,e);case 4:if(!e.local_file){r.next=14;break}return r.next=7,t.stop();case 7:if(!e.nobgm){r.next=10;break}return t.bgm=null,r.abrupt("return");case 10:return e.playing=!0,r.next=13,new Promise((function(r,n){t._audio=new Audio,t._audio.src=e.local_file.toInternalURL(),t._audio.onended=r,t._audio.onerror=n,t._audio.volume=Math.min(1,t.volume/100),t._audio.play()}));case 13:e.playing=!1;case 14:case"end":return r.stop()}}),r)})))()},pickAudio:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,new Promise(UGCApp.pickAudio.bind(UGCApp));case 2:if(r=t.sent,r.path){t.next=6;break}return e.$mResToast.error("选择失败"),t.abrupt("return");case 6:return t.next=8,e.getLocalAudio("file://"+r.path);case 8:n=t.sent,e.play(n);case 10:case"end":return t.stop()}}),t)})))()},getLocalAudio:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,new Promise(resolveLocalFileSystemURL.bind(window,e));case 2:return r=t.sent,n={name:r.name,local_file:r},t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})))()}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$emit("update:title","背景音乐"),e.$parent.acceptable(),t.next=4,S.fetchResList(S.ResType.music);case 4:if(e.allBGM=t.sent,e.bgm=e.allBGM.flatMap((function(e){return e.list})).filter((function(e){return e.local_file&&e.local_file.toNativeURL()==U.editlist.bgm.url}))[0],e.bgm||!U.editlist.bgm.url){t.next=10;break}return t.next=9,e.getLocalAudio(U.editlist.bgm.url);case 9:e.bgm=t.sent;case 10:e.volume=U.editlist.bgm.volume,e.initState={volume:e.volume};case 12:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){this.stop()}},wt=bt,yt=(r("5637"),Object(H["a"])(wt,vt,gt,!1,null,"4d53dd9b",null)),xt=yt.exports,_t=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"audioEffect"},[r("mu-list",{staticClass:"main",attrs:{value:e.mainActive},on:{change:function(t){e.mainActive=t}}},e._l(e.allAudio,(function(t){return r("mu-list-item",{key:t.name,class:{active:e.mainActive==t.name},attrs:{value:t.name,button:!0}},[r("mu-list-item-title",[e._v(e._s(t.name))])],1)})),1),r("mu-list",{staticClass:"sub"},e._l(e.subList,(function(t){return r("mu-list-item",{key:t.name,attrs:{button:!0},on:{click:function(r){return e.chooseSubItem(t)}}},[r("mu-list-item-title",{staticClass:"subItem",class:{active:e.subActive&&e.subActive.name==t.name}},[t.playing?r("div",{staticClass:"playing"},[r("mu-icon",{staticClass:"icon",attrs:{value:"format_align_left",size:"16"}})],1):r("mu-icon",{attrs:{value:"music_note",size:"16"}}),r("div",{staticClass:"text"},[e._v(e._s(t.name))]),r("div",{staticStyle:{"text-align":"right"}},[t.loading?r("mu-icon",{staticClass:"loading",attrs:{value:"rotate_left",size:"16"}}):r("span",[e._v(e._s(t.duration)+"″")])],1)],1)],1)})),1)],1)},kt=[],Tt={props:["accept"],data:function(){return{mainActive:1,subActive:null,allAudio:[],subList:null}},watch:{mainActive:function(e){var t=this.allAudio.filter((function(t){return t.name==e}))[0];t&&(this.subList=t.list)},accept:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.stop();case 2:e&&t.subActive&&(U.editlist.add_amix(t.subActive),t.$emit("change"),U.editlist.createOperateHistory(_.Operate.AudioEffectAdd.Type)),t.$parent.close();case 4:case"end":return r.stop()}}),r)})))()}},methods:{chooseSubItem:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.subActive=e,t.subActive,r.next=4,t.play(e);case 4:case"end":return r.stop()}}),r)})))()},stop:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e._audio){t.next=7;break}return e._audio.pause(),e._audio.removeAttribute("src"),e._audio.load(),e._audio.onended&&e._audio.onended(),t.next=7,new Promise((function(e){return setTimeout(e,100)}));case 7:case"end":return t.stop()}}),t)})))()},play:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e.local_file||e.download){r.next=3;break}return r.next=3,S.downloadRes(S.ResType.audio,e);case 3:if(!e.local_file){r.next=12;break}return r.next=6,t.stop();case 6:return e.playing=!0,t.subList=t.subList.slice(0),r.next=10,new Promise((function(r,n){t._audio=new Audio,t._audio.src=e.local_file.toInternalURL(),t._audio.onended=r,t._audio.onerror=n,t._audio.play()}));case 10:e.playing=!1,t.subList=t.subList.slice(0);case 12:case"end":return r.stop()}}),r)})))()}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$emit("update:title","音效"),e.$parent.acceptable(),t.next=4,S.fetchResList(S.ResType.audio);case 4:e.allAudio=t.sent,e.mainActive=e.allAudio[0].name;case 6:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){this.stop()}},Ct=Tt,Rt=(r("7953"),r("83a6"),Object(H["a"])(Ct,_t,kt,!1,null,"28f2cb3a",null)),Ot=Rt.exports,Pt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"filter-box"},[r("div",{staticClass:"filter-slider",style:{visibility:e.filter&&e.filter.percent>=0?"":"hidden"}},[r("span",[e._v(e._s(e.filter&&e.filter.name))]),r("mu-slider",{staticClass:"slider",attrs:{min:0,max:100,step:5,color:"red"},model:{value:e.percent,callback:function(t){e.percent=t},expression:"percent"}}),r("span",{staticStyle:{width:"50px","text-align":"center"}},[e._v(e._s(e.percent))])],1),r("mu-tabs",{attrs:{value:e.active,color:"transparent","indicator-color":"red","text-color":"white",left:""},on:{"update:value":function(t){e.active=t}}},e._l(e.allFilter.filter((function(e){return e.list})),(function(t,n){return r("mu-tab",{key:n},[e._v(e._s(t.name))])})),1),r("div",{staticClass:"filter-main"},[r("ClipBtn",{staticClass:"item-btn",class:{active:e.noactive},attrs:{icon:"check",text:"无滤镜"},nativeOn:{click:function(t){return e.toggleEffect()}}}),r("div",{staticStyle:{margin:"10px",height:"60%","border-right":"1px solid gray"}}),e._l(e.allFilter.filter((function(e){return e.list})),(function(t,n){return[e.active==n?r("div",{key:n,staticStyle:{display:"flex"}},e._l(t.list,(function(t){return r("ClipBtn",{key:t.name,staticClass:"item-btn",attrs:{active:e.filter&&t.name==e.filter.name,src:t.thumb_remote_url,text:t.name},nativeOn:{click:function(r){return e.toggleEffect(t)}}},[e.isNeedDownload(t)?r("mu-icon",{staticClass:"downloadmu-icon",attrs:{value:"arrow_downward"}}):e._e(),t.download?r("mu-circular-progress",{staticClass:"loadingmu-icon",staticStyle:{zoom:"0.2","margin-left":"10px"},attrs:{value:t.download.percent,size:60,color:"white","stroke-width":10}}):e._e()],1)})),1):e._e()]}))],2)],1)},At=[],It={components:{ClipBtn:Be},props:["editlist"],data:function(){return{allFilter:[],active:0,percent:100,filter:null}},watch:{percent:function(e){this.editlist.filter_percent=e,this.filter&&(this.filter.percent=e)}},computed:{noactive:function(){return!this.filter}},methods:{isNeedDownload:function(e){return!!(!e.local_file||e.source_list&&e.source_list.filter((function(t,r){return!e.local_file_list[r]})).length)&&!e.download},toggleEffect:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e){r.next=5;break}return t.editlist.filter.length=0,t.editlist.filter_reset="",t.filter=null,r.abrupt("return");case 5:if(t.filter&&e.name==t.filter.name){r.next=10;break}if(!t.isNeedDownload(e)){r.next=9;break}return r.next=9,S.downloadRes(S.ResType.filter,e,(function(t){e.download.percent=Math.ceil(100*t)}));case 9:e.local_file&&(t.editlist.filter.length=0,t.editlist.filter.push(e),t.editlist.filter_reset=[e.local_file.toNativeURL()].concat(Object(u["a"])(e.local_file_list&&e.local_file_list.map((function(e){return e.toNativeURL()}))||[])).map((function(e){return e.replace("file://","")})).join("|"),t.filter=e,e.percent=100);case 10:case"end":return r.stop()}}),r)})))()},onDialogClose:function(){var e=this;if(this.initeState){var t=[this.initeState.filter].concat(Object(u["a"])(this.editlist.filter)).map((function(t){return{oldEnable:e.initeState.filter.find((function(e){return e.name==t.name})),currEnable:e.editlist.filter.find((function(e){return e.name==t.name}))}}));this.editlist.filter.length>2&&t.find((function(e){return e.oldEnable!=e.currEnable}))?this.editlist.createOperateHistory(_.Operate.FilterModify.Type):this.editlist.filter.length<=1&&t[0].currEnable!=t[0].oldEnable?t[0].currEnable?this.editlist.createOperateHistory(_.Operate.FilterEnable.Type):this.editlist.createOperateHistory(_.Operate.FilterDisable.Type):this.percent!=this.initeState.percent&&this.editlist.createOperateHistory(_.Operate.FilterModify.Type)}}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$emit("update:title","滤镜"),t.next=3,S.fetchResList(S.ResType.filter);case 3:e.allFilter=t.sent,e.editlist.filter.length&&e.allFilter.forEach((function(t){var r=t.list&&t.list.filter((function(t){return t.name==e.editlist.filter[0].name}))[0];r&&(e.filter=r)})),e.initState={percent:e.editlist.filter_percent,filter:f()(!0,[],e.editlist.filter)};case 6:case"end":return t.stop()}}),t)})))()}},St=It,Mt=(r("6901"),Object(H["a"])(St,Pt,At,!1,null,"6272fdad",null)),Et=Mt.exports,jt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"image-main"},[r("ScrollTab",{attrs:{value:e.active,color:"transparent","indicator-color":"red","text-color":"white",left:""},on:{"update:value":function(t){e.active=t}}},e._l(e.allSticker,(function(t,n){return r("mu-tab",{key:n},[e._v(e._s(t.name))])})),1),e._l(e.allSticker,(function(t,n){return r("div",{directives:[{name:"show",rawName:"v-show",value:e.active==n,expression:"active == idx"}],key:n,staticClass:"tab-box"},e._l(t.list,(function(t){return r("div",{key:t.name,staticClass:"stickerItem",on:{click:function(r){return e.chooseSticker(t)}}},[r("img",{attrs:{loop:"0",src:t.thumb_remote_url+"/"+t.source+".thumb.apng"}}),t.local_file||t.download?e._e():r("mu-icon",{staticClass:"downloadmu-icon",attrs:{value:"arrow_downward"}}),t.download?r("mu-circular-progress",{staticClass:"loadingmu-icon",staticStyle:{zoom:"0.2","margin-left":"10px"},attrs:{value:t.download.percent,size:60,color:"white","stroke-width":10}}):e._e()],1)})),0)}))],2)},$t=[],Dt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("HScrollBar",{staticClass:"scroll-tab",attrs:{scroller:e.scroller}},[r("mu-tabs",e._b({ref:"tab",on:{"update:value":function(t){return e.$emit("update:value",t)},change:function(t){e.fixTab(t),e.$emit("change",t)}}},"mu-tabs",e.$attrs,!1),[e._t("default")],2)],1)},Lt=[],Ut={components:{HScrollBar:Ye},data:function(){return{scroller:null}},methods:{fixTab:function(e){var t=this.$refs.tab.$el,r=t.querySelector(".mu-tab-link-highlight"),n=t.children[e].offsetLeft;t.children[e].scrollIntoView(!0),this.$nextTick((function(){var e=r.style.cssText;r.style.cssText=e.replace(/(translate\().*,/,"$1"+n+"px,")}))}},mounted:function(){var e=this;this.$nextTick((function(){e.scroller=e.$refs.tab.$el}))}},Ft=Ut,Bt=(r("0f20"),Object(H["a"])(Ft,Dt,Lt,!1,null,null,null)),Ht=Bt.exports,Xt={props:["editlist","postermode"],components:{ScrollTab:Ht},data:function(){return{active:0,allSticker:[]}},methods:{chooseSticker:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e.local_file||e.download){r.next=3;break}return r.next=3,S.downloadRes(S.ResType.image,e,(function(t){e.download.percent=Math.ceil(100*t)}));case 3:e.local_file&&(t.$emit("beforechange",{overlay:n}),n=t.editlist.add_overlay({end_sec:+e.duration,url:e.local_file.toURL(),type:_.Overlay.Type.Image},t.postermode),t.$emit("change",{overlay:n}),t.editlist.createOperateHistory(_.Operate.ImageAdd.Type,n.id));case 4:case"end":return r.stop()}}),r)})))()}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,S.fetchResList(S.ResType.image);case 2:e.allSticker=t.sent,window.console.log("allsticker:",e.allSticker),e.$emit("update:title","贴纸");case 5:case"end":return t.stop()}}),t)})))()}},zt=Xt,Nt=(r("475a"),Object(H["a"])(zt,jt,$t,!1,null,"7a96ab86",null)),Gt=Nt.exports,Vt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"textOverlay"},[r("TextRender",e._b({directives:[{name:"show",rawName:"v-show",value:e.overlay.text,expression:"overlay.text"}],ref:"textRender",staticClass:"text-render"},"TextRender",e.overlay,!1)),r("mu-tabs",{attrs:{value:e.active,color:"transparent","indicator-color":"red","text-color":"white",left:""},on:{"update:value":function(t){e.active=t}}},[r("mu-tab",{attrs:{value:e.TabID.Edit}},[r("mu-icon",{attrs:{value:"keyboard"}}),e._v(" 文字 ")],1),r("mu-tab",{attrs:{value:e.TabID.Template}},[r("mu-icon",{attrs:{value:"extension"}}),e._v(" 样式 ")],1),r("mu-tab",{attrs:{value:e.TabID.Settings}},[r("mu-icon",{attrs:{value:"tune"}}),e._v(" 调整 ")],1)],1),r("div",{directives:[{name:"show",rawName:"v-show",value:e.active==e.TabID.Edit,expression:"active == TabID.Edit"}]},[r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.overlay.text,expression:"overlay.text"}],ref:"input",staticStyle:{width:"100%",border:"1px solid #666","border-radius":"5px","font-size":"16px",height:"32px","line-height":"2",padding:"0 10px"},style:e.inputStyles,attrs:{type:"text",placeholder:"请输入文本"},domProps:{value:e.overlay.text},on:{input:function(t){t.target.composing||e.$set(e.overlay,"text",t.target.value)}}})]),r("div",{directives:[{name:"show",rawName:"v-show",value:e.active==e.TabID.Template,expression:"active == TabID.Template"}]},[r("mu-tabs",{attrs:{value:e.templateActive,color:"transparent","indicator-color":"rgba(255,255,255,0.3)","text-color":"white",left:""},on:{"update:value":function(t){e.templateActive=t}}},e._l(e.allBg,(function(t){return r("mu-tab",{key:t.name,attrs:{value:t.name}},[e._v(" "+e._s(t.name)+" ")])})),1),e._l(e.allBg,(function(t){return r("div",{directives:[{name:"show",rawName:"v-show",value:e.templateActive==t.name,expression:"templateActive == e.name"}],key:t.name,staticClass:"y-scroller stickerList",attrs:{value:t.name}},[r("div",{staticClass:"stickerItem none",on:{click:e.clearTemplate}},[r("mu-icon",{attrs:{value:"block",size:"24",color:"#eee"}})],1),e._l(t.list,(function(t,n){return r("div",{key:n,staticClass:"stickerItem",class:{active:t.name==e.overlay.templateName},on:{click:function(r){return e.chooseBubble(t)}}},[r("img",{attrs:{src:t.thumb_remote_url}}),t.local_file||t.download?e._e():r("mu-icon",{staticClass:"downloadmu-icon",attrs:{value:"arrow_downward"}}),t.download?r("mu-circular-progress",{staticClass:"loadingmu-icon",staticStyle:{zoom:"0.2","margin-left":"10px"},attrs:{value:t.download.percent,size:60,color:"white","stroke-width":10}}):e._e()],1)}))],2)}))],2),r("div",{directives:[{name:"show",rawName:"v-show",value:e.active==e.TabID.Settings,expression:"active == TabID.Settings"}]},[r("div",{staticClass:"scroller"},[r("div",{staticClass:"stickerList nowrap"},[r("div",{staticClass:"stickerItem fontItem",class:{active:null==e.overlay.font},on:{click:e.clearFont}},[e._v("系统字体")]),e._l(e.allFont,(function(t,n){return r("div",{key:n,staticClass:"stickerItem fontItem",class:{active:t.family==e.overlay.font},on:{click:function(r){return e.chooseFont(t)}}},[r("img",{attrs:{src:t.thumb_remote_url}}),t.local_file||t.download?e._e():r("mu-icon",{staticClass:"downloadmu-icon",attrs:{value:"arrow_downward"}}),t.download?r("mu-circular-progress",{staticClass:"loadingmu-icon",staticStyle:{zoom:"0.2","margin-left":"10px","line-height":"0"},attrs:{value:t.download.percent,size:50,color:"white","stroke-width":10}}):e._e()],1)}))],2)]),r("div",{staticClass:"stickerList align"},[r("mu-icon",{staticClass:"alignItem",class:{active:e.Const.Overlay.Align.Left==e.overlay.align},attrs:{value:"format_align_left"},on:{click:function(t){return e.chooseAlign(e.Const.Overlay.Align.Left)}}}),r("mu-icon",{staticClass:"alignItem",class:{active:e.Const.Overlay.Align.Center==e.overlay.align},attrs:{value:"format_align_center"},on:{click:function(t){return e.chooseAlign(e.Const.Overlay.Align.Center)}}}),r("mu-icon",{staticClass:"alignItem",class:{active:e.Const.Overlay.Align.Right==e.overlay.align},attrs:{value:"format_align_right"},on:{click:function(t){return e.chooseAlign(e.Const.Overlay.Align.Right)}}})],1),r("div",[r("mu-tabs",{attrs:{value:e.colorTabActive,color:"transparent","indicator-color":"rgba(255,255,255,0.3)","text-color":"white",left:""},on:{"update:value":function(t){e.colorTabActive=t}}},[r("mu-tab",{attrs:{value:"文字颜色"}},[e._v("文字颜色")]),r("mu-tab",{attrs:{value:"描边"}},[e._v("描边")]),r("mu-tab",{attrs:{value:"阴影"}},[e._v("阴影")]),r("mu-tab",{attrs:{value:"背景"}},[e._v("背景")])],1),r("div",{directives:[{name:"show",rawName:"v-show",value:"文字颜色"==e.colorTabActive,expression:"colorTabActive == '文字颜色'"}]},[r("div",{staticClass:"stickerList nowrap colorList scroller"},e._l(e.ColorPreset,(function(t,n){return r("div",{key:n,staticClass:"colorItem",class:{active:t==e.overlay.color},style:{background:t},on:{click:function(r){e.overlay.color=t}}})})),0),r("div",{staticClass:"bottomSlider"},[r("label",{staticClass:"label"},[e._v("透明度")]),r("mu-slider",{staticClass:"slider",attrs:{"track-color":"#666",max:1,min:0,step:.01},model:{value:e.overlay.transparent,callback:function(t){e.$set(e.overlay,"transparent",t)},expression:"overlay.transparent"}})],1)]),r("div",{directives:[{name:"show",rawName:"v-show",value:"描边"==e.colorTabActive,expression:"colorTabActive == '描边'"}]},[r("div",{staticClass:"stickerList nowrap colorList scroller"},[r("div",{staticClass:"colorItem none",on:{click:function(t){e.overlay.borderColor=null}}},[e._v(" 无 ")]),e._l(e.ColorPreset,(function(t,n){return r("div",{key:n,staticClass:"colorItem",class:{active:t==e.overlay.borderColor},style:{background:t},on:{click:function(r){e.overlay.borderColor=t}}})}))],2),r("div",{staticClass:"bottomSlider"},[r("label",{staticClass:"label"},[e._v("粗细")]),r("mu-slider",{staticClass:"slider",attrs:{"track-color":"#666",max:5,min:1,step:.01},model:{value:e.overlay.borderSize,callback:function(t){e.$set(e.overlay,"borderSize",t)},expression:"overlay.borderSize"}})],1)]),r("div",{directives:[{name:"show",rawName:"v-show",value:"阴影"==e.colorTabActive,expression:"colorTabActive == '阴影'"}]},[r("div",{staticClass:"stickerList nowrap colorList scroller"},[r("div",{staticClass:"colorItem none",on:{click:function(t){e.overlay.shadowColor=null}}},[e._v(" 无 ")]),e._l(e.ColorPreset,(function(t,n){return r("div",{key:n,staticClass:"colorItem",class:{active:t==e.overlay.shadowColor},style:{background:t},on:{click:function(r){e.overlay.shadowColor=t}}})}))],2),r("div",{staticClass:"bottomSlider"},[r("label",{staticClass:"label"},[e._v("强度")]),r("mu-slider",{staticClass:"slider",attrs:{"track-color":"#666",max:10,min:0,step:.01},model:{value:e.overlay.shadowLevel,callback:function(t){e.$set(e.overlay,"shadowLevel",t)},expression:"overlay.shadowLevel"}})],1)]),r("div",{directives:[{name:"show",rawName:"v-show",value:"背景"==e.colorTabActive,expression:"colorTabActive == '背景'"}]},[r("div",{staticClass:"stickerList nowrap colorList scroller"},[r("div",{staticClass:"colorItem none",on:{click:function(t){e.overlay.backgroundColor=null}}},[e._v(" 无 ")]),e._l(e.ColorPreset,(function(t,n){return r("div",{key:n,staticClass:"colorItem",class:{active:t==e.overlay.backgroundColor},style:{background:t},on:{click:function(r){e.overlay.backgroundColor=t}}})}))],2),r("div",{staticClass:"bottomSlider"},[r("label",{staticClass:"label"},[e._v("透明度")]),r("mu-slider",{staticClass:"slider",attrs:{"track-color":"#666",max:1,min:0,step:.01},model:{value:e.overlay.backgroundTransparent,callback:function(t){e.$set(e.overlay,"backgroundTransparent",t)},expression:"overlay.backgroundTransparent"}})],1)])],1)])],1)},Yt=[],qt=(r("2b3d"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"box"},[r("div",{staticClass:"border"},[e.loading?r("mu-icon",{staticClass:"loading",attrs:{value:"refresh",size:"30"}}):e._e(),r("canvas",{ref:"canvas",staticClass:"main",style:e.canvasStyles,attrs:{width:"1024",height:"500"}})],1)])}),Wt=[],Jt=r("cdd9"),Kt=r.n(Jt),Qt=r("84a2"),Zt=r.n(Qt),er=r("32a2"),tr=1e3,rr="黑体",nr={props:["text","font","fontUrl","align","color","transparent","borderColor","borderSize","shadowColor","shadowLevel","backgroundColor","backgroundTransparent","templateName","templateBgUrl","endX","endY","startX","startY","wordCount"],watch:{text:"delayRefresh",font:"delayRefresh",fontUrl:"delayRefresh",align:"delayRefresh",color:"delayRefresh",transparent:"delayRefresh",borderColor:"delayRefresh",borderSize:"delayRefresh",shadowColor:"delayRefresh",shadowLevel:"delayRefresh",backgroundColor:"delayRefresh",backgroundTransparent:"delayRefresh",templateBgUrl:"delayRefresh",startX:"delayRefresh",startY:"delayRefresh",endX:"delayRefresh",endY:"delayRefresh",wordCount:"delayRefresh"},data:function(){var e=this;return{loading:!1,delayRefresh:Zt()((function(){e.$refs.canvas&&e.refresh()}),200,{leading:!1,trailing:!0}),textSize:tr,textAreaWidth:0,textAreaHeight:0,textLines:[]}},computed:{canvasStyles:function(){return{"max-height":this.templateBgUrl?"80px":this.isHorizontal?"50px":"120px"}}},methods:{refresh:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i,a,s,o,c,l,u,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.$refs.canvas,n=e.canvasCtx,t.next=4,e._loadFont();case 4:if(!e.templateBgUrl){t.next=16;break}return t.next=7,new Promise((function(t,r){var n=new Image;n.onload=function(){return t(n)},n.onerror=r,n.crossOrigin="anonymous",n.src=e.templateBgUrl}));case 7:i=t.sent,r.width=i.naturalWidth,r.height=i.naturalHeight,n.clearRect(0,0,r.width,r.height),e.backgroundColor&&(n.fillStyle=Kt()(e.backgroundColor,1-e.backgroundTransparent),n.fillRect(0,0,r.width,r.height)),i&&i.width&&n.drawImage(i,0,0,r.width,r.height),e.text.length&&(a={x:i.naturalWidth*e.startX,y:i.naturalHeight*e.startY,width:i.naturalWidth*(e.endX-e.startX),height:i.naturalHeight*(e.endY-e.startY)},s=e.drawText(e.text,a,{textAlign:e.align==_.Overlay.Align.Left?"left":e.align==_.Overlay.Align.Right?"right":e.align==_.Overlay.Align.Top?"top":"center"}),n.drawImage(s,a.x,a.y)),t.next=22;break;case 16:o=e.text.split("\n"),c=o.reduce((function(e,t){return Math.max(e,t.replace(/[^\x0-\xff]/g,"xx").length/2)}),0),l=e.text,e.align==_.Overlay.Align.Top?(r.width=Math.ceil(tr/c*o.length),r.height=tr):(r.width=tr,r.height=Math.ceil(tr/c*o.length)),e.backgroundColor&&(n.fillStyle=Kt()(e.backgroundColor,1-e.backgroundTransparent),n.fillRect(0,0,r.width,r.height)),e.text.length&&(u={x:0,y:0,width:r.width,height:r.height},d=e.drawText(l,u,{lineBreak:"word",textAlign:e.align==_.Overlay.Align.Left?"left":e.align==_.Overlay.Align.Right?"right":e.align==_.Overlay.Align.Top?"top":"center"}),n.drawImage(d,u.x,u.y));case 22:case"end":return t.stop()}}),t)})))()},drawText:function(e,t,r){var n=document.createElement("canvas"),i=n.getContext("2d");return n.width=t.width,n.height=t.height,i.shadowColor=this.shadowColor,i.strokeStyle=this.borderColor,i.fillStyle=Kt()(this.color,1-this.transparent),e&&Object(er["a"])(n,e,Object(m["a"])({textAlign:"center",verticalAlign:"middle",sizeToFill:!0,strokeText:!0,renderHDPI:!1,font:"10px "+(this.font||rr),lineWidth:.05*this.borderSize/5,shadowBlur:.5*this.shadowLevel/10,paddingX:Math.min(t.width,t.height)/20,paddingY:Math.min(t.width,t.height)/20},r)),n},_loadFont:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.fontUrl){t.next=11;break}if(!document.fonts){t.next=8;break}return r=new FontFace(e.font,"url("+e.fontUrl+")"),t.next=5,r.load();case 5:document.fonts.add(r),t.next=11;break;case 8:n=document.createElement("style"),n.appendChild(document.createTextNode("                        @font-face {                        font-family: '"+e.font+"';                        src: url('"+e.fontUrl+"');                        }                    ")),document.head.appendChild(n);case 11:case"end":return t.stop()}}),t)})))()},getDataPng:function(){return this.$refs.canvas.toDataURL()},getBlob:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,r=null,n=new Date,t.prev=3,t.next=6,new Promise((function(t){e.$refs.canvas.toBlob(t)}));case 6:r=t.sent;case 7:return t.prev=7,e.loading=!1,window.console.log("blob time:",new Date-n),t.finish(7);case 11:return t.abrupt("return",r);case 12:case"end":return t.stop()}}),t,null,[[3,,7,11]])})))()}},mounted:function(){this.canvasCtx=this.$refs.canvas.getContext("2d"),this.refresh()}},ir=nr,ar=(r("fab43"),Object(H["a"])(ir,qt,Wt,!1,null,"765fb19e",null)),sr=ar.exports,or=(r("2095"),r("d4ea"));a["default"].use(or["a"]);var cr=0,lr={Edit:cr++,Template:cr++,Settings:cr++},ur=["#ffffff","#ff0000","#0000ff","#00ff00","#ff0000","#FFC0CB","#FFA500","#777777","#770000","#000077","#007700","#777700","#770077","#775533"],dr={TabID:lr,props:["editlist","accept","postermode","options"],components:{TextRender:sr},data:function(){var e=this.newOverlay();return{TabID:lr,ColorPreset:ur,Const:_,active:lr.Edit,colorTabActive:0,templateActive:0,isApplyToAll:!1,allTemplateWord:[],allBg:[],allFont:[],overlay:e,overlayProps:Object.keys(e).filter((function(e){return"text"!=e}))}},watch:{options:"handleOptions",active:function(){var e=this;this.categoryActive=0,this.$nextTick((function(){e.active==lr.Edit?e.$refs.input.focus():e.$refs.input.blur()}))},accept:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a,s,o,c,l,u,d;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=!0,e&&t.overlayInitialState&&(n=Object.keys(t.overlayInitialState).find((function(e){return t.overlayInitialState[e]!=t.overlay[e]}))),!(e&&n&&t.overlay.text)){r.next=22;break}return a=t.overlay,s=!a.id,t.$emit("beforechange",{overlay:a}),null==t.overlay.id&&(a=t.editlist.add_overlay(t.overlay,t.postermode)),o=null,c=function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$refs.textRender.getBlob();case 2:if(o=e.sent,null!=o){e.next=7;break}return e.next=6,new Promise((function(e){t.$nextTick((function(){return c().then(e)}))}));case 6:return e.abrupt("return");case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r.next=11,c();case 11:return r.next=13,S.getTempFolder();case 13:return l=r.sent,u=l.name+"/textImage_"+a.id+"_"+Math.random().toString(16).replace("0.","")+".png",r.next=17,t.createCacheFile(o,u);case 17:d=r.sent,a.url=d+"?"+Math.random(),t.overlay=a,t.$emit("change",{overlay:a}),t.postermode||(s?t.editlist.createOperateHistory(_.Operate.TextAdd.Type,a.id):t.editlist.createOperateHistory(_.Operate.TextModify.Type));case 22:t.$parent.close();case 23:case"end":return r.stop()}}),r)})))()}},computed:{inputStyles:function(){var e=Math.min(this.overlay.text.split(/\n/).length,3);return{height:(e<=1?36:20*e+8)+"px","line-height":(e<=1?36:20)+"px"}}},methods:{clearTemplate:function(){this.overlay.templateName=null,this.overlay.templateBgUrl=null,this.overlay.startX=0,this.overlay.startY=0,this.overlay.endX=0,this.overlay.endY=0,this.overlay.wordCount=0},chooseTemplate:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.templateName=e.name;case 1:case"end":return r.stop()}}),r)})))()},chooseBubble:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!window.requestFileSystem){r.next=7;break}if(e.local_file||e.download){r.next=4;break}return r.next=4,S.downloadRes(S.ResType.fontbg,e);case 4:e.local_file&&(t.overlay.templateBgUrl=e.local_file.toInternalURL()),r.next=8;break;case 7:t.overlay.templateBgUrl=e.source_remote_url;case 8:t.overlay.templateBgUrl&&t.setBackground(e);case 9:case"end":return r.stop()}}),r)})))()},clearFont:function(){this.overlay.font=null,this.overlay.fontUrl=null},setBackground:function(e){this.overlay.templateName=e.name,this.overlay.startX=e.startX,this.overlay.startY=e.startY,this.overlay.endX=e.endX,this.overlay.endY=e.endY,this.overlay.wordCount=e.wordCount},chooseFont:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!window.requestFileSystem){r.next=7;break}if(e.local_file){r.next=4;break}return r.next=4,S.downloadRes(S.ResType.font,e);case 4:e.local_file&&(t.overlay.fontUrl=e.local_file.toInternalURL()),r.next=8;break;case 7:t.overlay.fontUrl=e.source_remote_url;case 8:t.overlay.fontUrl&&(t.overlay.font=e.family);case 9:case"end":return r.stop()}}),r)})))()},chooseAlign:function(e){this.overlay.align=e},newOverlay:function(){return{type:_.Overlay.Type.Text,text:"",font:null,fontUrl:null,color:"grey",borderColor:null,shadowColor:null,backgroundColor:null,align:_.Overlay.Align.Left,transparent:0,borderSize:1,shadowLevel:1,backgroundTransparent:0,templateName:"",templateBgUrl:null,startX:0,startY:0,endX:0,endY:0,wordCount:0}},updateOverlay:function(e){this.overlay=e},createCacheFile:function(e,t){return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(window.requestFileSystem){r.next=2;break}return r.abrupt("return",URL.createObjectURL(e));case 2:return r.next=4,S.filesystem();case 4:return n=r.sent,r.next=7,new Promise((function(e,r){n.root.getFile(t,{create:!0,exclusive:!1},e,r)}));case 7:return i=r.sent,r.next=10,new Promise((function(e,t){i.createWriter(e,t)}));case 10:return a=r.sent,r.next=13,new Promise((function(t,r){a.onwriteend=t,a.onerror=r,a.write(e)}));case 13:return r.abrupt("return",i.nativeURL);case 14:case"end":return r.stop()}}),r)})))()},handleOptions:function(){var e=this.options;if(e)switch(e.operateToolTabId){case ot.TabID.ToolEdit:this.active=lr.Edit;break;case ot.TabID.ToolTemplate:this.active=lr.Template;break;case ot.TabID.ToolSettings:this.active=lr.Settings;break;default:break}e&&e.overlay?(this.updateOverlay(e.overlay),this.overlayInitialState=f()(!0,{},e.overlay)):(this.overlay=this.newOverlay(),this.overlayInitialState=null)},applyToAll:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isApplyToAll){t.next=6;break}return r=e.overlay,n=e.editlist.overlay.map(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(n){var i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n.type!=_.Overlay.Type.Text||n.id==r.id){t.next=19;break}return e.overlayProps.forEach((function(e){n[e]=r[e]})),e.overlay=n,t.prev=3,window.console.log("applyToAll start "+n.id),e.$refs.textRender.refresh(),t.next=8,e.$refs.textRender.getBlob();case 8:return i=t.sent,t.next=11,e.createCacheFile(i,"textImage_"+n.id+".png");case 11:a=t.sent,n.url=a,window.console.log("applyToAll end"),t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](3),window.console.log("applyToAll error",t.t0);case 19:case"end":return t.stop()}}),t,null,[[3,16]])})));return function(e){return t.apply(this,arguments)}}()),t.next=5,Promise.all(n);case 5:e.editlist.overlay.forEach((function(e){return window.console.log(e.id,e.text)}));case 6:case"end":return t.stop()}}),t)})))()}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.handleOptions(),e.$parent.acceptable(),e.$refs.input.focus(),t.next=5,S.fetchResList(S.ResType.font);case 5:return e.allFont=t.sent,t.next=8,S.fetchResList(S.ResType.fontbg);case 8:e.allBg=t.sent,e.$emit("update:title","贴字");case 10:case"end":return t.stop()}}),t)})))()}},fr=dr,pr=(r("c5b1"),r("031c"),Object(H["a"])(fr,Vt,Yt,!1,null,"b4f62e66",null)),hr=pr.exports,mr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"videobase-item"},[r("span",[e._v("亮度("+e._s(e.eq.brightness)+")")]),r("mu-slider",{attrs:{min:-1,max:1,step:.02},on:{change:e.change},model:{value:e.eq.brightness,callback:function(t){e.$set(e.eq,"brightness",t)},expression:"eq.brightness"}})],1),r("div",{staticClass:"videobase-item"},[r("span",[e._v("对比度("+e._s(e.eq.contrast)+")")]),r("mu-slider",{attrs:{min:0,max:5,step:.05},on:{change:e.change},model:{value:e.eq.contrast,callback:function(t){e.$set(e.eq,"contrast",t)},expression:"eq.contrast"}})],1),r("div",{staticClass:"videobase-item"},[r("span",[e._v("饱和度("+e._s(e.eq.saturation)+")")]),r("mu-slider",{attrs:{min:0,max:3,step:.03},on:{change:e.change},model:{value:e.eq.saturation,callback:function(t){e.$set(e.eq,"saturation",t)},expression:"eq.saturation"}})],1),r("div",{staticClass:"videobase-item"},[r("span",[e._v("伽马值("+e._s(e.eq.gamma)+")")]),r("mu-slider",{attrs:{min:.1,max:10,step:.1},on:{change:e.change},model:{value:e.eq.gamma,callback:function(t){e.$set(e.eq,"gamma",t)},expression:"eq.gamma"}})],1),r("div",{staticStyle:{"text-align":"center"}},[r("mu-button",{attrs:{small:""},on:{click:e.resumeNormal}},[e._v(" 恢复默认 ")])],1)])},vr=[],gr={data:function(){return{eq:{brightness:0,contrast:0,saturation:0,gamma:0}}},methods:{resumeNormal:function(){this.eq.brightness=0,this.eq.contrast=1,this.eq.saturation=1,this.eq.gamma=1,this.change()},change:function(){U.editlist.update_timeline_videobase(U.editlist.cur_timeline)},onDialogClose:function(){var e=this;this.initState&&Object.keys(this.eq).find((function(t){return e.eq[t]!=e.initState.eq[t]}))&&U.editlist.createOperateHistory(_.Operate.VideoParamsModify.Type)}},mounted:function(){this.eq=U.editlist.cur_timeline.eq,this.$emit("update:title","视频参数"),this.initState={eq:f()(!0,{},this.eq)}}},br=gr,wr=(r("f6e1"),Object(H["a"])(br,mr,vr,!1,null,"4f58663e",null)),yr=wr.exports,xr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"sort_main"},[r("Container",{staticClass:"sort_box",attrs:{"auto-scroll-enabled":!1,orientation:"horizontal","drag-begin-delay":200},on:{drop:e.onDrop}},[e._l(e.timelines,(function(t){return[t.ending?e._e():r("Draggable",{key:t.id,staticClass:"sort_item"},[r("div",{staticClass:"sort_head"},[e._v(e._s((t.end_sec-t.start_sec).toFixed(1)))]),r("div",{staticClass:"sort_thumb"},[t.thumbs.length&&t.thumbs[0].url?r("img",{attrs:{src:t.thumbs[0].url}}):e._e()])])]}))],2),r("div",{staticClass:"sort_tip"},[e._v(" 长按拖动改变顺序 ")])],1)},_r=[],kr=r("3f7d"),Tr={props:["accept"],components:{Container:kr["Container"],Draggable:kr["Draggable"]},data:function(){return{timelines:[]}},watch:{accept:function(e){var t=this;e&&(U.editlist.update_timelines(this.timelines),U.editlist.timelines=this.timelines,this.$emit("change","sort"),this.initState.timelines.find((function(e,r){return t.timelines[r].id!=e.id}))&&U.editlist.createOperateHistory(_.Operate.VideoSort.Type)),this.$parent.close()}},methods:{onDrop:function(e){var t=e.removedIndex,r=e.addedIndex,n=e.payload;if(null!==t||null!==r){var i=Object(u["a"])(this.timelines),a=n;null!==t&&(a=i.splice(t,1)[0]),null!==r&&i.splice(r,0,a),this.timelines=i}}},mounted:function(){this.timelines=U.editlist.timelines,this.$emit("update:title","排序"),this.$parent.acceptable(),this.initState={timelines:f()(!0,[],this.timelines)}}},Cr=Tr,Rr=(r("e65f"),r("aa9c"),Object(H["a"])(Cr,xr,_r,!1,null,"c791ff4c",null)),Or=Rr.exports,Pr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"face-main"},[r("mu-switch",{attrs:{color:"red"},model:{value:e.enabled,callback:function(t){e.enabled=t},expression:"enabled"}}),r("span",{staticStyle:{color:"white",width:"100px"}},[e._v("美颜级别")]),r("mu-slider",{staticStyle:{margin:"0"},attrs:{disabled:!e.enabled,min:0,max:10,step:1},model:{value:e.face.level,callback:function(t){e.$set(e.face,"level",t)},expression:"face.level"}}),r("div",{staticStyle:{width:"50px","text-align":"center"}},[e._v(e._s(e.face.level))])],1)},Ar=[],Ir={data:function(){return{enabled:!1,face:{level:10}}},watch:{enabled:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t){e.next=4;break}U.editlist.beauty_level=0,e.next=10;break;case 4:if(0==this.face.level&&(this.face.level=10),U.editlist.face.beauty_source){e.next=9;break}return e.next=8,S.getBeautySource();case 8:U.editlist.beauty_source=e.sent;case 9:U.editlist.beauty_level=this.face.level;case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),"face.level":function(e){U.editlist.beauty_level=e}},methods:{onDialogClose:function(){this.initeState&&(this.initeState.enable!=this.enabled?this.enabled?U.editlist.createOperateHistory(_.Operate.FilterEnable.Type):U.editlist.createOperateHistory(_.Operate.FilterDisable.Type):this.initeState.level!=U.editlist.beauty_level&&U.editlist.createOperateHistory(_.Operate.FilterModify.Type))}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$emit("update:title","美颜"),e.enabled=U.editlist.face.beauty_level>0,e.face.level=U.editlist.face.beauty_level,e.initeState={enabled:e.enabled,level:e.face.level};case 4:case"end":return t.stop()}}),t)})))()}},Sr=Ir,Mr=(r("b164"),Object(H["a"])(Sr,Pr,Ar,!1,null,"b33073c6",null)),Er=Mr.exports,jr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"aspect-box"},[r("div",[r("ClipBtn",{staticClass:"item-btn",attrs:{active:!e.curAspectRatio,icon:"phonelink_lock",text:"原始"},nativeOn:{click:function(t){return e.choose(null)}}}),e._l(e.AspectRatio,(function(t,n){return r("ClipBtn",{key:t[0]+":"+t[1],staticClass:"item-btn",attrs:{active:e.curAspectRatio==t,src:e.AspectRatioIcon[n],text:t[0]+":"+t[1]},nativeOn:{click:function(r){return e.choose(t)}}})}))],2)])},$r=[],Dr=[[9,16],[16,9],[1,1],[3,4],[4,3]];function Lr(e){return Ur.apply(this,arguments)}function Ur(){return Ur=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var r,n,i,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=30,n=100,i=document.createElement("canvas"),i.width=n+2*r,i.height=n+2*r,a=i.getContext("2d"),a.fillStyle="white",s=t[0]/t[1],s>1?a.fillRect(r,r+(n-n/s)/2,n,n/s):a.fillRect(r+(n-n*s)/2,r,n*s,n),e.t0=URL,e.next=12,new Promise(i.toBlob.bind(i));case 12:return e.t1=e.sent,e.abrupt("return",e.t0.createObjectURL.call(e.t0,e.t1));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),Ur.apply(this,arguments)}var Fr={components:{ClipBtn:Be},props:["editlist"],data:function(){return{AspectRatio:Dr,AspectRatioIcon:[],curAspectRatio:null}},methods:{choose:function(e){this.curAspectRatio!=e&&(this.curAspectRatio=e,this.editlist.video.dar=e||U.DARPreset.auto,this.$emit("change"))},onDialogClose:function(){this.initState&&this.initState.aspectRatio!=this.curAspectRatio&&this.editlist.createOperateHistory(_.Operate.VideoAspect.Type)}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$emit("update:title","画幅比例"),t.next=3,Lr(Dr);case 3:e.AspectRatioIcon=t.sent,e.curAspectRatio=Dr.filter((function(t){return t.join(":")==e.editlist.video.dar.join(":")}))[0],e.initState={aspectRatio:e.curAspectRatio};case 6:case"end":return t.stop()}}),t)})))()}},Br=Fr,Hr=(r("d213"),Object(H["a"])(Br,jr,$r,!1,null,"6c3aa489",null)),Xr=Hr.exports,zr={components:{AudioBase:mt,BGM:xt,AudioEffect:Ot,VFilter:Et,ImageOverlay:Gt,TextOverlay:hr,VideoBase:yr,Sort:Or,Face:Er,AspectRatio:Xr},props:["editlist","postermode"],data:function(){return{tabid:-1,title:"",dialogAccept:!1,dialogAcceptable:!1,TabID:ot.TabID,options:null}},computed:{style:function(){var e={height:"auto"};return this.options&&this.options.height&&(e.position="absolute",e.height=this.options.height),e}},methods:{show:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.title="",this.dialogAccept=!1,this.dialogAcceptable=!1,this.tabid=e,this.options=Object(m["a"])({},t)},beforechange:function(e){this.$emit("beforechange",e)},change:function(e){this.$emit("change",e,this.tabid)},acceptable:function(){this.dialogAcceptable=!0},close:function(){this.dialogAccept=!1,this.triggerClose(),this.tabid=-1},accept:function(){this.dialogAccept=!0},triggerClose:function(){var e=this;Object.keys(this.$refs).forEach((function(t){e.$refs[t]&&e.$refs[t].onDialogClose&&e.$refs[t].onDialogClose()}))}}},Nr=zr,Gr=(r("1539"),Object(H["a"])(Nr,ct,lt,!1,null,"1f0d95ac",null)),Vr=Gr.exports,Yr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"resize",rawName:"v-resize",value:e.updateUISize,expression:"updateUISize"}],ref:"mainbox",on:{click:e.boxClick}},[e.overlay?r("div",{ref:"main",staticClass:"clip_img",style:e.style,attrs:{tabindex:"-1"},on:{touchstart:e.touchstart,touchmove:e.touchmove,touchend:e.hideMagnet,touchcancel:e.hideMagnet}},[r("img",{directives:[{name:"show",rawName:"v-show",value:e.loaded,expression:"loaded"}],key:e.url,ref:"img",staticClass:"img",attrs:{src:e.url+"?"+e.overlay.id},on:{load:e.imgLoaded,error:e.imgLoadError}}),r("div",{staticClass:"border"}),r("div",{staticClass:"remove-btn item-btn",on:{click:e.remove}},[r("mu-icon",{attrs:{value:"close"}})],1),e.edit_filter&&e.edit_filter(e.overlay)?r("div",{staticClass:"edit-btn item-btn",on:{click:function(t){return e.$emit("edit",e.overlay)}}},[r("mu-icon",{attrs:{value:"edit"}})],1):e._e(),r("div",{staticClass:"resize-btn item-btn",on:{touchstart:function(t){return t.stopPropagation(),e.resize_start(t)},touchmove:function(t){return t.stopPropagation(),e.resize_move(t)},touchend:function(t){return t.stopPropagation(),e.resize_end(t)}}},[r("mu-icon",{attrs:{value:"code"}})],1)]):e._e(),e.magnetX?r("div",{staticClass:"magnet-x",style:{left:e.magnetX+"px"}}):e._e(),e.magnetY?r("div",{staticClass:"magnet-y",style:{top:e.magnetY+"px"}}):e._e()])},qr=[];r("466d");function Wr(e,t,r){var n=Math.sqrt(Math.pow(e.X-t.X,2)+Math.pow(e.Y-t.Y,2)),i=Math.sqrt(Math.pow(e.X-r.X,2)+Math.pow(e.Y-r.Y,2)),a=Math.sqrt(Math.pow(t.X-r.X,2)+Math.pow(t.Y-r.Y,2)),s=(Math.pow(n,2)+Math.pow(i,2)-Math.pow(a,2))/(2*n*i),o=Math.round(180*Math.acos(s)/Math.PI),c=(t.X-e.X)*(r.Y-t.Y)-(t.Y-e.Y)*(r.X-t.X);return c<0&&(o=360-o),{angle:o,scale:i/n}}function Jr(e){var t=e.offsetLeft,r=e.offsetParent;while(null!=r)t+=r.offsetLeft+(r.offsetWidth-r.clientWidth)/2,r=r.offsetParent;var n=e.offsetTop;r=e.offsetParent;while(null!=r)n+=r.offsetTop+(r.offsetHeight-r.clientHeight)/2,r=r.offsetParent;return{x:t,y:n}}var Kr={props:["time_sec","overlays_in","mosics_in","postermode","edit_filter"],data:function(){return{userModify:!1,overlay:null,loaded:!1,ignoreLoadEvent:!1,url:"",magnetX:null,magnetY:null,box:{width:0,height:0,offsetX:0,offsetY:0,scale:1},style:{left:"50px",top:"50px",width:"100px",height:"100px",transform:"rotate(0deg)"},temp:{pageX:0,pageY:0,offsetX:0,offsetY:0},tempStyle:{x:0,y:0,w:0,h:0,rotate:0}}},watch:{"overlay.url":"load"},computed:{allOverlays:function(){return[].concat(Object(u["a"])(this.overlays_in),Object(u["a"])(this.mosics_in))},hasActive:function(){return!!this.overlay},layouts:function(){var e=this,t=this.allOverlays().map((function(r){var n=Math.hypot(r.w,r.h),i=r.x,a=r.y;r.type!=_.Overlay.Type.Mosic&&(i-=(r.w-n)/2,a-=(r.h-n)/2);var s={id:r.id,type:r.type};s.left=e.box.offsetX+i/e.box.scale,s.top=e.box.offsetY+a/e.box.scale,s.width=r.w/e.box.scale,s.height=r.h/e.box.scale,s.rotate=r.rotate,t.push(s)}));return window.console.log("layouts style"),t}},methods:{updateUISize:function(){this.box.width=this.$refs.mainbox.clientWidth,this.box.height=this.$refs.mainbox.clientHeight;var e=this.box.width/this.box.height,t=U.editlist.dar[0]/U.editlist.dar[1];t>e?(this.box.offsetY=(this.box.height-this.box.width/t)/2,this.box.offsetX=0,this.box.scale=U.editlist.resolution_dar[0]/this.box.width):(this.box.offsetX=(this.box.width-this.box.height*t)/2,this.box.offsetY=0,this.box.scale=U.editlist.resolution_dar[1]/this.box.height),window.console.log("ClipImg update box: "+JSON.stringify(this.box))},boxClick:function(e){var t=this;if(this.hasActive)this.blur();else{var r=Jr(this.$refs.mainbox),n=r.x,i=r.y;n=(e.pageX-n-this.box.offsetX)*this.box.scale,i=(e.pageY-i-this.box.offsetY)*this.box.scale;var a=this.allOverlays.filter((function(e){return e.offset_sec<=t.time_sec&&(0==e.end_sec||e.offset_sec+e.end_sec>=t.time_sec)})).filter((function(e){var t=Math.hypot(e.w,e.h),r=e.x,a=e.y;e.type!=_.Overlay.Type.Mosic&&(r-=(e.w-t)/2,a-=(e.h-t)/2);var s=T(r+e.w/2,a+e.h/2,n,i,-e.rotate);return r<s.x&&a<s.y&&r+e.w>s.x&&a+e.h>s.y}));if(a.length){var s=a.reverse()[0];this.active(s),this.load(),this.$emit("overlayActive",s)}else this.blur()}},blur:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.overlay){t.next=19;break}if(e.overlay.enabled=!0,e.overlay.active=!1,!e.overlay.new){t.next=9;break}return e.overlay.new=!1,t.next=7,e.$emit("change");case 7:t.next=15;break;case 9:if(e.overlay.type!=_.Overlay.Type.Mosic){t.next=13;break}U.editlist.update_mosic(e.overlay),t.next=15;break;case 13:return t.next=15,U.editlist.update_overlay(e.overlay,e.postermode);case 15:e.userModify&&e.createOrUpdateOperateHistory(),r=e.overlay,e.overlay=null,e.$emit("overlayDeactive",r);case 19:case"end":return t.stop()}}),t)})))()},active:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.overlay&&(t.overlay.active=!1),e.active=!0,t.overlay=e,t.userModify=!1,t.overlay.type==_.Overlay.Type.Mosic?(t.loaded=!1,t.url="",U.editlist.update_mosic(t.overlay)):U.editlist.update_overlay(t.overlay,t.postermode),t.updateUI(),!e.url&&e.w<=10&&(t.toCenter(1),t.onChange(!0)),t.$nextTick((function(){t.$refs.main.focus()})),window.console.log("ClipImg active: "+JSON.stringify(t.overlay));case 9:case"end":return r.stop()}}),r)})))()},updateUI:function(){if(this.updateUISize(),this.overlay){window.console.log("layout style");var e=Math.hypot(this.overlay.w,this.overlay.h),t=this.overlay.x,r=this.overlay.y;this.overlay.type!=_.Overlay.Type.Mosic&&(t-=(this.overlay.w-e)/2,r-=(this.overlay.h-e)/2),this.style.left=this.box.offsetX+t/this.box.scale+"px",this.style.top=this.box.offsetY+r/this.box.scale+"px",this.style.width=this.overlay.w/this.box.scale+"px",this.style.height=this.overlay.h/this.box.scale+"px",this.style.transform="rotate("+this.overlay.rotate+"deg)"}},imgLoaded:function(){this.loaded=!0,!this.ignoreLoadEvent&&this.overlay&&this.$refs.img.naturalWidth&&this.$refs.img.naturalHeight&&this.setDefaultSize()},setDefaultSize:function(){var e=!1,t=this.style.width,r=this.$refs.img.naturalWidth/this.$refs.img.naturalHeight;+this.style.width.replace("px","")<10&&(this.toCenter(r),e=!0),this.style.width=r*this.style.height.replace("px","")+"px",Math.ceil(this.style.width+0)!=Math.ceil(t+0)&&(e=!0),e&&this.onChange(!0)},imgLoadError:function(e){window.console.log("img load error ",e)},toCenter:function(e){var t=this.box.width/2-this.box.offsetX,r=this.box.height/2-this.box.offsetY;e>1?r=t/e:t=r*e,this.style.left=(this.box.width-t)/2+"px",this.style.top=(this.box.height-r)/2+"px",this.style.width=t+"px",this.style.height=r+"px"},remove:function(){var e=this;this.overlay.active=!1;var t=this.overlays_in.findIndex((function(t){return t.id==e.overlay.id}));t>=0&&this.overlays_in.splice(t,1),this.mosics_in&&(t=this.mosics_in.findIndex((function(t){return t.id==e.overlay.id})),t>=0&&this.mosics_in.splice(t,1)),this.overlay=null,this.$emit("change")},resize_start:function(e){this.temp.pageX=e.changedTouches[0].pageX,this.temp.pageY=e.changedTouches[0].pageY,this.tempStyle.x=+this.style.left.replace("px",""),this.tempStyle.y=+this.style.top.replace("px",""),this.tempStyle.w=+this.style.width.replace("px",""),this.tempStyle.h=+this.style.height.replace("px","");var t=Jr(this.$refs.main),r=t.x,n=t.y;return this.temp.offsetX=this.temp.pageX-(r-this.tempStyle.x),this.temp.offsetY=this.temp.pageY-(n-this.tempStyle.y),this.tempStyle.rotate=+this.style.transform.match(/\d+/)[0],!0},resize_move_scale:function(e){var t=e.changedTouches[0].pageX-this.temp.pageX,r=e.changedTouches[0].pageY-this.temp.pageY,n=t,i=r;return this.style.left=this.tempStyle.x-n/2+"px",this.style.top=this.tempStyle.y-i/2+"px",this.style.width=this.tempStyle.w+n+"px",this.style.height=this.tempStyle.h+i+"px",this.onChange(),e.preventDefault&&e.preventDefault(),e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),!1},resize_move:function(e){if(this.overlay.type==_.Overlay.Type.Mosic)return this.resize_move_scale(e);var t=e.changedTouches[0].pageX-this.temp.pageX,r=e.changedTouches[0].pageY-this.temp.pageY,n=Wr({X:this.tempStyle.x+this.tempStyle.w/2,Y:this.tempStyle.y+this.tempStyle.h/2},{X:this.temp.offsetX,Y:this.temp.offsetY},{X:this.temp.offsetX+t,Y:this.temp.offsetY+r}),i=n.angle,a=n.scale;i+=this.tempStyle.rotate,this.style.transform="rotate("+i+"deg)";var s=(a-1)*this.tempStyle.w,o=(a-1)*this.tempStyle.h;return this.style.left=this.tempStyle.x-s/2+"px",this.style.top=this.tempStyle.y-o/2+"px",this.style.width=this.tempStyle.w+s+"px",this.style.height=this.tempStyle.h+o+"px",this.onChange(),e.preventDefault&&e.preventDefault(),e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),!1},resize_end:function(){},touchstart:function(e){this.temp.pageX=e.changedTouches[0].pageX,this.temp.pageY=e.changedTouches[0].pageY,this.tempStyle.x=+this.style.left.replace("px",""),this.tempStyle.y=+this.style.top.replace("px","")},touchmove:function(e){var t=this.tempStyle.x+e.changedTouches[0].pageX-this.temp.pageX,r=this.tempStyle.y+e.changedTouches[0].pageY-this.temp.pageY,n=this.createMagnetLayout({left:this.tempStyle.x,top:this.tempStyle.y,width:+this.style.width.replace("px",""),height:+this.style.height.replace("px","")}),i=this.createMagnetLayout({left:t,top:r,width:n.width,height:n.height});return i=this.magnet.check(n,i),t=i.left,r=i.top,this.style.left=t+"px",this.style.top=r+"px",this.onChange(),e.preventDefault&&e.preventDefault(),e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),!1},onChange:function(e){if(this.overlay.x=(+this.style.left.replace("px","")-this.box.offsetX)*this.box.scale,this.overlay.y=(+this.style.top.replace("px","")-this.box.offsetY)*this.box.scale,this.overlay.w=+this.style.width.replace("px","")*this.box.scale,this.overlay.h=+this.style.height.replace("px","")*this.box.scale,this.overlay.rotate=+this.style.transform.match(/\d+/)[0],this.overlay.type!=_.Overlay.Type.Mosic){var t=Math.hypot(this.overlay.w,this.overlay.h);this.overlay.x+=(this.overlay.w-t)/2,this.overlay.y+=(this.overlay.h-t)/2}this.overlay.x=+this.overlay.x.toFixed(2),this.overlay.y=+this.overlay.y.toFixed(2),this.overlay.w=+this.overlay.w.toFixed(2),this.overlay.h=+this.overlay.h.toFixed(2),this.overlay.type==_.Overlay.Type.Mosic?U.editlist.update_mosic(this.overlay):U.editlist.update_overlay(this.overlay,this.postermode),window.console.log("overlay changed: "+this.overlay.x+","+this.overlay.y+","+this.overlay.w+","+this.overlay.h),e?this.createOrUpdateOperateHistory(!0):this.userModify=!0},load:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.overlay||!e.overlay.url){t.next=16;break}return e.ignoreLoadEvent=!0,e.loaded=!1,t.prev=3,t.next=6,pe.Util.getCdvUrl(e.overlay.url);case 6:r=t.sent,t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](3),r=e.overlay.url;case 12:if(e.ignoreLoadEvent=!1,e.overlay){t.next=15;break}return t.abrupt("return");case 15:e.url=r;case 16:case"end":return t.stop()}}),t,null,[[3,9]])})))()},createOrUpdateOperateHistory:function(e){e?this.overlay.type==_.Overlay.Type.Mosic?U.editlist.updateOperateHistory(_.Operate.MosicAdd.Type,this.overlay):this.overlay.type==_.Overlay.Type.Image?U.editlist.updateOperateHistory(_.Operate.ImageAdd.Type,this.overlay):U.editlist.updateOperateHistory(_.Operate.TextAdd.Type,this.overlay):this.overlay.type==_.Overlay.Type.Mosic?U.editlist.createOperateHistory(_.Operate.MosicModify.Type):this.overlay.type==_.Overlay.Type.Image?U.editlist.createOperateHistory(_.Operate.ImageModify.Type):U.editlist.createOperateHistory(_.Operate.TextModify.Type)},createMagnetLayout:function(e){return Object(m["a"])({},e,{right:e.left+e.width,bottom:e.top+e.height})},hideMagnet:function(){this.magnetX=null,this.magnetY=null}},mounted:function(){var e=this,t=this.$refs.mainbox;this.magnet=new ie({span:10,features:["middle","center"],render:function(t,r){e.magnetX=t,e.magnetY=r},dynamicLayouts:function(){return[e.createMagnetLayout({left:0,top:0,width:t.offsetWidth,height:t.offsetHeight})]}})}},Qr=Kr,Zr=(r("604a"),r("bf55"),Object(H["a"])(Qr,Yr,qr,!1,null,"4b248636",null)),en=Zr.exports,tn=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("NativeVideo",{ref:"video",on:{resize:function(t){return e.$emit("resize")},meta:function(t){e.meta(t),e.$emit("render")},playing:function(t){return e.$emit("playing",t)},finished:function(t){return e.$emit("finished")},render:function(t){e.render(t),e.$emit("render")},timeupdate:function(t){return e.$emit("timeupdate",t)}}})},rn=[],nn=r("8785"),an=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"native-video-main",class:{show:e.showscreen}})},sn=[],on=r("6dd8"),cn={Meta:1,Render:2,Timeupdate:3,Finished:4,Error:5,End:6,toString:function(e){for(var t in cn)if(cn[t]==e)return t}},ln={rect:function(){},play:function(){},running:function(){},pause:function(){},stop:function(){},seek:function(){},duration:function(){},position:function(){},mute:function(){},thumb:function(){},refresh:function(){},setEventCallback:function(){}},un={data:function(){return{cmd:"",ready:!1,playing:!1,loaded:!1,keep_screen:!1,lastPosition:0,timeupdateTmr:null}},computed:{showscreen:function(){return!0}},watch:{playing:function(e){this.$emit("playing",e)}},methods:{resize:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.$el.getBoundingClientRect(),t.next=3,e.rect(r);case 3:e.$emit("resize");case 4:case"end":return t.stop()}}),t)})))()},rect:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.width&&e.height){t.next=2;break}return t.abrupt("return");case 2:return window.console.log("ffplay rect: "+[e.x,e.y,e.width,e.height].join(",")),t.next=5,new Promise(ln.rect.bind(null,e.x,e.y,e.width,e.height));case 5:return t.next=7,new Promise((function(e){return setTimeout(e,150)}));case 7:return t.next=9,new Promise(ln.refresh.bind(null));case 9:case"end":return t.stop()}}),t)})))()},load:function(e,t){var r=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,r.stop();case 2:if(r.ready=!1,r.playing=!1,r.loaded=!1,r.keep_screen=e&&t,r.cmd=e,ln.setEventCallback(r.onEvent),!e){n.next=13;break}return n.next=11,new Promise(ln.play.bind(null,e));case 11:return n.next=13,new Promise((function(e,t){var n=5e3,i=setInterval((function(){n-=100,n<0?(clearInterval(i),t()):r.loaded&&(clearInterval(i),e())}),100)}));case 13:case"end":return n.stop()}}),n)})))()},running:function(){return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise(ln.running);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()},resume:function(){this.playing=!0,ln.mute(0),ln.resume()},pause:function(){this.playing=!1,ln.mute(1),ln.pause()},stop:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.playing=!1,t.next=3,new Promise(ln.stop);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))()},seek:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(-1!=e){r.next=4;break}return r.next=3,t.duration();case 3:e=r.sent;case 4:t.lastPosition=e,t.playing=!1,ln.seek(e);case 7:case"end":return r.stop()}}),r)})))()},duration:function(){return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise(ln.duration);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()},position:function(){return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise(ln.position);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()},onResume:function(){ln.refresh()},onEvent:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:window.console.log("got player event: "+cn.toString(e)),r.t0=e,r.next=r.t0===cn.Meta?4:r.t0===cn.Render?11:r.t0===cn.Timeupdate?19:r.t0===cn.Finished?20:r.t0===cn.End?22:25;break;case 4:return r.t1=t,r.next=7,t.duration();case 7:return r.t2=r.sent,r.t3={duration:r.t2},r.t1.$emit.call(r.t1,"meta",r.t3),r.abrupt("break",25);case 11:if(t.loaded){r.next=17;break}return r.next=14,new Promise((function(e){return setTimeout(e,100)}));case 14:return r.next=16,t.resize();case 16:t.loaded=!0;case 17:return t.$emit("render"),r.abrupt("break",25);case 19:return r.abrupt("break",25);case 20:return t.$emit("finished"),r.abrupt("break",25);case 22:return t.loaded=!1,t.$emit("end"),r.abrupt("break",25);case 25:case"end":return r.stop()}}),r)})))()}},mounted:function(){var e=this;w.isCordova()&&(ln=UGCApp.ffplay,this.resize(),document.addEventListener("resume",this.onResume,!1)),this._resizeOb=new on["a"]((function(){e.resize()})),this._resizeOb.observe(this.$el)},beforeDestroy:function(){document.removeEventListener("resume",this.onResume,!1),this._resizeOb.disconnect()}},dn=un,fn=(r("f10f"),Object(H["a"])(dn,an,sn,!1,null,"9e69dbea",null)),pn=fn.exports;function hn(){var e=Object(nn["a"])(["get transfromsource done:",""]);return hn=function(){return e},e}var mn={components:{NativeVideo:pn},props:["editlist","pause","postermode"],data:function(){return{seeking:!1}},watch:{pause:function(e){e?this.$refs.video.pause():this.$refs.video.resume()}},methods:{meta:function(){},doSeek:Zt()((function(e){window.console.log("seek to ".concat(e)),this.$refs.video.seek(e),this.seeking=!1}),1e3),seek:function(e){this.seeking=!0,this.doSeek(e),U.editlist.time_sec=e},render:function(){return Object(i["a"])(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(U.editlist.poster.url){e.next=10;break}return e.next=3,new Promise(UGCApp.ffplay.refresh);case 3:return e.next=5,S.getTempFolder();case 5:return t=e.sent,r=t.nativeURL+"/poster.jpg",e.next=9,new Promise(UGCApp.ffplay.thumb.bind(null,r.replace("file://","")));case 9:U.editlist.poster.url=r+"?"+Math.random();case 10:case"end":return e.stop()}}),e)})))()},reload:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(U.editlist=t.editlist,U.editlist.transform_source){r.next=14;break}return r.prev=2,window.console.log("get transfromsource"),r.next=6,S.getTransformSource();case 6:U.editlist.transform_source=r.sent,window.console.log(hn(),U.editlist.transform_source),window.transform_source=U.editlist.transform_source,r.next=14;break;case 11:r.prev=11,r.t0=r["catch"](2),window.console.log(r.t0);case 14:if(!t.postermode){r.next=19;break}return r.next=17,t.$refs.video.load(U.getPosterPlayerParam(),e);case 17:r.next=21;break;case 19:return r.next=21,t.$refs.video.load(U.getPlayerParam(),e);case 21:case"end":return r.stop()}}),r,null,[[2,11]])})))()}}},vn=mn,gn=Object(H["a"])(vn,tn,rn,!1,null,"05ff2473",null),bn=gn.exports,wn=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"main"},[r("PosterMakerTop",{attrs:{saving:e.saving},on:{close:e.close,save:e.save}}),r("div",{staticClass:"title"},[e._v(" 选择封面 ")]),r("div",{ref:"mainBox",staticClass:"main-box"},[r("PreviewPlayer",{ref:"preview",staticClass:"main-video",attrs:{pause:!0,editlist:e.editlist,postermode:!0},on:{render:e.onPreviewLoaded}}),r("ClipImg",{ref:"overlayEditor",staticClass:"overlay-box",attrs:{postermode:!0,edit_filter:function(t){return t.type==e.Const.Overlay.Type.Text},overlays_in:e.editlist.poster.overlay,mosics_in:[],time_sec:e.editlist.time_sec},on:{change:e.overlayChange,edit:e.overlayEdit}})],1),r("div",{staticClass:"toolBox"},[r("ClipTimeline",{ref:"timeline",attrs:{timelines_in:e.editlist.timelines,playing:!e.player.pause,postermode:!0},on:{timeChange:e.timeChange}}),r("PosterToolTab",{on:{select:e.tabSelect}}),r("ToolDialog",{ref:"toolDlg",attrs:{postermode:!0,editlist:e.editlist},on:{close:e.mainBoxResized,change:e.toolValueChange}})],1)],1)},yn=[],xn=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"main-title"},[r("mu-button",{attrs:{large:"",icon:""},on:{click:function(t){return e.$emit("close")}}},[r("mu-icon",{attrs:{color:"white",size:"36",value:"close"}})],1),r("div",{staticStyle:{width:"100%","text-align":"center"}}),r("mu-button",{attrs:{color:"red",small:"",round:"",disabled:e.saving},on:{click:function(t){return e.$emit("save")}}},[e._v(" "+e._s(e.saving?"保存中...":"保存")+" ")])],1)},_n=[],kn={props:["saving"],data:function(){return{}},methods:{}},Tn=kn,Cn=(r("9388"),Object(H["a"])(Tn,xn,_n,!1,null,"7f26cbd2",null)),Rn=Cn.exports,On=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"poster-tab-main"},[r("mu-button",{attrs:{color:"red",small:"",round:""},on:{click:function(t){return e.$emit("select",e.TabID.AddLocalImage)}}},[r("mu-icon",{attrs:{value:"image",left:""}}),e._v("贴图 ")],1),r("mu-button",{attrs:{color:"red",small:"",round:""},on:{click:function(t){return e.$emit("select",e.TabID.AddText)}}},[r("mu-icon",{attrs:{value:"textsms",left:""}}),e._v("贴字 ")],1)],1)},Pn=[],An={data:function(){return{TabID:ot.TabID}}},In=An,Sn=(r("fc8f"),Object(H["a"])(In,On,Pn,!1,null,"2dc27ce7",null)),Mn=Sn.exports,En={props:["editlist"],components:{PosterMakerTop:Rn,ClipTimeline:Ce,ClipImg:en,PreviewPlayer:bn,PosterToolTab:Mn,ToolDialog:Vr},data:function(){return{Const:_,player:{pause:!0},saving:!1,waitReload:!1,importProgress:-1}},methods:{save:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$refs.overlayEditor.hasActive&&!e.waitReload){t.next=10;break}if(e.saving=!0,!e.$refs.overlayEditor.hasActive){t.next=7;break}if(e.$refs.overlayEditor.blur(),e.waitReload){t.next=7;break}return t.next=7,e.reloadPlayer();case 7:return t.next=9,new Promise((function(t,r){var n=setInterval((function(){e.waitReload||(clearInterval(n),clearTimeout(i),t())}),100),i=setTimeout((function(){clearInterval(n),r()}),5e3)}));case 9:e.saving=!1;case 10:return t.next=12,S.getTempFolder();case 12:return r=t.sent,n="poster_"+Math.random().toString(16).replace("0.","")+".jpg",i=r.nativeURL+"/"+n,t.prev=15,t.next=18,new Promise(UGCApp.ffplay.thumb.bind(null,i.replace("file://","")));case 18:e.editlist.poster.url=i+"?"+Math.random(),e.editlist.poster.rotate=0,e.$emit("close"),e.editlist.createOperateHistory(_.Operate.PosterModify.Type),t.next=27;break;case 24:t.prev=24,t.t0=t["catch"](15),e.$mResToast.error("截取封面失败");case 27:case"end":return t.stop()}}),t,null,[[15,24]])})))()},close:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,new Promise(UGCApp.ffplay.stop);case 2:e.$emit("close");case 3:case"end":return t.stop()}}),t)})))()},onPreviewLoaded:function(){this.waitReload=!1},reloadPlayer:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.waitReload=!0,r.next=3,t.$refs.preview.reload(!e);case 3:case"end":return r.stop()}}),r)})))()},timeChange:function(e){window.console.log("seek:"+e.time_sec),this.player.pause=!0,this.$refs.preview.seek(e.time_sec),this.$refs.timeline.seek(e.time_sec),this.editlist.time_sec=e.time_sec},overlayChange:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.reloadPlayer();case 2:case"end":return t.stop()}}),t)})))()},overlayEdit:function(e){this.$refs.toolDlg.show(ot.TabID.AddText,{height:"auto",overlay:e,operateToolTabId:ot.TabID.ToolSettings})},tabSelect:function(e){e==ot.TabID.AddLocalImage?this.pickImg():this.$refs.toolDlg.show(e)},toolValueChange:function(e){if(e&&e.overlay)return e.overlay.offset_sec=0,e.overlay.end_sec=this.editlist.total_sec,void this.$refs.overlayEditor.active(e.overlay);this.reloadPlayer()},pickImg:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(e,t){return navigator.camera.getPicture(e,t,{sourceType:Camera.PictureSourceType.PHOTOLIBRARY,allowEdit:!1,correctOrientation:!0,mediaType:Camera.MediaType.PICTURE})}));case 3:if(r=t.sent,r){t.next=7;break}return e.reloadPlayer(),t.abrupt("return");case 7:n=e.editlist.add_overlay({url:r,type:_.Overlay.Type.Image},!0),e.toolValueChange({overlay:n}),e.reloadPlayer(),t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](0),e.reloadPlayer();case 15:case"end":return t.stop()}}),t,null,[[0,12]])})))()},mainBoxResized:function(){var e=this;this.$nextTick((function(){e.$refs.overlayEditor.updateUI()}))}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$nextTick((function(){return e.reloadPlayer(!0)})),document.addEventListener("backbutton",e.close,!1);case 2:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:document.removeEventListener("backbutton",e.close,!1);case 1:case"end":return t.stop()}}),t)})))()}},jn=En,$n=(r("d159"),Object(H["a"])(jn,wn,yn,!1,null,"2955d106",null)),Dn=$n.exports,Ln=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"ending-main"},[r("PosterMakerTop",{on:{close:e.close,save:function(t){e.rendering=!0}}}),r("div",{staticClass:"title"},[e._v("设置片尾")]),r("div",{ref:"mainBox",staticClass:"main-box"},[r("div",{staticStyle:{"text-align":"center"}},[r("div",{staticClass:"avatar",on:{click:e.onAvatarClick}},[e.avatarUrl?r("img",{attrs:{src:e.avatarUrl},on:{error:e.avatarLoadError}}):r("span",{staticClass:"material-icons"},[e._v("account_circle")]),r("div",{staticClass:"text"},[e._v("编辑头像")])])]),r("div",{staticClass:"input"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.ending.nickName,expression:"ending.nickName"}],attrs:{placeholder:"请输入昵称信息",maxlength:"18"},domProps:{value:e.ending.nickName},on:{input:function(t){t.target.composing||e.$set(e.ending,"nickName",t.target.value)}}})]),r("div",{staticClass:"input"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.ending.desc,expression:"ending.desc"}],attrs:{placeholder:"请输入描述信息（可为空）",maxlength:"23"},domProps:{value:e.ending.desc},on:{input:function(t){t.target.composing||e.$set(e.ending,"desc",t.target.value)}}})])]),e.rendering?r("EndingRender",{ref:"render",attrs:{"avatar-file":e.ending.avatarFile,"nick-name":e.ending.nickName||e.nickNamePlaceholder,desc:e.ending.desc},on:{rendered:e.save,error:e.renderError}}):e._e(),e.cropping?r("Crop",{ref:"crop",attrs:{src:e.avatarUrl,ratio:1},on:{close:function(t){e.cropping=!1},save:e.cropSave}}):e._e(),r("mu-bottom-sheet",{attrs:{"overlay-close":!0,"esc-press-close":!0,open:e.isMenuOpen},on:{"update:open":function(t){e.isMenuOpen=t}}},[r("mu-list",{on:{"item-click":function(t){e.isMenuOpen=!1}}},[r("mu-sub-header",[e._v("选择")]),r("mu-list-item",{attrs:{button:""},on:{click:e.pickImage}},[r("mu-list-item-action",[r("mu-icon",{attrs:{value:"folder_open",color:"orange"}})],1),r("mu-list-item-title",{staticStyle:{color:"#f44336"}},[e._v("更换一张照片")])],1),r("mu-list-item",{attrs:{button:""},on:{click:e.deleteAvatar}},[r("mu-list-item-action",[r("mu-icon",{attrs:{value:"delete",color:"orange"}})],1),r("mu-list-item-title",[e._v("删除")])],1)],1)],1)],1)},Un=[],Fn=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"crop-main"},[r("PosterMakerTop",{on:{close:e.close,save:e.save}}),r("div",{staticClass:"title"},[e._v("图片裁剪")]),r("div",{ref:"mainBox",staticClass:"main-box"},[r("VueCropper",{ref:"cropper",style:{background:"transparent"},attrs:{img:e.src,outputSize:1,outputType:"png",autoCrop:!0,fixed:!0,fixedNumber:e.fixedNumber,full:!0,original:!0,fixedBox:!0,canMoveBox:!1,mode:"cover"}})],1)],1)},Bn=[],Hn=r("7e79"),Xn={props:["src","ratio"],components:{PosterMakerTop:Rn,VueCropper:Hn["VueCropper"]},computed:{fixedNumber:function(){return[this.ratio,1]}},methods:{close:function(){this.$emit("close")},save:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.$refs.cropper,t.next=3,new Promise(r.getCropBlob.bind(r));case 3:n=t.sent,e.$emit("save",n);case 5:case"end":return t.stop()}}),t)})))()}},mounted:function(){}},zn=Xn,Nn=(r("8253"),Object(H["a"])(zn,Fn,Bn,!1,null,"21603386",null)),Gn=Nn.exports,Vn=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"mask"},[r("div",{staticClass:"loading"},[r("mu-icon",{staticClass:"loading-icon",attrs:{value:"refresh",size:"30"}}),e._v(" 生成片尾中 ")],1),r("canvas",{ref:"canvas",staticClass:"render"})])},Yn=[],qn=(r("cb29"),1e3),Wn=60,Jn="黑体",Kn={props:["avatarFile","nickName","desc"],methods:{render:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=5*Wn,n={marginTop:1.5*-Wn-r/2,size:r,file:e.avatarFile},i={marginTop:0,fontSize:Wn,color:"white",font:Jn,content:e.nickName},a={marginTop:1.5*Wn,fontSize:.8*Wn,color:"#888",font:Jn,content:e.desc},t.prev=4,e.setupCanvas(),e.drawBg(),!e.avatarFile){t.next=10;break}return t.next=10,e.drawImage(n);case 10:e.nickName&&e.drawText(i),e.desc&&e.drawText(a),e.$emit("rendered"),t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](4),e.$emit("error",t.t0);case 18:case"end":return t.stop()}}),t,null,[[4,15]])})))()},drawBg:function(){},drawText:function(e){var t=this.canvasCtx;t.save(),t.font=e.fontSize+"px "+e.font,t.fillStyle=e.color;var r=this.canvas.width/2,n=this.canvas.height/2,i=r,a=n+e.marginTop,s=e.content;t.textAlign="center",t.textBaseline="middle",t.fillText(s,i,a),t.restore()},drawImage:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i,a,s,o,c,l,u,d;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=t.canvasCtx,i=t.canvas.width/2,a=t.canvas.height/2,r.next=5,t.loadImage(e.file);case 5:s=r.sent,o=e.size,c=0,l=0,u=i,d=a+e.marginTop,s.naturalHeight>s.naturalWidth?(l=o,c=o/s.naturalWidth*s.naturalHeight):(l=o/s.naturalHeight*s.naturalWidth,c=o),n.save(),n.beginPath(),n.fillStyle="black",n.arc(u,d,o/2,0,2*Math.PI),n.closePath(),n.fill(),n.globalCompositeOperation="source-in",n.drawImage(s,u-l/2,d-c/2,l,c),n.restore();case 21:case"end":return r.stop()}}),r)})))()},loadImage:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(r,n){var i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,pe.Util.getCdvUrl(e);case 2:if(i=t.sent,"cdvfile:"==location.protocol){t.next=7;break}return t.next=6,S.assetReadAsDataUrl(i);case 6:i=t.sent;case 7:a=new Image,a.onload=r.bind(a,a),a.onerror=n.bind(a,"load image fail"),a.src=i;case 11:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)})))()},setupCanvas:function(){this.canvas.width=qn,this.canvas.height=qn},getDataPng:function(){return this.$refs.canvas.toDataURL()},getBlob:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=null,t.next=3,new Promise((function(t){e.$refs.canvas.toBlob(t)}));case 3:return r=t.sent,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})))()}},mounted:function(){this.canvas=this.$refs.canvas,this.canvasCtx=this.$refs.canvas.getContext("2d"),this.render()}},Qn=Kn,Zn=(r("5c4b"),Object(H["a"])(Qn,Vn,Yn,!1,null,"37a257de",null)),ei=Zn.exports,ti={components:{PosterMakerTop:Rn,EndingRender:ei,Crop:Gn},data:function(){return{rendering:!1,editlist:null,avatarUrl:null,isMenuOpen:!1,cropping:!1,nickNamePlaceholder:"请输入昵称信息",ending:{avatarFile:"",nickName:"",desc:""}}},methods:{avatarLoadError:function(){this.avatarUrl=""},onAvatarClick:function(){this.ending.avatarFile?this.isMenuOpen=!0:this.pickImage()},deleteAvatar:function(){this.ending.avatarFile="",this.ending.url="",this.avatarUrl=""},pickImage:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(e,t){return navigator.camera.getPicture(e,t,{sourceType:Camera.PictureSourceType.PHOTOLIBRARY,allowEdit:!1,mediaType:Camera.MediaType.PICTURE,destinationType:Camera.DestinationType.NATIVE_URI})}));case 2:if(r=t.sent,r){t.next=5;break}return t.abrupt("return");case 5:e.ending.avatarFile=r,e.loadImage(),e.cropping=!0;case 8:case"end":return t.stop()}}),t)})))()},save:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i,a,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.rendering=!1,r={avatarFile:e.ending.avatarFile,nickName:e.ending.nickName,desc:e.ending.desc,url:null},S.saveLastEnding(r),t.next=5,e.$refs.render.getBlob();case 5:return n=t.sent,t.next=8,S.getTempFolder();case 8:return i=t.sent,a=i.name+"/endingImage_"+Math.random().toString(16).replace("0.","")+".png",t.next=12,e.createCacheFile(n,a);case 12:s=t.sent,r.url=s,window.console.log("created ending file: "+s),o=U.editlist.timelines.find((function(e){return e.ending})),o?Object.assign(o,r):U.editlist.add_timelines([Object(m["a"])({start_sec:0,end_sec:2,total_sec:2,ending:!0},r)]),e.$emit("close"),U.editlist.createOperateHistory(_.Operate.EndingModify.Type);case 19:case"end":return t.stop()}}),t)})))()},renderError:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.rendering=!1,t.$mResToast.error("生成失败"),window.console.error(e);case 3:case"end":return r.stop()}}),r)})))()},close:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,new Promise(UGCApp.ffplay.stop);case 2:e.$emit("close");case 3:case"end":return t.stop()}}),t)})))()},loadImage:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.ending&&e.ending.avatarFile){t.next=2;break}return t.abrupt("return");case 2:return r="",t.prev=3,t.next=6,pe.Util.getCdvUrl(e.ending.avatarFile);case 6:if(r=t.sent,"cdvfile:"==location.protocol){t.next=11;break}return t.next=10,S.assetReadAsDataUrl(r);case 10:r=t.sent;case 11:t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](3),r=e.ending.avatarFile;case 16:e.avatarUrl=r;case 17:case"end":return t.stop()}}),t,null,[[3,13]])})))()},cropSave:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,S.getTempFolder();case 2:return n=r.sent,i=n.name+"/avatarCropImage_"+Math.random().toString(16).replace("0.","")+".png",r.next=6,t.createCacheFile(e,i);case 6:return a=r.sent,t.ending.avatarFile=a,r.next=10,t.loadImage();case 10:t.cropping=!1;case 11:case"end":return r.stop()}}),r)})))()},createCacheFile:function(e,t){return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(window.requestFileSystem){r.next=2;break}return r.abrupt("return",URL.createObjectURL(e));case 2:return r.next=4,S.filesystem();case 4:return n=r.sent,r.next=7,new Promise((function(e,r){n.root.getFile(t,{create:!0,exclusive:!1},e,r)}));case 7:return i=r.sent,r.next=10,new Promise((function(e,t){i.createWriter(e,t)}));case 10:return a=r.sent,r.next=13,new Promise((function(t,r){a.onwriteend=t,a.onerror=r,a.write(e)}));case 13:return r.abrupt("return",i.nativeURL);case 14:case"end":return r.stop()}}),r)})))()}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=U.editlist.timelines.find((function(e){return e.ending})),r||(r=S.getLastEnding()),r&&(e.ending=Object(m["a"])({},r),e.loadImage()),document.addEventListener("backbutton",e.close,!1);case 4:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:document.removeEventListener("backbutton",e.close,!1);case 1:case"end":return t.stop()}}),t)})))()}},ri=ti,ni=(r("8c36"),Object(H["a"])(ri,Ln,Un,!1,null,"613b9c1a",null)),ii=ni.exports,ai=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.output.desSrc?r("div",{staticClass:"exporter-main"},[r("div",{staticClass:"main-title"},[r("mu-button",{attrs:{large:"",icon:""},on:{click:e.cancel}},[r("mu-icon",{attrs:{color:"white",size:"36",value:"close"}})],1),r("mu-button",{staticClass:"btn-done",attrs:{large:"",icon:""},on:{click:e.done}},[r("mu-icon",{attrs:{color:"white",size:"36",value:"done"}})],1)],1),r("div",{staticClass:"title"},[r("mu-icon",{attrs:{value:"check"}}),e._v(" 导出完成 "),r("span",[e._v("视频已保存到系统相册")])],1),r("div",{staticClass:"content"},[r("video",{attrs:{src:e.output.desSrc,controls:""}})]),r("div",{staticClass:"bottom"})]):r("div",{staticClass:"exporter-main"},[r("div",{staticClass:"main-title"},[r("mu-button",{attrs:{large:"",icon:""},on:{click:e.cancel}},[r("mu-icon",{attrs:{color:"white",size:"36",value:"close"}})],1)],1),e._m(0),r("div",{staticClass:"content"},[r("img",{attrs:{src:e.thumbUrl}}),r("div",{staticClass:"progress"},[r("mu-circular-progress",{staticClass:"progress-item progress-slave",attrs:{mode:"determinate",color:"rgba(255,255,255,0.3",value:100,"stroke-width":10,size:105}}),r("mu-circular-progress",{staticClass:"progress-item progress-master",attrs:{mode:"determinate",color:"red",value:e.exportProgress,"stroke-width":5,size:100}}),r("div",{staticClass:"progress-item"},[e._v(" "+e._s(e.exportProgress)+"% ")])],1)]),r("div",{staticClass:"bottom"})])},si=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"title"},[e._v(" 导出中 "),r("span",[e._v("期间请不要切换程序")])])}],oi={data:function(){return{thumbUrl:"",exportProgress:0,output:{desSrc:""},error:""}},methods:{begin:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i,a,s,o,c,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,U.editlist.getConfig();case 2:return r=t.sent,r.output||(r.output=cordova.file.cacheDirectory+"output.mp4",U.editlist.setConfig(r)),n=r.output.replace("file://",""),t.next=7,new Promise(UGCApp.ffmpeg.start.bind(null,U.getExportParam(n)));case 7:if(i=t.sent,!i){t.next=11;break}return e.error="导出未能开始："+i,t.abrupt("return");case 11:return a=U.editlist.total_sec,s=0,window.console.log("total_sec: "+a),t.next=16,new Promise((function(e){setTimeout(e,1e3)}));case 16:return t.next=18,new Promise(UGCApp.ffmpeg.status);case 18:return o=t.sent,t.next=21,new Promise(UGCApp.ffmpeg.progress);case 21:return c=t.sent,s=c.pts/1e3,e.exportProgress=+Math.max(0,Math.min(100,s/a*100)).toFixed(1),t.next=26,new Promise((function(e){setTimeout(e,200)}));case 26:window.console.log("ffmpeg progress:"+c.pts+", status:"+o);case 27:if(1==o){t.next=16;break}case 28:return t.next=30,new Promise(UGCApp.ffmpeg.report);case 30:if(l=t.sent,0!=l){t.next=47;break}if(!w.isIOS()){t.next=40;break}return t.next=35,new Promise((function(e,t){return UGCApp.sendToDCIM(n,e,t)}));case 35:return t.next=37,pe.Util.getCdvUrl(n);case 37:e.output.desSrc=t.sent.replace("cdvfile:","http:"),t.next=45;break;case 40:return t.next=42,new Promise((function(e,t){return UGCApp.sendToDCIM(n,e,t)}));case 42:return t.next=44,pe.Util.getCdvUrl(n);case 44:e.output.desSrc=t.sent;case 45:t.next=48;break;case 47:e.error="导出失败";case 48:case"end":return t.stop()}}),t)})))()},cancel:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,new Promise(UGCApp.ffmpeg.cancel);case 2:e.$emit("close");case 3:case"end":return t.stop()}}),t)})))()},done:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,U.editlist.getConfig();case 2:if(r=t.sent,!r.output_thumb){t.next=13;break}return t.prev=4,t.next=7,e.copyPosterTo(r.output_thumb);case 7:t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](4),window.console.log("copy poster: ",t.t0),e.error="导出封面失败";case 13:return t.next=15,S.clearTempFiles();case 15:return t.next=17,new Promise(UGCApp.done.bind(UGCApp,{statusCode:UGCApp.StatusCode.Ok,message:e.error||"导出成功",output:r.output,output_thumb:r.output_thumb||U.editlist.poster.url}));case 17:case"end":return t.stop()}}),t,null,[[4,9]])})))()},copyPosterTo:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=U.editlist.poster.url,"/"==r[0]&&(r="file://"+r),t.next=4,new Promise(resolveLocalFileSystemURL.bind(window,"file:///"));case 4:return n=t.sent,t.next=7,new Promise(n.getFile.bind(n,e,{create:!0}));case 7:return i=t.sent,t.next=10,new Promise(i.getParent.bind(i));case 10:return a=t.sent,t.next=13,new Promise(resolveLocalFileSystemURL.bind(window,r));case 13:return s=t.sent,t.next=16,new Promise(s.copyTo.bind(s,a,i.name));case 16:return t.abrupt("return",t.sent);case 17:case"end":return t.stop()}}),t)})))()}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!U.editlist.poster.url){t.next=7;break}return t.next=3,pe.Util.getCdvUrl(U.editlist.poster.url);case 3:t.t0=t.sent,t.t1=t.t0+"?",t.t2=Math.random(),e.thumbUrl=t.t1+t.t2;case 7:document.addEventListener("backbutton",e.cancel,!1),e.begin();case 9:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:document.removeEventListener("backbutton",e.cancel,!1);case 1:case"end":return t.stop()}}),t)})))()}},ci=oi,li=(r("8538"),Object(H["a"])(ci,ai,si,!1,null,"4e0ded93",null)),ui=li.exports,di=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("mu-bottom-sheet",{attrs:{"overlay-close":e.editlist.timelines.length>0,"esc-press-close":e.editlist.timelines.length>0,open:e.isopen},on:{"update:open":function(t){e.isopen=t}}},[r("mu-list",{on:{"item-click":e.close}},[r("mu-sub-header",[e._v("选择")]),r("mu-list-item",{attrs:{button:""},on:{click:e.importFile}},[r("mu-list-item-action",[r("mu-icon",{attrs:{value:"folder_open",color:"orange"}})],1),r("mu-list-item-title",[e._v("从文件导入")])],1),r("mu-list-item",{attrs:{button:""},on:{click:e.captureFile}},[r("mu-list-item-action",[r("mu-icon",{attrs:{value:"photo_camera",color:"orange"}})],1),r("mu-list-item-title",[e._v("拍摄")])],1)],1)],1)},fi=[],pi={props:["editlist"],data:function(){return{isopen:!1}},methods:{open:function(){this.isopen=!0},close:function(){this.isopen=!1},importFile:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isIOS()){t.next=15;break}return t.prev=1,t.next=4,new Promise(MediaPicker.getMedias.bind(MediaPicker,{selectMode:102,maxSelectCount:1}));case 4:r=t.sent,window.console.log(r),e.$emit("select",r),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),window.console.log(t.t0),e.editlist.timelines.length||e.open();case 13:t.next=26;break;case 15:return t.prev=15,t.next=18,new Promise((function(e,t){return navigator.camera.getPicture(e,t,{sourceType:Camera.PictureSourceType.PHOTOLIBRARY,allowEdit:!0,mediaType:Camera.MediaType.VIDEO})}));case 18:n=t.sent,e.$emit("select",[{uri:n}]),t.next=26;break;case 22:t.prev=22,t.t1=t["catch"](15),window.console.log(t.t1),e.editlist.timelines.length||e.open();case 26:case"end":return t.stop()}}),t,null,[[1,9],[15,22]])})))()},captureFile:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,!e.isAndroid()){t.next=12;break}return t.next=4,new Promise((function(e,t){return UGCApp.captureVideo(e,t,{duration:_.CaptureVideo.Duration})}));case 4:if(r=t.sent,window.console.log(r),r.path){t.next=9;break}return e.$mResToast.error("选择失败"),t.abrupt("return");case 9:e.$emit("select",[{uri:r.path}]),t.next=17;break;case 12:return t.next=14,new Promise((function(e,t){return navigator.device.capture.captureVideo(e,t,{duration:_.CaptureVideo.Duration})}));case 14:n=t.sent,window.console.log(n),e.$emit("select",n.map((function(e){return{uri:e.fullPath}})));case 17:t.next=23;break;case 19:t.prev=19,t.t0=t["catch"](0),window.console.log(t.t0),e.editlist.timelines.length||e.open();case 23:case"end":return t.stop()}}),t,null,[[0,19]])})))()},importProgress:function(e){"progress"==e.status&&this.$emit("progress",e.index)}},mounted:function(){this.isIOS()&&document.addEventListener("MediaPicker.CompressVideoEvent",this.importProgress)},beforeDestroy:function(){this.isIOS()&&document.removeEventListener("MediaPicker.CompressVideoEvent",this.importProgress)}},hi=pi,mi=(r("d52b"),Object(H["a"])(hi,di,fi,!1,null,"3cfa8a02",null)),vi=mi.exports;window.clipModel=pe;var gi=window.console,bi={components:{ClipTop:z,ClipTimeline:Ce,PlayerController:Me,ToolTab:ot,ToolDialog:Vr,ClipImg:en,PreviewPlayer:bn,PosterMaker:Dn,EndingMaker:ii,Exporter:ui,Importer:vi},data:function(){return{player:{pause:!0},editlist:U.editlist,showOverlay:!1,overlayType:!1,showAMix:!1,showTooltab:!0,showPlayerController:!0,showTimeline:!0,activeItem:null,makePoster:!1,makeEnding:!1,doExport:!1,importProgress:-1}},methods:{reloadPlayer:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$refs.preview.reload(!e);case 2:case"end":return r.stop()}}),r)})))()},seekPlayer:function(e){this.$refs.preview.seek(e),this.$refs.timeline.seek(e)},playerFinished:function(){gi.log("finished"),this.player.pause=!0},timeChange:function(e){this.player.pause=!0,this.seekPlayer(e.time_sec)},timelinesChange:function(e){this.editlist.timelines=e,this.editlist.createOperateHistory(_.Operate.VideoTimeModify.Type)},amixChange:function(e){this.editlist.update_amix(e),this.editlist.createOperateHistory(_.Operate.AudioEffectTimeModify.Type)},amixActive:function(e){this.activeItem=e},overlayChange:function(e){this.$refs.overlayEditor.active(e),this.editlist.update_overlay(e),e.type==_.Overlay.Type.Image?this.editlist.createOperateHistory(_.Operate.ImageTimeModify.Type):e.type==_.Overlay.Type.Text?this.editlist.createOperateHistory(_.Operate.TextTimeModify.Type):e.type==_.Overlay.Type.Mosic&&this.editlist.createOperateHistory(_.Operate.MosicTimeModify.Type)},overlayActive:function(e){e?this.$refs.overlayEditor.active(e):(this.$refs.overlayEditor.blur(),this.activeItem&&this.activeItem.active&&(this.activeItem.active=!1)),this.activeItem=e},overlayDeactive:function(){this.activeItem=null},blankClicked:function(){this.$refs.overlayEditor.blur()},playerControllerEvent:function(e){var t,r,n=this;switch(e.eventID){case Me.EventID.Play:!this.$refs.preview.seeking&&this.$refs.preview.$refs.video.loaded&&(this.player.pause=!1);break;case Me.EventID.Pause:this.player.pause=!0;break;case Me.EventID.SeekBegin:if(this.player.pause=!0,t=this.editlist.cur_timeline,!t&&this.editlist.timelines.length&&(t=this.editlist.timelines[this.editlist.timelines.length-1]),r=k(this.editlist.time_sec),t){if(r==k(t.offset_sec)){var a=Math.max(0,this.editlist.timelines.findIndex((function(e){return e.id==t.id}))-1);t=this.editlist.timelines[a]}Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return setTimeout(e,100)}));case 2:n.seekPlayer(t.offset_sec);case 3:case"end":return e.stop()}}),e)})))()}break;case Me.EventID.SeekEnd:if(this.player.pause=!0,t=this.editlist.cur_timeline,r=k(this.editlist.time_sec),t){if(r==k(t.offset_sec+t.end_sec-t.start_sec)){var s=this.editlist.timelines.indexOf(t)+1;s<this.editlist.timelines.length&&(t=this.editlist.timelines[s])}Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return setTimeout(e,100)}));case 2:n.seekPlayer(t.offset_sec+t.end_sec-t.start_sec);case 3:case"end":return e.stop()}}),e)})))()}break;case Me.EventID.Undo:this.undo();break;case Me.EventID.AspectRatio:this.$refs.toolDlg.show(ot.TabID.AspectRatio,{height:this.$refs.toolTab.clientHeight+"px"});break}},toolBeforeChange:function(){this.player.pause=!0},toolValueChange:function(e,t){if(t==ot.TabID.AspectRatio&&(this.player.pause=!0),e&&e.overlay)return this.overlayActive(e.overlay),void(e.overlay.type==_.Overlay.Type.Text&&this.reloadPlayer());this.reloadPlayer()},clipImgChange:function(){this.reloadPlayer()},tabSelect:function(e){var t=this,r=ot.TabID;switch(gi.log(r),e){case ot.TabID.ImageTab:this.showOverlay=!0,this.overlayType=_.Overlay.Type.Image|_.Overlay.Type.Mosic,this.showAMix=!1;break;case ot.TabID.TextTab:this.showOverlay=!0,this.overlayType=_.Overlay.Type.Text,this.showAMix=!1;break;case ot.TabID.AudioTab:this.showAMix=!0,this.showOverlay=!1;break;case ot.TabID.OtherTab:this.showOverlay=!1,this.showAMix=!1;break;case ot.TabID.ToolEdit:case ot.TabID.ToolTemplate:case ot.TabID.ToolSettings:this.activeItem.type==_.Overlay.Type.Text&&(this.showTimeline=!1,this.showPlayerController=!1,this.$refs.toolDlg.show(ot.TabID.AddText,{height:"auto",overlay:this.activeItem,operateToolTabId:e}));break;case ot.TabID.ToolDone:this.activeItem.active=!1,this.activeItem=null,this.$refs.overlayEditor.blur();break;case ot.TabID.ToolRemove:this.editlist.remove_overlay(this.activeItem.id),this.activeItem.active=!1,this.$refs.overlayEditor.blur(),this.activeItem=null,this.reloadPlayer();break;case ot.TabID.VideoAdd:this.pickVideo();break;case ot.TabID.VideoRemove:var n=this.editlist.timelines,i=n.findIndex((function(e){return e.active}));if(-1==i){var a=this.editlist.cur_timeline;i=!a&&n.length?0:n.findIndex((function(e){return e.id==a.id}))}if(i>=0){var s=n[i];n.splice(i,1),[0].concat(Object(u["a"])(n)).reduce((function(e,t){return t.offset_sec=e,t.offset_sec+t.end_sec-t.start_sec})),[].concat(Object(u["a"])(this.editlist.amix),Object(u["a"])(this.editlist.overlay)).forEach((function(e){var r=k(s.offset_sec)<=k(e.offset_sec)&&k(e.offset_sec)<k(s.offset_sec+s.end_sec-s.start_sec);r&&t.editlist.remove_overlay(e.id)})),this.reloadPlayer(),0!=i&&n.length?this.seekPlayer(n[i-1].offset_sec+n[i-1].end_sec-n[i-1].start_sec):this.seekPlayer(0),this.editlist.createOperateHistory(_.Operate.VideoRemove.Type,s.id)}0==n.length&&(this.editlist.poster.url="",this.editlist.poster.overlay.splice(0,-1),this.pickVideo());break;case ot.TabID.VideoSplit:this.player.pause=!0;var o=this.editlist.timelines,c=-1,l=k(this.$refs.timeline.time_sec);if(o.forEach((function(e,t){k(e.offset_sec)<l&&k(e.end_sec-e.start_sec+e.offset_sec)>l&&(c=t)})),c>=0){var d=o[c],p=f()(!0,{},d,{id:this.editlist.timelineId});if(d.active=!1,l-d.offset_sec<this.editlist.video_min_sec||d.offset_sec+d.end_sec-d.start_sec-l<this.editlist.video_min_sec)return void this.$mResToast.error("时长小于1秒，无法分割");d.end_sec=p.start_sec=l-d.offset_sec+d.start_sec,o.splice(c+1,0,p),o.reduce((function(e,t,r){return 1==r&&(e=e.end_sec-e.start_sec),t.offset_sec=e,t.offset_sec+t.end_sec-t.start_sec})),this.$refs.timeline.refreshUI(),this.reloadPlayer(),this.editlist.createOperateHistory(_.Operate.VideoSplit.Type)}else this.$mResToast.error("时长小于1秒，无法分割");break;case ot.TabID.VideoRotate:var h=this.editlist.timelines,m=-1;if(h.forEach((function(e,r){e.offset_sec<=t.editlist.time_sec&&e.end_sec-e.start_sec+e.offset_sec>t.editlist.time_sec&&(m=r)})),m>=0){var v=h[m];0==m&&(this.editlist.poster.rotate+=270,this.editlist.poster.rotate%=360,this.rotatePosterOverlay(v,270)),v.rotate+=270,v.rotate%=360,this.reloadPlayer(),this.editlist.createOperateHistory(_.Operate.VideoRotate.Type)}break;case ot.TabID.VideoVFlip:var g=this.editlist.timelines,b=-1;if(g.forEach((function(e,r){e.offset_sec<t.editlist.time_sec&&e.end_sec-e.start_sec+e.offset_sec>t.editlist.time_sec&&(b=r)})),b>=0){var w=g[b];w.vflip=!w.vflip,this.reloadPlayer(),this.editlist.createOperateHistory(_.Operate.VideoVFlip.Type)}break;case ot.TabID.VideoHFlip:var y=this.editlist.timelines,x=-1;if(y.forEach((function(e,r){e.offset_sec<t.editlist.time_sec&&e.end_sec-e.start_sec+e.offset_sec>t.editlist.time_sec&&(x=r)})),x>=0){var T=y[x];T.hflip=!T.hflip,this.reloadPlayer(),this.editlist.createOperateHistory(_.Operate.VideoHFlip.Type)}break;case ot.TabID.AddLocalImage:this.pickImg();break;case ot.TabID.Mosic:this.addMosic();break;default:var C;switch(e){case ot.TabID.Face:case ot.TabID.AudioBase:C=this.$refs.toolTab.clientHeight+"px";break;case ot.TabID.AddText:this.showTimeline=!1,this.showPlayerController=!1,C="auto";break;case ot.TabID.BGM:C=this.$el.clientHeight/2+"px";break;default:C=this.$refs.toolBox.clientHeight+"px"}this.$refs.toolDlg.show(e,{height:C})}e!=ot.TabID.ImageTab&&e!=ot.TabID.TextTab&&e!=ot.TabID.AudioTab&&e!=ot.TabID.OtherTab||this.overlayActive(null)},reset:function(){},pickImg:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(e,t){return navigator.camera.getPicture(e,t,{sourceType:Camera.PictureSourceType.PHOTOLIBRARY,allowEdit:!1,correctOrientation:!0,mediaType:Camera.MediaType.PICTURE})}));case 2:if(r=t.sent,r){t.next=5;break}return t.abrupt("return");case 5:n=e.editlist.add_overlay({url:r,type:_.Overlay.Type.Image}),e.$refs.overlayEditor.active(n),e.overlayActive(n),e.editlist.createOperateHistory(_.Operate.ImageAdd.Type);case 9:case"end":return t.stop()}}),t)})))()},importFileSelect:function(e,t,r){var n=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var s,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=n.editlist.total_sec,a.next=3,Promise.all(e.map(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var i,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t.uri,e.next=3,new Promise(UGCApp.ffmpeg.format.bind(null,i));case 3:if(a=e.sent,a.duration){e.next=7;break}return r&&n.$mResToast.error("导入失败，文件可能不存在或没有权限"),e.abrupt("return");case 7:return(90+a.video.rotate)%180==0&&(s=a.video.width,a.video.width=a.video.height,a.video.height=s),e.abrupt("return",{url:i,src_rotate:a.video.rotate,width:a.video.width,height:a.video.height,start_sec:0,end_sec:a.duration/1e3,total_sec:a.duration/1e3});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:if(o=a.sent,o=o.filter((function(e){return e})),0!=o.length||r){a.next=8;break}return setTimeout((function(){return n.importFileSelect(e,t,!0)}),500),a.abrupt("return");case 8:if(o=o.filter((function(e){return e})),o.length){a.next=11;break}return a.abrupt("return");case 11:return n.editlist.add_timelines(o),t||o.forEach((function(e){n.editlist.createOperateHistory(_.Operate.VideoAdd.Type,e.id)})),a.next=15,n.$refs.preview.reload();case 15:n.seekPlayer(s),n.importProgress=-1,n.editlist.timelines.length||n.pickVideo();case 18:case"end":return a.stop()}}),a)})))()},pickVideo:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$refs.importer.open();case 1:case"end":return t.stop()}}),t)})))()},mainBoxResized:function(){var e=this;this.$nextTick((function(){e.$refs.overlayEditor.updateUI()}))},addMosic:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.editlist.mosic_source){t.next=4;break}return t.next=3,S.getMosicSource();case 3:e.editlist.mosic_source=t.sent;case 4:return r=e.editlist.add_mosic(),t.next=7,e.reloadPlayer();case 7:e.activeItem=r,e.$refs.overlayEditor.active(r),e.$refs.overlayEditor.toCenter(1),e.editlist.createOperateHistory(_.Operate.MosicAdd.Type,r.id);case 11:case"end":return t.stop()}}),t)})))()},undo:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,i,a,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.editlist.undoOperateHistory(),!r){t.next=33;break}n=r.undo,i=r.restore,a=function(e,t){e.splice(0,e.length),t.forEach((function(t){return e.push(f()(!0,{},t))}))},a(e.editlist.timelines,i.timelines),a(e.editlist.amix,i.amix),a(e.editlist.overlay,i.overlay),a(e.editlist.mosic,i.mosic),a(e.editlist.filter,i.filter),e.editlist.face=i.face,e.editlist.video=i.video,e.editlist.audio=i.audio,e.editlist.bgm=i.bgm,e.editlist.poster=i.poster,s=Object.keys(_.Operate).find((function(e){return _.Operate[e].Type==n.operateType})),t.t0=n.operateType,t.next=t.t0===_.Operate.VideoRemove.Type?19:23;break;case 19:return o=e.editlist.timelines.find((function(e){return n.targetId==e.id})),o.active=!0,e.seekPlayer(o.offset_sec),t.abrupt("break",23);case 23:e.editlist.time_sec>e.editlist.total_sec&&e.seekPlayer(e.editlist.total_sec),e.player.pause=!0,e.$refs.overlayEditor.blur(),e.activeItem&&(e.activeItem.active=!1),e.reloadPlayer(),e.$mResToast.success("撤销 "+_.Operate[s].Name),window.console.log("undo: ",i),e.editlist.timelines.length||e.pickVideo(),t.next=34;break;case 33:e.$mResToast.success("没有可撤销的内容了！");case 34:case"end":return t.stop()}}),t)})))()},rotatePosterOverlay:function(e,t){var r=this.editlist.getRotatedWidth(e),n=r,i=0;this.editlist.poster.overlay.forEach((function(e){var a=Math.hypot(e.w,e.h),s=e.x-(e.w-a)/2,o=e.y-(e.h-a)/2,c=T(n,i,s,o,t),l=T(n,i,s+e.w,o+e.h,t);n=(c.x+l.x)/2,i=(c.y+l.y)/2,c=T(n,i,c.x,c.y,-t),c.x-=r,e.x=c.x+(e.w-a)/2,e.y=c.y+(e.h-a)/2,e.rotate+=t,e.rotate%=360}))}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(window.UGCApp){t.next=3;break}return gi.log("no ugcapp"),t.abrupt("return");case 3:return t.next=5,e.editlist.getConfig();case 5:if(r=t.sent,!r.input){t.next=11;break}return t.next=9,e.importFileSelect([{uri:r.input}],!0);case 9:t.next=12;break;case 11:e.pickVideo((function(t){if(gi.log(t),"progress"==t.status){var r=t.index;e.$data.importProgress=r}else e.$data.importProgress=-1}));case 12:e.editlist.createOperateHistory(_.Operate.Init.Type);case 13:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}},wi=bi,yi=(r("4988"),Object(H["a"])(wi,c,l,!1,null,"3e2e709d",null)),xi=yi.exports,_i={name:"app",components:{Clip:xi}},ki=_i,Ti=(r("034f"),Object(H["a"])(ki,s,o,!1,null,null,null)),Ci=Ti.exports,Ri=r("30f4"),Oi=(r("d6f6"),r("480c"),r("a7ab"),r("7e1c")),Pi=r.n(Oi);a["default"].use(Pi.a),a["default"].use(Ri["a"]),a["default"].config.productionTip=!1,a["default"].prototype.isCordova=w.isCordova,a["default"].prototype.isIOS=w.isIOS,a["default"].prototype.isAndroid=w.isAndroid,a["default"].prototype.isMobile=function(){return w.isIOS()||w.isAndroid()},a["default"].prototype.isPortrait=w.isPortrait,Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,w.init();case 2:new a["default"]({render:function(e){return e(Ci)}}).$mount("#app");case 3:case"end":return e.stop()}}),e)})))()},"5c4b":function(e,t,r){"use strict";var n=r("c9a3"),i=r.n(n);i.a},"5cc1":function(e,t,r){},"5e14":function(e,t,r){},"604a":function(e,t,r){"use strict";var n=r("4716"),i=r.n(n);i.a},"60ca":function(e,t,r){},6901:function(e,t,r){"use strict";var n=r("3210"),i=r.n(n);i.a},"78e0":function(e,t,r){"use strict";var n=r("c045"),i=r.n(n);i.a},7953:function(e,t,r){"use strict";var n=r("60ca"),i=r.n(n);i.a},"7b23":function(e,t,r){},8253:function(e,t,r){"use strict";var n=r("d7d1"),i=r.n(n);i.a},"83a6":function(e,t,r){"use strict";var n=r("d017"),i=r.n(n);i.a},8538:function(e,t,r){"use strict";var n=r("3d70"),i=r.n(n);i.a},"85ec":function(e,t,r){},8632:function(e,t,r){},"8c36":function(e,t,r){"use strict";var n=r("b0c9"),i=r.n(n);i.a},"8efa":function(e,t,r){},9388:function(e,t,r){"use strict";var n=r("c91f"),i=r.n(n);i.a},9428:function(e,t,r){},"9ab9":function(e,t,r){"use strict";var n=r("d492"),i=r.n(n);i.a},aa9c:function(e,t,r){"use strict";var n=r("7b23"),i=r.n(n);i.a},ae1b:function(e,t,r){},ae1f:function(e,t,r){},af15:function(e,t,r){},b0c9:function(e,t,r){},b164:function(e,t,r){"use strict";var n=r("3be7"),i=r.n(n);i.a},b312:function(e,t,r){},bf55:function(e,t,r){"use strict";var n=r("3d69"),i=r.n(n);i.a},c045:function(e,t,r){},c525:function(e,t,r){"use strict";var n=r("af15"),i=r.n(n);i.a},c5b1:function(e,t,r){"use strict";var n=r("f70a"),i=r.n(n);i.a},c6d9:function(e,t,r){},c91f:function(e,t,r){},c9a3:function(e,t,r){},c9dc:function(e,t,r){"use strict";var n=r("f0b4"),i=r.n(n);i.a},d017:function(e,t,r){},d159:function(e,t,r){"use strict";var n=r("fab4"),i=r.n(n);i.a},d1a5:function(e,t,r){},d213:function(e,t,r){"use strict";var n=r("8632"),i=r.n(n);i.a},d492:function(e,t,r){},d52b:function(e,t,r){"use strict";var n=r("e31e"),i=r.n(n);i.a},d7d1:function(e,t,r){},df05:function(e,t,r){"use strict";var n=r("b312"),i=r.n(n);i.a},e25e:function(e,t,r){},e31e:function(e,t,r){},e65f:function(e,t,r){"use strict";var n=r("1541"),i=r.n(n);i.a},e99d:function(e,t,r){},efa5:function(e,t,r){},f0b4:function(e,t,r){},f10f:function(e,t,r){"use strict";var n=r("ae1b"),i=r.n(n);i.a},f6e1:function(e,t,r){"use strict";var n=r("e25e"),i=r.n(n);i.a},f70a:function(e,t,r){},fab4:function(e,t,r){},fab43:function(e,t,r){"use strict";var n=r("d1a5"),i=r.n(n);i.a},fc8f:function(e,t,r){"use strict";var n=r("2a0d"),i=r.n(n);i.a}});
//# sourceMappingURL=app.ec82bb73.js.map